<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Docker架构简介  命令详解 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Docker架构简介  命令详解" />
<meta property="og:description" content="1.1、Docker的介绍
Docker是一个开源的应用容器引擎，使用Go语言开发，基于Linux内核的cgroup，namespace，Union FS等技术，对应用进程进行封装隔离，并且
独立于宿主机与其他进程，这种运行时封装的状态称为容器。
Docker早起版本实现是基于LXC，并进一步对其封装，包括文件系统、网络互联、镜像管理等方面，极大简化了容器管理。从0.7版本以后开始去
除LXC，转为自行研发的libcontainer，从1.11版本开始，进一步演进为使用runC和containerd。
Docker理念是将应用及依赖包打包到一个可移植的容器中，可发布到任意Linux发行版Docker引擎上。使用沙箱机制运行程序，程序之间相互隔离。
1.2、docker的体系架构
Containerd：是一个简单的守护进程，使用runC管理容器。向Docker Engine提 供接口。 Shim：只负责管理一个容器。 runC：是一个轻量级的工具，只用来运行容器。 1.4、docker的内部组件
1. Namespaces
命名空间，Linux内核提供的一种对进程资源隔离的机制，例如进程、网络、挂载点等资源。
2. CGroups
控制组，Linux内核提供的一种限制进程资源的机制；例如CPU、内存等资源。
3. UnionFS
联合文件系统，支持将不同位置的目录挂载到同一虚拟文件系统，形成一种分层的模型。
1.5、虚拟机与容器区别
以 KVM 举例，与 Docker 对比
启动时间
Docker秒级启动，KVM分钟级启动。
轻量级
容器镜像大小通常以M为单位，虚拟机以G为单位。
容器资源占用小，要比虚拟机部署更快速。
性能
容器共享宿主机内核，系统级虚拟化，占用资源少，没有Hypervisor层开销，容器性能基本接近物理机；
虚拟机需要Hypervisor层支持，虚拟化一些设备，具有完整的GuestOS，虚拟化开销大，因而降低性能，没有容器性能好。
安全性
由于共享宿主机内核，只是进程级隔离，因此隔离性和稳定性不如虚拟机，容器具有一定权限访问宿主机内核，存在一定安全隐患。
使用 要求
KVM基于硬件的完全虚拟化，需要硬件CPU虚拟化技术支持；
容器共享宿主机内核，可运行在主流的Linux发行版，不用考虑CPU是否支持虚拟化技术。
1.6、docker 的应用场景
场景一：节省项目环境部署时间
1. 单项目打包
2. 整套项目打包
3. 新开源技术试用
场景二：环境一致性
场景三：持续集成
场景四：微服务
场景五：弹性伸缩
参看： https://blog.51cto.com/lizhenliang/1978081
1.7、在Centos7.x安装docker
CentOS7 # 安装依赖包 yum install -y yum-utils device-mapper-persistent-data lvm2 # 添加Docker软件包源 yum-config-manager --add-repo http://mirrors." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/a236b21148c035474d0e145eb451ad3a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-07-20T17:29:34+08:00" />
<meta property="article:modified_time" content="2020-07-20T17:29:34+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Docker架构简介  命令详解</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>1.1、Docker的介绍</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p><code>Docker是一个开源的应用容器引擎，使用Go语言开发，基于Linux内核的cgroup，namespace，Union FS等技术，对应用进程进行封装隔离，并且</code></p> <p><code>独立于宿主机与其他进程，这种运行时封装的状态称为容器。</code></p> <p><code>Docker早起版本实现是基于LXC，并进一步对其封装，包括文件系统、网络互联、镜像管理等方面，极大简化了容器管理。从0.7版本以后开始去</code></p> <p><code>除LXC，转为自行研发的libcontainer，从1.11版本开始，进一步演进为使用runC和containerd。</code></p> <p><code>Docker理念是将应用及依赖包打包到一个可移植的容器中，可发布到任意Linux发行版Docker引擎上。使用沙箱机制运行程序，程序之间相互隔离。</code></p> </td></tr></tbody></table> 
<p>1.2、docker的体系架构</p> 
<p><img alt="" src="https://images2.imgbox.com/96/9a/ssshZUyI_o.png"></p> 
<pre><code>Containerd：是一个简单的守护进程，使用runC管理容器。向Docker Engine提
供接口。
Shim：只负责管理一个容器。
runC：是一个轻量级的工具，只用来运行容器。</code></pre> 
<p> <img alt="" src="https://images2.imgbox.com/9b/9c/FZGsfOC9_o.png"></p> 
<p>1.4、docker的内部组件</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p><code>1. Namespaces</code></p> <p><code>命名空间，Linux内核提供的一种对进程资源隔离的机制，例如进程、网络、挂载点等资源。</code></p> <p> </p> <p><code>2. CGroups</code></p> <p><code>控制组，Linux内核提供的一种限制进程资源的机制；例如CPU、内存等资源。</code></p> <p> </p> <p><code>3. UnionFS</code></p> <p><code>联合文件系统，支持将不同位置的目录挂载到同一虚拟文件系统，形成一种分层的模型。</code></p> </td></tr></tbody></table> 
<p>1.5、虚拟机与容器区别</p> 
<p><img alt="" src="https://images2.imgbox.com/5a/f9/ZeV0m4du_o.png"></p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p><code>以 KVM 举例，与 Docker 对比</code></p> <p> </p> <p><code>启动时间</code></p> <p><code>Docker秒级启动，KVM分钟级启动。</code></p> <p> </p> <p><code>轻量级</code></p> <p><code>容器镜像大小通常以M为单位，虚拟机以G为单位。</code></p> <p><code>容器资源占用小，要比虚拟机部署更快速。</code></p> <p> </p> <p><code>性能</code></p> <p><code>容器共享宿主机内核，系统级虚拟化，占用资源少，没有Hypervisor层开销，容器性能基本接近物理机；</code></p> <p><code>虚拟机需要Hypervisor层支持，虚拟化一些设备，具有完整的GuestOS，虚拟化开销大，因而降低性能，没有容器性能好。</code></p> <p> </p> <p><code>安全性</code></p> <p><code>由于共享宿主机内核，只是进程级隔离，因此隔离性和稳定性不如虚拟机，容器具有一定权限访问宿主机内核，存在一定安全隐患。</code></p> <p> </p> <p><code>使用 要求</code></p> <p><code>KVM基于硬件的完全虚拟化，需要硬件CPU虚拟化技术支持；</code></p> <p><code>容器共享宿主机内核，可运行在主流的Linux发行版，不用考虑CPU是否支持虚拟化技术。</code></p> </td></tr></tbody></table> 
<p>1.6、docker 的应用场景</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p><code>场景一：节省项目环境部署时间</code></p> <p><code>1. 单项目打包</code></p> <p><code>2. 整套项目打包</code></p> <p><code>3. 新开源技术试用</code></p> <p><code>场景二：环境一致性</code></p> <p><code>场景三：持续集成</code></p> <p><code>场景四：微服务</code></p> <p><code>场景五：弹性伸缩</code></p> <p> </p> <p><code>参看： https:</code><code>//blog</code><code>.51cto.com</code><code>/lizhenliang/1978081</code></p> </td></tr></tbody></table> 
<p> 1.7、在Centos7.x安装docker</p> 
<pre><code>CentOS7
# 安装依赖包
yum install -y yum-utils device-mapper-persistent-data lvm2
# 添加Docker软件包源
yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
# 更新yum包索引
yum makecache fast
# 安装Docker CE
yum install docker-ce -y
# 启动
systemctl start docker
# 卸载
yum remove docker-ce
rm -rf /var/lib/docker
官方安装文档：
https://docs.docker.com/engine/installation/linux/docker-
ce/centos/#docker-ee-customers

1.8、镜像加速</code></pre> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p><code>什么是镜像？</code></p> <p><code>简单说，Docker镜像是一个不包含Linux内核而又精简的Linux操作系统。</code></p> <p> </p> <p><code>镜像从哪里来？</code></p> <p><code>Docker Hub是由Docker公司负责维护的公共注册中心，包含大量的容器镜像，Docker工具默认从这个公共镜像库下载镜像。</code></p> <p><code>https:</code><code>//hub</code><code>.docker.com</code><code>/explore</code></p> <p><code>默认是国外的源，下载会慢，建议配置国内镜像仓库：</code></p> <p><code># vi /etc/docker/daemon.json</code></p> <p><code>{<!-- --></code></p> <p><code>"registry-mirrors"</code><code>: [ </code><code>"https://registry.docker-cn.com"</code><code>]</code></p> <p><code>}</code></p> <p> </p> <p><code>----</code></p> <p><code>重启一下：</code></p> <p> </p> <p><code>systemctl restart docker </code></p> </td></tr></tbody></table> 
<p>1.9、镜像与容器的关系</p> 
<p><img alt="" height="888" src="https://images2.imgbox.com/cf/10/HKUmmaCe_o.png" width="1030"></p> 
<p> </p> 
<p> </p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p><code>镜像不是一个单一的文件，而是有多层构成。我们可以通过docker </code><code>history</code> <code>&lt;ID</code><code>/NAME</code><code>&gt; 查</code></p> <p><code>看镜像中各层内容及大小，每层对应着Dockerfile中的一条指令。Docker镜像默认存储在</code></p> <p><code>/var/lib/docker/</code><code>&lt;storage-driver&gt;中。</code></p> <p><code>容器其实是在镜像的最上面加了一层读写层，在运行容器里做的任何文件改动，都会写</code></p> <p><code>到这个读写层。如果容器删除了，最上面的读写层也就删除了，改动也就丢失了。</code></p> <p><code>Docker使用存储驱动管理镜像每层内容及可读写层的容器层。</code></p> </td></tr></tbody></table> 
<p><img alt="" src="https://images2.imgbox.com/1f/bd/IfsSfGi4_o.png"></p> 
<p>2.0、存储驱动</p> 
<p><img alt="" height="536" src="https://images2.imgbox.com/6e/24/2HI5hDbK_o.png" width="1024"></p> 
<p> </p> 
<p>2.1、镜像命令</p> 
<p><img alt="" src="https://images2.imgbox.com/02/f5/WnZ2jBOm_o.png"></p> 
<p> </p> 
<p> </p> 
<h4>二、docker常用命令</h4> 
<p>2.1、查看版本</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p><code>[root@ansible-server ~]</code><code># docker --version</code></p> <p><code>Docker version 18.09.6, build 481bc77156</code></p> </td></tr></tbody></table> 
<p>2.2、查看帮助</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p><code>[root@ansible-server ~]</code><code># docker --help</code></p> <p> </p> <p><code>Usage:  docker [OPTIONS] COMMAND</code></p> <p> </p> <p><code>A self-sufficient runtime </code><code>for</code> <code>containers</code></p> <p> </p> <p><code>Options:</code></p> <p><code>      </code><code>--config string      Location of client config files (default </code><code>"/root/.docker"</code><code>)</code></p> <p><code>  </code><code>-D, --debug              Enable debug mode</code></p> <p><code>  </code><code>-H, --host list          Daemon socket(s) to connect to</code></p> <p><code>  </code><code>-l, --log-level string   Set the logging level (</code><code>"debug"</code><code>|</code><code>"info"</code><code>|</code><code>"warn"</code><code>|</code><code>"error"</code><code>|</code><code>"fatal"</code><code>) (default </code><code>"info"</code><code>)</code></p> <p><code>      </code><code>--tls                Use TLS; implied by --tlsverify</code></p> <p><code>      </code><code>--tlscacert string   Trust certs signed only by this CA (default </code><code>"/root/.docker/ca.pem"</code><code>)</code></p> <p><code>      </code><code>--tlscert string     Path to TLS certificate </code><code>file</code> <code>(default </code><code>"/root/.docker/cert.pem"</code><code>)</code></p> <p><code>      </code><code>--tlskey string      Path to TLS key </code><code>file</code> <code>(default </code><code>"/root/.docker/key.pem"</code><code>)</code></p> <p><code>      </code><code>--tlsverify          Use TLS and verify the remote</code></p> <p><code>  </code><code>-</code><code>v</code><code>, --version            Print version information and quit</code></p> </td></tr></tbody></table> 
<p>2.3、查看镜像分层</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p><code>[root@ansible-server ~]</code><code># docker image history nginx:latest</code></p> <p><code>IMAGE               CREATED             CREATED BY                                      SIZE                COMMENT</code></p> <p><code>53f3fd8007f7        2 weeks ago         </code><code>/bin/sh</code> <code>-c </code><code>#(nop)  CMD ["nginx" "-g" "daemon…   0B                  </code></p> <p><code>&lt;missing&gt;           2 weeks ago         </code><code>/bin/sh</code> <code>-c </code><code>#(nop)  STOPSIGNAL SIGTERM           0B                  </code></p> <p><code>&lt;missing&gt;           2 weeks ago         </code><code>/bin/sh</code> <code>-c </code><code>#(nop)  EXPOSE 80                    0B                  </code></p> <p><code>&lt;missing&gt;           2 weeks ago         </code><code>/bin/sh</code> <code>-c </code><code>ln</code> <code>-sf </code><code>/dev/stdout</code> <code>/var/log/nginx</code><code>…   22B                 </code></p> <p><code>&lt;missing&gt;           2 weeks ago         </code><code>/bin/sh</code> <code>-c </code><code>set</code> <code>-x  &amp;&amp; apt-get update  &amp;&amp; apt…   54.1MB              </code></p> <p><code>&lt;missing&gt;           2 weeks ago         </code><code>/bin/sh</code> <code>-c </code><code>#(nop)  ENV NJS_VERSION=1.15.12.0…   0B                  </code></p> <p><code>&lt;missing&gt;           2 weeks ago         </code><code>/bin/sh</code> <code>-c </code><code>#(nop)  ENV NGINX_VERSION=1.15.12…   0B                  </code></p> <p><code>&lt;missing&gt;           2 weeks ago         </code><code>/bin/sh</code> <code>-c </code><code>#(nop)  LABEL maintainer=NGINX Do…   0B                  </code></p> <p><code>&lt;missing&gt;           2 weeks ago         </code><code>/bin/sh</code> <code>-c </code><code>#(nop)  CMD ["bash"]                 0B                  </code></p> <p><code>&lt;missing&gt;           2 weeks ago         </code><code>/bin/sh</code> <code>-c </code><code>#(nop) ADD file:fcb9328ea4c115670…   55.3MB</code></p> </td></tr></tbody></table> 
<p>2.4、查看镜像的详细信息</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p><code>查看镜像的详细信息</code></p> <p><code>[root@ansible-server ~]</code><code># docker image inspect nginx</code></p> <p><code>[</code></p> <p><code>    </code><code>{<!-- --></code></p> <p><code>        </code><code>"Id"</code><code>: </code><code>"sha256:53f3fd8007f76bd23bf663ad5f5009c8941f63828ae458cef584b5f85dc0a7bf"</code><code>,</code></p> <p><code>        </code><code>"RepoTags"</code><code>: [</code></p> <p><code>            </code><code>"nginx:latest"</code></p> <p><code>        </code><code>],</code></p> <p><code>        </code><code>"RepoDigests"</code><code>: [</code></p> <p><code>省略部分......</code></p> </td></tr></tbody></table> 
<p>2.5、下载镜像</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p><code>[root@ansible-server ~]</code><code># docker image pull nginx:1.11</code></p> <p><code>1.11: Pulling from library</code><code>/nginx</code></p> <p><code>6d827a3ef358: Pull complete </code></p> <p><code>f8f2e0556751: Pull complete </code></p> <p><code>5c9972dca3fd: Pull complete </code></p> <p><code>451b9524cb06: Pull complete </code></p> <p><code>Digest: sha256:e6693c20186f837fc393390135d8a598a96a833917917789d63766cab6c59582</code></p> <p><code>Status: Downloaded newer image </code><code>for</code> <code>nginx:1.11</code></p> </td></tr></tbody></table> 
<p>2.6、删除镜像</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p><code>查看并删除镜像</code></p> <p><code>[root@ansible-server ~]</code><code># docker images</code></p> <p><code>REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</code></p> <p><code>nginx               latest              53f3fd8007f7        2 weeks ago         109MB</code></p> <p><code>nginx               1.11                5766334bdaa0        2 years ago         183MB</code></p> <p><code>&lt;br&gt;[root@ansible-server ~]</code><code># docker image rm nginx:1.11</code></p> <p><code>Untagged: nginx:1.11</code></p> <p><code>Untagged: nginx@sha256:e6693c20186f837fc393390135d8a598a96a833917917789d63766cab6c59582</code></p> <p><code>Deleted: sha256:5766334bdaa0bc37f1f0c02cb94c351f9b076bcffa042d6ce811b0fd9bc31f3b</code></p> <p><code>Deleted: sha256:1fcf2d3addf02c3b6add24c7b0993038f7e3eee616b10e671e25440e03bc7697</code></p> <p><code>Deleted: sha256:51c56cdbb9306c4d6f2da2b780924f3b926bd13d15a4f6693a5175690e288436</code></p> <p><code>Deleted: sha256:ec9a826666cfa5df0471f716145da63294019c09a5f2e31613122b57df8f7ce0</code></p> <p><code>Deleted: sha256:5d6cbe0dbcf9a675e86aa0fbedf7ed8756d557c7468d6a7c64bde7fa9e029636</code></p> </td></tr></tbody></table> 
<p>2.7、给镜像打tag</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p><code>#给镜像打tag，再查看</code></p> <p><code>[root@ansible-server ~]</code><code># docker tag nginx:1.11 nginx:v1</code></p> <p> </p> <p><code>[root@ansible-server ~]</code><code># docker images</code></p> <p><code>REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</code></p> <p><code>nginx               latest              53f3fd8007f7        2 weeks ago         109MB</code></p> <p><code>nginx               1.11                5766334bdaa0        2 years ago         183MB</code></p> <p><code>nginx               v1                  5766334bdaa0        2 years ago         183MB</code></p> </td></tr></tbody></table> 
<p>2.8、导出镜像</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p><code>[root@ansible-server ~]</code><code># docker image save nginx:1.11 &gt;nginx1.11.tar</code></p> <p><code>[root@ansible-server ~]</code><code># du -sh nginx1.11.tar </code></p> <p><code>182M    nginx1.11.</code><code>tar</code></p> </td></tr></tbody></table> 
<p>2.9、导入镜像</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p><code>#删除这个已存在的镜像</code></p> <p><code>[root@ansible-server ~]</code><code># docker rmi nginx:1.11</code></p> <p><code>Untagged: nginx:1.11</code></p> <p> </p> <p><code>#再导入镜像</code></p> <p><code>[root@ansible-server ~]</code><code># docker load &lt;nginx1.11.tar </code></p> <p><code>Loaded image: nginx:1.11</code></p> <p> </p> <p><code>#查看镜像</code></p> <p><code>[root@ansible-server ~]</code><code># docker images</code></p> <p><code>REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</code></p> <p><code>nginx               latest              53f3fd8007f7        2 weeks ago         109MB</code></p> <p><code>nginx               1.11                5766334bdaa0        2 years ago         183MB</code></p> <p><code>nginx               v1                  5766334bdaa0        2 years ago         183MB</code></p> </td></tr></tbody></table> 
<p>3.0、运行一个容器</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p><code>[root@ansible-server ~]</code><code># docker run -itd nginx</code></p> <p><code>b8ecef224d29f0eaece24c9406e88207491443ab6beb053eb560dce2171b8b4a</code></p> <p> </p> <p><code>#查看容器</code></p> <p><code>[root@ansible-server ~]</code><code># docker ps -a</code></p> <p><code>CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES</code></p> <p><code>b8ecef224d29        nginx               </code><code>"nginx -g 'daemon of…"</code>   <code>9 seconds ago       Up 6 seconds        80</code><code>/tcp</code>              <code>affectionate_feistel</code></p> </td></tr></tbody></table> 
<p>3.1、导出一个正在运行的容器（备注：导出后就变成了一个镜像文件）</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p><code>[root@ansible-server ~]</code><code># docker ps -a</code></p> <p><code>CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES</code></p> <p><code>b8ecef224d29        nginx               </code><code>"nginx -g 'daemon of…"</code>   <code>2 minutes ago       Up 2 minutes        80</code><code>/tcp</code>              <code>affectionate_feistel</code></p> <p> </p> <p><code>[root@ansible-server ~]</code><code># docker export b8ecef224d29 &gt;nginx.tar</code></p> <p> </p> <p><code> </code><code>[root@ansible-server ~]</code><code># du -sh nginx.tar </code></p> <p><code>107M    nginx.</code><code>tar</code></p> </td></tr></tbody></table> 
<p>３.２、导入镜像</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p><code>[root@ansible-server ~]</code><code># docker image import nginx.tar nginx:self</code></p> <p><code>sha256:bbf50008d2bfb21486bb723cb9779ac04e854ee7e8176529d433941527a10fb9</code></p> <p> </p> <p><code> </code><code>[root@ansible-server ~]</code><code># docker images</code></p> <p><code>REPOSITORY          TAG                 IMAGE ID            CREATED              SIZE</code></p> <p><code>nginx               self                594fc0cf36b0        58 seconds ago       108MB</code></p> <p><code>nginx               latest              53f3fd8007f7        2 weeks ago          109MB</code></p> <p><code>nginx               1.11                5766334bdaa0        2 years ago          183MB</code></p> <p><code>nginx               v1                  5766334bdaa0        2 years ago          183MB</code></p> </td></tr></tbody></table> 
<h4>三、容器管理</h4> 
<p>3.1、查看容器命令</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p><code>[root@ansible-server ~]</code><code># docker container --help</code></p> <p> </p> <p><code>Usage:  docker container COMMAND</code></p> <p> </p> <p><code>Manage containers</code></p> <p> </p> <p><code>Commands:</code></p> <p><code>  </code><code>attach      Attach </code><code>local</code> <code>standard input, output, and error streams to a running container</code></p> <p><code>  </code><code>commit      Create a new image from a container's changes</code></p> <p><code>  </code><code>cp</code>          <code>Copy files</code><code>/folders</code> <code>between a container and the </code><code>local</code> <code>filesystem</code></p> <p><code>  </code><code>create      Create a new container</code></p> <p><code>  </code><code>diff</code>        <code>Inspect changes to files or directories on a container's filesystem</code></p> <p><code>  </code><code>exec</code>        <code>Run a </code><code>command</code> <code>in</code> <code>a running container</code></p> <p><code>  </code><code>export</code>      <code>Export a container's filesystem as a </code><code>tar</code> <code>archive</code></p> <p><code>  </code><code>inspect     Display detailed information on one or </code><code>more</code> <code>containers</code></p> <p><code>  </code><code>kill</code>        <code>Kill one or </code><code>more</code> <code>running containers</code></p> <p><code>  </code><code>logs        Fetch the logs of a container</code></p> <p><code>  </code><code>ls</code>          <code>List containers</code></p> <p><code>  </code><code>pause       Pause all processes within one or </code><code>more</code> <code>containers</code></p> <p><code>  </code><code>port        List port mappings or a specific mapping </code><code>for</code> <code>the container</code></p> <p><code>  </code><code>prune       Remove all stopped containers</code></p> <p><code>  </code><code>rename      Rename a container</code></p> <p><code>  </code><code>restart     Restart one or </code><code>more</code> <code>containers</code></p> <p><code>  </code><code>rm</code>          <code>Remove one or </code><code>more</code> <code>containers</code></p> <p><code>  </code><code>run         Run a </code><code>command</code> <code>in</code> <code>a new container</code></p> <p><code>  </code><code>start       Start one or </code><code>more</code> <code>stopped containers</code></p> <p><code>  </code><code>stats       Display a live stream of container(s) resource usage statistics</code></p> <p><code>  </code><code>stop        Stop one or </code><code>more</code> <code>running containers</code></p> <p><code>  </code><code>top</code>         <code>Display the running processes of a container</code></p> <p><code>  </code><code>unpause     Unpause all processes within one or </code><code>more</code> <code>containers</code></p> <p><code>  </code><code>update      Update configuration of one or </code><code>more</code> <code>containers</code></p> <p><code>  </code><code>wait        Block </code><code>until</code> <code>one or </code><code>more</code> <code>containers stop, </code><code>then</code> <code>print their </code><code>exit</code> <code>codes</code></p> <p> </p> <p><code>Run </code><code>'docker container COMMAND --help'</code> <code>for</code> <code>more</code> <code>information on a </code><code>command</code><code>.</code></p> </td></tr></tbody></table> 
<p> 3.2、创建容器常用选项</p> 
<p><img alt="" src="https://images2.imgbox.com/03/00/d8ucrQN6_o.png"></p> 
<p> </p> 
<p>3.3、创建一个容器</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p><code>#创建一个重命名为bs的容器</code></p> <p><code>[root@ansible-server ~]</code><code># docker container run -itd --name bs busybox</code></p> <p><code>27080338dabb3d76d3a5864999e2085240d3a6e9c7ef201bd91f9d18c0167969</code></p> <p> </p> <p><code>#查看容器</code></p> <p><code>[root@ansible-server ~]</code><code># docker ps -a</code></p> <p><code>CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                          PORTS               NAMES</code></p> <p><code>27080338dabb        busybox             </code><code>"sh"</code>                     <code>49 seconds ago      Up 47 seconds                                       bs</code></p> <p><code>d5ee27264bd3        alpine              </code><code>"/bin/sh"</code>                <code>3 minutes ago       Exited (0) About a minute ago                       focus</code></p> <p><code>b8ecef224d29        nginx               </code><code>"nginx -g 'daemon of…"</code>   <code>45 minutes ago      Up 45 minutes                   80</code><code>/tcp</code>              <code>affec</code></p> <p> </p> <p><code>#进入容器中</code></p> <p><code>[root@ansible-server ~]</code><code># docker container attach bs</code></p> <p><code>/ </code><code># ls</code></p> <p><code>bin   dev   etc   home  proc  root  sys   tmp   usr   var</code></p> <p><code>/ </code><code># ps -ef</code></p> <p><code>PID   USER     TIME  COMMAND</code></p> <p><code>    </code><code>1 root      0:00 sh</code></p> <p><code>    </code><code>8 root      0:00 </code><code>ps</code> <code>-ef</code></p> <p> </p> <p><code>/ </code><code># ifconfig</code></p> <p><code>eth0 Link encap:Ethernet HWaddr 02:42:AC:11:00:03 </code></p> <p><code>inet addr:172.17.0.3 Bcast:172.17.255.255 Mask:255.255.0.0</code></p> <p><code>UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1</code></p> <p><code>RX packets:8 errors:0 dropped:0 overruns:0 frame:0</code></p> <p><code>TX packets:0 errors:0 dropped:0 overruns:0 carrier:0</code></p> <p><code>collisions:0 txqueuelen:0 </code></p> <p><code>RX bytes:648 (648.0 B) TX bytes:0 (0.0 B)</code></p> <p> </p> <p><code>lo Link encap:Local Loopback </code></p> <p><code>inet addr:127.0.0.1 Mask:255.0.0.0</code></p> <p><code>UP LOOPBACK RUNNING MTU:65536 Metric:1</code></p> <p><code>RX packets:0 errors:0 dropped:0 overruns:0 frame:0</code></p> <p><code>TX packets:0 errors:0 dropped:0 overruns:0 carrier:0</code></p> <p><code>collisions:0 txqueuelen:1000 </code></p> <p><code>RX bytes:0 (0.0 B) TX bytes:0 (0.0 B)</code></p> <p> </p> <p><code>/ </code><code># echo "123" &gt;&gt;/etc/hosts</code></p> <p><code>/ </code><code># tail -1 /etc/hosts</code></p> <p><code>123</code></p> <p> </p> <p><code>/ </code><code># exit  #退出容器，同时终端也会并闭。</code></p> </td></tr></tbody></table> 
<p>3.4、进入容器命令</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p><code>[root@ansible-server ~]</code><code># docker ps -a</code></p> <p><code>CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                      PORTS               NAMES</code></p> <p><code>27080338dabb        busybox             </code><code>"sh"</code>                     <code>15 minutes ago      Up 4 minutes                                    bs</code></p> <p> </p> <p><code>[root@ansible-server ~]</code><code># docker exec -it bs sh</code></p> <p><code>/ </code><code># ls</code></p> <p><code>bin   dev   etc   home  proc  root  sys   tmp   usr   var</code></p> <p><code>/ </code><code># </code></p> </td></tr></tbody></table> 
<p>3.5、运行容器，映射端口80到8088上面。</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p><code>#运行容器，映射端口80到8088上面。</code></p> <p><code>[root@ansible-server ~]</code><code># docker container run -itd -p 8080:80 --name nginx02 nginx</code></p> <p><code>71beefd3446a4db2cf316c5ca6611256fd77a3e49494e89838c59e520ebfac4c</code></p> <p> </p> <p><code>#查看容器</code></p> <p><code>[root@ansible-server ~]</code><code># docker ps -a</code></p> <p><code>CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                      PORTS                  NAMES</code></p> <p><code>71beefd3446a        nginx               </code><code>"nginx -g 'daemon of…"</code>   <code>17 seconds ago      Up 15 seconds               0.0.0.0:8080-&gt;80</code><code>/tcp</code>   <code>nginx02</code></p> <p> </p> <p><code>#访问这个容器</code></p> <p><code>59.47.71.220:8080</code></p> <p><code>返回结果：</code></p> <p><code>Welcome to nginx!</code></p> </td></tr></tbody></table> 
<p>3.6、查看容器的日志（备注：日志会输出到控制台）</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p><code>#查看容器的日志（备注：日志会输出到控制台）</code></p> <p><code>[root@ansible-server ~]</code><code># docker logs nginx02</code></p> <p><code>98.142.138.176 - - [23</code><code>/May/2019</code><code>:02:59:08 +0000] </code><code>"GET / HTTP/1.1"</code> <code>200 612 </code><code>"-"</code> <code>"Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.169 Safari/537.36"</code> <code>"-"</code></p> <p><code>2019</code><code>/05/23</code> <code>02:59:09 [error] 6</code><code>#6: *2 open() "/usr/share/nginx/html/favicon.ico" failed (2: No such file or directory), client: 98.142.138.176, server: localhost, request: "GET /favicon.ico HTTP/1.1", host: "59.47.71.229:8080", referrer: "http://59.47.71.229:8080/"</code></p> <p><code>98.142.138.176 - - [23</code><code>/May/2019</code><code>:02:59:09 +0000] </code><code>"GET /favicon.ico HTTP/1.1"</code> <code>404 556 </code><code>"http://59.47.71.229:8080/"</code> <code>"Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.169 Safari/537.36"</code> <code>"-"</code></p> <p> </p> <p><code>#容器日志保存地址</code></p> <p><code>[root@ansible-server ~]</code><code># ls /var/lib/docker/containers/</code></p> <p><code>71beefd3446a4db2cf316c5ca6611256fd77a3e49494e89838c59e520ebfac4c</code></p> <p> </p> <p><code>#进入日志目录，查看访问日志</code></p> <p><code>[root@ansible-server containers]</code><code># cd 71beefd3446a4db2cf316c5ca6611256fd77a3e49494e89838c59e520ebfac4c/</code></p> <p><code>[root@ansible-server 71beefd3446a4db2cf316c5ca6611256fd77a3e49494e89838c59e520ebfac4c]</code><code># ll</code></p> <p><code>total 28</code></p> <p><code>-rw-r-----. 1 root root 1751 May 23 11:08 71beefd3446a4db2cf316c5ca6611256fd77a3e49494e89838c59e520ebfac4c-json.log</code></p> <p><code>drwx------. 2 root root    6 May 23 10:57 checkpoints</code></p> <p><code>-rw-------. 1 root root 2900 May 23 10:57 config.v2.json</code></p> <p><code>-rw-r--r--. 1 root root 1463 May 23 10:57 hostconfig.json</code></p> <p><code>-rw-r--r--. 1 root root   13 May 23 10:57 </code><code>hostname</code></p> <p><code>-rw-r--r--. 1 root root  174 May 23 10:57 hosts</code></p> <p><code>drwx------. 3 root root   17 May 23 10:57 mounts</code></p> <p><code>-rw-r--r--. 1 root root   76 May 23 10:57 resolv.conf</code></p> <p><code>-rw-r--r--. 1 root root   71 May 23 10:57 resolv.conf.</code><code>hash</code></p> <p><code>&lt;br&gt;</code><code>#查看访问日志</code></p> <p><code>[root@ansible-server 71beefd3446a4db2cf316c5ca6611256fd77a3e49494e89838c59e520ebfac4c]</code><code># tail 71beefd3446a4db2cf316c5ca6611256fd77a3e49494e89838c59e520ebfac4c-json.log </code></p> <p><code>{<!-- --></code><code>"log"</code><code>:</code><code>"98.142.138.176 - - [23/May/2019:02:59:08 +0000] \"GET / HTTP/1.1\" 200 612 \"-\" \"Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.169 Safari/537.36\" \"-\"\r\n"</code><code>,</code><code>"stream"</code><code>:</code><code>"stdout"</code><code>,</code><code>"time"</code><code>:</code><code>"2019-05-23T02:59:08.9258795Z"</code><code>}</code></p> <p><code>{<!-- --></code><code>"log"</code><code>:</code><code>"2019/05/23 02:59:09 [error] 6#6: *2 open() \"/usr/share/nginx/html/favicon.ico\" failed (2: No such file or directory), client: 98.142.138.176, server: localhost, request: \"GET /favicon.ico HTTP/1.1\", host: \"59.47.71.229:8080\", referrer: \"http://59.47.71.229:8080/\"\r\n"</code><code>,</code><code>"stream"</code><code>:</code><code>"stdout"</code><code>,</code><code>"time"</code><code>:</code><code>"2019-05-23T02:59:09.7594971Z"</code><code>}</code></p> <p><code>{<!-- --></code><code>"log"</code><code>:</code><code>"98.142.138.176 - - [23/May/2019:02:59:09 +0000] \"GET /favicon.ico HTTP/1.1\" 404 556 \"http://59.47.71.229:8080/\" \"Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.169 Safari/537.36\" \"-\"\r\n"</code><code>,</code><code>"stream"</code><code>:</code><code>"stdout"</code><code>,</code><code>"time"</code><code>:</code><code>"2019-05-23T02:59:09.7595791Z"</code><code>}</code></p> <p><code>{<!-- --></code><code>"log"</code><code>:</code><code>"98.142.138.176 - - [23/May/2019:03:08:10 +0000] \"GET / HTTP/1.1\" 304 0 \"-\" \"Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.169 Safari/537.36\" \"-\"\r\n"</code><code>,</code><code>"stream"</code><code>:</code><code>"stdout"</code><code>,</code><code>"time"</code><code>:</code><code>"2019-05-23T03:08:10.0499976Z"</code><code>}</code></p> <p><code>{<!-- --></code><code>"log"</code><code>:</code><code>"98.142.138.176 - - [23/May/2019:03:08:12 +0000] \"GET / HTTP/1.1\" 304 0 \"-\" \"Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.169 Safari/537.36\" \"-\"\r\n"</code><code>,</code><code>"stream"</code><code>:</code><code>"stdout"</code><code>,</code><code>"time"</code><code>:</code><code>"2019-05-23T03:08:12.8716702Z"</code><code>}</code></p> <p><code>{<!-- --></code><code>"log"</code><code>:</code><code>"98.142.138.176 - - [23/May/2019:03:08:15 +0000] \"GET / HTTP/1.1\" 304 0 \"-\" \"Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.169 Safari/537.36\" \"-\"\r\n"</code><code>,</code><code>"stream"</code><code>:</code><code>"stdout"</code><code>,</code><code>"time"</code><code>:</code><code>"2019-05-23T03:08:15.1182369Z"</code><code>}</code></p> </td></tr></tbody></table> 
<p>3.7、--restart=always：指的是服务退出，始终会重启容器</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p><code>#清理所有容器</code></p> <p><code>[root@ansible-server ~]</code><code># docker stop $(docker ps -a -q);docker rm $(docker ps -a -q)</code></p> <p><code>4aff4bb376dd</code></p> <p><code>eb53d76f4778</code></p> <p><code>27080338dabb</code></p> <p><code>d5ee27264bd3</code></p> <p><code>b8ecef224d29</code></p> <p><code>4aff4bb376dd</code></p> <p><code>eb53d76f4778</code></p> <p><code>27080338dabb</code></p> <p><code>d5ee27264bd3</code></p> <p><code>b8ecef224d29</code></p> <p><code>&lt;br&gt;</code><code>#删除所有镜像</code></p> </td></tr></tbody></table> 
<p>   [root@ansible-server ~]# docker rmi $(docker images -q)</p> 
<p> </p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p><code>#运行容器（--restart=always：指的是服务退出，始终会重启容器）</code></p> <p><code>[root@ansible-server ~]</code><code># docker container run -itd -p 8080:80 --name nginx02 --restart=always nginx</code></p> <p><code>1372e859b8e8bff473f2d242a50e0f51f96dabd325800ae3504aabf3e041af55</code></p> <p> </p> <p><code>#查看容器</code></p> <p><code>[root@ansible-server ~]</code><code># docker ps -a</code></p> <p><code>CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                  NAMES</code></p> <p><code>1372e859b8e8        nginx               </code><code>"nginx -g 'daemon of…"</code>   <code>5 seconds ago       Up 3 seconds        0.0.0.0:8080-&gt;80</code><code>/tcp</code>   <code>nginx02</code></p> </td></tr></tbody></table> 
<p>3.8、限制容器使用CPU资源</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p>1</p> <p>2</p> <p>3</p> <p>4</p> <p>5</p> <p>6</p> </td><td> <p><code>[root@ansible-server ~]</code><code># docker container run -itd --cpus 1 --name nginx01 nginx</code></p> <p><code>2d801ef7a76d913124b77e42d14da6722d138501600d076beec1a734642dbf99</code></p> <p> </p> <p><code>[root@ansible-server ~]</code><code># docker ps -a</code></p> <p><code>CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES</code></p> <p><code>2d801ef7a76d        nginx               </code><code>"nginx -g 'daemon of…"</code>   <code>6 seconds ago       Up 4 seconds        80</code><code>/tcp</code>              <code>nginx01</code></p> </td></tr></tbody></table> 
<p>3.9、限制内存使用率</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p><code>[root@ansible-server ~]</code><code># docker container run -itd --memory 512m --name nginx02 nginx</code></p> <p><code>ea65f58c0e55a38019480c4c75a76e71ee129d310e279e5adea73ac792f1a04e</code></p> <p><code>[root@ansible-server ~]</code><code># docker ps -a</code></p> <p><code>CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES</code></p> <p><code>ea65f58c0e55        nginx               </code><code>"nginx -g 'daemon of…"</code>   <code>8 seconds ago       Up 5 seconds        80</code><code>/tcp</code>              <code>nginx02</code></p> <p><code>2d801ef7a76d        nginx               </code><code>"nginx -g 'daemon of…"</code>   <code>4 minutes ago       Up 4 minutes        80</code><code>/tcp</code>              <code>n</code></p> </td></tr></tbody></table> 
<p>4.0、查看容器资源利用率</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p><code>[root@ansible-server ~]</code><code># docker container stats nginx02</code></p> <p> </p> <p><code>CONTAINER ID        NAME                CPU %               MEM USAGE / LIMIT   MEM %               NET I</code><code>/O</code>             <code>BLOCK I</code><code>/O</code>           <code>PIDS</code></p> <p><code>ea65f58c0e55        nginx02             0.00%               1.359MiB / 512MiB   0.27%               648B / 0B           0B / 0B             2</code></p> <p> </p> <p><code>CONTAINER ID        NAME                CPU %               MEM USAGE / LIMIT   MEM %               NET I</code><code>/O</code>             <code>BLOCK I</code><code>/O</code>           <code>PIDS</code></p> <p><code>ea65f58c0e55        nginx02             0.00%               1.359MiB / 512MiB   0.27%               648B / 0B           0B / 0B             2</code></p> <p> </p> <p><code>CONTAINER ID        NAME                CPU %               MEM USAGE / LIMIT   MEM %               NET I</code><code>/O</code>             <code>BLOCK I</code><code>/O</code>           <code>PIDS</code></p> <p><code>ea65f58c0e55        nginx02             0.00%               1.359MiB / 512MiB   0.27%               648B / 0B           0B / 0B             2</code></p> <p> </p> <p><code>CONTAINER ID        NAME                CPU %               MEM USAGE / LIMIT   MEM %               NET I</code><code>/O</code>             <code>BLOCK I</code><code>/O</code>           <code>PIDS</code></p> <p><code>ea65f58c0e55        nginx02             0.00%               1.359MiB / 512MiB   0.27%               648B / 0B           0B / 0B             2</code></p> <p> </p> <p><code>CONTAINER ID        NAME                CPU %               MEM USAGE / LIMIT   MEM %               NET I</code><code>/O</code>             <code>BLOCK I</code><code>/O</code>           <code>PIDS</code></p> <p><code>ea65f58c0e55        nginx02             0.00%               1.359MiB / 512MiB   0.27%               648B / 0B           0B / 0B             2</code></p> <p> </p> <p><code>CONTAINER ID        NAME                CPU %               MEM USAGE / LIMIT   MEM %               NET I</code><code>/O</code>             <code>BLOCK I</code><code>/O</code>           <code>PIDS</code></p> <p><code>ea65f58c0e55        nginx02             0.00%               1.359MiB / 512MiB   0.27%               648B / 0B           0B / 0B             2</code></p> </td></tr></tbody></table> 
<p>4.1、 查看所有容器IP地址</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p><code>[root@ansible-server ~]</code><code># docker inspect --format='{<!-- -->{.Name}} - {<!-- -->{range .NetworkSettings.Networks}}{<!-- -->{.IPAddress}}{<!-- -->{end}}' $(docker ps -aq)</code></p> <p><code>/composelnmp_nginx_1</code> <code>- </code></p> <p><code>/thirsty_ptolemy</code> <code>- 172.17.0.3</code></p> <p><code>/composelnmp_php_1</code> <code>- 172.22.0.2</code></p> <p><code>/composelnmp_mysql_1</code> <code>- 172.22.0.3</code></p> <p><code>/grafana</code> <code>- 172.23.0.4</code></p> <p><code>/cadvisor</code> <code>- 172.23.0.3</code></p> <p><code>/influxdb</code> <code>- 172.23.0.2</code></p> </td></tr></tbody></table> 
<p>　　</p> 
<h4>四、管理容器常用命令</h4> 
<p><img alt="" src="https://images2.imgbox.com/b0/92/LxE6X6Kt_o.png"></p> 
<p>4.1、删除容器和镜像</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p><code>#删除所有容器</code></p> <p><code>docker stop $(docker </code><code>ps</code> <code>-a -q);docker </code><code>rm</code> <code>$(docker </code><code>ps</code> <code>-a -q)</code></p> <p> </p> <p><code>#删除所有镜像</code></p> <p><code>[root@ansible-server ~]</code><code># docker rmi -f `docker images -q`</code></p> </td></tr></tbody></table> 
<p>4.2、进入容器</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p><code>法一：</code></p> <p><code>[root@ansible-server ~]</code><code># docker exec -it nginx02 bash</code></p> <p><code>root@ea65f58c0e55:/</code><code># exit</code></p> <p> </p> <p><code>法二：</code></p> <p><code>[root@ansible-server ~]</code><code># docker exec -it nginx02 sh</code></p> <p><code># ls</code></p> <p><code>bin  boot  dev  etc  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</code></p> <p> </p> <p><code>法三：</code></p> <p><code>[root@ansible-server ~]</code><code># docker run -it centos /bin/bash</code></p> </td></tr></tbody></table> 
<p>4.3、commit ：把容器打包成镜像</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p><code>#下载镜像</code></p> <p><code>[root@ansible-server ~]</code><code># docker pull centos</code></p> <p><code>Using default tag: latest</code></p> <p><code>latest: Pulling from library</code><code>/centos</code></p> <p><code>8ba884070f61: Pull complete </code></p> <p><code>Digest: sha256:b40cee82d6f98a785b6ae35748c958804621dc0f2194759a2b8911744457337d</code></p> <p><code>Status: Downloaded newer image </code><code>for</code> <code>centos:latest</code></p> <p><code>[root@ansible-server ~]</code><code># docker images</code></p> <p><code>REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</code></p> <p><code>centos              latest              9f38484d220f        2 months ago        202MB</code></p> <p> </p> <p><code>#进入镜像</code></p> <p><code>[root@ansible-server ~]</code><code># docker run -it centos /bin/bash</code></p> <p> </p> <p><code>#在容器中安装vim</code></p> <p><code>[root@2ffc3f732d99 /]</code><code># yum install vim -y </code></p> <p><code>[root@2ffc3f732d99 /]</code><code># exit</code></p> <p> </p> <p><code>#查看容器</code></p> <p><code>[root@ansible-server ~]</code><code># docker ps -a</code></p> <p><code>CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</code></p> <p><code>c1e98c693e84        centos              </code><code>"/bin/bash"</code>         <code>49 seconds ago      Up 46 seconds                           dreamy_dirac</code></p> <p> </p> <p><code>#把容器打包成镜像：</code></p> <p><code>[root@ansible-server ~]</code><code># docker commit c1e98c693e84 centos-vim</code></p> <p><code>sha256:8377fdf51ec1d46dbb79e96a73e47d72c4be2c4f51ba23969ecea23d0a22b3a8</code></p> <p> </p> <p><code>#查看镜像</code></p> <p><code>[root@ansible-server ~]</code><code># docker images</code></p> <p><code>REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</code></p> <p><code>centos-vim          latest              8377fdf51ec1        5 seconds ago       202MB</code></p> <p><code>centos              latest              9f38484d220f        2 months ago        202MB</code></p> </td></tr></tbody></table> 
<p>4.4、把文件从电脑中拷贝到容器中</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p><code>#查看容器</code></p> <p><code>[root@ansible-server ~]</code><code># docker ps -a</code></p> <p><code>CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</code></p> <p><code>c1e98c693e84        centos              </code><code>"/bin/bash"</code>         <code>9 minutes ago       Up 9 minutes                            dreamy_dirac</code></p> <p> </p> <p><code>#查看需要拷贝的文件</code></p> <p><code>[root@ansible-server ~]</code><code># ll</code></p> <p><code>total 294828</code></p> <p><code>-rw-r--r--. 1 root root      2656 May 18 16:26 nginx.conf</code></p> <p> </p> <p><code>#拷贝文件到容器中</code></p> <p><code>[root@ansible-server ~]</code><code># docker container cp nginx.conf dreamy_dirac:/root</code></p> <p> </p> <p><code>#进入容器查看，是否有拷贝过来的文件</code></p> <p><code>[root@ansible-server ~]</code><code># docker container exec dreamy_dirac ls /root</code></p> <p><code>anaconda-ks.cfg</code></p> <p><code>nginx.conf&lt;br&gt;&lt;br&gt;</code><code>#在容器中的文件重启也不会丢失</code></p> </td></tr></tbody></table> 
<p>    [root@ansible-server ~]# docker restart dreamy_dirac<br>     dreamy_dirac</p> 
<p>4.5、查看容器日志</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p><code>#下载并运行容器</code></p> <p><code>[root@ansible-server ~]</code><code># docker container run -itd -p 8080:80 --name nginx02 nginx</code></p> <p><code>Unable to </code><code>find</code> <code>image </code><code>'nginx:latest'</code> <code>locally</code></p> <p><code>latest: Pulling from library</code><code>/nginx</code></p> <p><code>743f2d6c1f65: Pull complete </code></p> <p><code>6bfc4ec4420a: Pull complete </code></p> <p><code>688a776db95f: Pull complete </code></p> <p><code>Digest: sha256:0e409e180983aea7972c92b0a8ae538d1d3c802fe3a8f795ad8049951894590a</code></p> <p><code>Status: Downloaded newer image </code><code>for</code> <code>nginx:latest</code></p> <p><code>7d5b76c0f8b20038eac1449daba79ded2da7ec41f448ca02252fda877f2ffa9a</code></p> <p> </p> <p><code>#查看容器</code></p> <p><code>[root@ansible-server ~]</code><code># docker ps -a</code></p> <p><code>CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                  NAMES</code></p> <p><code>7d5b76c0f8b2        nginx               </code><code>"nginx -g 'daemon of…"</code>   <code>29 seconds ago      Up 26 seconds       0.0.0.0:8080-&gt;80</code><code>/tcp</code>   <code>nginx02</code></p> <p><code>c1e98c693e84        centos              </code><code>"/bin/bash"</code>              <code>20 minutes ago      Up 4 minutes                               dreamy_dirac</code></p> <p> </p> <p><code>#访问容器的nginx</code></p> <p><code>[root@ansible-server ~]</code><code># curl 59.47.71.229:8080</code></p> <p><code>&lt;!DOCTYPE html&gt;</code></p> <p><code>&lt;html&gt;</code></p> <p><code>&lt;body&gt;</code></p> <p><code>&lt;h1&gt;Welcome to nginx!&lt;</code><code>/h1</code><code>&gt;</code></p> <p><code>&lt;</code><code>/body</code><code>&gt;</code></p> <p><code>&lt;</code><code>/html</code><code>&gt;</code></p> <p> </p> <p><code>#查看容器日志</code></p> <p><code>[root@ansible-server ~]</code><code># docker logs nginx02</code></p> <p><code>59.47.71.229 - - [23</code><code>/May/2019</code><code>:08:32:34 +0000] </code><code>"GET / HTTP/1.1"</code> <code>200 612 </code><code>"-"</code> <code>"curl/7.29.0"</code> <code>"-"</code></p> <p><code>59.47.71.229 - - [23</code><code>/May/2019</code><code>:08:32:35 +0000] </code><code>"GET / HTTP/1.1"</code> <code>200 612 </code><code>"-"</code> <code>"curl/7.29.0"</code> <code>"-"</code></p> </td></tr></tbody></table> 
<p>4.6、查看容器负载情况</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p><code>[root@ansible-server ~]</code><code># docker stats nginx02</code></p> <p><code>CONTAINER ID        NAME                CPU %               MEM USAGE / LIMIT     MEM %               NET I</code><code>/O</code>             <code>BLOCK I</code><code>/O</code>           <code>PIDS</code></p> <p><code>7d5b76c0f8b2        nginx02             0.00%               1.371MiB / 3.693GiB   0.04%               1.83kB / 2.46kB     0B / 0B             2</code></p> <p> </p> <p><code>CONTAINER ID        NAME                CPU %               MEM USAGE / LIMIT     MEM %               NET I</code><code>/O</code>             <code>BLOCK I</code><code>/O</code>           <code>PIDS</code></p> <p><code>7d5b76c0f8b2        nginx02             0.00%               1.371MiB / 3.693GiB   0.04%               1.83kB / 2.46kB     0B / 0B             2</code></p> <p> </p> <p><code>CONTAINER ID        NAME                CPU %               MEM USAGE / LIMIT     MEM %               NET I</code><code>/O</code>             <code>BLOCK I</code><code>/O</code>           <code>PIDS</code></p> <p><code>7d5b76c0f8b2        nginx02             0.00%               1.371MiB / 3.693GiB   0.04%               1.83kB / 2.46kB     0B / 0B             2</code></p> <p> </p> <p><code>CONTAINER ID        NAME                CPU %               MEM USAGE / LIMIT     MEM %               NET I</code><code>/O</code>             <code>BLOCK I</code><code>/O</code>           <code>PIDS</code></p> <p><code>7d5b76c0f8b2        nginx02             0.00%               1.371MiB / 3.693GiB   0.04%               1.83kB / 2.46kB     0B / 0B             2</code></p> <p> </p> <p><code>CONTAINER ID        NAME                CPU %               MEM USAGE / LIMIT     MEM %               NET I</code><code>/O</code>             <code>BLOCK I</code><code>/O</code>           <code>PIDS</code></p> <p><code>7d5b76c0f8b2        nginx02             0.00%               1.371MiB / 3.693GiB   0.04%               1.83kB / 2.46kB     0B / 0B             2</code></p> </td></tr></tbody></table> 
<p>4.7、查看容器的端口</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p><code>[root@ansible-server ~]</code><code># docker port nginx02</code></p> <p><code>80</code><code>/tcp</code> <code>-&gt; 0.0.0.0:8080</code></p> </td></tr></tbody></table> 
<p>4.8、update</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p><code>[root@ansible-server ~]</code><code># docker update --help</code></p> <p> </p> <p><code>Usage:  docker update [OPTIONS] CONTAINER [CONTAINER...]</code></p> <p> </p> <p><code>Update configuration of one or </code><code>more</code> <code>containers</code></p> <p> </p> <p><code>Options:</code></p> <p><code>      </code><code>--blkio-weight uint16        Block IO (relative weight), between 10 and 1000, or 0</code></p> <p><code>                                   </code><code>to disable (default 0)</code></p> <p><code>      </code><code>--cpu-period int             Limit CPU CFS (Completely Fair Scheduler) period</code></p> <p><code>      </code><code>--cpu-</code><code>quota</code> <code>int              Limit CPU CFS (Completely Fair Scheduler) </code><code>quota</code></p> <p><code>      </code><code>--cpu-rt-period int          Limit the CPU real-</code><code>time</code> <code>period </code><code>in</code> <code>microseconds</code></p> <p><code>      </code><code>--cpu-rt-runtime int         Limit the CPU real-</code><code>time</code> <code>runtime </code><code>in</code> <code>microseconds</code></p> <p><code>  </code><code>-c, --cpu-shares int             CPU shares (relative weight)</code></p> <p><code>      </code><code>--cpus decimal               Number of CPUs</code></p> <p><code>      </code><code>--cpuset-cpus string         CPUs </code><code>in</code> <code>which</code> <code>to allow execution (0-3, 0,1)</code></p> <p><code>      </code><code>--cpuset-mems string         MEMs </code><code>in</code> <code>which</code> <code>to allow execution (0-3, 0,1)</code></p> <p><code>      </code><code>--kernel-memory bytes        Kernel memory limit</code></p> <p><code>  </code><code>-m, --memory bytes               Memory limit</code></p> <p><code>      </code><code>--memory-reservation bytes   Memory soft limit</code></p> <p><code>      </code><code>--memory-swap bytes          Swap limit equal to memory plus swap: </code><code>'-1'</code> <code>to </code><code>enable</code></p> <p><code>                                   </code><code>unlimited swap</code></p> <p><code>      </code><code>--restart string             Restart policy to apply when a container exits</code></p> </td></tr></tbody></table> 
<p> 示例：</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p><code>[root@ansible-server ~]</code><code># docker ps -a</code></p> <p><code>CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                  NAMES</code></p> <p><code>7d5b76c0f8b2        nginx               </code><code>"nginx -g 'daemon of…"</code>   <code>22 minutes ago      Up 22 minutes       0.0.0.0:8080-&gt;80</code><code>/tcp</code>   <code>nginx02</code></p> <p><code>c1e98c693e84        centos              </code><code>"/bin/bash"</code>              <code>42 minutes ago      Up 26 minutes                              dreamy_dirac&lt;br&gt;&lt;br&gt;</code><code>#设置容器重启策略</code></p> <p><code>[root@ansible-server ~]</code><code># docker update --restart=always 7d5b76c0f8b2</code></p> <p><code>7d5b76c0f8b2</code></p> </td></tr></tbody></table> 
<h4>五、Volume(数据卷)</h4> 
<p>5.1、将Docker主机数据挂载到容器</p> 
<p>1、保证容器中的数据不丢失</p> 
<p>2、原来容器中的数据，不能容器挂了，数据就拿不出来了。</p> 
<p><img alt="" src="https://images2.imgbox.com/dc/43/22JtPkrW_o.png"></p> 
<p><img alt="" src="https://images2.imgbox.com/66/8e/tyG3ChLt_o.png"></p> 
<p>挂载数据的三种方式：</p> 
<p>1、volumes  (常用)</p> 
<p>[root@ansible-server ~]# ls /var/lib/docker/volumes/<br> metadata.db</p> 
<p>#查看帮助</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p><code>[root@ansible-server ~]</code><code># docker volume --help</code></p> <p> </p> <p><code>Usage:  docker volume COMMAND</code></p> <p> </p> <p><code>Manage volumes</code></p> <p> </p> <p><code>Commands:</code></p> <p><code>  </code><code>create      Create a volume</code></p> <p><code>  </code><code>inspect     Display detailed information on one or </code><code>more</code> <code>volumes</code></p> <p><code>  </code><code>ls</code>          <code>List volumes</code></p> <p><code>  </code><code>prune       Remove all unused </code><code>local</code> <code>volumes</code></p> <p><code>  </code><code>rm</code>          <code>Remove one or </code><code>more</code> <code>volumes</code></p> <p> </p> <p><code>Run </code><code>'docker volume COMMAND --help'</code> <code>for</code> <code>more</code> <code>information on a </code><code>command</code><code>.</code></p> </td></tr></tbody></table> 
<p>2、bind mounts (常用)</p> 
<p>挂载在宿主机上面</p> 
<p>3、tmpfs  (不常用)</p> 
<p>tmpfs是一种基于内存的文件系统，也叫临时文件系统，tmpfs可以使用RAM,也可以使用swap分区存储。它并不是一个块设备，只要安装就可以使用。是基本RAM的文件系统。</p> 
<p><img alt="" height="517" src="https://images2.imgbox.com/1d/77/dCLkIs3s_o.png" width="1060"></p> 
<p>5.2、创建挂载卷，并挂载到容器中</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p><code>#创建卷</code></p> <p><code>[root@ansible-server ~]</code><code># docker volume create nginx-vo1</code></p> <p><code>nginx-vo1</code></p> <p> </p> <p><code>#卷存储位置</code></p> <p><code>[root@ansible-server ~]</code><code># docker volume ls</code></p> <p><code>DRIVER              VOLUME NAME</code></p> <p><code>local</code>               <code>nginx-vo1</code></p> <p> </p> <p><code>#查看卷的详细信息</code></p> <p><code>[root@ansible-server ~]</code><code># docker volume inspect nginx-vo1</code></p> <p><code>[</code></p> <p><code>    </code><code>{<!-- --></code></p> <p><code>        </code><code>"CreatedAt"</code><code>: </code><code>"2019-05-23T17:09:33+08:00"</code><code>,</code></p> <p><code>        </code><code>"Driver"</code><code>: </code><code>"local"</code><code>,</code></p> <p><code>        </code><code>"Labels"</code><code>: {},</code></p> <p><code>        </code><code>"Mountpoint"</code><code>: </code><code>"/var/lib/docker/volumes/nginx-vo1/_data"</code><code>,</code></p> <p><code>        </code><code>"Name"</code><code>: </code><code>"nginx-vo1"</code><code>,</code></p> <p><code>        </code><code>"Options"</code><code>: {},</code></p> <p><code>        </code><code>"Scope"</code><code>: </code><code>"local"</code></p> <p><code>    </code><code>}</code></p> <p><code>]</code></p> <p> </p> <p><code>#挂载卷 </code></p> <p><code>语法：</code></p> <p><code>docker run -itd, nginx的名称,--</code><code>mount</code> <code>src=挂载的数据卷, dst=nginx网站的根目录</code></p> <p><code>[root@ansible-server ~]</code><code># docker run -itd --name=nginx-test --mount src=nginx-vo1,dst=/usr/share/nginx/html nginx</code></p> <p><code>ef9087684fb9ffe8775895215e0bbb13d1a8ad39f5b30c93a171213522df10c5</code></p> <p> </p> <p><code>#查看容器</code></p> <p><code>[root@ansible-server ~]</code><code># docker ps -a</code></p> <p><code>CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                      PORTS               NAMES</code></p> <p><code>ef9087684fb9        nginx               </code><code>"nginx -g 'daemon of…"</code>   <code>3 minutes ago       Up 3 minutes                80</code><code>/tcp</code>              <code>nginx-</code><code>test</code></p> <p><code>7d5b76c0f8b2        nginx               </code><code>"nginx -g 'daemon of…"</code>   <code>45 minutes ago      Exited (0) 22 minutes ago                       nginx02</code></p> <p><code>c1e98c693e84        centos              </code><code>"/bin/bash"</code>              <code>About an hour ago   Up About an hour                                dreamy_dirac</code></p> <p> </p> <p><code>#进入容器</code></p> <p><code>[root@ansible-server ~]</code><code># docker exec -it nginx-test bash</code></p> <p><code>root@ef9087684fb9:/</code><code># </code></p> <p> </p> <p><code>#进入nginx网站根目录</code></p> <p><code>root@ef9087684fb9:/</code><code># cd /usr/share/nginx/html/</code></p> <p> </p> <p><code>#创建一个文件</code></p> <p><code>root@ef9087684fb9:</code><code>/usr/share/nginx/html</code><code># touch 1.html</code></p> <p><code>root@ef9087684fb9:</code><code>/usr/share/nginx/html</code><code># ls</code></p> <p><code>1.html  50x.html  index.html</code></p> <p> </p> <p><code>#查看容器外面宿主机目录中是否有这几个文件（备注：再开一个终端）</code></p> <p><code>[root@ansible-server ~]</code><code># cd /var/lib/docker/volumes/nginx-vo1/_data/</code></p> <p><code>[root@ansible-server _data]</code><code># ls</code></p> <p><code>1.html  50x.html  index.html</code></p> </td></tr></tbody></table> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p><code>[root@ansible-server _data]</code><code># exit</code></p> </td></tr></tbody></table> 
<p>5.3、演示容器删除了，数据卷的数据还在</p> 
<p>(备注：如果在容器中删除了数据，那么本地也会跟着删除)</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p><code>#创建10个文件</code></p> <p><code>root@ef9087684fb9:</code><code>/usr/share/nginx/html</code><code># touch {1..10}.txt</code></p> <p> </p> <p><code>root@ef9087684fb9:</code><code>/usr/share/nginx/html</code><code># ls</code></p> <p><code>1.txt  10.txt  2.txt  3.txt  4.txt  5.txt  50x.html  6.txt  7.txt  8.txt  9.txt  index.html</code></p> <p> </p> <p><code>root@ef9087684fb9:</code><code>/usr/share/nginx/html</code><code># exit</code></p> <p><code>exit</code></p> <p> </p> <p><code>#删除所有容器</code></p> <p><code>[root@ansible-server ~]</code><code># docker rm -f $(docker ps -q -a)</code></p> <p><code>ef9087684fb9</code></p> <p><code>7d5b76c0f8b2</code></p> <p><code>c1e98c693e84</code></p> <p> </p> <p><code>#查看容器</code></p> <p><code>[root@ansible-server ~]</code><code># docker ps -a</code></p> <p><code>CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</code></p> <p> </p> <p><code>#查看数据卷</code></p> <p><code>[root@ansible-server _data]</code><code># cd /var/lib/docker/volumes/nginx-vo1/_data</code></p> <p><code>[root@ansible-server _data]</code><code># ls</code></p> <p><code>10.txt  1.txt  2.txt  3.txt  4.txt  50x.html  5.txt  6.txt  7.txt  8.txt  9.txt  index.html</code></p> </td></tr></tbody></table> 
<p>5.4、运行容器，增加端口，再通过本地数据卷中写入一个a.html的文件。再用浏览器访问他看是否可以打开</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p><code>#再运行容器，增加端口</code></p> <p><code>[root@ansible-server ~]</code><code># docker run -itd --name=nginx-test -p 8080:80 --mount src=nginx-vo1,dst=/usr/share/nginx/html nginx</code></p> <p><code>7c82062a7435997717a938a252684ee5832caafe089d97ebf3948010951ae18a</code></p> <p><code>[root@ansible-server ~]</code><code># docker ps -a</code></p> <p><code>CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES</code></p> <p><code>7c82062a7435 nginx </code><code>"nginx -g 'daemon of…"</code> <code>4 seconds ago Up 2 seconds 0.0.0.0:8080-&gt;80</code><code>/tcp</code> <code>nginx-</code><code>test</code></p> <p> </p> <p><code>#容器数据卷存储目录</code></p> <p><code>[root@ansible-server _data]</code><code># cd /var/lib/docker/volumes/nginx-vo1/_data</code></p> <p><code>[root@ansible-server _data]</code><code># ls</code></p> <p><code>10.txt 1.txt 2.txt 3.txt 4.txt 50x.html 5.txt 6.txt 7.txt 8.txt 9.txt index.html</code></p> <p> </p> <p><code>#创建一个html的文件</code></p> <p><code>[root@ansible-server _data]</code><code># vi a.html</code></p> <p><code>&lt;h&gt;welcome nulige&lt;</code><code>/n</code><code>&gt;</code></p> <p> </p> <p><code>#通过浏览器进行访问</code></p> <p><code>http:</code><code>//59</code><code>.47.71.229:8080</code><code>/a</code><code>.html</code></p> <p><code>返回结果：</code></p> <p><code>welcome nulige</code></p> </td></tr></tbody></table> 
<p>5.5、实现数据卷共享他们的数据</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p><code>#数据卷可以共享他们的数据</code></p> <p><code>[root@ansible-server ~]</code><code># docker run -itd --name=nginx-test -p 8080:80 --mount src=nginx-vo1,dst=/usr/share/nginx/html nginx</code></p> <p><code>7c82062a7435997717a938a252684ee5832caafe089d97ebf3948010951ae18a</code></p> <p> </p> <p><code>#本地数据卷目录</code></p> <p><code>[root@ansible-server _data]</code><code># cd /var/lib/docker/volumes/nginx-vo1/_data</code></p> <p> </p> <p><code>[root@ansible-server _data]</code><code># ls</code></p> <p><code>50x.html index.html</code></p> <p> </p> <p><code>#创建一个文件</code></p> <p><code>[root@ansible-server _data]</code><code># vi a.html</code></p> <p><code>&lt;h&gt;welcome nulige&lt;</code><code>/n</code><code>&gt;</code></p> <p> </p> <p><code>#查看文件</code></p> <p><code>[root@ansible-server _data]</code><code># ls</code></p> <p><code>50x.html a.html  index.html</code></p> <p> </p> <p><code>#通过再创建一个容器，共享上面这个数据卷。实现了数据共享，多个nginx服务都访问同一个数据卷。这里有点像nginx访问nfs共享文件夹的功能。</code></p> <p><code>[root@ansible-server ~]</code><code># docker run -itd --name=nginx-test02 -p 8081:80 --mount src=nginx-vo1,dst=/usr/share/nginx/html nginx</code></p> <p><code>6e984d5e99a43487e616e92d75a9e9c57c4da3a0d7f0833c37f46072c3673970</code></p> <p> </p> <p><code>[root@ansible-server ~]</code><code># docker ps -a</code></p> <p><code>CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                  NAMES</code></p> <p><code>6e984d5e99a4        nginx               </code><code>"nginx -g 'daemon of…"</code>   <code>16 seconds ago      Up 14 seconds       0.0.0.0:8081-&gt;80</code><code>/tcp</code>   <code>nginx-test02</code></p> <p><code>7c82062a7435        nginx               </code><code>"nginx -g 'daemon of…"</code>   <code>43 minutes ago      Up 43 minutes       0.0.0.0:8080-&gt;80</code><code>/tcp</code>   <code>nginx-</code><code>test</code></p> </td></tr></tbody></table> 
<p>5.6、没有指定数据卷，他默认会创建数据库</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p><code>#没有指定数据卷，他默认会自动创建数据卷</code></p> <p><code>卷分类：</code></p> <p><code>一种是：命名卷，自己指定的卷</code></p> <p><code>一种是：匿名卷，系统默认创建的卷</code></p> <p><code>&lt;br&gt;</code><code>#创建匿名卷</code></p> </td></tr></tbody></table> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p><code>[root@ansible-server ~]</code><code># docker run -itd --name=nginx-test03 -p 8082:80 --mount src=,dst=/usr/share/nginx/html nginx bcbdee85ae6d005971649a802484dacc8b6aca6f96adf70ef4c4ba3dab32bee9 &lt;br&gt;#查看卷</code></p> <p><code>[root@ansible-server ~]</code><code># docker volume ls</code></p> <p><code>DRIVER              VOLUME NAME</code></p> <p><code>local</code>               <code>92dbb978ec9d767fee49b1cdb440cd45ada36feb42b064132ba152150780fe67 </code><code>#匿名卷</code></p> <p><code>local</code>               <code>nginx-vo1  </code><code>#命名卷</code></p> </td></tr></tbody></table> 
<p>5.7、通过bind挂载数据卷</p> 
<p><img alt="" src="https://images2.imgbox.com/8b/f4/9RNgNbfR_o.png"></p> 
<p>示例：</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p><code>#删除容器</code></p> <p><code>[root@ansible-server ~]</code><code># docker rm -f $(docker ps -q -a)</code></p> <p><code>bcbdee85ae6d</code></p> <p><code>6e984d5e99a4</code></p> <p><code>7c82062a7435</code></p> <p> </p> <p><code>#绑定系统中已经存在的卷,src=app，这个目录必须存在，否则会报错</code></p> <p><code>加参数：</code><code>type</code><code>=bind</code></p> <p> </p> <p><code>先创建一个文件夹</code></p> <p><code>[root@ansible-server ~]</code><code># mkdir -p /app/wwwroot</code></p> <p> </p> <p><code>再绑定到这个文件夹中</code></p> <p><code>[root@ansible-server ~]</code><code># docker run -itd --name=nginx-test --mount type=bind,src=/app/wwwroot,dst=/usr/share/nginx/html nginx</code></p> <p><code>02c1bdaab564b3add7bbe0ac9b289e616e4bc40c965ff9824188bb99ed1fccb2</code></p> <p> </p> <p><code>[root@ansible-server ~]</code><code># docker ps -a</code></p> <p><code>CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES</code></p> <p><code>02c1bdaab564        nginx               </code><code>"nginx -g 'daemon of…"</code>   <code>5 seconds ago       Up 3 seconds        80</code><code>/tcp</code>              <code>nginx-</code><code>test</code></p> <p> </p> <p><code>#进入容器</code></p> <p><code>[root@ansible-server ~]</code><code># docker exec -it nginx-test bash</code></p> <p> </p> <p><code>#查看mount是否挂载到/usr/share/nginx/html目录</code></p> <p><code>root@02c1bdaab564:/</code><code># mount</code></p> <p><code>overlay on / </code><code>type</code> <code>overlay (rw,relatime,seclabel,lowerdir=</code><code>/var/lib/docker/overlay2/l/3QG6SC3NFVC6UJJQNVQGSHSCJV</code><code>:</code><code>/var/lib/docker/overlay2/l/IDJTHZBOQVLBQ7TISUNIWAAKS4</code><code>:</code><code>/var/lib/docker/overlay2/l/57TQY5XX7CMEROHBTYSQYNQTFY</code><code>:</code><code>/var/lib/docker/overlay2/l/FBBYWNRKKGDXOBECYPD3KFPUZN</code><code>,upperdir=</code><code>/var/lib/docker/overlay2/e7815303046019f7b9a48c1b1549bd46d25a5011aded5c61a4ca11620880f91d/diff</code><code>,workdir=</code><code>/var/lib/docker/overlay2/e7815303046019f7b9a48c1b1549bd46d25a5011aded5c61a4ca11620880f91d/work</code><code>)</code></p> <p><code>proc on </code><code>/proc</code> <code>type</code> <code>proc (rw,nosuid,nodev,noexec,relatime)</code></p> <p><code>tmpfs on </code><code>/dev</code> <code>type</code> <code>tmpfs (rw,nosuid,seclabel,size=65536k,mode=755)</code></p> <p><code>devpts on </code><code>/dev/pts</code> <code>type</code> <code>devpts (rw,nosuid,noexec,relatime,seclabel,gid=5,mode=620,ptmxmode=666)</code></p> <p><code>sysfs on </code><code>/sys</code> <code>type</code> <code>sysfs (ro,nosuid,nodev,noexec,relatime,seclabel)</code></p> <p><code>tmpfs on </code><code>/sys/fs/cgroup</code> <code>type</code> <code>tmpfs (ro,nosuid,nodev,noexec,relatime,seclabel,mode=755)</code></p> <p><code>cgroup on </code><code>/sys/fs/cgroup/systemd</code> <code>type</code> <code>cgroup (ro,nosuid,nodev,noexec,relatime,seclabel,xattr,release_agent=</code><code>/usr/lib/systemd/systemd-cgroups-agent</code><code>,name=systemd)</code></p> <p><code>cgroup on </code><code>/sys/fs/cgroup/perf_event</code> <code>type</code> <code>cgroup (ro,nosuid,nodev,noexec,relatime,seclabel,perf_event)</code></p> <p><code>cgroup on </code><code>/sys/fs/cgroup/blkio</code> <code>type</code> <code>cgroup (ro,nosuid,nodev,noexec,relatime,seclabel,blkio)</code></p> <p><code>cgroup on </code><code>/sys/fs/cgroup/cpuset</code> <code>type</code> <code>cgroup (ro,nosuid,nodev,noexec,relatime,seclabel,cpuset)</code></p> <p><code>cgroup on </code><code>/sys/fs/cgroup/memory</code> <code>type</code> <code>cgroup (ro,nosuid,nodev,noexec,relatime,seclabel,memory)</code></p> <p><code>cgroup on </code><code>/sys/fs/cgroup/cpu</code><code>,cpuacct </code><code>type</code> <code>cgroup (ro,nosuid,nodev,noexec,relatime,seclabel,cpuacct,cpu)</code></p> <p><code>cgroup on </code><code>/sys/fs/cgroup/net_cls</code><code>,net_prio </code><code>type</code> <code>cgroup (ro,nosuid,nodev,noexec,relatime,seclabel,net_prio,net_cls)</code></p> <p><code>cgroup on </code><code>/sys/fs/cgroup/devices</code> <code>type</code> <code>cgroup (ro,nosuid,nodev,noexec,relatime,seclabel,devices)</code></p> <p><code>cgroup on </code><code>/sys/fs/cgroup/pids</code> <code>type</code> <code>cgroup (ro,nosuid,nodev,noexec,relatime,seclabel,pids)</code></p> <p><code>cgroup on </code><code>/sys/fs/cgroup/freezer</code> <code>type</code> <code>cgroup (ro,nosuid,nodev,noexec,relatime,seclabel,freezer)</code></p> <p><code>cgroup on </code><code>/sys/fs/cgroup/hugetlb</code> <code>type</code> <code>cgroup (ro,nosuid,nodev,noexec,relatime,seclabel,hugetlb)</code></p> <p><code>mqueue on </code><code>/dev/mqueue</code> <code>type</code> <code>mqueue (rw,nosuid,nodev,noexec,relatime,seclabel)</code></p> <p><code>/dev/mapper/centos-root</code> <code>on </code><code>/etc/resolv</code><code>.conf </code><code>type</code> <code>xfs (rw,relatime,seclabel,attr2,inode64,noquota)</code></p> <p><code>/dev/mapper/centos-root</code> <code>on </code><code>/etc/hostname</code> <code>type</code> <code>xfs (rw,relatime,seclabel,attr2,inode64,noquota)</code></p> <p><code>/dev/mapper/centos-root</code> <code>on </code><code>/etc/hosts</code> <code>type</code> <code>xfs (rw,relatime,seclabel,attr2,inode64,noquota)</code></p> <p><code>shm on </code><code>/dev/shm</code> <code>type</code> <code>tmpfs (rw,nosuid,nodev,noexec,relatime,seclabel,size=65536k)</code></p> <p><code>/dev/mapper/centos-root</code> <code>on </code><code>/usr/share/nginx/html</code> <code>type</code> <code>xfs (rw,relatime,seclabel,attr2,inode64,noquota)</code></p> <p><code>devpts on </code><code>/dev/console</code> <code>type</code> <code>devpts (rw,nosuid,noexec,relatime,seclabel,gid=5,mode=620,ptmxmode=666)</code></p> <p><code>proc on </code><code>/proc/bus</code> <code>type</code> <code>proc (ro,relatime)</code></p> <p><code>proc on </code><code>/proc/fs</code> <code>type</code> <code>proc (ro,relatime)</code></p> <p><code>proc on </code><code>/proc/irq</code> <code>type</code> <code>proc (ro,relatime)</code></p> <p><code>proc on </code><code>/proc/sys</code> <code>type</code> <code>proc (ro,relatime)</code></p> <p><code>proc on </code><code>/proc/sysrq-trigger</code> <code>type</code> <code>proc (ro,relatime)</code></p> <p><code>tmpfs on </code><code>/proc/acpi</code> <code>type</code> <code>tmpfs (ro,relatime,seclabel)</code></p> <p><code>tmpfs on </code><code>/proc/kcore</code> <code>type</code> <code>tmpfs (rw,nosuid,seclabel,size=65536k,mode=755)</code></p> <p><code>tmpfs on </code><code>/proc/keys</code> <code>type</code> <code>tmpfs (rw,nosuid,seclabel,size=65536k,mode=755)</code></p> <p><code>tmpfs on </code><code>/proc/timer_list</code> <code>type</code> <code>tmpfs (rw,nosuid,seclabel,size=65536k,mode=755)</code></p> <p><code>tmpfs on </code><code>/proc/timer_stats</code> <code>type</code> <code>tmpfs (rw,nosuid,seclabel,size=65536k,mode=755)</code></p> <p><code>tmpfs on </code><code>/proc/sched_debug</code> <code>type</code> <code>tmpfs (rw,nosuid,seclabel,size=65536k,mode=755)</code></p> <p><code>tmpfs on </code><code>/proc/scsi</code> <code>type</code> <code>tmpfs (ro,relatime,seclabel)</code></p> <p><code>tmpfs on </code><code>/sys/firmware</code> <code>type</code> <code>tmpfs (ro,relatime,seclabel)</code></p> <p> </p> <p><code>#备注：通过bind挂载的容器，他会隐藏掉文件夹下面的内容</code></p> <p><code>root@02c1bdaab564:/</code><code># cd /usr/share/nginx/html/</code></p> <p><code>root@02c1bdaab564:</code><code>/usr/share/nginx/html</code><code># ls</code></p> <p> </p> <p><code>#再开一个终端</code></p> <p><code>[root@ansible-server _data]</code><code># cd /app/wwwroot/</code></p> <p> </p> <p><code>#往里面写入点内容</code></p> <p><code>[root@ansible-server wwwroot]</code><code># echo "&lt;h&gt;welcome nulige &lt;/h&gt;" &gt;index.html </code></p> <p><code>[root@ansible-server wwwroot]</code><code># cat index.html </code></p> <p><code>&lt;h&gt;welcome nulige&lt;</code><code>/h</code><code>&gt;</code></p> <p> </p> <p><code>#再到容器中查看</code></p> <p><code>[root@ansible-server ~]</code><code># docker exec -it nginx-test bash</code></p> <p><code>       </code> </p> <p><code>root@02c1bdaab564:/</code><code># cd /usr/share/nginx/html/   </code></p> <p><code>        </code> </p> <p><code>root@02c1bdaab564:</code><code>/usr/share/nginx/html</code><code># ls</code></p> <p><code>index.html</code></p> <p> </p> <p><code>root@02c1bdaab564:</code><code>/usr/share/nginx/html</code><code># cat index.html </code></p> <p><code>&lt;h&gt;welcome nulige &lt;</code><code>/h</code><code>&gt;</code></p> </td></tr></tbody></table> 
<p>#bind的应用场景</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p><code>1、用在tomcat的部署中，直接生成jar包，挂载到部署目录中。</code></p> <p><code>ls</code> <code>target</code><code>/xxx</code><code>.war jar</code></p> </td></tr></tbody></table> 
<h4><strong>六、应用案例</strong></h4> 
<p>6.1、搭建LNMP网站平台实战</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p><code>一、搭建LNMP网站平台（nginx+php+mysql）</code></p> <p><code>1、创建网络</code></p> <p><code>[root@ansible-server ~]</code><code># docker network create lnmp</code></p> <p><code>#查看网络</code></p> <p><code>[root@ansible-server ~]</code><code># docker network ls</code></p> <p><code>NETWORK ID          NAME                DRIVER              SCOPE</code></p> <p><code>b892a0991d9d        bridge              bridge              </code><code>local</code></p> <p><code>f5f547cc8686        host                host                </code><code>local</code></p> <p><code>35b5589b014b        lnmp                bridge              </code><code>local</code></p> <p><code>a480fd78ff5a        none                null                </code><code>local</code></p> <p> </p> <p><code>2、创建Mysql数据库容器</code></p> <p><code>docker run -itd \</code></p> <p><code>--name lnmp_mysql \</code></p> <p><code>--net lnmp \</code></p> <p><code>-p 3306:3306 \</code></p> <p><code>--</code><code>mount</code> <code>src=mysql-vol,dst=</code><code>/var/lib/mysql</code> <code>\</code></p> <p><code>-e MYSQL_ROOT_PASSWORD=123456 \</code></p> <p><code>mysql --character-</code><code>set</code><code>-server=utf8</code></p> <p> </p> <p><code>#查看数据卷</code></p> <p><code>[root@ansible-server ~]</code><code># docker volume ls</code></p> <p><code>DRIVER              VOLUME NAME</code></p> <p><code>local</code>               <code>92dbb978ec9d767fee49b1cdb440cd45ada36feb42b064132ba152150780fe67</code></p> <p><code>local</code>               <code>mysql-vol</code></p> <p><code>local</code>               <code>nginx-vo1</code></p> <p> </p> <p><code>#数据卷目录存放地址</code></p> <p><code>[root@ansible-server ~]</code><code># ls /var/lib/docker/volumes/mysql-vol/_data/</code></p> <p><code>auto.cnf       ca-key.pem       ib_buffer_pool  ibtmp1        performance_schema  server-key.pem</code></p> <p><code>binlog.000001  ca.pem           ibdata1         </code><code>#innodb_temp  private_key.pem     sys</code></p> <p><code>binlog.000002  client-cert.pem  ib_logfile0     mysql         public_key.pem      undo_001</code></p> <p><code>binlog.index   client-key.pem   ib_logfile1     mysql.ibd     server-cert.pem     undo_002</code></p> <p> </p> <p><code>#查看lnmp_mysql日志</code></p> <p><code>[root@ansible-server ~]</code><code># docker logs lnmp_mysql</code></p> <p> </p> <p><code>#查看top</code></p> <p><code>[root@ansible-server ~]</code><code># docker top lnmp_mysql</code></p> <p><code>UID                 PID                 PPID                C                   STIME               TTY                 TIME                CMD</code></p> <p><code>polkitd             5896                5879                2                   11:07               pts</code><code>/0</code>               <code>00:00:08            mysqld --character-</code><code>set</code><code>-server=utf8</code></p> <p> </p> <p><code>3、创建所需数据库</code></p> <p><code>[root@ansible-server ~]</code><code># docker exec lnmp_mysql sh -c 'exec mysql -uroot -p"$MYSQL_ROOT_PASSWORD" -e "create database wordpress"'</code></p> <p><code>#提示密码不安全</code></p> <p><code>mysql: [Warning] Using a password on the </code><code>command</code> <code>line interface can be insecure.</code></p> <p> </p> <p><code>#查看数据库</code></p> <p><code>[root@ansible-server ~]</code><code># docker exec lnmp_mysql sh -c 'exec mysql -uroot -p"123456" -h 59.47.71.229 -e "show databases;"'</code></p> <p><code>mysql: [Warning] Using a password on the </code><code>command</code> <code>line interface can be insecure.</code></p> <p><code>Database</code></p> <p><code>information_schema</code></p> <p><code>mysql</code></p> <p><code>performance_schema</code></p> <p><code>sys</code></p> <p><code>wordpress</code></p> <p> </p> <p><code>4、创建PHP环境容器(备注：镜像中包括：nginx+php-fpm)</code></p> <p><code>docker run -itd \</code></p> <p><code>--name lnmp_web \</code></p> <p><code>--net lnmp \</code></p> <p><code>-p 88:80 \</code></p> <p><code>--</code><code>mount</code> <code>type</code><code>=bind,src=</code><code>/app/wwwroot</code><code>,dst=</code><code>/var/www/html</code> <code>richarvey</code><code>/nginx-php-fpm</code></p> <p> </p> <p><code>#查看容器</code></p> <p><code>[root@ansible-server wordpress]</code><code># docker ps -a</code></p> <p><code>CONTAINER ID        IMAGE                     COMMAND                  CREATED             STATUS              PORTS                                   NAMES</code></p> <p><code>6de0d790b079        richarvey</code><code>/nginx-php-fpm</code>   <code>"docker-php-entrypoi…"</code>   <code>9 minutes ago       Up 9 minutes        443</code><code>/tcp</code><code>, 9000</code><code>/tcp</code><code>, 0.0.0.0:88-&gt;80</code><code>/tcp</code>   <code>lnmp_web</code></p> <p><code>cee253e2ef97        mysql                     </code><code>"docker-entrypoint.s…"</code>   <code>12 minutes ago      Up 12 minutes       0.0.0.0:3306-&gt;3306</code><code>/tcp</code><code>, 33060</code><code>/tcp</code>       <code>lnmp_mysql</code></p> <p> </p> <p><code>5、以wordpress博客为例测试</code></p> <p><code>wget https:</code><code>//cn</code><code>.wordpress.org</code><code>/wordpress-4</code><code>.7.4-zh_CN.</code><code>tar</code><code>.gz</code></p> <p><code>tar</code> <code>zxf wordpress-4.7.4-zh_CN.</code><code>tar</code><code>.gz -C </code><code>/app/wwwroot</code></p> <p> </p> <p><code>#查看解压文件</code></p> <p><code>[root@ansible-server ~]</code><code># ls /app/wwwroot/</code></p> <p><code>index.html  wordpress</code></p> <p> </p> <p><code>[root@ansible-server wordpress]</code><code># iptables -I INPUT -s 0.0.0.0/0 -d 0.0.0.0/0 -j ACCEPT</code></p> <p><code>[root@ansible-server wordpress]</code><code># service iptables save</code></p> <p><code>[root@ansible-server wordpress]</code><code># service iptables restart</code></p> <p> </p> <p><code>6、浏览器测试访问</code></p> <p><code>http:</code><code>//59</code><code>.47.71.229:88</code><code>/wordpress</code></p> <p> </p> <p><code>#访问后会跳转到</code></p> <p><code>http:</code><code>//59</code><code>.47.71.229:88</code><code>/wordpress/wp-admin/setup-config</code><code>.php</code></p> </td></tr></tbody></table>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/3359ec734ee399858b6adefe877039fe/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">后台如何接收LocalDateTime类型</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/49747dc67b9bca944d6819eb7377ba5c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">1. 关于系统架构师</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>