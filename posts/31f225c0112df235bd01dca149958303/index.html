<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>java 不验证证书,不带身份验证信任证书的JavaMail SSL，无论如何 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="java 不验证证书,不带身份验证信任证书的JavaMail SSL，无论如何" />
<meta property="og:description" content="I have a local mail server (hMailServer) with SSL (port 465) and a self-signed certificate.
Domain is &#34;foobar.com&#34;
I have setup my Properties to enable ssl, disable auth, and trust any host
props.put(&#34;mail.smtp.auth&#34;, &#34;false&#34;);
props.put(&#34;mail.smtp.ssl.enable&#34;, &#34;true&#34;);
props.put(&#34;mail.smtp.ssl.trust&#34;, &#34;*&#34;);
If I send the message through the static call to Transport.send()
The email gets delivered.
If I try to get a transport instance from the session then I get
javax.net.ssl.SSLHandshakeException: sun.security.validator.ValidatorException: PKIX path building failed: sun." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/31f225c0112df235bd01dca149958303/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-02-24T03:09:20+08:00" />
<meta property="article:modified_time" content="2021-02-24T03:09:20+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">java 不验证证书,不带身份验证信任证书的JavaMail SSL，无论如何</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div style="font-size:16px;"> 
 <p align="center"><img src="" alt=""></p> 
 <p>I have a local mail server (hMailServer) with SSL (port 465) and a self-signed certificate.</p> 
 <p>Domain is "foobar.com"</p> 
 <p>I have setup my Properties to enable ssl, disable auth, and trust any host</p> 
 <p>props.put("mail.smtp.auth", "false");</p> 
 <p>props.put("mail.smtp.ssl.enable", "true");</p> 
 <p>props.put("mail.smtp.ssl.trust", "*");</p> 
 <p>If I send the message through the static call to Transport.send()</p> 
 <p>The email gets delivered.</p> 
 <p>If I try to get a transport instance from the session then I get</p> 
 <p>javax.net.ssl.SSLHandshakeException: sun.security.validator.ValidatorException: PKIX path building failed: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target</p> 
 <p>How does the static call avoids the SSLHandshakeException?</p> 
 <p>Here's my tester code:</p> 
 <p>public static void main(String[] args) throws Exception {<!-- --></p> 
 <p>Properties props = new Properties();</p> 
 <p>props.put("mail.smtp.host", "127.0.0.1");</p> 
 <p>props.put("mail.debug", "false");</p> 
 <p>props.put("mail.smtp.port", "465");</p> 
 <p>props.put("mail.smtp.timeout", "60000");</p> 
 <p>props.put("mail.smtp.auth", "false");</p> 
 <p>props.put("mail.smtp.sendpartial", "true");</p> 
 <p>props.put("mail.smtp.ssl.enable", "true");</p> 
 <p>props.put("mail.smtp.ssl.trust", "*");</p> 
 <p>Session session = Session.getInstance(props);</p> 
 <p>Message message = new MimeMessage(session);</p> 
 <p>message.setFrom(new InternetAddress("mrFoo@foobar.com"));</p> 
 <p>message.setRecipients(Message.RecipientType.TO, InternetAddress.parse("you@foobar.com"));</p> 
 <p>message.setSubject("Just a Test " + new Date());</p> 
 <p>message.setText("Hello World");</p> 
 <p>//Comment and uncomment to test</p> 
 <p>Transport.send(message, message.getAllRecipients());</p> 
 <p>//Transport t = session.getTransport("smtps");</p> 
 <p>//t.connect();</p> 
 <p>//t.sendMessage(message, message.getAllRecipients());</p> 
 <p>//t.close();</p> 
 <p>}</p> 
 <p>This is a local system hidden from the outside, so I am not worried about man in the middle attack generating their own certificates to bypass the SSL Handshake...</p> 
 <p>解决方案</p> 
 <p>You asked for an "smtps" transport. You set the properties for the "smtp" transport. Since you've set the "mail.smtp.ssl.enable" property to "true", you can just ask for an "smtp" transport and it will use SSL.</p> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/2c0cca51464e6843305a47ac92b14ab3/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Java 堆 栈面试题_Java工程师面试题：Java的堆，栈，方法区你都搞清楚了吗?</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ec02a80251d75f94469dd76df246df19/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">女生适合学习java什么_女生不适合学习java吗？其实不是这样的，女生往往更有优势！...</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>