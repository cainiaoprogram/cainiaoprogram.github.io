<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>mysql5.6主从不报错_mysql5.6 主从配置 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="mysql5.6主从不报错_mysql5.6 主从配置" />
<meta property="og:description" content="参考网址：http://www.cnblogs.com/zhoujie/p/mysql1.html
http://kerry.blog.51cto.com/172631/277414/
1、配置主库：
1)、授权给从数据库服务器
mysql&gt;GRANT REPLICATION SLAVE ON *.* to &#39;rep1&#39;@&#39;192.168.8.11&#39; identified by &#39;test123456&#39;;
mysql&gt;FLUSH PRIVILEGES;
2)、修改主库配置文件，开启binlog，并设置server-id，每次修改配置文件后都要重启mysql服务才会生效
vim /etc/my.cnf
在该配置文件[mysqld]下面添加下面内容：
[mysqld]
log-bin=/var/lib/mysql/binlog
server-id=1
binlog-do-db =cmdb
datadir=/var/lib/mysql
socket=/var/lib/mysql/mysql.sock
......
server-id：master端的ID号；
log-bin：同步的日志路径及文件名，一定注意这个目录要是mysql有权限写入的(我这里是偷懒了，直接放在了下面那个datadir下面)；
binlog-do-db：要同步的数据库名
还可以显示 设置不同步的数据库：
binlog-ignore-db = mysql 不同步mysql库和test库
binlog-ignore-db = test
修改配置文件后，重启服务：service mysqld restart
mysql&gt;show master status;&#43;---------------&#43;----------&#43;--------------&#43;------------------&#43;
| File | Position | Binlog_Do_DB | Binlog_Ignore_DB |
&#43;---------------&#43;----------&#43;--------------&#43;------------------&#43;
| binlog.000001 | 1304 | cmdb | |
&#43;---------------&#43;----------&#43;--------------&#43;------------------&#43;
1 row in set (0." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/c2b79458670e3df6119a281eef1517de/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-02-18T09:51:27+08:00" />
<meta property="article:modified_time" content="2021-02-18T09:51:27+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">mysql5.6主从不报错_mysql5.6 主从配置</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div style="font-size:16px;"> 
 <p>参考网址：http://www.cnblogs.com/zhoujie/p/mysql1.html</p> 
 <p>http://kerry.blog.51cto.com/172631/277414/</p> 
 <p>1、配置主库：</p> 
 <p>1)、授权给从数据库服务器</p> 
 <p>mysql&gt;GRANT REPLICATION SLAVE ON *.* to 'rep1'@'192.168.8.11' identified by 'test123456';</p> 
 <p>mysql&gt;FLUSH PRIVILEGES;</p> 
 <p>2)、修改主库配置文件，开启binlog，并设置server-id，每次修改配置文件后都要重启mysql服务才会生效</p> 
 <p>vim /etc/my.cnf</p> 
 <p>在该配置文件[mysqld]下面添加下面内容：</p> 
 <p align="center"><img src="https://images2.imgbox.com/c5/f8/jCVMEaA6_o.png" alt="48304ba5e6f9fe08f3fa1abda7d326ab.png"></p> 
 <p>[mysqld]</p> 
 <p>log-bin=/var/lib/mysql/binlog</p> 
 <p>server-id=1</p> 
 <p>binlog-do-db =cmdb</p> 
 <p>datadir=/var/lib/mysql</p> 
 <p>socket=/var/lib/mysql/mysql.sock</p> 
 <p>......</p> 
 <p align="center"><img src="https://images2.imgbox.com/5f/cb/pPZIVqj4_o.png" alt="48304ba5e6f9fe08f3fa1abda7d326ab.png"></p> 
 <p>server-id：master端的ID号；</p> 
 <p>log-bin：同步的日志路径及文件名，一定注意这个目录要是mysql有权限写入的(我这里是偷懒了，直接放在了下面那个datadir下面)；</p> 
 <p>binlog-do-db：要同步的数据库名</p> 
 <p>还可以显示 设置不同步的数据库：</p> 
 <p>binlog-ignore-db = mysql 不同步mysql库和test库</p> 
 <p>binlog-ignore-db = test</p> 
 <p>修改配置文件后，重启服务：service mysqld restart</p> 
 <p>mysql&gt;show master status;+---------------+----------+--------------+------------------+</p> 
 <p>| File | Position | Binlog_Do_DB | Binlog_Ignore_DB |</p> 
 <p>+---------------+----------+--------------+------------------+</p> 
 <p>| binlog.000001 | 1304 | cmdb | |</p> 
 <p>+---------------+----------+--------------+------------------+</p> 
 <p>1 row in set (0.00 sec)</p> 
 <p>2、配置从库</p> 
 <p>1)、理所当然也是从配置文件着手，在/etc/my.cnf 添加下面配置：</p> 
 <p align="center"><img src="https://images2.imgbox.com/a2/37/SDTYSnAH_o.png" alt="48304ba5e6f9fe08f3fa1abda7d326ab.png"></p> 
 <p>[mysqld]</p> 
 <p>server-id=2</p> 
 <p>登陆从数据库，创建cmdb数据库</p> 
 <p>，然后执行下面的语句</p> 
 <p>mysql&gt; CHANGE MASTER TO MASTER_HOST='192.168.8.10',</p> 
 <p>MASTER_PORT=3306,</p> 
 <p>MASTER_USER='rep1',</p> 
 <p>MASTER_PASSWORD='test123456',</p> 
 <p>MASTER_LOG_FILE='binlog.000001',</p> 
 <p>MASTER_LOG_POS=1304; #后面两个参数的值与主库保持一致</p> 
 <p>2)、启动slave进程</p> 
 <p>mysql&gt;</p> 
 <p>startslave ;</p> 
 <p>Query OK, 0 rows affected (0.04 sec)</p> 
 <p>3)、查看slave的状态，如果下面两项值为YES，则表示配置正确：</p> 
 <p>Slave_IO_Running: Yes</p> 
 <p>Slave_SQL_Running: Yes</p> 
 <p align="center"><img src="https://images2.imgbox.com/68/0b/2DMreQjS_o.png" alt="e2a73225ca93115774dbf8211faee86e.png"></p> 
 <p>从库正在等待主库更新数据。。。Waitin for master to send event...</p> 
 <p>Slave_SQL_Running: No mysql同步故障解决方法</p> 
 <p>Slave_SQL_Running: No mysql同步故障解决</p> 
 <p>今天检查数据库发现一台MySQL Slave未和主机同步，查看Slave状态：</p> 
 <p>mysql&gt; show slave statusG</p> 
 <p>Slave_IO_Running: Yes</p> 
 <p>Slave_SQL_Running: No</p> 
 <p>Last_Errno: 1062</p> 
 <p>....</p> 
 <p>Seconds_Behind_Master:NULL</p> 
 <p>原因：</p> 
 <p>1.程序可能在slave上进行了写操作</p> 
 <p>2.也可能是slave机器重起后，事务回滚造成的.</p> 
 <p>解决办法I：</p> 
 <p>1.首先停掉Slave服务：slave stop</p> 
 <p>2.到主服务器上查看主机状态：</p> 
 <p>记录File和Position对应的值。</p> 
 <p>mysql&gt; show master status;</p> 
 <p>+------------------+-----------+--------------+------------------+</p> 
 <p>| File | Position | Binlog_Do_DB | Binlog_Ignore_DB |</p> 
 <p>+------------------+-----------+--------------+------------------+</p> 
 <p>| mysql-bin.000020 | 135617781 | | |</p> 
 <p>+------------------+-----------+--------------+------------------+</p> 
 <p>1 row in set (0.00 sec)</p> 
 <p>3.到slave服务器上执行手动同步：</p> 
 <p>mysql&gt; change master to</p> 
 <p>&gt; master_host='master_ip',</p> 
 <p>&gt; master_user='user',</p> 
 <p>&gt; master_password='pwd',</p> 
 <p>&gt; master_port=3307,</p> 
 <p>&gt; master_log_file='mysql-bin.000020',</p> 
 <p>&gt; master_log_pos=135617781;</p> 
 <p>1 row in set (0.00 sec)</p> 
 <p>mysql&gt; slave start;</p> 
 <p>1 row in set (0.00 sec)</p> 
 <p>再次查看slave状态发现：</p> 
 <p>Slave_IO_Running: Yes</p> 
 <p>Slave_SQL_Running: Yes</p> 
 <p>...</p> 
 <p>Seconds_Behind_Master: 0</p> 
 <p>解决办法II：</p> 
 <p>mysql&gt; slave stop;</p> 
 <p>mysql&gt; set GLOBAL SQL_SLAVE_SKIP_COUNTER=1;</p> 
 <p>mysql&gt; slave start;</p> 
 <p>自己的使用体会:方法一是强制性从某一个点开始同步,会有部分没有同步的数据丢失,后续主服务器上删除记录同步也会有一些错误信息,不会影响使用.方法二不一定会有效果.</p> 
 <p>=======================================================================================]</p> 
 <p>1,主从不能同步:</p> 
 <p>show slave status;报错:Error xxx dosn't exist</p> 
 <p>且show slave statusG:</p> 
 <p>Slave_SQL_Running: NO</p> 
 <p>Seconds_Behind_Master: NULL</p> 
 <p>解决方法:</p> 
 <p>stop slave;</p> 
 <p>set global sql_slave_skip_counter =1 ;</p> 
 <p>start slave;</p> 
 <p>之后Slave会和Master去同步 主要看:</p> 
 <p>Slave_IO_Running: Yes</p> 
 <p>Slave_SQL_Running: Yes</p> 
 <p>Seconds_Behind_Master是否为0，0就是已经同步了</p> 
 <p>2,还需要做的一些优化与监视:</p> 
 <p>show full processlist; //查看mysql当前同步线程号</p> 
 <p>skip-name-resolve       //跳过dns名称查询，有助于加快连接及同步的速度</p> 
 <p>max_connections=1000    //增大Mysql的连接数目，(默认100)</p> 
 <p>max_connect_errors=100 //增大Mysql的错误连接数目,(默认10)</p> 
 <p>查看日志一些命令</p> 
 <p>1,  show master statusG;</p> 
 <p>在这里主要是看log-bin的文件是否相同。</p> 
 <p>show slave statusG;</p> 
 <p>在这里主要是看:</p> 
 <p>Slave_IO_Running=Yes</p> 
 <p>Slave_SQL_Running=Yes</p> 
 <p>如果都是Yes,则说明配置成功.</p> 
 <p>2,在master上输入show processlistG;</p> 
 <p>mysql&gt; SHOW PROCESSLISTG</p> 
 <p>*************************** 1. row ***************************</p> 
 <p>Id: 2</p> 
 <p>User: root</p> 
 <p>Host: localhost:32931</p> 
 <p>db: NULL</p> 
 <p>Command: Binlog Dump</p> 
 <p>Time: 94</p> 
 <p>State: Has sent all binlog to slave; waiting for binlog to</p> 
 <p>be updated</p> 
 <p>Info: NULL</p> 
 <p>如果出现Command: Binlog Dump,则说明配置成功.</p> 
 <p>stop slave    #停止同步</p> 
 <p>start slave    #开始同步，从日志终止的位置开始更新。</p> 
 <p>SET SQL_LOG_BIN=0|1  #主机端运行，需要super权限，用来开停日志，随意开停，会造成主机从机数据不一致，造成错误</p> 
 <p>SET GLOBAL SQL_SLAVE_SKIP_COUNTER=n  # 客户端运行，用来跳过几个事件，只有当同步进程出现错误而停止的时候才可以执行。</p> 
 <p>RESET MASTER  #主机端运行,清除所有的日志，这条命令就是原来的FLUSH MASTER</p> 
 <p>RESET SLAVE   #从机运行，清除日志同步位置标志，并重新生成master.info</p> 
 <p>虽然重新生成了master.info,但是并不起用，最好，将从机的mysql进程重启一下，</p> 
 <p>LOAD TABLE tblname FROM MASTER #从机运行，从主机端重读指定的表的数据，每次只能读取一个，受timeout时间限制，需要调整timeout时间。执行这个命令需要同步账号有 reload和super权限。以及对相应的库有select权限。如果表比较大，要增加net_read_timeout 和 net_write_timeout的值</p> 
 <p>LOAD DATA FROM MASTER  #从机执行，从主机端重新读入所有的数据。执行这个命令需要同步账号有reload和super权限。以及对相应的库有select权限。如果表比较大，要增加net_read_timeout 和 net_write_timeout的值</p> 
 <p>CHANGE MASTER TO master_def_list  #在线改变一些主机设置，多个用逗号间隔,比如</p> 
 <p>CHANGE MASTER TO</p> 
 <p>MASTER_HOST='master2.mycompany.com',</p> 
 <p>MASTER_USER='replication',</p> 
 <p>MASTER_PASSWORD='bigs3cret'</p> 
 <p>MASTER_POS_WAIT() #从机运行</p> 
 <p>SHOW MASTER STATUS #主机运行，看日志导出信息</p> 
 <p>SHOW SLAVE HOSTS #主机运行，看连入的从机的情况。</p> 
 <p>SHOW SLAVE STATUS (slave)</p> 
 <p>SHOW MASTER LOGS (master)</p> 
 <p>SHOW BINLOG EVENTS [ IN 'logname' ] [ FROM pos ] [ LIMIT [offset,] rows ]</p> 
 <p>PURGE [MASTER] LOGS TO 'logname' ; PURGE [MASTER] LOGS BEFORE 'date'</p> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/27fee8f58218288c5f59df59dbf46358/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">“xcodebuild“ command but it exited with error code 65 和 ‘event2/event-config.h‘ file not found 解决方案</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/158ca190cafbed6127ba11f4dd5790fb/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Tic Tac Toe</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>