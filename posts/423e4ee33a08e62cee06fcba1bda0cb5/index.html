<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>在CentOS安装pptpd以及部署 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="在CentOS安装pptpd以及部署" />
<meta property="og:description" content="在使用CentOS系统的时候，对有些人也许会遇到在CentOS安装pptpd的问题。下面就来介绍一下，如何在CentOS安装pptpd。在CentOS安装pptpd最省事的安装就是下载rpm包pptpd-1.3.4-1.rhel5.1.i386.rpm,然后直接执行 rpm –ivh pptpd-1.3.4-.rhel5.1.i386.rpm 。幸运的是这个包没有其他依赖，因此CentOS安装pptpd应该是异常的顺利。如果使用源码安装，会出现ppp版本高的情况，需删除pppd2.3.4 再安装pppp2.4.3，反而麻烦了。安装完rpm包后，自动生成几个配置文件，主配置文件/etc/pptpd.conf，选项文件/etc/ppp/options.pptpd, 帐号文件/etc/ppp/chapsecrets.后面配置pptpd主要就是对这几个文件进行修改。
一、CentOS安装pptpd （vpn）拓扑结构
vpn的访问逻辑上存在3个网络： 1、欲访问的目标网络。通常在vpn服务器所在的内部网络（vpn服务器有2个网卡，一个是公网的，一个是私有网络的） 2、Vpn的公网网络。 3、Vpn连接后与客户端形成的虚拟网络。建议单独设置一个网络，这样就不会占用vpn后面的私有网络（目标网络）的ip资源/地址。 图1 当然vpn隧道网络可以跟目标网络是同一个网段，不过不推荐这样。
二、CentOS安装pptpd vpn服务器端的配置
（一）修改主配置文件/etc/pptpd.conf.只需要加入下面两行：
localip 172.16.195.1 remoteip 172.16.195.101-200 Localip这行是给vpn服务器设置一个隧道ip Remoteip是自动分配给客户端的ip地址范围。 （二）修改选项文件/etc/ppp/options.pptpd.需要设定分配给客户端的dns，因此仅需把ms-dns前的注释去掉，改成可用的dns如下：ms-dns 61.135.154.5 ms-dns 159.226.240.66
为了方便查看调试信息，把debug行前面的注释取消即可。Dump前的注释也取消。
（三）CentOS安装pptpd 添加帐号。通过编辑文件/etc/ppp/chap-secrets逐行加入；一个账号占一行。一行分4列，其表示如下： 用户名 服务器名 密码 ip 没有字符数限制 Pptpd—都用这个，如果用其它的名称，需要修改options.pptpd文件的name行的内容 用双引号的话，密码就不能包含双引号了 * 表示有pptpd随机分配ip
三、CentOS安装运行pptpd.执行命令service pptpd start或者执行/etc/init.d/pptpd 即可启动它。
通过检查进程、查看系统日志来确定pptpd是否正常。
四、客户端配置（windows）。
这个应该很容易了，就不再多费口舌。
五、拨号登录。
拨号过程中，登录到vpn服务器查看日志，会看到用户的连接情况，下面是截取的一个片断，供参考： Dec 19 17:16:01 max-vpn pppd[9833]: Plugin /usr/lib/pptpd/pptpd-logwtmp.so loaded. Dec 19 17:16:01 max-vpn pppd[9833]: pptpd-logwtmp: $Version$ Dec 19 17:16:01 max-vpn pppd[9833]: pppd options in effect: Dec 19 17:16:01 max-vpn pppd[9833]: debug # (from /etc/ppp/options." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/423e4ee33a08e62cee06fcba1bda0cb5/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2015-03-06T14:06:48+08:00" />
<meta property="article:modified_time" content="2015-03-06T14:06:48+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">在CentOS安装pptpd以及部署</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p style="margin-top:10px; margin-bottom:10px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); text-indent:28px; font-family:宋体; font-size:14px; line-height:28px; background-color:rgb(248,248,248)"> 在使用CentOS系统的时候，对有些人也许会遇到在CentOS安装pptpd的问题。下面就来介绍一下，如何在CentOS安装pptpd。在CentOS安装pptpd最省事的安装就是下载rpm包pptpd-1.3.4-1.rhel5.1.i386.rpm,然后直接执行 rpm –ivh pptpd-1.3.4-.rhel5.1.i386.rpm 。幸运的是这个包没有其他依赖，因此CentOS安装pptpd应该是异常的顺利。如果使用源码安装，会出现ppp版本高的情况，需删除pppd2.3.4 再安装pppp2.4.3，反而麻烦了。安装完rpm包后，自动生成几个配置文件，主配置文件/etc/pptpd.conf，选项文件/etc/ppp/options.pptpd, 帐号文件/etc/ppp/chapsecrets.后面配置pptpd主要就是对这几个文件进行修改。</p> 
<p style="margin-top:10px; margin-bottom:10px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); text-indent:28px; font-family:宋体; font-size:14px; line-height:28px; background-color:rgb(248,248,248)"> <span style="text-align:center">一、CentOS安装pptpd （vpn）拓扑结构</span></p> 
<p style="margin-top:10px; margin-bottom:10px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); text-indent:28px; font-family:宋体; font-size:14px; line-height:28px; background-color:rgb(248,248,248)"> vpn的访问逻辑上存在3个网络：<br style="clear:both; width:0px; height:0px"> 1、欲访问的目标网络。通常在vpn服务器所在的内部网络（vpn服务器有2个网卡，一个是公网的，一个是私有网络的）<br style="clear:both; width:0px; height:0px"> 2、Vpn的公网网络。<br style="clear:both; width:0px; height:0px"> 3、Vpn连接后与客户端形成的虚拟网络。建议单独设置一个网络，这样就不会占用vpn后面的私有网络（目标网络）的ip资源/地址。<br style="clear:both; width:0px; height:0px"> <br style="clear:both; width:0px; height:0px"> </p> 
<table class="ln" cellspacing="0" align="center" bgcolor="#ddddd0" border="1" style="color:rgb(51,51,51); font-family:宋体; font-size:14px; line-height:28px"><tbody><tr><td bgcolor="#ffffff" style="margin:0px; padding:0px"><a target="_blank" href="http://images.51cto.com/files/uploadimg/20100330/1011440.jpg" rel="nofollow noopener noreferrer" style="color:rgb(0,66,118); text-decoration:none"><img class="fit-image" alt="" src="https://images2.imgbox.com/78/dd/G2BjILZ4_o.jpg" border="0" style="border:medium none; width:498px"></a></td></tr><tr><td class="it" align="middle" bgcolor="#dddddd" style="margin:0px; padding:0px">图1</td></tr></tbody></table> 
<p style="margin-top:10px; margin-bottom:10px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); text-indent:28px; font-family:宋体; font-size:14px; line-height:28px; background-color:rgb(248,248,248)"> </p> 
<p style="margin-top:10px; margin-bottom:10px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); text-indent:28px; font-family:宋体; font-size:14px; line-height:28px; background-color:rgb(248,248,248)"> 当然vpn隧道网络可以跟目标网络是同一个网段，不过不推荐这样。</p> 
<p style="margin-top:10px; margin-bottom:10px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); text-indent:28px; font-family:宋体; font-size:14px; line-height:28px; background-color:rgb(248,248,248)"> <span style="text-align:center">二、CentOS安装pptpd vpn服务器端的配置</span></p> 
<p style="margin-top:10px; margin-bottom:10px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); text-indent:28px; font-family:宋体; font-size:14px; line-height:28px; background-color:rgb(248,248,248)"> （一）修改主配置文件/etc/pptpd.conf.只需要加入下面两行：</p> 
<p style="margin-top:10px; margin-bottom:10px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); text-indent:28px; font-family:宋体; font-size:14px; line-height:28px; background-color:rgb(248,248,248)"> localip  172.16.195.1<br style="clear:both; width:0px; height:0px"> remoteip 172.16.195.101-200<br style="clear:both; width:0px; height:0px"> Localip这行是给vpn服务器设置一个隧道ip<br style="clear:both; width:0px; height:0px"> Remoteip是自动分配给客户端的ip地址范围。<br style="clear:both; width:0px; height:0px"> <br style="clear:both; width:0px; height:0px"> （二）修改选项文件/etc/ppp/options.pptpd.需要设定分配给客户端的dns，因此仅需把ms-dns前的注释去掉，改成可用的dns如下：ms-dns 61.135.154.5     ms-dns 159.226.240.66</p> 
<p style="margin-top:10px; margin-bottom:10px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); text-indent:28px; font-family:宋体; font-size:14px; line-height:28px; background-color:rgb(248,248,248)"> 为了方便查看调试信息，把debug行前面的注释取消即可。Dump前的注释也取消。</p> 
<p style="margin-top:10px; margin-bottom:10px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); text-indent:28px; font-family:宋体; font-size:14px; line-height:28px; background-color:rgb(248,248,248)"> （三）CentOS安装pptpd 添加帐号。通过编辑文件/etc/ppp/chap-secrets逐行加入；一个账号占一行。一行分4列，其表示如下：        <br style="clear:both; width:0px; height:0px"> 用户名<br style="clear:both; width:0px; height:0px"> 服务器名<br style="clear:both; width:0px; height:0px"> 密码<br style="clear:both; width:0px; height:0px"> ip<br style="clear:both; width:0px; height:0px"> 没有字符数限制<br style="clear:both; width:0px; height:0px"> Pptpd—都用这个，如果用其它的名称，需要修改options.pptpd文件的name行的内容<br style="clear:both; width:0px; height:0px"> 用双引号的话，密码就不能包含双引号了<br style="clear:both; width:0px; height:0px"> * 表示有pptpd随机分配ip</p> 
<p style="margin-top:10px; margin-bottom:10px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); text-indent:28px; font-family:宋体; font-size:14px; line-height:28px; background-color:rgb(248,248,248)"> <span style="text-align:center">三、CentOS安装运行pptpd.执行命令service pptpd start或者执行/etc/init.d/pptpd 即可启动它。</span></p> 
<p style="margin-top:10px; margin-bottom:10px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); text-indent:28px; font-family:宋体; font-size:14px; line-height:28px; background-color:rgb(248,248,248)"> 通过检查进程、查看系统日志来确定pptpd是否正常。</p> 
<p style="margin-top:10px; margin-bottom:10px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); text-indent:28px; font-family:宋体; font-size:14px; line-height:28px; background-color:rgb(248,248,248)"> <span style="text-align:center">四、客户端配置（windows）。</span></p> 
<p style="margin-top:10px; margin-bottom:10px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); text-indent:28px; font-family:宋体; font-size:14px; line-height:28px; background-color:rgb(248,248,248)"> 这个应该很容易了，就不再多费口舌。</p> 
<p style="margin-top:10px; margin-bottom:10px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); text-indent:28px; font-family:宋体; font-size:14px; line-height:28px; background-color:rgb(248,248,248)"> <span style="text-align:center">五、拨号登录。</span></p> 
<p style="margin-top:10px; margin-bottom:10px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); text-indent:28px; font-family:宋体; font-size:14px; line-height:28px; background-color:rgb(248,248,248)"> 拨号过程中，登录到vpn服务器查看日志，会看到用户的连接情况，下面是截取的一个片断，供参考：<br style="clear:both; width:0px; height:0px"> </p> 
<pre style="margin-top:0px; margin-bottom:1em; padding:0px; color:rgb(51,51,51); font-family:'Courier New',monospace; width:591.015625px; overflow:auto; line-height:28px; background:rgb(230,230,230)"> 
 <ol class="dp-xml" style="margin-left:55px; padding:5px 0px; color:rgb(92,92,92); word-wrap:break-word; word-break:normal; border:none; margin-top:0px!important; margin-right:0px!important; margin-bottom:1px!important; background:rgb(247,247,247)"><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; list-style:decimal outside none; word-wrap:break-word; word-break:normal; border:none; line-height:18px"><span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">Dec 19 17:16:01 max-vpn pppd[9833]: Plugin /usr/lib/pptpd/pptpd-logwtmp.so loaded.  </span></li><li style="list-style:decimal outside none; word-wrap:break-word; word-break:normal; border:none; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important"><span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">Dec 19 17:16:01 max-vpn pppd[9833]: pptpd-logwtmp: $Version$  </span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; list-style:decimal outside none; word-wrap:break-word; word-break:normal; border:none; line-height:18px"><span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">Dec 19 17:16:01 max-vpn pppd[9833]: pppd options in effect:  </span></li><li style="list-style:decimal outside none; word-wrap:break-word; word-break:normal; border:none; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important"><span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">Dec 19 17:16:01 max-vpn pppd[9833]: debug               # (from /etc/ppp/options.pptpd)  </span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; list-style:decimal outside none; word-wrap:break-word; word-break:normal; border:none; line-height:18px"><span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">Dec 19 17:16:01 max-vpn pppd[9833]: logfile /etc/ppp/vpn.log            # (from /etc/ppp/options.pptpd)  </span></li><li style="list-style:decimal outside none; word-wrap:break-word; word-break:normal; border:none; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important"><span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">Dec 19 17:16:01 max-vpn pppd[9833]: dump                # (from /etc/ppp/options.pptpd)  </span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; list-style:decimal outside none; word-wrap:break-word; word-break:normal; border:none; line-height:18px"><span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">Dec 19 17:16:01 max-vpn pppd[9833]: plugin /usr/lib/pptpd/pptpd-logwtmp.so              # (from command line)  </span></li><li style="list-style:decimal outside none; word-wrap:break-word; word-break:normal; border:none; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important"><span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">Dec 19 17:16:01 max-vpn pppd[9833]: require-mschap-v2           # (from /etc/ppp/options.pptpd)  </span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; list-style:decimal outside none; word-wrap:break-word; word-break:normal; border:none; line-height:18px"><span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">Dec 19 17:16:01 max-vpn pppd[9833]: refuse-pap          # (from /etc/ppp/options.pptpd)  </span></li><li style="list-style:decimal outside none; word-wrap:break-word; word-break:normal; border:none; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important"><span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">Dec 19 17:16:01 max-vpn pppd[9833]: refuse-chap         # (from /etc/ppp/options.pptpd)  </span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; list-style:decimal outside none; word-wrap:break-word; word-break:normal; border:none; line-height:18px"><span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">Dec 19 17:16:01 max-vpn pppd[9833]: refuse-mschap               # (from /etc/ppp/options.pptpd)  </span></li><li style="list-style:decimal outside none; word-wrap:break-word; word-break:normal; border:none; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important"><span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">Dec 19 17:16:01 max-vpn pppd[9833]: name pptpd          # (from /etc/ppp/options.pptpd)  </span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; list-style:decimal outside none; word-wrap:break-word; word-break:normal; border:none; line-height:18px"><span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">Dec 19 17:16:01 max-vpn pppd[9833]: pptpd-original-ip 200.199.118.72           # (from command line)  </span></li><li style="list-style:decimal outside none; word-wrap:break-word; word-break:normal; border:none; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important"><span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">Dec 19 17:16:01 max-vpn pppd[9833]: 115200              # (from command line)  </span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; list-style:decimal outside none; word-wrap:break-word; word-break:normal; border:none; line-height:18px"><span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">Dec 19 17:16:01 max-vpn pppd[9833]: lock                # (from /etc/ppp/options.pptpd)  </span></li><li style="list-style:decimal outside none; word-wrap:break-word; word-break:normal; border:none; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important"><span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">Dec 19 17:16:01 max-vpn pppd[9833]: local               # (from command line)  </span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; list-style:decimal outside none; word-wrap:break-word; word-break:normal; border:none; line-height:18px"><span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">Dec 19 17:16:01 max-vpn pppd[9833]: novj                # (from /etc/ppp/options.pptpd)  </span></li><li style="list-style:decimal outside none; word-wrap:break-word; word-break:normal; border:none; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important"><span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">Dec 19 17:16:01 max-vpn pppd[9833]: novjccomp           # (from /etc/ppp/options.pptpd)  </span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; list-style:decimal outside none; word-wrap:break-word; word-break:normal; border:none; line-height:18px"><span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">Dec 19 17:16:01 max-vpn pppd[9833]: ipparam 200.199.118.72             # (from command line)  </span></li><li style="list-style:decimal outside none; word-wrap:break-word; word-break:normal; border:none; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important"><span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">Dec 19 17:16:01 max-vpn pppd[9833]: ms-dns xxx # [don't know how to print value]                # (from /etc/ppp/options.pptpd)  </span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; list-style:decimal outside none; word-wrap:break-word; word-break:normal; border:none; line-height:18px"><span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">Dec 19 17:16:01 max-vpn pppd[9833]: proxyarp            # (from /etc/ppp/options.pptpd)  </span></li><li style="list-style:decimal outside none; word-wrap:break-word; word-break:normal; border:none; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important"><span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">Dec 19 17:16:01 max-vpn pppd[9833]: 172.16.195.1:172.16.195.101-200               # (from command line)  </span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; list-style:decimal outside none; word-wrap:break-word; word-break:normal; border:none; line-height:18px"><span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">Dec 19 17:16:02 max-vpn pppd[9833]: nobsdcomp           # (from /etc/ppp/options.pptpd)  </span></li><li style="list-style:decimal outside none; word-wrap:break-word; word-break:normal; border:none; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important"><span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">Dec 19 17:16:02 max-vpn pppd[9833]: require-mppe-128            # (from /etc/ppp/options.pptpd)  </span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; list-style:decimal outside none; word-wrap:break-word; word-break:normal; border:none; line-height:18px"><span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">Dec 19 17:16:02 max-vpn pppd[9833]: pppd 2.4.4 started by root, uid 0  </span></li><li style="list-style:decimal outside none; word-wrap:break-word; word-break:normal; border:none; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important"><span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">Dec 19 17:16:02 max-vpn pppd[9833]: Using interface ppp0  </span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; list-style:decimal outside none; word-wrap:break-word; word-break:normal; border:none; line-height:18px"><span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">Dec 19 17:16:02 max-vpn pppd[9833]: Connect: ppp0 </span><span class="tag" style="margin:0px 0px 10px; padding:7px 0px 4px; border:none; color:rgb(0,102,153); width:635px; font-weight:bold; background-color:inherit">&lt;</span><span class="tag-name" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">--</span><span class="tag" style="margin:0px 0px 10px; padding:7px 0px 4px; border:none; color:rgb(0,102,153); width:635px; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit"> /dev/pts/1  </span></li><li style="list-style:decimal outside none; word-wrap:break-word; word-break:normal; border:none; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important"><span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">Dec 19 17:16:02 max-vpn pptpd[9832]: CTRL: Ignored a SET LINK INFO packet with real ACCMs!  </span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; list-style:decimal outside none; word-wrap:break-word; word-break:normal; border:none; line-height:18px"><span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">Dec 19 17:16:02 max-vpn pppd[9833]: Unsupported protocol 'IPv6 Control Protovol' (0x8057) received  </span></li><li style="list-style:decimal outside none; word-wrap:break-word; word-break:normal; border:none; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important"><span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">Dec 19 17:16:02 max-vpn pppd[9833]: MPPE 128-bit stateless compression enabled  </span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; list-style:decimal outside none; word-wrap:break-word; word-break:normal; border:none; line-height:18px"><span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">Dec 19 17:16:04 max-vpn pppd[9833]: Cannot determine ethernet address for proxy ARP  </span></li><li style="list-style:decimal outside none; word-wrap:break-word; word-break:normal; border:none; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important"><span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">Dec 19 17:16:04 max-vpn pppd[9833]: local  IP address 172.16.195.1  </span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; list-style:decimal outside none; word-wrap:break-word; word-break:normal; border:none; line-height:18px"><span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">Dec 19 17:16:04 max-vpn pppd[9833]: remote IP address 172.16.195.101  </span></li><li style="list-style:decimal outside none; word-wrap:break-word; word-break:normal; border:none; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important"><span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">Dec 19 17:16:04 max-vpn pppd[9833]: pptpd-logwtmp.so ip-up ppp0 sery 200.199.118.72  </span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; list-style:decimal outside none; word-wrap:break-word; word-break:normal; border:none; line-height:18px"><span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">[root@max-vpn ~]#       </span></li></ol></pre> 
<p style="margin-top:10px; margin-bottom:10px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); text-indent:28px; font-family:宋体; font-size:14px; line-height:28px; background-color:rgb(248,248,248)"> </p> 
<p style="margin-top:10px; margin-bottom:10px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); text-indent:28px; font-family:宋体; font-size:14px; line-height:28px; background-color:rgb(248,248,248)"> 这段日志表明已经有一个来自200.199.118.72连接到vpn服务器，其账号为sery,分配给这个客户端机器的vpn地址是172.16.195.101.在拨号的机器（windows）上查看其现在的网络参数：<br style="clear:both; width:0px; height:0px"> </p> 
<pre style="margin-top:0px; margin-bottom:1em; padding:0px; color:rgb(51,51,51); font-family:'Courier New',monospace; width:591.015625px; overflow:auto; line-height:28px; background:rgb(230,230,230)"> 
 <ol class="dp-xml" style="margin-left:55px; padding:5px 0px; color:rgb(92,92,92); word-wrap:break-word; word-break:normal; border:none; margin-top:0px!important; margin-right:0px!important; margin-bottom:1px!important; background:rgb(247,247,247)"><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; list-style:decimal outside none; word-wrap:break-word; word-break:normal; border:none; line-height:18px"><span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit"><span style="margin:0px; padding:0px; border:none; background-color:inherit">C:\Users\sery</span><span class="tag" style="margin:0px 0px 10px; padding:7px 0px 4px; border:none; color:rgb(0,102,153); width:635px; font-weight:bold; background-color:inherit">&gt;</span><span style="margin:0px; padding:0px; border:none; background-color:inherit">ipconfig/all  </span></span></li><li style="list-style:decimal outside none; word-wrap:break-word; word-break:normal; border:none; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important"><span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">Windows IP 配置  </span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; list-style:decimal outside none; word-wrap:break-word; word-break:normal; border:none; line-height:18px"><span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">主机名  . . . . . . . . . . . . . : sery-sony  </span></li><li style="list-style:decimal outside none; word-wrap:break-word; word-break:normal; border:none; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important"><span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">主 DNS 后缀 . . . . . . . . . . . :  </span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; list-style:decimal outside none; word-wrap:break-word; word-break:normal; border:none; line-height:18px"><span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">节点类型  . . . . . . . . . . . . : 混合  </span></li><li style="list-style:decimal outside none; word-wrap:break-word; word-break:normal; border:none; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important"><span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">IP 路由已启用 . . . . . . . . . . : 否  </span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; list-style:decimal outside none; word-wrap:break-word; word-break:normal; border:none; line-height:18px"><span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">WINS 代理已启用 . . . . . . . . . : 否  </span></li><li style="list-style:decimal outside none; word-wrap:break-word; word-break:normal; border:none; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important"><span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">DNS 后缀搜索列表  . . . . . . . . : maxthon.net  </span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; list-style:decimal outside none; word-wrap:break-word; word-break:normal; border:none; line-height:18px"><span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">PPP 适配器 VPN 连接:  </span></li><li style="list-style:decimal outside none; word-wrap:break-word; word-break:normal; border:none; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important"><span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">连接特定的 DNS 后缀 . . . . . . . :  </span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; list-style:decimal outside none; word-wrap:break-word; word-break:normal; border:none; line-height:18px"><span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">描述. . . . . . . . . . . . . . . : VPN 连接  </span></li><li style="list-style:decimal outside none; word-wrap:break-word; word-break:normal; border:none; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important"><span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">物理地址. . . . . . . . . . . . . :  </span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; list-style:decimal outside none; word-wrap:break-word; word-break:normal; border:none; line-height:18px"><span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">DHCP 已启用 . . . . . . . . . . . : 否  </span></li><li style="list-style:decimal outside none; word-wrap:break-word; word-break:normal; border:none; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important"><span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">自动配置已启用. . . . . . . . . . : 是  </span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; list-style:decimal outside none; word-wrap:break-word; word-break:normal; border:none; line-height:18px"><span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">IPv4 地址 . . . . . . . . . . . . : 172.16.195.101(首选)  </span></li><li style="list-style:decimal outside none; word-wrap:break-word; word-break:normal; border:none; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important"><span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">子网掩码  . . . . . . . . . . . . : 255.255.255.255  </span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; list-style:decimal outside none; word-wrap:break-word; word-break:normal; border:none; line-height:18px"><span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">默认网关. . . . . . . . . . . . . : 0.0.0.0  </span></li><li style="list-style:decimal outside none; word-wrap:break-word; word-break:normal; border:none; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important"><span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">DNS 服务器  . . . . . . . . . . . : 61.135.154.5  </span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; list-style:decimal outside none; word-wrap:break-word; word-break:normal; border:none; line-height:18px"><span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">                                   159.226.240.66  </span></li><li style="list-style:decimal outside none; word-wrap:break-word; word-break:normal; border:none; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important"><span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">TCPIP 上的 NetBIOS  . . . . . . . : 已启用 </span></li></ol></pre> 
<p style="margin-top:10px; margin-bottom:10px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); text-indent:28px; font-family:宋体; font-size:14px; line-height:28px; background-color:rgb(248,248,248)"> </p> 
<p style="margin-top:10px; margin-bottom:10px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); text-indent:28px; font-family:宋体; font-size:14px; line-height:28px; background-color:rgb(248,248,248)"> <span style="text-align:center">六、CentOS安装pptpd设置路由及ip伪装。</span></p> 
<p style="margin-top:10px; margin-bottom:10px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); text-indent:28px; font-family:宋体; font-size:14px; line-height:28px; background-color:rgb(248,248,248)"> 需要在这里可以登录vpn服务器，但由于没有设置相关的转发规则，因此还是没办法访问vpn后面的私有网络或者通过vpn访问互联网（windows机器会在状态栏的网络连接图标显示一个黄色的感叹号）。所以还需要完成下面几步才算真正结束了—看了一些网上的文章，通常就是在这里结束了，看来作者只是登录了一下虚拟环境。</p> 
<p style="margin-top:10px; margin-bottom:10px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); text-indent:28px; font-family:宋体; font-size:14px; line-height:28px; background-color:rgb(248,248,248)"> （一）开启ip转发功能：修改配置文件/etc/sysctl.conf,使net.ipv4.ip_forward = 1<br style="clear:both; width:0px; height:0px"> （二）写个脚本文件，实现路由，其内容大致如下：<br style="clear:both; width:0px; height:0px"> </p> 
<pre style="margin-top:0px; margin-bottom:1em; padding:0px; color:rgb(51,51,51); font-family:'Courier New',monospace; width:591.015625px; overflow:auto; line-height:28px; background:rgb(230,230,230)"> 
 <ol class="dp-xml" style="margin-left:55px; padding:5px 0px; color:rgb(92,92,92); word-wrap:break-word; word-break:normal; border:none; margin-top:0px!important; margin-right:0px!important; margin-bottom:1px!important; background:rgb(247,247,247)"><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; list-style:decimal outside none; word-wrap:break-word; word-break:normal; border:none; line-height:18px"><span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">[root@max-vpn ~]# more /usr/local/bin/vpn_route.sh   </span></li><li style="list-style:decimal outside none; word-wrap:break-word; word-break:normal; border:none; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important"><span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">#!/bin/bash  </span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; list-style:decimal outside none; word-wrap:break-word; word-break:normal; border:none; line-height:18px"><span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">/sbin/iptables -t nat -A POSTROUTING -s 192.168.195.0/24 -o eth0 -j SNAT --to-source 61.135.251.50  </span></li><li style="list-style:decimal outside none; word-wrap:break-word; word-break:normal; border:none; line-height:18px; margin:0px!important; padding:0px 3px 0px 10px!important"><span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">/sbin/iptables -t nat -A POSTROUTING -s 172.16.195.0/24 -o eth1 -j SNAT --to-source 192.168.195.166  </span></li><li class="alt" style="margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; list-style:decimal outside none; word-wrap:break-word; word-break:normal; border:none; line-height:18px"><span style="margin:0px; padding:0px; border:none; color:black; background-color:inherit">/sbin/iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE  </span></li></ol></pre> 
<p style="margin-top:10px; margin-bottom:10px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); text-indent:28px; font-family:宋体; font-size:14px; line-height:28px; background-color:rgb(248,248,248)"> </p> 
<p style="margin-top:10px; margin-bottom:10px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); text-indent:28px; font-family:宋体; font-size:14px; line-height:28px; background-color:rgb(248,248,248)"> 目标网络/vpn的内部网络为192.168.195.0/24,vpn服务器有2个网卡，其中一个连接公网（eth0），ip地址是61.135.251.51，另外一个网卡连私有网络，ip是192.168.195.166。这样就能正常地路由所涉及的网络了。手动执行一下这个脚本，看客户端（windows）是否能访问目标网络里的机器：最简单的方法就是ping，假定目标网络里有一个192.168.195.100的机器，并请允许icmp通过，ping 192.168.195.100 ,正常的话，再进一步访问这个服务器（如远程登录）。没有问题的话，把它加在开机自启里面。为安全起见，你可以在这个脚本里加更多的iptables规则。<br style="clear:both; width:0px; height:0px"> 这样就可以在CentOS安装pptpd了。大家可以顺利的使用pptpd了。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b69dbd01c0f112d3cb09e83f0461997a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">visual C&#43;&#43; 项目和解决方案的区别</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a6c14a2a41a00542c67c35d5aedfb2ca/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">电脑进入BOOT MENU 按键总结！！！</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>