<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【测试】使用selenium实现QQ邮箱登录（2023.2.7更新） - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【测试】使用selenium实现QQ邮箱登录（2023.2.7更新）" />
<meta property="og:description" content="1.说明 QQ邮箱登录很可能需要拖动滑块进行验证，这里当做练习selenium，实现模拟拖动滑块
2.思路 1.使用selenium打开邮箱登录页面，判断是否，尝试登录，看是否需要验证码；
2.若需要图片验证码，那就获取验证码图片的url，验证码图片分为滑块小图片和背景图片，分别都下载；
3.使用OpenCV把图片高斯处理，然后边缘检测，匹配模板，得到最优匹配结果；
4.得到滑块与缺口之间的像素值，根据实际缩放比例以及偏移量得到最终要滑动的距离；
5.使用加速度公式模拟出比较类似人工操作的像素数组；
6.使用selenium分步拖动滑块完成验证
3.参考代码 测试环境Python版本：Python 3.9.2
Python库版本：
pip install selenium==4.8.0 pip install requests==2.28.0 pip install numpy==1.23.3 pip install Pillow==9.2.0 pip install opencv-python==4.6.0.66 import sys import time from io import BytesIO import cv2 import os import requests import random import numpy as np from PIL import Image as Im from selenium import webdriver from selenium.webdriver import ActionChains from selenium.webdriver.chrome.service import Service from selenium.webdriver.common.by import By wait_time_short = 1 wait_time1_long = 2 class QQEmail(object): def __init__(self, user, pwd, executable_path): self." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/36492f17e7a3d0dc6bab27d64f3b9176/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-02-07T12:26:50+08:00" />
<meta property="article:modified_time" content="2023-02-07T12:26:50+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【测试】使用selenium实现QQ邮箱登录（2023.2.7更新）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h5><a id="1_0"></a>1.说明</h5> 
<p>QQ邮箱登录很可能需要拖动滑块进行验证，这里当做练习selenium，实现模拟拖动滑块</p> 
<h5><a id="2_3"></a>2.思路</h5> 
<p>1.使用selenium打开邮箱登录页面，判断是否，尝试登录，看是否需要验证码；<br> 2.若需要图片验证码，那就获取验证码图片的url，验证码图片分为滑块小图片和背景图片，分别都下载；<br> 3.使用OpenCV把图片高斯处理，然后边缘检测，匹配模板，得到最优匹配结果；<br> 4.得到滑块与缺口之间的像素值，根据实际缩放比例以及偏移量得到最终要滑动的距离；<br> 5.使用加速度公式模拟出比较类似人工操作的像素数组；<br> 6.使用selenium分步拖动滑块完成验证</p> 
<h5><a id="3_11"></a>3.参考代码</h5> 
<p>测试环境Python版本：Python 3.9.2<br> Python库版本：</p> 
<pre><code class="prism language-python">pip install selenium<span class="token operator">==</span><span class="token number">4.8</span><span class="token number">.0</span>
pip install requests<span class="token operator">==</span><span class="token number">2.28</span><span class="token number">.0</span>
pip install numpy<span class="token operator">==</span><span class="token number">1.23</span><span class="token number">.3</span>
pip install Pillow<span class="token operator">==</span><span class="token number">9.2</span><span class="token number">.0</span>
pip install opencv<span class="token operator">-</span>python<span class="token operator">==</span><span class="token number">4.6</span><span class="token number">.0</span><span class="token number">.66</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token keyword">import</span> sys
<span class="token keyword">import</span> time
<span class="token keyword">from</span> io <span class="token keyword">import</span> BytesIO

<span class="token keyword">import</span> cv2
<span class="token keyword">import</span> os
<span class="token keyword">import</span> requests
<span class="token keyword">import</span> random
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image <span class="token keyword">as</span> Im
<span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver
<span class="token keyword">from</span> selenium<span class="token punctuation">.</span>webdriver <span class="token keyword">import</span> ActionChains
<span class="token keyword">from</span> selenium<span class="token punctuation">.</span>webdriver<span class="token punctuation">.</span>chrome<span class="token punctuation">.</span>service <span class="token keyword">import</span> Service
<span class="token keyword">from</span> selenium<span class="token punctuation">.</span>webdriver<span class="token punctuation">.</span>common<span class="token punctuation">.</span>by <span class="token keyword">import</span> By

wait_time_short <span class="token operator">=</span> <span class="token number">1</span>
wait_time1_long <span class="token operator">=</span> <span class="token number">2</span>


<span class="token keyword">class</span> <span class="token class-name">QQEmail</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> user<span class="token punctuation">,</span> pwd<span class="token punctuation">,</span> executable_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>user <span class="token operator">=</span> user
        self<span class="token punctuation">.</span>pwd <span class="token operator">=</span> pwd
        self<span class="token punctuation">.</span>driver <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span>service<span class="token operator">=</span>Service<span class="token punctuation">(</span>executable_path<span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>save_dir <span class="token operator">=</span> sys<span class="token punctuation">.</span>path<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">"/pic/"</span>

    <span class="token keyword">def</span> <span class="token function">login_email</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        login_url <span class="token operator">=</span> <span class="token string">"https://mail.qq.com"</span>
        self<span class="token punctuation">.</span>driver<span class="token punctuation">.</span>get<span class="token punctuation">(</span>login_url<span class="token punctuation">)</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span>wait_time1_long<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>driver<span class="token punctuation">.</span>switch_to<span class="token punctuation">.</span>frame<span class="token punctuation">(</span><span class="token string">"login_frame"</span><span class="token punctuation">)</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>driver<span class="token punctuation">.</span>find_element<span class="token punctuation">(</span><span class="token string">"switcher_plogin"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span>wait_time1_long<span class="token punctuation">)</span>

        u_input <span class="token operator">=</span> self<span class="token punctuation">.</span>driver<span class="token punctuation">.</span>find_element<span class="token punctuation">(</span>By<span class="token punctuation">.</span>XPATH<span class="token punctuation">,</span> <span class="token string">'//*[@id="u"]'</span><span class="token punctuation">)</span>
        u_input<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>
        u_input<span class="token punctuation">.</span>send_keys<span class="token punctuation">(</span>self<span class="token punctuation">.</span>user<span class="token punctuation">)</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span>wait_time_short<span class="token punctuation">)</span>
        p_input <span class="token operator">=</span> self<span class="token punctuation">.</span>driver<span class="token punctuation">.</span>find_element<span class="token punctuation">(</span>By<span class="token punctuation">.</span>XPATH<span class="token punctuation">,</span> <span class="token string">'//*[@id="p"]'</span><span class="token punctuation">)</span>
        p_input<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>
        p_input<span class="token punctuation">.</span>send_keys<span class="token punctuation">(</span>self<span class="token punctuation">.</span>pwd<span class="token punctuation">)</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span>wait_time_short<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>driver<span class="token punctuation">.</span>find_element<span class="token punctuation">(</span>By<span class="token punctuation">.</span>ID<span class="token punctuation">,</span> <span class="token string">"login_button"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span>wait_time1_long<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token string">"tcaptcha_iframe_dy"</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>driver<span class="token punctuation">.</span>page_source<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>driver<span class="token punctuation">.</span>switch_to<span class="token punctuation">.</span>frame<span class="token punctuation">(</span><span class="token string">"tcaptcha_iframe_dy"</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token string">"拖动下方滑块完成拼图"</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>driver<span class="token punctuation">.</span>page_source<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"需要验证码"</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>verification_code<span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"不需要验证码，直接登录"</span><span class="token punctuation">)</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">download_img</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> url<span class="token punctuation">,</span> size_type<span class="token punctuation">)</span><span class="token punctuation">:</span>
        try_times <span class="token operator">=</span> <span class="token number">3</span>
        path <span class="token operator">=</span> self<span class="token punctuation">.</span>save_dir <span class="token operator">+</span> size_type <span class="token operator">+</span> <span class="token string">'.png'</span>
        <span class="token keyword">while</span> try_times <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>self<span class="token punctuation">.</span>save_dir<span class="token punctuation">)</span><span class="token punctuation">:</span>
                    os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>self<span class="token punctuation">.</span>save_dir<span class="token punctuation">)</span>
                res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
                <span class="token keyword">if</span> size_type <span class="token operator">==</span> <span class="token string">"small"</span><span class="token punctuation">:</span>
                    img <span class="token operator">=</span> Im<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span>BytesIO<span class="token punctuation">(</span>res<span class="token punctuation">.</span>content<span class="token punctuation">)</span><span class="token punctuation">)</span>
                    crop <span class="token operator">=</span> img<span class="token punctuation">.</span>crop<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">140</span><span class="token punctuation">,</span> <span class="token number">490</span><span class="token punctuation">,</span> <span class="token number">260</span><span class="token punctuation">,</span> <span class="token number">610</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    crop<span class="token punctuation">.</span>save<span class="token punctuation">(</span>path<span class="token punctuation">)</span>
                    <span class="token keyword">return</span> path
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token string">"wb"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
                        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>res<span class="token punctuation">.</span>content<span class="token punctuation">)</span>
                    <span class="token keyword">return</span> f<span class="token punctuation">.</span>name
            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
                try_times <span class="token operator">-=</span> <span class="token number">1</span>

    <span class="token keyword">def</span> <span class="token function">get_distance</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> small_url<span class="token punctuation">,</span> big_url<span class="token punctuation">)</span><span class="token punctuation">:</span>
        s_img <span class="token operator">=</span> self<span class="token punctuation">.</span>download_img<span class="token punctuation">(</span>small_url<span class="token punctuation">,</span> <span class="token string">'small'</span><span class="token punctuation">)</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
        b_img <span class="token operator">=</span> self<span class="token punctuation">.</span>download_img<span class="token punctuation">(</span>big_url<span class="token punctuation">,</span> <span class="token string">'big'</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"s_img:"</span><span class="token punctuation">,</span> s_img<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"b_img:"</span><span class="token punctuation">,</span> b_img<span class="token punctuation">)</span>
        small_pic <span class="token operator">=</span> cv2<span class="token punctuation">.</span>Canny<span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>GaussianBlur<span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">'pic/small.png'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span>
        big_pic <span class="token operator">=</span> cv2<span class="token punctuation">.</span>Canny<span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>GaussianBlur<span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">'pic/big.png'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span>
        res <span class="token operator">=</span> cv2<span class="token punctuation">.</span>matchTemplate<span class="token punctuation">(</span>big_pic<span class="token punctuation">,</span> small_pic<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>TM_CCOEFF_NORMED<span class="token punctuation">)</span>
        x<span class="token punctuation">,</span> y <span class="token operator">=</span> np<span class="token punctuation">.</span>unravel_index<span class="token punctuation">(</span>res<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> res<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
        <span class="token comment"># min_val, max_val, min_loc, max_loc = cv2.minMaxLoc(res)</span>
        <span class="token comment"># print('max_loc[0]:', max_loc[0])</span>
        <span class="token keyword">return</span> y

    <span class="token keyword">def</span> <span class="token function">verification_code</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> offset<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>driver<span class="token punctuation">.</span>switch_to<span class="token punctuation">.</span>default_content<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>driver<span class="token punctuation">.</span>switch_to<span class="token punctuation">.</span>frame<span class="token punctuation">(</span><span class="token string">'login_frame'</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>driver<span class="token punctuation">.</span>switch_to<span class="token punctuation">.</span>frame<span class="token punctuation">(</span>self<span class="token punctuation">.</span>driver<span class="token punctuation">.</span>find_element<span class="token punctuation">(</span>By<span class="token punctuation">.</span>ID<span class="token punctuation">,</span> <span class="token string">"tcaptcha_iframe_dy"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>driver<span class="token punctuation">.</span>find_element<span class="token punctuation">(</span>By<span class="token punctuation">.</span>ID<span class="token punctuation">,</span> <span class="token string">'e_reload'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span>wait_time1_long<span class="token punctuation">)</span>
        small_pic_pattern <span class="token operator">=</span> <span class="token string">'//*[@id="tcOperation"]/div[8]'</span>
        small_url <span class="token operator">=</span> self<span class="token punctuation">.</span>driver<span class="token punctuation">.</span>find_element<span class="token punctuation">(</span>By<span class="token punctuation">.</span>XPATH<span class="token punctuation">,</span> small_pic_pattern<span class="token punctuation">)</span><span class="token punctuation">.</span>value_of_css_property<span class="token punctuation">(</span><span class="token string">'background-image'</span><span class="token punctuation">)</span>
        small_url <span class="token operator">=</span> small_url<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'"'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"small_url:"</span><span class="token punctuation">,</span> small_url<span class="token punctuation">)</span>
        big_pic_pattern <span class="token operator">=</span> <span class="token string">'/html/body/div/div[3]/div[2]/div[1]/div[2]/div'</span>
        big_url <span class="token operator">=</span> self<span class="token punctuation">.</span>driver<span class="token punctuation">.</span>find_element<span class="token punctuation">(</span>By<span class="token punctuation">.</span>XPATH<span class="token punctuation">,</span> big_pic_pattern<span class="token punctuation">)</span><span class="token punctuation">.</span>value_of_css_property<span class="token punctuation">(</span><span class="token string">'background-image'</span><span class="token punctuation">)</span>
        big_url <span class="token operator">=</span> big_url<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'"'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>big_url<span class="token punctuation">)</span>

        distance <span class="token operator">=</span> self<span class="token punctuation">.</span>get_distance<span class="token punctuation">(</span>small_url<span class="token punctuation">,</span> big_url<span class="token punctuation">)</span>
        distance <span class="token operator">=</span> <span class="token punctuation">(</span>distance <span class="token operator">-</span> offset<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">280.0</span> <span class="token operator">/</span> <span class="token number">680.0</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"distance:"</span><span class="token punctuation">,</span> distance<span class="token punctuation">)</span>
        element <span class="token operator">=</span> self<span class="token punctuation">.</span>driver<span class="token punctuation">.</span>find_element<span class="token punctuation">(</span>By<span class="token punctuation">.</span>XPATH<span class="token punctuation">,</span> <span class="token string">'//*[@id="tcOperation"]/div[6]'</span><span class="token punctuation">)</span>
        ActionChains<span class="token punctuation">(</span>self<span class="token punctuation">.</span>driver<span class="token punctuation">)</span><span class="token punctuation">.</span>click_and_hold<span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">.</span>perform<span class="token punctuation">(</span><span class="token punctuation">)</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span>
        steps <span class="token operator">=</span> self<span class="token punctuation">.</span>get_steps<span class="token punctuation">(</span>distance<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"steps:"</span><span class="token punctuation">,</span> steps<span class="token punctuation">)</span>
        <span class="token keyword">for</span> step <span class="token keyword">in</span> steps<span class="token punctuation">:</span>
            ActionChains<span class="token punctuation">(</span>self<span class="token punctuation">.</span>driver<span class="token punctuation">)</span><span class="token punctuation">.</span>move_by_offset<span class="token punctuation">(</span>step<span class="token punctuation">,</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>perform<span class="token punctuation">(</span><span class="token punctuation">)</span>
            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token punctuation">(</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

        ActionChains<span class="token punctuation">(</span>self<span class="token punctuation">.</span>driver<span class="token punctuation">)</span><span class="token punctuation">.</span>release<span class="token punctuation">(</span>on_element<span class="token operator">=</span>element<span class="token punctuation">)</span><span class="token punctuation">.</span>perform<span class="token punctuation">(</span><span class="token punctuation">)</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span>wait_time1_long<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>driver<span class="token punctuation">.</span>switch_to<span class="token punctuation">.</span>parent_frame<span class="token punctuation">(</span><span class="token punctuation">)</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span>wait_time1_long<span class="token punctuation">)</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>driver<span class="token punctuation">.</span>title <span class="token operator">!=</span> <span class="token string">"QQ邮箱"</span><span class="token punctuation">:</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>driver<span class="token punctuation">.</span>switch_to<span class="token punctuation">.</span>default_content<span class="token punctuation">(</span><span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>driver<span class="token punctuation">.</span>switch_to<span class="token punctuation">.</span>frame<span class="token punctuation">(</span><span class="token string">'login_frame'</span><span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>driver<span class="token punctuation">.</span>switch_to<span class="token punctuation">.</span>frame<span class="token punctuation">(</span><span class="token string">"tcaptcha_iframe_dy"</span><span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>driver<span class="token punctuation">.</span>find_element<span class="token punctuation">(</span>By<span class="token punctuation">.</span>ID<span class="token punctuation">,</span> <span class="token string">'guideText'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'滑动失败!'</span><span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>verification_code<span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span>
            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'帐号密码有误!'</span><span class="token punctuation">)</span>

        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'登录成功!'</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>driver<span class="token punctuation">.</span>quit<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">get_steps</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> dis<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 计算公式：v=v0+at, s=v0t+½at², v²-v0²=2as</span>
        v <span class="token operator">=</span> <span class="token number">0</span>
        t <span class="token operator">=</span> <span class="token number">0.3</span>
        steps <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        current <span class="token operator">=</span> <span class="token number">0</span>
        mid <span class="token operator">=</span> dis <span class="token operator">/</span> <span class="token number">2</span>
        <span class="token keyword">while</span> current <span class="token operator">&lt;</span> dis<span class="token punctuation">:</span>
            <span class="token keyword">if</span> current <span class="token operator">&lt;</span> mid<span class="token punctuation">:</span>
                a <span class="token operator">=</span> <span class="token number">2</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                a <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">2</span>
            v0 <span class="token operator">=</span> v
            s <span class="token operator">=</span> v0 <span class="token operator">*</span> t <span class="token operator">+</span> <span class="token number">0.5</span> <span class="token operator">*</span> a <span class="token operator">*</span> <span class="token punctuation">(</span>t <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">)</span>
            current <span class="token operator">+=</span> s
            steps<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">round</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span>
            v <span class="token operator">=</span> v0 <span class="token operator">+</span> a <span class="token operator">*</span> t
        <span class="token keyword">return</span> steps

    <span class="token keyword">def</span> <span class="token function">__del__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>driver<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>driver<span class="token punctuation">.</span>quit<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    driver_path <span class="token operator">=</span> <span class="token string">r"E:\webdriver\chromedriver.exe"</span>
    user_name <span class="token operator">=</span> <span class="token string">'993226448'</span>
    password <span class="token operator">=</span> <span class="token string">''</span>
    email <span class="token operator">=</span> QQEmail<span class="token punctuation">(</span>user_name<span class="token punctuation">,</span> password<span class="token punctuation">,</span> driver_path<span class="token punctuation">)</span>
    email<span class="token punctuation">.</span>login_email<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/6681b9de9e0f0747c66c8b37ad2e33d2/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">图像除尘去雾技术总结</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/fb1b122973cf3396afe07037728e3e4e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Nuxt3请求封装数据封装</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>