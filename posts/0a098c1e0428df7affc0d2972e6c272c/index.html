<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>爬虫之爬取中国移动采购与招标网 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="爬虫之爬取中国移动采购与招标网" />
<meta property="og:description" content="文章目录 一、确认爬取目标二、尝试爬取三、使用`pyppeteer`库四、完整代码 一、确认爬取目标 爬取中国移动采购与招标网
https://b2b.10086.cn/b2b/main/listVendorNotice.html?noticeType=2
二、尝试爬取 首先我使用开发者工具，尝试看一下，数据是怎么请求回来的。
然后就发现这个，
https://b2b.10086.cn/b2b/main/listVendorNoticeResult.html?ekp1APd1=5TLUwJWxAYSUQisKAQ7GQCmzeFYm3elSTJIbLwkENOZcE12UDTYQwQlfkHI060.eBM1uON79v8qI1LO7tF7F.X8OAzNv2UJzHC3c7mIn7kdv8uXX9oYb2fnQHKnadmc5g4UxDf3gtSPSVp2dTR.8w53vDV9zEmIFvtZEfuhjtWpy76pDtYbZyrwDAQu.ajmtBgS6V_te04Npxi.z7n29IOrW0vGx69gEODHLj7SpROqNSgrRnjg6m2C10.nxiPE3Ct1Z7l9prASgIZsjvRvPA4R7qrXjxPHyOQ8qjtk5cusVz6KcLLEq1C0M.iAxh1jFaI_71dvxIVG1Y8GMkyJLRfZdMqR486Fs8hElRevldHeA&amp;TB2MFwna=4QzPraLfz28OIFVRtGW84.C9jpMGeku7LWPoPWDJ02_xrpYWLY.c2YCWGvQsQ.mQo3bNxDkTGTAZ2HyxEen9QeI0e0MV7lT6inRUqWDy47nRYhdG0hqTjvvznYpfB1ONw8X1VE43GQXkqRolOuJW0ShZrVaqEDLjOGaewpowVguQ
根据这个可以通过分析js代码，查看参数的生成方式。使用requests.post请求之后，发现请求失败。
改变策略，使用selenium来试试看，普通的selenium没有隐藏掉相关的信息，发现还是返回不了数据。
现在有两个方法可以解决，一是隐藏掉selenium的信息，二是使用pyppeteer库，这一次先使用pyppeteer来爬取这个网站的信息。
三、使用pyppeteer库 这个库是puppeteer（node.js的一个库）的python版本，已经好久没更新了，之后可以使用node.js来实现，现在先使用pyppeteer来解决这个问题。
一些基本的语法，在上一篇博客中介绍了，有兴趣的可以去看看。
下面来尝试一下
import asyncio from pyppeteer import launch async def main(): url = &#39;https://b2b.10086.cn/b2b/main/listVendorNotice.html?noticeType=2&#39; browser = await launch(headless=False, ignoreDefaultArgs=[&#39;--enable-automation&#39;]) page = await browser.newPage() await page.goto(url) # 待提取数据 input(&#39;输入随意字符退出：&#39;) await browser.close() asyncio.get_event_loop().run_until_complete(main()) OK数据请求回来了，接下来就简单了，只需要把数据，拿出来就行了。
element = await page.querySelectorAll(&#34;tbody tr[class]&#34;) for el in element: s1 = await el.querySelector(&#34;td:nth-child(1)&#34;) s1 = await (await s1.getProperty(&#39;textContent&#39;)).jsonValue() s2 = await el.querySelector(&#34;td:nth-child(2)&#34;) s2 = await (await s2." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/0a098c1e0428df7affc0d2972e6c272c/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-06-22T10:14:29+08:00" />
<meta property="article:modified_time" content="2021-06-22T10:14:29+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">爬虫之爬取中国移动采购与招标网</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><ul><li><a href="#_2" rel="nofollow">一、确认爬取目标</a></li><li><a href="#_10" rel="nofollow">二、尝试爬取</a></li><li><a href="#pyppeteer_39" rel="nofollow">三、使用`pyppeteer`库</a></li><li><a href="#_107" rel="nofollow">四、完整代码</a></li></ul> 
 </li></ul> 
</div> 
<br> 
<br> 
<br> 
<p></p> 
<h3><a id="_2"></a>一、确认爬取目标</h3> 
<p>爬取中国移动采购与招标网</p> 
<p><code>https://b2b.10086.cn/b2b/main/listVendorNotice.html?noticeType=2</code></p> 
<p><br><br></p> 
<h3><a id="_10"></a>二、尝试爬取</h3> 
<p>首先我使用开发者工具，尝试看一下，数据是怎么请求回来的。</p> 
<p>然后就发现这个，</p> 
<p><img src="https://images2.imgbox.com/e3/00/aj7zC7r3_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/95/15/bJ29NGep_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>https://b2b.10086.cn/b2b/main/listVendorNoticeResult.html?ekp1APd1=5TLUwJWxAYSUQisKAQ7GQCmzeFYm3elSTJIbLwkENOZcE12UDTYQwQlfkHI060.eBM1uON79v8qI1LO7tF7F.X8OAzNv2UJzHC3c7mIn7kdv8uXX9oYb2fnQHKnadmc5g4UxDf3gtSPSVp2dTR.8w53vDV9zEmIFvtZEfuhjtWpy76pDtYbZyrwDAQu.ajmtBgS6V_te04Npxi.z7n29IOrW0vGx69gEODHLj7SpROqNSgrRnjg6m2C10.nxiPE3Ct1Z7l9prASgIZsjvRvPA4R7qrXjxPHyOQ8qjtk5cusVz6KcLLEq1C0M.iAxh1jFaI_71dvxIVG1Y8GMkyJLRfZdMqR486Fs8hElRevldHeA&amp;TB2MFwna=4QzPraLfz28OIFVRtGW84.C9jpMGeku7LWPoPWDJ02_xrpYWLY.c2YCWGvQsQ.mQo3bNxDkTGTAZ2HyxEen9QeI0e0MV7lT6inRUqWDy47nRYhdG0hqTjvvznYpfB1ONw8X1VE43GQXkqRolOuJW0ShZrVaqEDLjOGaewpowVguQ</p> 
</blockquote> 
<p>根据这个可以通过分析js代码，查看参数的生成方式。使用<code>requests.post</code>请求之后，发现请求失败。</p> 
<br> 
<p>改变策略，使用selenium来试试看，普通的selenium没有隐藏掉相关的信息，发现还是返回不了数据。</p> 
<p><img src="https://images2.imgbox.com/eb/f7/IaUKfqbJ_o.png" alt="在这里插入图片描述"></p> 
<p><br><br><br> 现在有两个方法可以解决，一是隐藏掉<code>selenium</code>的信息，二是使用<code>pyppeteer</code>库，这一次先使用<code>pyppeteer</code>来爬取这个网站的信息。</p> 
<p><br><br><br></p> 
<h3><a id="pyppeteer_39"></a>三、使用<code>pyppeteer</code>库</h3> 
<p>这个库是<code>puppeteer</code>（node.js的一个库）的python版本，已经好久没更新了，之后可以使用node.js来实现，现在先使用<code>pyppeteer</code>来解决这个问题。</p> 
<p>一些基本的语法，在上一篇博客中介绍了，有兴趣的可以去看看。</p> 
<p>下面来尝试一下</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> asyncio
<span class="token keyword">from</span> pyppeteer <span class="token keyword">import</span> launch


<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    url <span class="token operator">=</span> <span class="token string">'https://b2b.10086.cn/b2b/main/listVendorNotice.html?noticeType=2'</span>
    browser <span class="token operator">=</span> <span class="token keyword">await</span> launch<span class="token punctuation">(</span>headless<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> ignoreDefaultArgs<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'--enable-automation'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    page <span class="token operator">=</span> <span class="token keyword">await</span> browser<span class="token punctuation">.</span>newPage<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">await</span> page<span class="token punctuation">.</span>goto<span class="token punctuation">(</span>url<span class="token punctuation">)</span>

    <span class="token comment"># 待提取数据</span>

    <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'输入随意字符退出：'</span><span class="token punctuation">)</span>

    <span class="token keyword">await</span> browser<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
asyncio<span class="token punctuation">.</span>get_event_loop<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>run_until_complete<span class="token punctuation">(</span>main<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/54/f4/27S3kG5Q_o.png" alt="在这里插入图片描述"></p> 
<p><br><br></p> 
<p>OK数据请求回来了，接下来就简单了，只需要把数据，拿出来就行了。</p> 
<pre><code class="prism language-python">element <span class="token operator">=</span> <span class="token keyword">await</span> page<span class="token punctuation">.</span>querySelectorAll<span class="token punctuation">(</span><span class="token string">"tbody tr[class]"</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> el <span class="token keyword">in</span> element<span class="token punctuation">:</span>
    s1 <span class="token operator">=</span> <span class="token keyword">await</span> el<span class="token punctuation">.</span>querySelector<span class="token punctuation">(</span><span class="token string">"td:nth-child(1)"</span><span class="token punctuation">)</span>
    s1 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token punctuation">(</span><span class="token keyword">await</span> s1<span class="token punctuation">.</span>getProperty<span class="token punctuation">(</span><span class="token string">'textContent'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>jsonValue<span class="token punctuation">(</span><span class="token punctuation">)</span>

    s2 <span class="token operator">=</span> <span class="token keyword">await</span> el<span class="token punctuation">.</span>querySelector<span class="token punctuation">(</span><span class="token string">"td:nth-child(2)"</span><span class="token punctuation">)</span>
    s2 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token punctuation">(</span><span class="token keyword">await</span> s2<span class="token punctuation">.</span>getProperty<span class="token punctuation">(</span><span class="token string">'textContent'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>jsonValue<span class="token punctuation">(</span><span class="token punctuation">)</span>

    s3 <span class="token operator">=</span> <span class="token keyword">await</span> el<span class="token punctuation">.</span>querySelector<span class="token punctuation">(</span><span class="token string">"td:nth-child(3)"</span><span class="token punctuation">)</span>
    s3 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token punctuation">(</span><span class="token keyword">await</span> s3<span class="token punctuation">.</span>getProperty<span class="token punctuation">(</span><span class="token string">'textContent'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>jsonValue<span class="token punctuation">(</span><span class="token punctuation">)</span>

    s4 <span class="token operator">=</span> <span class="token keyword">await</span> el<span class="token punctuation">.</span>querySelector<span class="token punctuation">(</span><span class="token string">"td:nth-child(4)"</span><span class="token punctuation">)</span>
    s4 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token punctuation">(</span><span class="token keyword">await</span> s4<span class="token punctuation">.</span>getProperty<span class="token punctuation">(</span><span class="token string">'textContent'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>jsonValue<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>s1<span class="token punctuation">,</span> s2<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>s3<span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> s4<span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/19/c3/HV6Qy2Vl_o.png" alt="在这里插入图片描述"></p> 
<p><br><br></p> 
<p>使用点击，进入下一页</p> 
<pre><code class="prism language-python"><span class="token keyword">await</span> page<span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token string">"#pageid2 &gt; table &gt; tbody &gt; tr &gt; td:nth-child(4) &gt; a &gt; span"</span><span class="token punctuation">)</span>
</code></pre> 
<p>这样就可以进行爬取数据了，将爬取的数据存在csv中。<br> <br><br> <br></p> 
<h3><a id="_107"></a>四、完整代码</h3> 
<pre><code class="prism language-python"><span class="token keyword">import</span> asyncio
<span class="token keyword">from</span> pyppeteer <span class="token keyword">import</span> launch
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd


<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    url <span class="token operator">=</span> <span class="token string">'https://b2b.10086.cn/b2b/main/listVendorNotice.html?noticeType=2'</span>
    browser <span class="token operator">=</span> <span class="token keyword">await</span> launch<span class="token punctuation">(</span>headless<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> ignoreDefaultArgs<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'--enable-automation'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    page <span class="token operator">=</span> <span class="token keyword">await</span> browser<span class="token punctuation">.</span>newPage<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">await</span> page<span class="token punctuation">.</span>goto<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
	
    s <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    n <span class="token operator">=</span> <span class="token number">10</span>
    <span class="token comment"># 10页</span>
    <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
        element <span class="token operator">=</span> <span class="token keyword">await</span> page<span class="token punctuation">.</span>querySelectorAll<span class="token punctuation">(</span><span class="token string">"tbody tr[class]"</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> el <span class="token keyword">in</span> element<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            s1 <span class="token operator">=</span> <span class="token keyword">await</span> el<span class="token punctuation">.</span>querySelector<span class="token punctuation">(</span><span class="token string">"td:nth-child(1)"</span><span class="token punctuation">)</span>
            s1 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token punctuation">(</span><span class="token keyword">await</span> s1<span class="token punctuation">.</span>getProperty<span class="token punctuation">(</span><span class="token string">'textContent'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>jsonValue<span class="token punctuation">(</span><span class="token punctuation">)</span>

            s2 <span class="token operator">=</span> <span class="token keyword">await</span> el<span class="token punctuation">.</span>querySelector<span class="token punctuation">(</span><span class="token string">"td:nth-child(2)"</span><span class="token punctuation">)</span>
            s2 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token punctuation">(</span><span class="token keyword">await</span> s2<span class="token punctuation">.</span>getProperty<span class="token punctuation">(</span><span class="token string">'textContent'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>jsonValue<span class="token punctuation">(</span><span class="token punctuation">)</span>

            s3 <span class="token operator">=</span> <span class="token keyword">await</span> el<span class="token punctuation">.</span>querySelector<span class="token punctuation">(</span><span class="token string">"td:nth-child(3)"</span><span class="token punctuation">)</span>
            s3 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token punctuation">(</span><span class="token keyword">await</span> s3<span class="token punctuation">.</span>getProperty<span class="token punctuation">(</span><span class="token string">'textContent'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>jsonValue<span class="token punctuation">(</span><span class="token punctuation">)</span>

            s4 <span class="token operator">=</span> <span class="token keyword">await</span> el<span class="token punctuation">.</span>querySelector<span class="token punctuation">(</span><span class="token string">"td:nth-child(4)"</span><span class="token punctuation">)</span>
            s4 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token punctuation">(</span><span class="token keyword">await</span> s4<span class="token punctuation">.</span>getProperty<span class="token punctuation">(</span><span class="token string">'textContent'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>jsonValue<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>s1<span class="token punctuation">,</span> s2<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>s3<span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> s4<span class="token punctuation">)</span>
            s<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">[</span>s1<span class="token punctuation">,</span> s2<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>s3<span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> s4<span class="token punctuation">]</span><span class="token punctuation">)</span>

        <span class="token keyword">await</span> page<span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token string">"#pageid2 &gt; table &gt; tbody &gt; tr &gt; td:nth-child(4) &gt; a &gt; span"</span><span class="token punctuation">)</span>
        <span class="token keyword">await</span> page<span class="token punctuation">.</span>waitFor<span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span>
	<span class="token keyword">else</span><span class="token punctuation">:</span>
        sl <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
    	sl<span class="token punctuation">.</span>to_csv<span class="token punctuation">(</span><span class="token string">"test.csv"</span><span class="token punctuation">,</span>index<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"爬取完成"</span><span class="token punctuation">)</span>

    <span class="token keyword">await</span> browser<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>


asyncio<span class="token punctuation">.</span>get_event_loop<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>run_until_complete<span class="token punctuation">(</span>main<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ea890c1ba1e504c96225291ec661e146/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">mac安装openjdk并配置idea</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f17f84db709db78224acaa07809f0073/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">ICMP协议抓包相关分析</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>