<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>多reactor模式模拟Proactor模式的C&#43;&#43;高性能高并发HTTP服务器 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="多reactor模式模拟Proactor模式的C&#43;&#43;高性能高并发HTTP服务器" />
<meta property="og:description" content="多reactor模式模拟Proactor模式的C&#43;&#43;高性能高并发HTTP服务器 github地址：https://github.com/1249302623/myWebServer
介绍 本项目为linux下C&#43;&#43;11编写的Web资源服务器，支持web端用户实现注册、登录功能，可以请求服务器图片和视频文件，实现同步/异步日志系统，记录服务器运行状态，经压力测试可以实现至少两万的并发连接客户端，50s内处理请求200w个，0失败，每秒响应请求4w多个。
环境 操作系统: Ubuntu 16.04.12编译器: g&#43;&#43; 5.4.0IDE：vscode服务器配置：4核8G华为云主机数据库：mysql 运行 进入build目录，执行./LiuServerPro文件
必须在build目录执行，否则无法正确识别HTML文件
cd build
./LiuServerPro
运用技术 使用主从Reactor线程池模拟Proactor模式，reactor线程池充当Proactor的异步IO线程。使用Epoll边沿触发的IO多路复用技术构建Reactor线程池，主reactor线程只负责accept请求，并以RoundRobin的方式分发给从reactor线程。从reactor线程池在接收完数据后通知Proactor用户线程。构建Proactor用户线程池，对tcp数据进行处理，执行用户函数。使用基于小根堆的定时器关闭超时请求使用muduo库的buffer类实现高性能的输入输出缓冲区使用eventfd实现了线程的异步唤醒使用双缓冲区技术实现了异步日志系统使用状态机解析HTTP请求报文，支持解析GET和POST请求访问服务器数据库实现web端用户注册、登录功能，可以请求服务器图片和视频文件为减少内存泄漏的可能，使用智能指针等RAII机制重构了muduo库的框架，用继承和虚函数的方式代替了回调函数，框架更加清晰。 模型 并发模型为主从Reactor线程池(Procator异步线程）&#43;用户线程池（Proactor同步线程）。
参考 本文主要参考自陈硕老师muduo库
https://github.com/chenshuo/muduoReactor线程池，有限状态机和定时器部分参考
https://github.com/linyacool/WebServer数据库连接池部分和HTML文件摘自
https://github.com/qinguoyi/TinyWebServer 测试 使用Apache Benchmark(简称ab)进行服务器压力测试，ab是Apache安装包中自带的压力测试工具.
输入命令：
ab -t 60 -n 2000000 -c 20000 -r -k http://127.0.0.1:8080/
命令解释：测试实现限制在60s,并发连接用户数2w个（2w并不是服务器的最大连接数，而是ab压力测试所能模拟的最大客户端数量），并发请求数200w个 ,保持常连接，出错时直接返回，结果如下：
可以看到，
完成请求200w次，0失败
每秒响应请求数41036次，
带宽21239.4kb/s,
最大请求响应时间797ms
演示 web端用户实现注册、登录功能，可以请求服务器图片和视频文件
https://github.com/1249302623/myWebServer/blob/master/TestPic/%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%BC%94%E7%A4%BA.mp4" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/0aeb3c019b69b335b2acfb59e8bc21af/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-11-24T21:57:09+08:00" />
<meta property="article:modified_time" content="2020-11-24T21:57:09+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">多reactor模式模拟Proactor模式的C&#43;&#43;高性能高并发HTTP服务器</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="reactorProactorCHTTP_0"></a>多reactor模式模拟Proactor模式的C++高性能高并发HTTP服务器</h2> 
<p>github地址：<a href="https://github.com/1249302623/myWebServer">https://github.com/1249302623/myWebServer</a></p> 
<h3><a id="_2"></a>介绍</h3> 
<p>本项目为linux下C++11编写的Web资源服务器，支持web端用户实现注册、登录功能，可以请求服务器图片和视频文件，实现同步/异步日志系统，记录服务器运行状态，经压力测试可以实现至少两万的并发连接客户端，50s内处理请求200w个，0失败，每秒响应请求4w多个。</p> 
<h3><a id="_7"></a>环境</h3> 
<ul><li>操作系统: Ubuntu 16.04.12</li><li>编译器: g++ 5.4.0</li><li>IDE：vscode</li><li>服务器配置：4核8G华为云主机</li><li>数据库：mysql</li></ul> 
<h3><a id="_13"></a>运行</h3> 
<p>进入build目录，执行./LiuServerPro文件<br> 必须在build目录执行，否则无法正确识别HTML文件</p> 
<ul><li> <p>cd build</p> </li><li> <p>./LiuServerPro</p> </li></ul> 
<h3><a id="_21"></a>运用技术</h3> 
<ul><li>使用主从Reactor线程池模拟Proactor模式，reactor线程池充当Proactor的异步IO线程。</li><li>使用Epoll边沿触发的IO多路复用技术构建Reactor线程池，主reactor线程只负责accept请求，并以RoundRobin的方式分发给从reactor线程。从reactor线程池在接收完数据后通知Proactor用户线程。</li><li>构建Proactor用户线程池，对tcp数据进行处理，执行用户函数。</li><li>使用基于小根堆的定时器关闭超时请求</li><li>使用muduo库的buffer类实现高性能的输入输出缓冲区</li><li>使用eventfd实现了线程的异步唤醒</li><li>使用双缓冲区技术实现了异步日志系统</li><li>使用状态机解析HTTP请求报文，支持解析GET和POST请求</li><li>访问服务器数据库实现web端用户注册、登录功能，可以请求服务器图片和视频文件</li><li>为减少内存泄漏的可能，使用智能指针等RAII机制</li><li>重构了muduo库的框架，用继承和虚函数的方式代替了回调函数，框架更加清晰。</li></ul> 
<h3><a id="_34"></a>模型</h3> 
<p>并发模型为主从Reactor线程池(Procator异步线程）+用户线程池（Proactor同步线程）。<br> <img src="https://images2.imgbox.com/62/51/dfXSlq9g_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_39"></a>参考</h3> 
<ul><li>本文主要参考自陈硕老师muduo库<br> <a href="https://github.com/chenshuo/muduo">https://github.com/chenshuo/muduo</a></li><li>Reactor线程池，有限状态机和定时器部分参考<br> <a href="https://github.com/linyacool/WebServer">https://github.com/linyacool/WebServer</a></li><li>数据库连接池部分和HTML文件摘自<br> <a href="https://github.com/qinguoyi/TinyWebServer">https://github.com/qinguoyi/TinyWebServer</a></li></ul> 
<h3><a id="_47"></a>测试</h3> 
<p>使用Apache Benchmark(简称ab)进行服务器压力测试，ab是Apache安装包中自带的压力测试工具.<br> 输入命令：<br> ab -t 60 -n 2000000 -c 20000 -r -k http://127.0.0.1:8080/</p> 
<p>命令解释：测试实现限制在60s,并发连接用户数2w个（2w并不是服务器的最大连接数，而是ab压力测试所能模拟的最大客户端数量），并发请求数200w个 ,保持常连接，出错时直接返回，结果如下：<br> <img src="https://images2.imgbox.com/ad/39/7m6QMagj_o.png" alt="在这里插入图片描述"></p> 
<p>可以看到，<br> 完成请求200w次，0失败<br> 每秒响应请求数41036次，<br> 带宽21239.4kb/s,<br> 最大请求响应时间797ms</p> 
<h3><a id="_62"></a>演示</h3> 
<p>web端用户实现注册、登录功能，可以请求服务器图片和视频文件<br> <a href="https://github.com/1249302623/myWebServer/blob/master/TestPic/%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%BC%94%E7%A4%BA.mp4">https://github.com/1249302623/myWebServer/blob/master/TestPic/%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%BC%94%E7%A4%BA.mp4</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/8dac6c7b361ae8989ebd3315fc403bac/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">blob 图片_js如何下载图片、pdf、mp3等各类多媒体文件</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/62103e0ff6d10205deb7a4f785c78376/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">计算机网络之应用层图解，秒解应用层HTTP，期末考试不担心！！</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>