<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Linux--好玩的进度条 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Linux--好玩的进度条" />
<meta property="og:description" content="前言 先来看看我们想要达到的进度条效果，具体代码会在文章最后面放出。 一、创建文件及Makefile 我们需要实现声明的定义的分离，因此创建如下三个文件。
process.h prcess.c main.c。
touch process.h process.c main.c 同时还需要创建Makefile来帮助我们构建代码。
touch Makefile vim打开Makefile进行编辑。
vim Makefile 第一行 代表mybin依赖与main.c和process.c
第二行 gcc命令，$^指第一行 “:” 右边的内容，$@指 “:” 左边的内容，即等于gcc main.c process.c -o mybin。这会生成可执行文件mybin。
第三行 .PHONY声明伪目标：clean，让clean代码一直可以执行。
第四行 代表clean没有依赖任何文件
第五行 删除命令，删除 mybin
1 mybin:main.c process.c 2 gcc $^ -o $@ 3 .PHONY:clean 4 clean: 5 rm -f mybin 二、第一版代码 vim process.h 打开文件进行编辑。（unistd.h是后面需要用到的休眠函数头文件）
#pragma once #include &lt;stdio.h&gt; #include &lt;string.h&gt; #include &lt;unistd.h&gt; void process(); vim process.c 代码部分难度不高，重要的地方在于打印函数，printf(&#34;[%-100s][%3d%%][%c]\r&#34;,bar,rate,str[rate%num]);" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/169c347e445918a8eee423f525b9f0dd/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-08T17:57:16+08:00" />
<meta property="article:modified_time" content="2024-01-08T17:57:16+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Linux--好玩的进度条</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2>前言</h2> 
<p>先来看看我们想要达到的进度条效果，具体代码会在文章最后面放出。 </p> 
<p><img alt="" height="363" src="https://images2.imgbox.com/7e/32/M0D8qPqc_o.gif" width="1130"></p> 
<h2> 一、创建文件及Makefile</h2> 
<p>我们需要实现声明的定义的分离，因此创建如下三个文件。</p> 
<p>process.h     prcess.c   main.c。</p> 
<pre><code class="language-bash">touch process.h process.c main.c</code></pre> 
<p> 同时还需要创建Makefile来帮助我们构建代码。</p> 
<pre><code class="language-bash">touch Makefile</code></pre> 
<p>vim打开Makefile进行编辑。</p> 
<pre><code class="language-cpp">vim Makefile</code></pre> 
<blockquote> 
 <p>第一行  代表mybin依赖与main.c和process.c</p> 
 <p>第二行  gcc命令，$^指第一行 “:” 右边的内容，$@指  “:”  左边的内容，即等于gcc main.c process.c -o mybin。这会生成可执行文件mybin。</p> 
 <p>第三行  .PHONY声明伪目标：clean，让clean代码一直可以执行。</p> 
 <p>第四行  代表clean没有依赖任何文件</p> 
 <p>第五行  删除命令，删除 mybin</p> 
</blockquote> 
<pre><code class="language-cpp">  1 mybin:main.c process.c
  2     gcc $^ -o $@
  3 .PHONY:clean
  4 clean:
  5     rm -f mybin    </code></pre> 
<h2>二、第一版代码</h2> 
<p>vim process.h 打开文件进行编辑。（unistd.h是后面需要用到的休眠函数头文件）</p> 
<pre><code class="language-cpp">#pragma once                                                                                                                                                   
#include &lt;stdio.h&gt;    
#include &lt;string.h&gt;    
#include &lt;unistd.h&gt;    
void process(); </code></pre> 
<p>vim process.c </p> 
<blockquote> 
 <p>代码部分难度不高，重要的地方在于打印函数，<span style="color:#fe2c24;"><strong>printf("[%-100s][%3d%%][%c]\r",bar,rate,str[rate%num]);</strong></span></p> 
 <p>-%100s代表向左保留100位打印字符串，%3d代表保留3位打印整形，\r代表只回车，就是将光标移动到最左边。</p> 
 <p>fflush(stdout)为刷新标准输出缓冲区，让缓冲区里面的内容输出在屏幕上。</p> 
 <p>usleep为休眠函数，单位为微秒。</p> 
</blockquote> 
<pre><code class="language-cpp">#include "process.h"    
    
#define SIZE 101    
#define STIME 1000*40    //设置休眠
const char* str = "|/-\\";    //旋转符号
    
void process()    
{    
    int rate = 0;    //设置达到比率
    char bar[SIZE] = {0};    //先置空
    int num = strlen(str);    
    while(rate&lt;=100)    
    {    
        printf("[%-100s][%3d%%][%c]\r",bar,rate,str[rate%num]);                                                                                                
        fflush(stdout);    
        usleep(STIME);    
        bar[rate++] = '#';    
    }    
    printf("\n");    
}    
</code></pre> 
<p>vim main.c 调用一下。</p> 
<pre><code class="language-cpp">#include "process.h"                                                                                
                                                                                                                                                               
int main()                                                                                      
{                                                                                                    
    process();                                                                                            
} </code></pre> 
<p>编辑好了就wq保存并退出。</p> 
<p>因为有了Makefile，我们在命令行直接输入make就可以完成构建了。</p> 
<p class="img-center"><img alt="" height="53" src="https://images2.imgbox.com/40/98/4VFgUCFN_o.png" width="447"></p> 
<p> ./mybin   执行一下就输出了。<img alt="" height="64" src="https://images2.imgbox.com/26/02/EfJqqT6E_o.png" width="794"></p> 
<h2>三、第二版代码</h2> 
<p>在一版代码中，我们使用了一个函数将进度条打印完成，但真实的场景不是这样的，我们应该根据rate的更新，进行打印，rate更新了多少，我们才打印多少。</p> 
<p>因此我们给第二个版本函数参数添加一个rate，函数里面也不需要循环了，目的是调用这个函数就打印一次，我通过外面的循环去控制rate来打印。</p> 
<p>process.c添加如下代码</p> 
<pre><code class="language-cpp">void process_v2(int rate)
{
    static char bar[SIZE] = {0};
    int num = strlen(str);
    if(rate&lt;=100&amp;&amp;rate&gt;=0)
    {                           
        printf("[%-100s][%3d%%][%c]\r",bar,rate,str[rate%num]);
        fflush(stdout);   
        bar[rate] = '#';
    }                                                                        
}  </code></pre> 
<p>main.c添加如下代码去模拟下载</p> 
<p>目标为target，当前下载为total，直到下载达到了target才能说我们下载完成了。</p> 
<pre><code class="language-cpp">#define TARGET_SIZE 1024*1024 //需要下载的文件
#define DSIZE 1024*10
void download()
{
    int target = TARGET_SIZE;
    int total = 0;

    while(total&lt;=target)
    {
        usleep(STIME);      //休眠模拟下载需要消费的时间
        total+=DSIZE;       //休眠（下载）完成就添加下载好的百分比
        process_v2(total*100/target);  //调用打印
    }
    printf("\n");                                                                           
}
</code></pre> 
<p>主函数再调用一下即可 </p> 
<p class="img-center"><img alt="" height="87" src="https://images2.imgbox.com/d6/0a/WJXfzZ8W_o.png" width="244"></p> 
<p> </p> 
<p>由于main.c用到了process.c的宏定义，因此需要将该宏定义放到process.h里才不会报错（main.c和process.c都包了头文件process.h）</p> 
<p>process.h修改如下</p> 
<p class="img-center"><img alt="" height="137" src="https://images2.imgbox.com/e2/40/XiO5yUSr_o.png" width="366"></p> 
<p>我们在make后运行一下，没啥问题。</p> 
<p><img alt="" height="90" src="https://images2.imgbox.com/cb/89/5A0L5EDL_o.png" width="805"></p> 
<p>最后附上总代码</p> 
<p> process.h</p> 
<pre><code class="language-cpp">#pragma once
#include &lt;stdio.h&gt;
#include &lt;string.h&gt;
#include &lt;unistd.h&gt;
#define SIZE 101
#define STIME 1000*40
void process_v1();                                                    
void process_v2(int rate);
</code></pre> 
<p> process.c</p> 
<pre><code class="language-cpp">#include "process.h"

const char* str = "|/-\\";
void process_v1()
{
    int rate = 0;
    char bar[SIZE] = {0};
    int num = strlen(str);
    while(rate&lt;=100)
    {
        printf("[%-100s][%3d%%][%c]\r",bar,rate,str[rate%num]);
        fflush(stdout);
        usleep(STIME);
        bar[rate++] = '#';
    }
    printf("\n");
}

void process_v2(int rate)
{
    static char bar[SIZE] = {0};                                                 
    int num = strlen(str);
    if(rate&lt;=100&amp;&amp;rate&gt;=0)
    {
        printf("[%-100s][%3d%%][%c]\r",bar,rate,str[rate%num]);
        fflush(stdout);
        bar[rate] = '#';
    }
}
</code></pre> 
<p>main.c </p> 
<pre><code class="language-cpp">#include "process.h"    
    
#define TARGET_SIZE 1024*1024 //需要下载的文件    
#define DSIZE 1024*10    
void download()    
{    
    int target = TARGET_SIZE;    
    int total = 0;    
    
    while(total&lt;=target)    
    {    
        usleep(STIME);      //休眠模拟下载需要消费的时间    
        total+=DSIZE;    
        process_v2(total*100/target);    
    }    
    printf("\n");                                                                
}    
    
int main()    
{    
    //process_v1();    
    download();    
}</code></pre> 
<p>Makefile</p> 
<pre><code class="language-cpp">mybin:main.c process.c    
    gcc $^ -o $@    
.PHONY:clean    
clean:    
    rm -f mybin </code></pre> 
<p>谢谢大家观看 </p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b5e70cfc1d32eea70fb8a1b3533caedc/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">如何开发一款搬家拉货小程序</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/5c7a224ddfe7efc7c13ad085f742cbe6/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">单例日常使用模板</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>