<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>[转](3条消息) docker安装Mysql8.0的坑之lower(转载请删除括号里的内容) - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="[转](3条消息) docker安装Mysql8.0的坑之lower(转载请删除括号里的内容)" />
<meta property="og:description" content="(转载请删除括号里的内容)
docker安装Mysql8.0的坑之lower_case_table_names 有一只柴犬 2020-09-02 17:32:07 229 收藏
分类专栏： mysql
版权
目录
0、环境：
1、修改my.cnf（无效）：
2、docker指定--lower-case-table-names=1（特定情况无效）：
3、解决方案
0、环境： centos7、docker 17.12.1-ce、mysql 8.0.21
docker安装mysql命令：
docker run --name mysql --restart=always \
-v /home/mysql/conf/my.cnf:/etc/mysql/my.cnf \
-v /home/mysql/data:/var/lib/mysql \
-p 3317:3306 \
-e MYSQL_ROOT_PASSWORD=&#34;root&#34; \
-e TZ=Asia/Shanghai \
-d mysql:8.0
[root@shamee shamee]# docker run --name mysql --restart=always -e MYSQL_ROOT_PASSWORD=&#34;root&#34; -d mysql:8.0
222f3969bdb4a3c58da50707a73866c48cfd26f4c7b2feed32b56ae7de09b036
[root@shamee shamee]# docker ps
CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES
222f3969bdb4 mysql:8.0 &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/07ceee4cb848e3b9fb64ec7854211b1b/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-05-15T17:03:46+08:00" />
<meta property="article:modified_time" content="2022-05-15T17:03:46+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">[转](3条消息) docker安装Mysql8.0的坑之lower(转载请删除括号里的内容)</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>(转载请删除括号里的内容)</p> 
<h2 id="articleContentId"><a name="t0"></a><a class="hl hl-1" href="https://so.csdn.net/so/search?q=docker&amp;spm=1001.2101.3001.7020" title="docker">docker</a>安装Mysql8.0的坑之lower_case_table_names</h2> 
<p><img alt="" src="https://images2.imgbox.com/d5/97/0XXAHDS2_o.png"></p> 
<p><a href="https://me.csdn.net/p793049488" rel="nofollow" title="有一只柴犬">有一只柴犬</a> 2020-09-02 17:32:07 <img alt="" src="https://images2.imgbox.com/c8/4f/4veVEmAD_o.png"> 229 <a id="blog_detail_zk_collection"><img alt="" src="https://images2.imgbox.com/59/15/9Q9jaqfL_o.png"> 收藏</a></p> 
<p>分类专栏： <a href="https://blog.csdn.net/p793049488/category_10192633.html" title="mysql">mysql</a></p> 
<p>版权</p> 
<p id="main-toc"><strong>目录</strong></p> 
<p id=""><a href="#t1" rel="nofollow">0、环境：</a></p> 
<p id=""><a href="#t2" rel="nofollow">1、修改my.cnf（无效）：</a></p> 
<p id=""><a href="#t3" rel="nofollow">2、docker指定--lower-case-table-names=1（特定情况无效）：</a></p> 
<p id=""><a href="#t4" rel="nofollow">3、解决方案</a></p> 
<hr id="hr-toc"> 
<h3 id="%E7%8E%AF%E5%A2%83%EF%BC%9A"><a name="t1"></a>0、环境：</h3> 
<p><a class="hl hl-1" href="https://so.csdn.net/so/search?q=centos7&amp;spm=1001.2101.3001.7020" title="centos7">centos7</a>、docker 17.12.1-ce、mysql 8.0.21</p> 
<p></p> 
<p>docker安装mysql命令：</p> 
<pre><code> </code></pre> 
<ol><li> <p><code>docker run --name mysql --restart=always \</code></p> </li><li> <p><code>-v /home/mysql/conf/my.cnf:/etc/mysql/my.cnf \</code></p> </li><li> <p><code>-v /home/mysql/data:/var/lib/mysql \</code></p> </li><li> <p><code>-p 3317:3306 \</code></p> </li><li> <p><code>-e MYSQL_ROOT_PASSWORD="root" \</code></p> </li><li> <p><code>-e TZ=Asia/Shanghai \</code></p> </li><li> <p><code>-d mysql:8.0</code></p> </li></ol> 
<pre><code> </code></pre> 
<ol><li> <p><code>[root@shamee shamee]# docker run --name mysql --restart=always -e MYSQL_ROOT_PASSWORD="root" -d mysql:8.0</code></p> </li><li> <p><code>222f3969bdb4a3c58da50707a73866c48cfd26f4c7b2feed32b56ae7de09b036</code></p> </li><li> <p><code>[root@shamee shamee]# docker ps</code></p> </li><li> <p><code>CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES</code></p> </li><li> <p><code>222f3969bdb4 mysql:8.0 "docker-entrypoint.s…" 2 seconds ago Up 1 second 3306/tcp, 33060/tcp mysql</code></p> </li><li> <p><code>[root@shamee shamee]# docker exec -it mysql bash</code></p> </li><li> <p><code>root@222f3969bdb4:/# mysql -uroot -proot</code></p> </li><li> <p><code>mysql: [Warning] Using a password on the command line interface can be insecure.</code></p> </li><li> <p><code>Welcome to the MySQL monitor. Commands end with ; or \g.</code></p> </li><li> <p><code>Your MySQL connection id is 8</code></p> </li><li> <p><code>Server version: 8.0.21 MySQL Community Server - GPL</code></p> </li><li><li> <p><code>Copyright (c) 2000, 2020, Oracle and/or its affiliates. All rights reserved.</code></p> </li><li><li> <p><code>Oracle is a registered trademark of Oracle Corporation and/or its</code></p> </li><li> <p><code>affiliates. Other names may be trademarks of their respective</code></p> </li><li> <p><code>owners.</code></p> </li><li><li> <p><code>Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</code></p> </li><li><li> <p><code>mysql&gt; show variables like '%case%';</code></p> </li><li> <p><code>+------------------------+-------+</code></p> </li><li> <p><code>| Variable_name | Value |</code></p> </li><li> <p><code>+------------------------+-------+</code></p> </li><li> <p><code>| lower_case_file_system | OFF |</code></p> </li><li> <p><code>| lower_case_table_names | 0 |</code></p> </li><li> <p><code>+------------------------+-------+</code></p> </li><li> <p><code>2 rows in set (0.01 sec)</code></p> </li><li><li> <p><code>mysql&gt; </code></p> </li></ol> 
<p>看到mysql启动成功，同时也能正常连接。（这里是本地虚拟机测试，所以docker run没有外挂宿主目录，显然这是个不好的习惯）。用navicat试一下，</p> 
<p><img alt="" height="173" src="https://images2.imgbox.com/38/57/L1rpnKQd_o.png" width="305"></p> 
<p>Nice，docker安装mysql8.0一分钟搞定。那不是有一个下午的时间玩游戏？那就打一把吃鸡压压惊吧。</p> 
<p>可是到了第二天，服务器报错了：</p> 
<pre><code>Error querying database.  Cause: com.mysql.jdbc.exceptions.jdbc4.MySQLSyntaxErrorException: Table 'biz.XXL_JOB_QRTZ' doesn't exist</code></pre> 
<p>很显然，表名不存在，是因为表名是大写的问题。 于是乎，立马查看mysql的大小写敏感配置：</p> 
<pre><code> </code></pre> 
<ol><li> <p><code>mysql&gt; show variables like '%case%';</code></p> </li><li> <p><code>+------------------------+-------+</code></p> </li><li> <p><code>| Variable_name | Value |</code></p> </li><li> <p><code>+------------------------+-------+</code></p> </li><li> <p><code>| lower_case_file_system | OFF |</code></p> </li><li> <p><code>| lower_case_table_names | 0 |</code></p> </li><li> <p><code>+------------------------+-------+</code></p> </li><li> <p><code>2 rows in set (0.01 sec)</code></p> </li><li><li> <p><code>mysql&gt;</code></p> </li></ol> 
<p>果然，区别大小写。于是修改my.cnf：</p> 
<pre><code> </code></pre> 
<ol><li> <p><code>[mysqld]</code></p> </li><li> <p><code>pid-file = /var/run/mysqld/mysqld.pid</code></p> </li><li> <p><code>socket = /var/run/mysqld/mysqld.sock</code></p> </li><li> <p><code>datadir = /var/lib/mysql</code></p> </li><li> <p><code>secure-file-priv= NULL</code></p> </li><li> <p><code>lower_case_table_names=1</code></p> </li><li><li> <p><code># Custom config should go here</code></p> </li><li> <p><code>!includedir /etc/mysql/conf.d/</code></p> </li></ol> 
<p>重启mysql，发现mysql不仅没有启动成功，反而不断的在重启。查看log：</p> 
<pre><code> </code></pre> 
<ol><li> <p><code>[root@iZuf68t6hada0ayijajs45Z ~]# docker logs -f -t --tail 100f mysql</code></p> </li><li> <p><code>2020-09-02T08:47:27.840720958Z 2020-09-02 16:47:27+08:00 [Note] [Entrypoint]: Entrypoint script for MySQL Server 8.0.21-1debian10 started.</code></p> </li><li> <p><code>2020-09-02T08:47:27.897290758Z 2020-09-02 16:47:27+08:00 [Note] [Entrypoint]: Switching to dedicated user 'mysql'</code></p> </li><li> <p><code>2020-09-02T08:47:27.901725465Z 2020-09-02 16:47:27+08:00 [Note] [Entrypoint]: Entrypoint script for MySQL Server 8.0.21-1debian10 started.</code></p> </li><li> <p><code>2020-09-02T08:47:27.960172822Z mysqld: [Warning] Skipping '!includedir /etc/mysql/conf.d/' directive as maximum include recursion level was reached in file /etc/mysql/conf.d/my.cnf at line 30.</code></p> </li><li> <p><code>2020-09-02T08:47:28.197969455Z 2020-09-02T08:47:28.190817Z 0 [System] [MY-010116] [Server] /usr/sbin/mysqld (mysqld 8.0.21) starting as process 1</code></p> </li><li> <p><code>2020-09-02T08:47:28.199468695Z 2020-09-02T08:47:28.199360Z 1 [System] [MY-013576] [InnoDB] InnoDB initialization has started.</code></p> </li><li> <p><code>2020-09-02T08:47:28.432824695Z 2020-09-02T08:47:28.429540Z 1 [System] [MY-013577] [InnoDB] InnoDB initialization has ended.</code></p> </li><li> <p><code>2020-09-02T08:47:28.434242966Z 2020-09-02T08:47:28.434080Z 1 [ERROR] [MY-011087] [Server] Different lower_case_table_names settings for server ('1') and data dictionary ('0').</code></p> </li><li> <p><code>2020-09-02T08:47:28.434477428Z 2020-09-02T08:47:28.434339Z 0 [ERROR] [MY-010020] [Server] Data Dictionary initialization failed.</code></p> </li><li> <p><code>2020-09-02T08:47:28.434584287Z 2020-09-02T08:47:28.434551Z 0 [ERROR] [MY-010119] [Server] Aborting</code></p> </li><li> <p><code>2020-09-02T08:47:28.954820885Z 2020-09-02T08:47:28.949232Z 0 [System] [MY-010910] [Server] /usr/sbin/mysqld: Shutdown complete (mysqld 8.0.21) MySQL Community Server - GPL.</code></p> </li></ol> 
<p>显然，报错的第8行提示，设置的lower_case_table_names=1与默认的字典值0不一致，接着就拒绝了我的设置。</p> 
<p>翻看Mysql官网，<a href="https://dev.mysql.com/doc/refman/8.0/en/server-system-variables.html#sysvar_lower_case_table_names" rel="nofollow" title="MySQL :: MySQL 8.0 Reference Manual :: 5.1.8 Server System Variables">MySQL :: MySQL 8.0 Reference Manual :: 5.1.8 Server System Variables</a>有这个一段说明：</p> 
<p><img alt="" height="220" src="https://images2.imgbox.com/c2/33/X9xNe4gU_o.png" width="1200"></p> 
<p>在大多数情况下，这需要在第一次启动MySQL服务器之前在MySQL选项文件中配置lower_case_table_names。</p> 
<h3 id="1%E3%80%81%E4%BF%AE%E6%94%B9my.cnf%EF%BC%88%E6%97%A0%E6%95%88%EF%BC%89%EF%BC%9A"><a name="t2"></a>1、修改my.cnf（无效）：</h3> 
<p>按照官网的说法，Mysql8.0一旦你在初始化的时候没有给与相应的值，则默认lower_case_table_names=0。后续如果你想要在my.cnf中修改此项，Mysql8.0是不允许两者不一致的情况发生（5.7的版本是可以的，所以5.7的版本依然可以直接修改my.cnf）。所以事后修改这个配置是不允许的。</p> 
<h3 id="2%E3%80%81docker%E6%8C%87%E5%AE%9A--lower-case-table-names%3D1%EF%BC%88%E7%89%B9%E5%AE%9A%E6%83%85%E5%86%B5%E6%97%A0%E6%95%88%EF%BC%89%EF%BC%9A"><a name="t3"></a>2、docker指定--lower-case-table-names=1（特定情况无效）：</h3> 
<p>docker启动mysql修改配置：</p> 
<pre><code> </code></pre> 
<ol><li> <p><code>docker run --name mysql --restart=always \</code></p> </li><li> <p><code>-v /home/mysql/conf/my.cnf:/etc/mysql/my.cnf \</code></p> </li><li> <p><code>-v /home/mysql/data:/var/lib/mysql \</code></p> </li><li> <p><code>-p 3317:3306 \</code></p> </li><li> <p><code>-e MYSQL_ROOT_PASSWORD="root" \</code></p> </li><li> <p><code>-e TZ=Asia/Shanghai \</code></p> </li><li> <p><code>-d mysql:8.0 --lower-case-table-names=1</code></p> </li></ol> 
<p>网上很多说法都是在docker启动mysql的时候配置--lower-case-table-names。但是我这边尝试了很多遍都无效，原因是因为我的mysql初始化过了，/var/lib/mysql不是默认的初始化数据库，有人为修改的痕迹。</p> 
<h3 id="3%E3%80%81%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><a name="t4"></a>3、解决方案</h3> 
<p>重新启动mysql，如果是第一次安装，那么docker后面直接加--lower-case-table-names=1是可以的。</p> 
<p>如果不是第一次装，需要卸载掉原有的mysql，-v /home/mysql/data:/var/lib/mysql 这里指定一个新的，干净的数据仓库。然后再--lower-case-table-names=1即可。</p> 
<p>如：</p> 
<pre><code> </code></pre> 
<ol><li> <p><code>原有：</code></p> </li><li> <p><code>docker run --name mysql --restart=always \</code></p> </li><li> <p><code>-v /home/mysql/conf/my.cnf:/etc/mysql/my.cnf \</code></p> </li><li> <p><code>-v /home/mysql/data:/var/lib/mysql \</code></p> </li><li> <p><code>-p 3317:3306 \</code></p> </li><li> <p><code>-e MYSQL_ROOT_PASSWORD="root" \</code></p> </li><li> <p><code>-e TZ=Asia/Shanghai \</code></p> </li><li> <p><code>-d mysql:8.0</code></p> </li><li><li><li><li> <p><code>修改：</code></p> </li><li> <p><code>docker run --name mysql --restart=always \</code></p> </li><li> <p><code>-v /home/mysql/conf/my.cnf:/etc/mysql/my.cnf \</code></p> </li><li> <p><code>-v /home/mysql/data2:/var/lib/mysql \</code></p> </li><li> <p><code>-p 3317:3306 \</code></p> </li><li> <p><code>-e MYSQL_ROOT_PASSWORD="root" \</code></p> </li><li> <p><code>-e TZ=Asia/Shanghai \</code></p> </li><li> <p><code>-d mysql:8.0 --lower-case-table-names=1</code></p> </li></ol> 
<p>其中/home/mysql/data2为新建的目录即可， 但是这种做法，最好数据要备份，防止丢失。</p> 
<p><br> ---------------------<br> 作者：白云v城主<br> 来源：CSDN<br> 原文：https://blog.csdn.net/sinat_36765345/article/details/108769802<br> 版权声明：本文为作者原创文章，转载请附上博文链接！<br> 内容解析By：<a href="https://greasyfork.org/zh-CN/scripts/381053-csdn-cnblog%E5%8D%9A%E5%AE%A2%E6%96%87%E7%AB%A0%E4%B8%80%E9%94%AE%E8%BD%AC%E8%BD%BD%E6%8F%92%E4%BB%B6" rel="nofollow" title="CSDN,CNBLOG博客文章一键转载插件">CSDN,CNBLOG博客文章一键转载插件</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f34c54deafc886c6b6506113fb9dfc8d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">SpringIOC 依赖注入</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f65a1c0541f037845eb5d3e20fa4d42e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Orchestrator Failover过程源码分析-II</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>