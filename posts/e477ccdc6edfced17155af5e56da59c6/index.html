<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Android网络数据JSON解析使用总结 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Android网络数据JSON解析使用总结" />
<meta property="og:description" content="一．JSON基础知识 （一）什么是json JSON(JavaScript Object Notation) 是一种轻量级的数据交换格式。 易于人阅读和编写。同时也易于机器解析和生成。 它基于JavaScript Programming Language, Standard ECMA262 3rd Edition - December 1999的一个子集。 JSON采用完全独立于语言的文本格式，但 是也使用了类似于C语言家族的习惯（包括C, C&#43;&#43;, C#, Java, JavaScript, Perl, Python等）。 这些特性使JSON成为理想的数据交换语言。
（二）JSON建构于两种结构 1.“名称/值”对的集合（A collection of name/value pairs）。 不同的语言中，它被理解为对象（object），哈希表 （hash table），有键列表（keyed list），或者关联数组 （associative array）等等。 2.值的有序列表（An ordered list of values）。 在大部分语言中，它被理解为数组 （array）。 这些都是常见的数据结构。事实上大部分现代计算机语言都以某种形式支持它们。这使得一种数据格式在同样基于这些结构的编程语言之间交换成为可能。
（三）JSON形式 1.对象是一个无序的“‘名称/值’对”集合。 一个对象以“{”（左括号）开始，“}”（右括 号）结束。每个“名称”后跟一个“:”（冒号）；“‘名称/值’ 对”之间使用“,”（逗号） 分隔。 2.数组是值（value）的有序集合。 一个数组以“[”（左中括号）开始，“]”（右中括号）结 束。值之间使用“,”（逗号）分隔。 3.值（value）可以是双引号括起来的字符串（string）、数值(number)、true、false、 null、 对象（object）或者数组（array）。这些结构可以嵌套。 4.几个例子 （1）例子： Array里面包含对象(object) [ {“id”:1,”name”:”小猪” ,”age”:22} , {“id”:2,”name”:”小猫”,”age”:23} , …….] Array里面的对象数据是有序的" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/e477ccdc6edfced17155af5e56da59c6/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2016-11-16T13:50:51+08:00" />
<meta property="article:modified_time" content="2016-11-16T13:50:51+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Android网络数据JSON解析使用总结</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2 id="一json基础知识">一．JSON基础知识</h2> 
<h3 id="一什么是json">（一）什么是json</h3> 
<p>       JSON(JavaScript Object Notation) 是一种轻量级的数据交换格式。 易于人阅读和编写。同时也易于机器解析和生成。 它基于JavaScript Programming Language, Standard ECMA262 3rd Edition - December 1999的一个子集。 JSON采用完全独立于语言的文本格式，但 是也使用了类似于C语言家族的习惯（包括C, C++, C#, Java, JavaScript, Perl, Python等）。 这些特性使JSON成为理想的数据交换语言。</p> 
<h3 id="二json建构于两种结构">（二）JSON建构于两种结构</h3> 
<h4 id="1名称值对的集合a-collection-of-namevalue-pairs">1.“名称/值”对的集合（A collection of name/value pairs）。</h4> 
<p>       不同的语言中，它被理解为对象（object），哈希表 （hash table），有键列表（keyed list），或者关联数组 （associative array）等等。 </p> 
<h4 id="2值的有序列表an-ordered-list-of-values">2.值的有序列表（An ordered list of values）。</h4> 
<p>       在大部分语言中，它被理解为数组 （array）。 <br>        这些都是常见的数据结构。事实上大部分现代计算机语言都以某种形式支持它们。这使得一种数据格式在同样基于这些结构的编程语言之间交换成为可能。</p> 
<h3 id="三json形式">（三）JSON形式</h3> 
<h4 id="1对象是一个无序的名称值对集合">1.对象是一个无序的“‘名称/值’对”集合。</h4> 
<p>一个对象以“{”（左括号）开始，“}”（右括 号）结束。每个“名称”后跟一个“:”（冒号）；“‘名称/值’ 对”之间使用“,”（逗号） 分隔。 </p> 
<h4 id="2数组是值value的有序集合">2.数组是值（value）的有序集合。</h4> 
<p>一个数组以“[”（左中括号）开始，“]”（右中括号）结 束。值之间使用“,”（逗号）分隔。 </p> 
<h4 id="3值value可以是双引号括起来的字符串string数值numbertruefalse-null-对象object或者数组array这些结构可以嵌套">3.值（value）可以是双引号括起来的字符串（string）、数值(number)、true、false、 null、 对象（object）或者数组（array）。这些结构可以嵌套。</h4> 
<h4 id="4几个例子">4.几个例子</h4> 
<h5 id="1例子-array里面包含对象object">（1）例子： Array里面包含对象(object)</h5> 
<p>[ {“id”:1,”name”:”小猪” ,”age”:22} , {“id”:2,”name”:”小猫”,”age”:23} , …….] <br> Array里面的对象数据是有序的</p> 
<h5 id="2例子对象object中可以包含array">（2）例子：对象(object)中可以包含Array</h5> 
<p>一个对象包含1个数组，2个子对象 <br> {“root”: <br> [{“id”:”001”,”name”:”小猪”}, <br> {“id”:”002”,”name”:”小猫”}, {“id”:”003”,”name”:”小狗”}] , “total”:3, “success”:true } <br> 其中这里的root对应的值是数组数据，total对应的值是一个int类型数据，success对应的是一个布尔类型数据；其中root对应的值里面还有很多数据。</p> 
<h5 id="3以对象嵌套子对象子对象再嵌套数组">（3）以对象嵌套子对象，子对象再嵌套数组</h5> 
<p>{“calendar”: <br> {“calendarlist”: <br> [{“id”:”001”,”name”:”小猪”}, {“id”:”002”,”name”:”小猫”}] <br> } <br> } <br> 这里的数据最外层只有一个键值对：calendar对应对象value1，value1里面也是只有一个键值对：calendarlist对应数组数据ArrayValue，ArrayValue里面又两个有序对象，这两个有序对象里面都有两个无序的数据。</p> 
<h3 id="四android中json类">（四）Android中JSON类</h3> 
<p>       在Android中包含四个与JSON相关的类和一个Exceptions：分別是 JSONArray、JSONObject、 JSONStringer、JSONTokener、JSONException；下面分別进行介绍：</p> 
<h4 id="1jsonobject">（1）JSONObject:</h4> 
<p>       这是系统中有关JSON定义的基本单元，其包含一对儿(Key/Value)数值。 <br> 它对外部(External：应用toString()方法输出的数值)调用的响应体现为一个标准的字符串（例 如：{“JSON”: “Hello, World”}，最外被大括号包裹，其中的Key和Value被冒号”:”分 隔）。其对于内部(Internal)行为的操作格式略微，例如：初始化一个JSONObject实例，引用 内部的put()方法添加数值：new JSONObject().put(“JSON”, “Hello, World!”)，在Key 和Value之间是以逗号”,”分隔。 <br>        Value的类型包括：Boolean、JSONArray、JSONObject、Number、String或者默认值 JSONObject.NULL object。 <br>        有两个不同的取值方法： get(): 在确定数值存在的条件下使用，否则当无法检索到相关Key时，将会抛出一个Exception 信息。 opt(): 这个方法相对比较灵活，当无法获取所指定数值时，将会返回一个默认数值，并不会抛出异常。所以我们使用opt的方法来取值。</p> 
<h4 id="2jsonarray-它代表一组有序的数值">（2）JSONArray: 它代表一组有序的数值。</h4> 
<p>将其转换为String输出(toString)所表现的形式是用方括号包裹，数值以逗号”,”分隔（例如：[value1,value2,value3]，大家可以亲自利用简短的代码更加直观的了解其格式）。这个类的内部同样具有查询行为，get()和opt()两种方法都可以通过index索 引返回指定的数值，put()方法用来添加或者替换数值。同样这个类的value类型可以包括：Boolean、JSONArray、JSONObject、Number、String 或者默认值JSONObject.NULL object。</p> 
<h4 id="3jsonstringer">（3）JSONStringer:</h4> 
<p>        根据官方的解释，这个类可以帮助快速和便捷的创建JSONtext。其最大的优点在于可以减少 由于格式的错误导致程序异常，引用这个类可以自动严格按照JSON语法规则（syntaxrules） 创建JSONtext。每个JSONStringer实体只能对应创建一个JSONtext。</p> 
<h4 id="4jsontokener">（4）JSONTokener:</h4> 
<p>       这个是系统为JSONObject和JSONArray构造器解析JSON source string的类，它可以从 <br> source string中提取数值信息。</p> 
<h4 id="5jsonexception">（5）JSONException:</h4> 
<p>       是JSON.org类抛出的异常信息。</p> 
<p>       在JSON数据解析中，常用的两个类就是JSONObject和 <br> JSONArray；</p> 
<h2 id="二json解析数据的一个简单示例演示">二．JSON解析数据的一个简单示例演示</h2> 
<h3 id="一比如从网络中获取到下面的一段字符串需要去解析到每一个动物的姓名和它的图片url网址">（一）比如从网络中获取到下面的一段字符串，需要去解析到每一个动物的姓名和它的图片URL网址</h3> 
<pre class="prettyprint"><code class=" hljs bash">S=”{<!-- --><span class="hljs-string">"root"</span>: 
[{<!-- --><span class="hljs-string">"id"</span>:<span class="hljs-string">"001"</span>,<span class="hljs-string">"name"</span>:<span class="hljs-string">"小猪"</span>，“img”:”StringURL1”}, 
{<!-- --><span class="hljs-string">"id"</span>:<span class="hljs-string">"002"</span>,<span class="hljs-string">"name"</span>:<span class="hljs-string">"小猫"</span>，“img”:”StringURL2”},        {<!-- --><span class="hljs-string">"id"</span>:<span class="hljs-string">"003"</span>,<span class="hljs-string">"name"</span>:<span class="hljs-string">"小狗"</span>，“img”:”StringURL3”}] 
 , <span class="hljs-string">"total"</span>:<span class="hljs-number">3</span>, <span class="hljs-string">"success"</span>:<span class="hljs-literal">true</span>  }”</code></pre> 
<h3 id="二解析过程的语句">(二)解析过程的语句</h3> 
<pre class="prettyprint"><code class=" hljs javascript">创建两个数组用来存储数据
<span class="hljs-built_in">String</span>[] names=<span class="hljs-keyword">new</span> <span class="hljs-built_in">String</span>[<span class="hljs-number">3</span>];
<span class="hljs-built_in">String</span>[] imgURLs=<span class="hljs-keyword">new</span> <span class="hljs-built_in">String</span>[<span class="hljs-number">3</span>]; 
<span class="hljs-comment">//数据的获取过程</span>
JSONObject jsonObject = <span class="hljs-keyword">new</span> JSONObject(s)
JSONArray array =jsonObject.optJSONArray(<span class="hljs-string">"root"</span>);<span class="hljs-comment">//获得json数组，数组里面有三个对象</span>
<span class="hljs-keyword">for</span> (int i = <span class="hljs-number">0</span>; i &lt; array.length(); i++) {
JSONObject obj = array.optJSONObject(i);<span class="hljs-comment">//数组数据是根据游标值获取</span>
names[i]=obj.optString(“name”）;<span class="hljs-comment">//获取名字</span>
imgURLs[i]=obj.optString(“img”);<span class="hljs-comment">//获取图片的URL</span>
}</code></pre> 
<p>到这里上面的两个存放数据的数组已经有数据了。 <br> 这里只是简单的示范，实际中的网络数据都是有几百行代码或更多，但是取数据的方式还是一样的。</p> 
<h2 id="三解析网络中复杂的json数据的程序示例">三．解析网络中复杂的json数据的程序示例</h2> 
<p>这里设计一个简易的笑话大全的软件。 <br> 程序运行后显示的界面： <br> <img src="https://images2.imgbox.com/30/60/gUI232Sh_o.png" alt="w1" title=""> <br> 这里的布局设计的是两个按钮，单击“java请求”获取的是页面源码的json数据； <br> <img src="https://images2.imgbox.com/5e/32/IAmVUTNC_o.png" alt="w2" title=""> <br> 点击“Android请求笑话大全”，跳转到另一个页面显示解析后的数据，并且点击前还可以对笑话的数据进行选择，如选择页码或选择查看笑话的图片。。。 <br> <img src="https://images2.imgbox.com/4f/f0/nDD29x2q_o.png" alt="w3" title=""></p> 
<h3 id="一数据请求的准备和分析">（一）数据请求的准备和分析</h3> 
<p>       这里使用的网络中请求的数据，相当于一个完整的app的数据。 <br>        这里推荐一个请求json数据的一个网站：ShowAPI <br> <img src="https://images2.imgbox.com/90/06/9UCiQ55q_o.png" alt="w4" title=""> <br>        里面可以获取很多使用的数据，比如天气预报，快递查询，附近景点，公交车信息查询等等。其实里面提供的都是对应的链接的URL字符串，但是这里都帮我们整理好相关的数据了，我们只需要调用它提供的API就可以实现对应的功能。 <br>        要获得网站的数据要先进行注册，这里注册是非常简单的。 <br>        注册成功后，点击右上角–个人中心，选择–我的应用，至少要确保自己又一个app名称，如果没有就去添加，这里的appid和secret对应的值是我们链接网址必须要用到的。 <br> <img src="https://images2.imgbox.com/4b/1f/coz3zfkh_o.png" alt="w5" title=""></p> 
<p>注册成功后搜索要查找的数据的API，如图所示： <br> <img src="https://images2.imgbox.com/14/37/nhqnLVut_o.png" alt="w6" title=""></p> 
<p>右上角点击订阅，做相关操作后才能显示可调用。</p> 
<p>       点击进去可以查看使用方法和其他的相关介绍，比如可以显示很多的笑话文本/笑话图片/动态图片； <br> <img src="https://images2.imgbox.com/82/0c/v7xLW7zg_o.png" alt="w7" title=""></p> 
<p>       上面的URL并不是完整的URL，还需要添加它规定的参数才能使用，那么就要查看它是怎么规定参数的。。。 <br> <img src="https://images2.imgbox.com/3e/fe/4PnNGpdQ_o.png" alt="ww" title=""> <br>        查看请求的参数要求中可以看到，有些数据是必须要的添加才能在URL中请求到数据的； <br>        比如上面的数据中showapi_appid和showapi_sign是必须要的，这个也是我们注册后才有的数据值。 <br>        其他的数据也可以做简单的了解，比如page代表的是你要请求的是第几页，如果没有输入，默认是1； <br>        根据网站的提示，我们可以得到一个简单的URL字符串地址path=”http://route.showapi.com/341-1?showapi_appid=27155&amp;page=&amp;showapi_sign=5bd3b5774c2346068463b526171ba86e” <br>        这里的属相的值用冒号：对应，每一对值使用&amp;号隔开，还要记得在基础的URL后面加一个？号。 <br> 请求到的数据是一大串的json格式的字符串； <br>        对于这个返回的字符串我们也是要去看一下的，因为我们的json解析是从外到内一层一层去解析数据的。这里最好下载一个json数据格式化的工具，或者在网页中直接使用json格式化工具，可以把一长串的字符串显示为json格式，方便我们去解析它的数据。 <br> 数据解析前，如图所示： <br> <img src="https://images2.imgbox.com/60/8f/wgcWCeLn_o.png" alt="w7" title=""> <br>        数据显示的是连接在一起的，很难区分标签和段落所以使用解析工具就非常重要了。 <br>        数据解析后，如图所示：</p> 
<p><img src="https://images2.imgbox.com/ac/6a/o2Gd1qmI_o.png" alt="w8" title=""> <br> <img src="https://images2.imgbox.com/44/72/Rin7STJT_o.png" alt="w9" title=""> <br> 可以很清楚的看到我们要取的数据的关键字。 <br>        这里提供一个代码解析工具的下载的网址： <br> <a href="http://download.csdn.net/detail/wenzhi20102321/9684426">http://download.csdn.net/detail/wenzhi20102321/9684426</a> <br>        网站提示，数据解析后，返回需要的数据。 <br> <img src="https://images2.imgbox.com/14/16/WdHqEaE8_o.png" alt="w10" title=""></p> 
<p>上面是通过json解析后可以得到的很多数据，但是实际中我们只需要提取一些需要的数据就可以了。</p> 
<h3 id="二程序的实际设计">（二）程序的实际设计</h3> 
<h4 id="1布局文件activitymainxml的设计">1.布局文件activity_main.xml的设计</h4> 
<pre class="prettyprint"><code class=" hljs xml"><span class="hljs-pi">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">LinearLayout</span> <span class="hljs-attribute">xmlns:android</span>=<span class="hljs-value">"http://schemas.android.com/apk/res/android"</span>
    <span class="hljs-attribute">android:id</span>=<span class="hljs-value">"@+id/activity_main"</span>
    <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"match_parent"</span>
    <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"match_parent"</span>
    <span class="hljs-attribute">android:orientation</span>=<span class="hljs-value">"vertical"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">Button
</span>        <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"match_parent"</span>
        <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"wrap_content"</span>
        <span class="hljs-attribute">android:onClick</span>=<span class="hljs-value">"conn1"</span>
        <span class="hljs-attribute">android:text</span>=<span class="hljs-value">"java请求"</span> /&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">LinearLayout
</span>        <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"match_parent"</span>
        <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"wrap_content"</span>
        <span class="hljs-attribute">android:orientation</span>=<span class="hljs-value">"horizontal"</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">EditText
</span>            <span class="hljs-attribute">android:id</span>=<span class="hljs-value">"@+id/main_et_pager"</span>
            <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"match_parent"</span>
            <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"wrap_content"</span>
            <span class="hljs-attribute">android:layout_marginLeft</span>=<span class="hljs-value">"5dp"</span>
            <span class="hljs-attribute">android:layout_weight</span>=<span class="hljs-value">"1"</span>
            <span class="hljs-attribute">android:background</span>=<span class="hljs-value">"@null"</span>
            <span class="hljs-attribute">android:hint</span>=<span class="hljs-value">"输入页数"</span>
            <span class="hljs-attribute">android:singleLine</span>=<span class="hljs-value">"true"</span> /&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">CheckBox
</span>            <span class="hljs-attribute">android:id</span>=<span class="hljs-value">"@+id/main_cb_isImage"</span>
            <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"wrap_content"</span>
            <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"wrap_content"</span>
            <span class="hljs-attribute">android:text</span>=<span class="hljs-value">"选择图片"</span> /&gt;</span>

    <span class="hljs-tag">&lt;/<span class="hljs-title">LinearLayout</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">Button
</span>        <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"match_parent"</span>
        <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"wrap_content"</span>
        <span class="hljs-attribute">android:onClick</span>=<span class="hljs-value">"conn2"</span>
        <span class="hljs-attribute">android:text</span>=<span class="hljs-value">"Android请求笑话大全"</span> /&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">ScrollView
</span>        <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"match_parent"</span>
        <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"match_parent"</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">TextView
</span>            <span class="hljs-attribute">android:id</span>=<span class="hljs-value">"@+id/main_tv"</span>
            <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"match_parent"</span>
            <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"match_parent"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">ScrollView</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-title">LinearLayout</span>&gt;</span></code></pre> 
<p>上面使用一个ScrollView来显示获取到的json数据。</p> 
<h4 id="2布局文件activityjokexml文件的设计">2.布局文件activity_joke.xml文件的设计</h4> 
<pre class="prettyprint"><code class=" hljs xml"><span class="hljs-pi">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">LinearLayout</span> <span class="hljs-attribute">xmlns:android</span>=<span class="hljs-value">"http://schemas.android.com/apk/res/android"</span>
    <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"match_parent"</span>
    <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"match_parent"</span>
    <span class="hljs-attribute">android:orientation</span>=<span class="hljs-value">"vertical"</span>
    <span class="hljs-attribute">android:padding</span>=<span class="hljs-value">"10dp"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">TextView
</span>        <span class="hljs-attribute">android:id</span>=<span class="hljs-value">"@+id/joke_tv_title"</span>
        <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"wrap_content"</span>
        <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"wrap_content"</span>
        <span class="hljs-attribute">android:layout_gravity</span>=<span class="hljs-value">"center"</span>
        <span class="hljs-attribute">android:text</span>=<span class="hljs-value">"title"</span>
        <span class="hljs-attribute">android:textColor</span>=<span class="hljs-value">"@android:color/black"</span>
        <span class="hljs-attribute">android:textSize</span>=<span class="hljs-value">"18sp"</span> /&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">TextView
</span>        <span class="hljs-attribute">android:id</span>=<span class="hljs-value">"@+id/joke_tv_content"</span>
        <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"match_parent"</span>
        <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"wrap_content"</span>
        <span class="hljs-attribute">android:layout_margin</span>=<span class="hljs-value">"5dp"</span>
        <span class="hljs-attribute">android:text</span>=<span class="hljs-value">"content"</span>
        <span class="hljs-attribute">android:textColor</span>=<span class="hljs-value">"@android:color/black"</span>
        <span class="hljs-attribute">android:textSize</span>=<span class="hljs-value">"16sp"</span> /&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">ImageView
</span>        <span class="hljs-attribute">android:id</span>=<span class="hljs-value">"@+id/joke_iv_content"</span>
        <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"match_parent"</span>
        <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"wrap_content"</span>
        <span class="hljs-attribute">android:layout_margin</span>=<span class="hljs-value">"5dp"</span>
        <span class="hljs-attribute">android:adjustViewBounds</span>=<span class="hljs-value">"true"</span>
        <span class="hljs-attribute">android:scaleType</span>=<span class="hljs-value">"fitXY"</span> /&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">TextView
</span>        <span class="hljs-attribute">android:id</span>=<span class="hljs-value">"@+id/joke_tv_time"</span>
        <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"match_parent"</span>
        <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"wrap_content"</span>
        <span class="hljs-attribute">android:layout_margin</span>=<span class="hljs-value">"5dp"</span>
        <span class="hljs-attribute">android:gravity</span>=<span class="hljs-value">"right"</span>
        <span class="hljs-attribute">android:text</span>=<span class="hljs-value">"时间"</span>
        <span class="hljs-attribute">android:textSize</span>=<span class="hljs-value">"14sp"</span> /&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-title">LinearLayout</span>&gt;</span></code></pre> 
<p>上面的布局是每一个笑话内容显示的布局设计。 </p> 
<h4 id="3创建一个json解析和数据收集的类">3.创建一个json解析和数据收集的类</h4> 
<pre class="prettyprint"><code class=" hljs java"><span class="hljs-keyword">package</span> com.lwz.conn;

<span class="hljs-keyword">import</span> org.json.JSONArray;
<span class="hljs-keyword">import</span> org.json.JSONException;
<span class="hljs-keyword">import</span> org.json.JSONObject;

<span class="hljs-keyword">import</span> java.io.Serializable;
<span class="hljs-keyword">import</span> java.util.ArrayList;

<span class="hljs-javadoc">/**
 * 这是一个数据解析的工具类，
 * &lt;p&gt;
 * 这里是从源码中取出属性值
 * 这里是使用从外到内一层一层的去获取资源数据，最里面一层的数据才是我们要显示在页面上的数据
 * 这里的处理的方式是比较麻烦的一种，其中它处理的方式可以有好几种
 * 这里的数据层层嵌套，就像xml资源的子标签一样
 */</span>

<span class="hljs-comment">/*下面是提供API网站给我们的数据的提示，xml文件中下面的某些变量，我们可以选择性的去使用，
但是这些变量的名字是固定的，更改了就获取不到了
 allNum String  345 所有记录数
    allPages    String  45  所有页数。每页20条。
    contentlist JokeItem[]      笑话条目内容
    - title String  吃了一百年的玉米    笑话标题
    - text  String      笑话正文
    - ct    String  2015-07-10 05:54:00.000 生成时间
    currentPage String  1   当前第几页
    maxResult   String  20  每页最多显示几条*/</span>

<span class="hljs-comment">//因为要Intent来实现数据的传递，所以要实现序列化</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JokeBean</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Serializable</span> {<!-- --></span>
    <span class="hljs-comment">//最外层的属性值</span>
    <span class="hljs-keyword">int</span> showapi_res_code;
    String showapi_res_error;
    Body showapi_res_body;<span class="hljs-comment">//这个才是有用的信息数据，上面的实现其实也是可以不用去定义的</span>

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span>() {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"JokeBean{"</span> +
                <span class="hljs-string">"showapi_res_body="</span> + showapi_res_body +
                <span class="hljs-string">", showapi_res_code="</span> + showapi_res_code +
                <span class="hljs-string">", showapi_res_error='"</span> + showapi_res_error + <span class="hljs-string">'\''</span> +
                <span class="hljs-string">'}'</span>;
    }

    class Body implements Serializable {
        <span class="hljs-keyword">int</span> allNum;
        <span class="hljs-keyword">int</span> allPages;
        <span class="hljs-keyword">int</span> currentPage;<span class="hljs-comment">//当前第几页</span>
        <span class="hljs-keyword">int</span> maxResult;
        <span class="hljs-keyword">int</span> ret_code;
        ArrayList&lt;Content&gt; contentlist;

        <span class="hljs-annotation">@Override</span>
        <span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span>() {
            <span class="hljs-keyword">return</span> <span class="hljs-string">"Body{"</span> +
                    <span class="hljs-string">"allNum="</span> + allNum +
                    <span class="hljs-string">", allPages="</span> + allPages +
                    <span class="hljs-string">", currentPage="</span> + currentPage +
                    <span class="hljs-string">", maxResult="</span> + maxResult +
                    <span class="hljs-string">", ret_code="</span> + ret_code +
                    <span class="hljs-string">", contentlist="</span> + contentlist +
                    <span class="hljs-string">'}'</span>;
        }

        class Content implements Serializable {
            String id;
            String ct;<span class="hljs-comment">//生成时间</span>
            String text;<span class="hljs-comment">//笑话正文</span>
            String title;<span class="hljs-comment">//笑话标题</span>
            <span class="hljs-keyword">int</span> type;<span class="hljs-comment">//文本笑话，图片笑话，动态图笑话</span>
            String img;<span class="hljs-comment">//笑话的图片连接地址URL</span>

            <span class="hljs-comment">//重写toString方法，查看数据</span>
            <span class="hljs-annotation">@Override</span>
            <span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span>() {
                <span class="hljs-keyword">return</span> <span class="hljs-string">"Content{"</span> +
                        <span class="hljs-string">"ct='"</span> + ct + <span class="hljs-string">'\''</span> +
                        <span class="hljs-string">", id='"</span> + id + <span class="hljs-string">'\''</span> +
                        <span class="hljs-string">", text='"</span> + text + <span class="hljs-string">'\''</span> +
                        <span class="hljs-string">", title='"</span> + title + <span class="hljs-string">'\''</span> +
                        <span class="hljs-string">", type="</span> + type +
                        <span class="hljs-string">", img='"</span> + img + <span class="hljs-string">'\''</span> +
                        <span class="hljs-string">'}'</span>;
            }
        }
    }

    <span class="hljs-javadoc">/**
     * 创建一个静态的转换方法
     * 将字符串使用json解析的方式，转换成对象
     * 用于把资源代码的字符串中某些值赋值给某些需要的变量
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> JokeBean <span class="hljs-title">getBeanValue</span>(String json) {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">//1.将最外层的字符串，转换为json对象</span>
            JSONObject jsonObject = <span class="hljs-keyword">new</span> JSONObject(json);
            <span class="hljs-comment">//2.创建返回的对象</span>
            JokeBean jokeBean = <span class="hljs-keyword">new</span> JokeBean();
            <span class="hljs-comment">//3.取外层的数据，两种方法opt和get，其中opt更好，get在数据不匹配时会报错</span>
            jokeBean.showapi_res_code = jsonObject.optInt(<span class="hljs-string">"showapi_res_code"</span>);
            jokeBean.showapi_res_error = jsonObject.optString(<span class="hljs-string">"showapi_res_error"</span>);

            <span class="hljs-comment">//4.取第二层数据，是一个对象</span>
            JSONObject bodyObject = jsonObject.optJSONObject(<span class="hljs-string">"showapi_res_body"</span>);
            <span class="hljs-comment">//5.通过这个对象的值，再去取数据</span>
            <span class="hljs-comment">//创建内部对象,把获取到的数据赋值给这个类的对象</span>
            Body body = jokeBean.<span class="hljs-keyword">new</span> Body();
            body.allNum = bodyObject.optInt(<span class="hljs-string">"allNum"</span>);
            body.allPages = bodyObject.optInt(<span class="hljs-string">"allPages"</span>);
            body.currentPage = bodyObject.optInt(<span class="hljs-string">"currentPage"</span>);
            body.maxResult = bodyObject.optInt(<span class="hljs-string">"maxResult"</span>);
            body.ret_code = bodyObject.optInt(<span class="hljs-string">"ret_code"</span>);
            <span class="hljs-comment">//Log.e("TAG", "jokeBean------------&gt;" + jokeBean.toString());</span>
            <span class="hljs-comment">// Log.e("TAG", "body------------&gt;" + body.toString());</span>
            <span class="hljs-comment">//这里的contentlist的数据是数组类型的！</span>
            JSONArray array = bodyObject.optJSONArray(<span class="hljs-string">"contentlist"</span>);
            <span class="hljs-comment">//创建一个集合用来存放数组</span>
            body.contentlist = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();
            <span class="hljs-comment">//通过数据遍历循环去取所有的对象</span>
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; array.length(); i++) {
                Body.Content content = body.<span class="hljs-keyword">new</span> Content();
                <span class="hljs-comment">//再次使用json解析数据</span>
                <span class="hljs-comment">//集合通过optXXX(index)的方法去取值</span>
                JSONObject obj = array.optJSONObject(i);
                content.ct = obj.optString(<span class="hljs-string">"ct"</span>);<span class="hljs-comment">//笑话的创建时间</span>
                content.id = obj.optString(<span class="hljs-string">"id"</span>);<span class="hljs-comment">//笑话的id编号</span>
                content.title = obj.optString(<span class="hljs-string">"title"</span>);<span class="hljs-comment">//笑话的标题</span>
                content.type = obj.optInt(<span class="hljs-string">"type"</span>);<span class="hljs-comment">//笑话的类别，1代表文本，2代表图像</span>

                <span class="hljs-comment">//对类别的判断</span>
                <span class="hljs-keyword">if</span> (content.type == <span class="hljs-number">2</span>) {
                    content.img = obj.optString(<span class="hljs-string">"img"</span>);
                } <span class="hljs-keyword">else</span> {
                    content.text = obj.optString(<span class="hljs-string">"text"</span>);
                }
                body.contentlist.add(content);
            }
            <span class="hljs-comment">//Log.e("TAG", "body.c------------&gt;" + body.contentlist.toString());</span>
            jokeBean.showapi_res_body = body;
            <span class="hljs-comment">//返回一个JokeBean对象，里面包含所有的数据</span>
            <span class="hljs-keyword">return</span> jokeBean;
        } <span class="hljs-keyword">catch</span> (JSONException e) {
            e.printStackTrace();
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
    }

}</code></pre> 
<h4 id="4创建一个异步任务类用来下载json数据">4.创建一个异步任务类，用来下载json数据</h4> 
<pre class="prettyprint"><code class=" hljs scala"><span class="hljs-keyword">package</span> com.lwz.conn.utils;

<span class="hljs-keyword">import</span> android.content.Context;
<span class="hljs-keyword">import</span> android.content.Intent;
<span class="hljs-keyword">import</span> android.os.AsyncTask;
<span class="hljs-keyword">import</span> android.util.Log;

<span class="hljs-keyword">import</span> com.lwz.conn.JokeBean;
<span class="hljs-keyword">import</span> com.lwz.conn.ShowActivity;

<span class="hljs-keyword">import</span> java.io.ByteArrayOutputStream;
<span class="hljs-keyword">import</span> java.io.InputStream;
<span class="hljs-keyword">import</span> java.net.HttpURLConnection;
<span class="hljs-keyword">import</span> java.net.URL;

<span class="hljs-javadoc">/**
 * 异步任务的创建
 * 这里的任务是下载网络的资源文件
 */</span>

public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyAsyncTask</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AsyncTask</span>&lt;<span class="hljs-title">String</span>, <span class="hljs-title">Void</span>, <span class="hljs-title">String</span>&gt; {<!-- --></span>
    Context context;

    public MyAsyncTask(Context context) {
        <span class="hljs-keyword">this</span>.context = context;
    }

    <span class="hljs-comment">//在子线程中做资源的下载</span>
    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">protected</span> String doInBackground(String... params) {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">//从params中获取传过来的URL</span>
            URL url = <span class="hljs-keyword">new</span> URL(params[<span class="hljs-number">0</span>]);
            Log.e(<span class="hljs-string">"TAG"</span>, params[<span class="hljs-number">0</span>]);
            <span class="hljs-comment">//使用URLconnection的子类HttpURLconnection来请求连接更好</span>
            HttpURLConnection conn = (HttpURLConnection) url.openConnection();
            conn.setDoOutput(<span class="hljs-keyword">true</span>);<span class="hljs-comment">//设置要读取文件</span>
            conn.setConnectTimeout(<span class="hljs-number">10000</span>);<span class="hljs-comment">//设置连接的最长时间</span>
            InputStream is = conn.getInputStream();<span class="hljs-comment">//获取连接的输入流</span>
            ByteArrayOutputStream baos = <span class="hljs-keyword">new</span> ByteArrayOutputStream(); <span class="hljs-comment">//创建一个高速的输出流来读取输入流</span>
            <span class="hljs-comment">//对数据的读取（边读边取）</span>
            int len = <span class="hljs-number">0</span>;
            byte[] buf = <span class="hljs-keyword">new</span> byte[<span class="hljs-number">1024</span>];
            <span class="hljs-keyword">while</span> ((len = is.read(buf)) != -<span class="hljs-number">1</span>) {
                baos.write(buf, <span class="hljs-number">0</span>, len);
            }
            <span class="hljs-comment">//获得的输出流变成String类型的字符串，用于最后的返回</span>
            String result = <span class="hljs-keyword">new</span> String(baos.toByteArray(), <span class="hljs-string">"utf-8"</span>);<span class="hljs-comment">//设置编码格式</span>
            <span class="hljs-comment">//返回的是获取的一大串文本资源源码</span>
            Log.e(<span class="hljs-string">"TAG"</span>,<span class="hljs-string">"--------------&gt;"</span>+ result);
            <span class="hljs-keyword">return</span> result;
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
    }


    <span class="hljs-comment">//任务完成后页面的跳转，把相关数据带到要跳转的页面</span>
    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">protected</span> void onPostExecute(String s) {
        <span class="hljs-keyword">super</span>.onPostExecute(s);
        <span class="hljs-comment">//这里接收的s，就是从网络中获取到的一大串字符串的文件源码</span>
        <span class="hljs-comment">//这里要使用json解析，从源码中来获取我们需要的数据</span>
        Log.e(<span class="hljs-string">"TAG"</span>, s);
        JokeBean jokeBean = JokeBean.getBeanValue(s);
        <span class="hljs-comment">//页面的跳转</span>
        Intent intent = <span class="hljs-keyword">new</span> Intent(context, ShowActivity.<span class="hljs-keyword">class</span>);
        intent.putExtra(<span class="hljs-string">"jokeBean"</span>, jokeBean);  <span class="hljs-comment">//数据传递</span>
        context.startActivity(intent);<span class="hljs-comment">//开始跳转</span>

    }
}</code></pre> 
<h4 id="5创建一个绑定视图和url的工具类">5.创建一个绑定视图和URL的工具类</h4> 
<pre class="prettyprint"><code class=" hljs scala"><span class="hljs-keyword">package</span> com.lwz.conn.utils;

<span class="hljs-keyword">import</span> android.content.Context;
<span class="hljs-keyword">import</span> android.content.Intent;
<span class="hljs-keyword">import</span> android.os.AsyncTask;
<span class="hljs-keyword">import</span> android.util.Log;

<span class="hljs-keyword">import</span> com.lwz.conn.JokeBean;
<span class="hljs-keyword">import</span> com.lwz.conn.ShowActivity;

<span class="hljs-keyword">import</span> java.io.ByteArrayOutputStream;
<span class="hljs-keyword">import</span> java.io.InputStream;
<span class="hljs-keyword">import</span> java.net.HttpURLConnection;
<span class="hljs-keyword">import</span> java.net.URL;

<span class="hljs-javadoc">/**
 * 异步任务的创建
 * 这里的任务是下载网络的资源文件
 */</span>

public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyAsyncTask</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AsyncTask</span>&lt;<span class="hljs-title">String</span>, <span class="hljs-title">Void</span>, <span class="hljs-title">String</span>&gt; {<!-- --></span>
    Context context;

    public MyAsyncTask(Context context) {
        <span class="hljs-keyword">this</span>.context = context;
    }

    <span class="hljs-comment">//在子线程中做资源的下载</span>
    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">protected</span> String doInBackground(String... params) {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">//从params中获取传过来的URL</span>
            URL url = <span class="hljs-keyword">new</span> URL(params[<span class="hljs-number">0</span>]);
            Log.e(<span class="hljs-string">"TAG"</span>, params[<span class="hljs-number">0</span>]);
            <span class="hljs-comment">//使用URLconnection的子类HttpURLconnection来请求连接更好</span>
            HttpURLConnection conn = (HttpURLConnection) url.openConnection();
            conn.setDoOutput(<span class="hljs-keyword">true</span>);<span class="hljs-comment">//设置要读取文件</span>
            conn.setConnectTimeout(<span class="hljs-number">10000</span>);<span class="hljs-comment">//设置连接的最长时间</span>
            InputStream is = conn.getInputStream();<span class="hljs-comment">//获取连接的输入流</span>
            ByteArrayOutputStream baos = <span class="hljs-keyword">new</span> ByteArrayOutputStream(); <span class="hljs-comment">//创建一个高速的输出流来读取输入流</span>
            <span class="hljs-comment">//对数据的读取（边读边取）</span>
            int len = <span class="hljs-number">0</span>;
            byte[] buf = <span class="hljs-keyword">new</span> byte[<span class="hljs-number">1024</span>];
            <span class="hljs-keyword">while</span> ((len = is.read(buf)) != -<span class="hljs-number">1</span>) {
                baos.write(buf, <span class="hljs-number">0</span>, len);
            }
            <span class="hljs-comment">//获得的输出流变成String类型的字符串，用于最后的返回</span>
            String result = <span class="hljs-keyword">new</span> String(baos.toByteArray(), <span class="hljs-string">"utf-8"</span>);<span class="hljs-comment">//设置编码格式</span>
            <span class="hljs-comment">//返回的是获取的一大串文本资源源码</span>
            Log.e(<span class="hljs-string">"TAG"</span>,<span class="hljs-string">"--------------&gt;"</span>+ result);
            <span class="hljs-keyword">return</span> result;
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
    }


    <span class="hljs-comment">//任务完成后页面的跳转，把相关数据带到要跳转的页面</span>
    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">protected</span> void onPostExecute(String s) {
        <span class="hljs-keyword">super</span>.onPostExecute(s);
        <span class="hljs-comment">//这里接收的s，就是从网络中获取到的一大串字符串的文件源码</span>
        <span class="hljs-comment">//这里要使用json解析，从源码中来获取我们需要的数据</span>
        Log.e(<span class="hljs-string">"TAG"</span>, s);
        JokeBean jokeBean = JokeBean.getBeanValue(s);
        <span class="hljs-comment">//页面的跳转</span>
        Intent intent = <span class="hljs-keyword">new</span> Intent(context, ShowActivity.<span class="hljs-keyword">class</span>);
        intent.putExtra(<span class="hljs-string">"jokeBean"</span>, jokeBean);  <span class="hljs-comment">//数据传递</span>
        context.startActivity(intent);<span class="hljs-comment">//开始跳转</span>

    }
}</code></pre> 
<h4 id="6创建一个baseadapter的工具类">6.创建一个BaseAdapter的工具类</h4> 
<pre class="prettyprint"><code class=" hljs scala"><span class="hljs-keyword">package</span> com.lwz.conn.utils;

<span class="hljs-keyword">import</span> android.content.Context;
<span class="hljs-keyword">import</span> android.content.Intent;
<span class="hljs-keyword">import</span> android.os.AsyncTask;
<span class="hljs-keyword">import</span> android.util.Log;

<span class="hljs-keyword">import</span> com.lwz.conn.JokeBean;
<span class="hljs-keyword">import</span> com.lwz.conn.ShowActivity;

<span class="hljs-keyword">import</span> java.io.ByteArrayOutputStream;
<span class="hljs-keyword">import</span> java.io.InputStream;
<span class="hljs-keyword">import</span> java.net.HttpURLConnection;
<span class="hljs-keyword">import</span> java.net.URL;

<span class="hljs-javadoc">/**
 * 异步任务的创建
 * 这里的任务是下载网络的资源文件
 */</span>

public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyAsyncTask</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AsyncTask</span>&lt;<span class="hljs-title">String</span>, <span class="hljs-title">Void</span>, <span class="hljs-title">String</span>&gt; {<!-- --></span>
    Context context;

    public MyAsyncTask(Context context) {
        <span class="hljs-keyword">this</span>.context = context;
    }

    <span class="hljs-comment">//在子线程中做资源的下载</span>
    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">protected</span> String doInBackground(String... params) {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">//从params中获取传过来的URL</span>
            URL url = <span class="hljs-keyword">new</span> URL(params[<span class="hljs-number">0</span>]);
            Log.e(<span class="hljs-string">"TAG"</span>, params[<span class="hljs-number">0</span>]);
            <span class="hljs-comment">//使用URLconnection的子类HttpURLconnection来请求连接更好</span>
            HttpURLConnection conn = (HttpURLConnection) url.openConnection();
            conn.setDoOutput(<span class="hljs-keyword">true</span>);<span class="hljs-comment">//设置要读取文件</span>
            conn.setConnectTimeout(<span class="hljs-number">10000</span>);<span class="hljs-comment">//设置连接的最长时间</span>
            InputStream is = conn.getInputStream();<span class="hljs-comment">//获取连接的输入流</span>
            ByteArrayOutputStream baos = <span class="hljs-keyword">new</span> ByteArrayOutputStream(); <span class="hljs-comment">//创建一个高速的输出流来读取输入流</span>
            <span class="hljs-comment">//对数据的读取（边读边取）</span>
            int len = <span class="hljs-number">0</span>;
            byte[] buf = <span class="hljs-keyword">new</span> byte[<span class="hljs-number">1024</span>];
            <span class="hljs-keyword">while</span> ((len = is.read(buf)) != -<span class="hljs-number">1</span>) {
                baos.write(buf, <span class="hljs-number">0</span>, len);
            }
            <span class="hljs-comment">//获得的输出流变成String类型的字符串，用于最后的返回</span>
            String result = <span class="hljs-keyword">new</span> String(baos.toByteArray(), <span class="hljs-string">"utf-8"</span>);<span class="hljs-comment">//设置编码格式</span>
            <span class="hljs-comment">//返回的是获取的一大串文本资源源码</span>
            Log.e(<span class="hljs-string">"TAG"</span>,<span class="hljs-string">"--------------&gt;"</span>+ result);
            <span class="hljs-keyword">return</span> result;
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
    }


    <span class="hljs-comment">//任务完成后页面的跳转，把相关数据带到要跳转的页面</span>
    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">protected</span> void onPostExecute(String s) {
        <span class="hljs-keyword">super</span>.onPostExecute(s);
        <span class="hljs-comment">//这里接收的s，就是从网络中获取到的一大串字符串的文件源码</span>
        <span class="hljs-comment">//这里要使用json解析，从源码中来获取我们需要的数据</span>
        Log.e(<span class="hljs-string">"TAG"</span>, s);
        JokeBean jokeBean = JokeBean.getBeanValue(s);
        <span class="hljs-comment">//页面的跳转</span>
        Intent intent = <span class="hljs-keyword">new</span> Intent(context, ShowActivity.<span class="hljs-keyword">class</span>);
        intent.putExtra(<span class="hljs-string">"jokeBean"</span>, jokeBean);  <span class="hljs-comment">//数据传递</span>
        context.startActivity(intent);<span class="hljs-comment">//开始跳转</span>

    }
}</code></pre> 
<h4 id="7设计mainactivityjava文件">7.设计MainActivity.java文件</h4> 
<pre class="prettyprint"><code class=" hljs java"><span class="hljs-keyword">package</span> com.lwz.conn;

<span class="hljs-keyword">import</span> android.os.Bundle;
<span class="hljs-keyword">import</span> android.support.v7.app.AppCompatActivity;
<span class="hljs-keyword">import</span> android.text.TextUtils;
<span class="hljs-keyword">import</span> android.view.View;
<span class="hljs-keyword">import</span> android.widget.CheckBox;
<span class="hljs-keyword">import</span> android.widget.EditText;
<span class="hljs-keyword">import</span> android.widget.TextView;
<span class="hljs-keyword">import</span> android.widget.Toast;

<span class="hljs-keyword">import</span> com.lwz.conn.utils.MyAsyncTask;

<span class="hljs-keyword">import</span> java.io.InputStream;
<span class="hljs-keyword">import</span> java.net.URL;
<span class="hljs-keyword">import</span> java.net.URLConnection;

<span class="hljs-javadoc">/***
 * Android网络请求示例
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AppCompatActivity</span> {<!-- --></span>
    <span class="hljs-comment">//定义布局内的控件</span>
    TextView textView;
    CheckBox checkBox;
    EditText editText;

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onCreate</span>(Bundle savedInstanceState) {
        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        <span class="hljs-comment">//实例化控件</span>
        textView = (TextView) findViewById(R.id.main_tv);
        checkBox = (CheckBox) findViewById(R.id.main_cb_isImage);
        editText = (EditText) findViewById(R.id.main_et_pager);

    }

    <span class="hljs-comment">//第一个按钮的回调方法</span>
    <span class="hljs-comment">//这里请求的数页面数据的源码资源</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">conn1</span>(View v) {
        <span class="hljs-comment">//所有的网络资源请求都是子线程中进行的</span>
        <span class="hljs-keyword">new</span> Thread(<span class="hljs-keyword">new</span> Runnable() {
            <span class="hljs-annotation">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span>() {
                <span class="hljs-comment">//资源下载的实际代码</span>
                <span class="hljs-keyword">try</span> {
                    <span class="hljs-comment">//设置URL</span>
                    URL url = <span class="hljs-keyword">new</span> URL(<span class="hljs-string">"http://route.showapi.com/341-1?showapi_appid=27155&amp;time=&amp;page=&amp;maxResult=&amp;showapi_sign=5bd3b5774c2346068463b526171ba86e"</span>);
                    <span class="hljs-comment">// URL url = new URL("https://www.baidu.com");</span>
                    <span class="hljs-comment">//打开连接使用openConnection方法</span>
                    URLConnection conn = url.openConnection();
                    <span class="hljs-comment">//必须要对连接对象做相关的设置</span>
                    conn.setConnectTimeout(<span class="hljs-number">10000</span>);<span class="hljs-comment">//设置连接的最长时间</span>
                    conn.setDoOutput(<span class="hljs-keyword">true</span>);<span class="hljs-comment">//用于设置是否从连接中读取数据，如果参数值为true时，表示读取数据，否则不读取数据</span>
                    <span class="hljs-comment">//这里写数据使用setDoInput(boolean newValue)，我也是感觉比较奇怪的地方！</span>
                    <span class="hljs-comment">//获取输入流</span>
                    InputStream is = conn.getInputStream();
                    <span class="hljs-comment">//对流里面的数据进行读取</span>
                    <span class="hljs-keyword">int</span> len = <span class="hljs-number">0</span>;
                    <span class="hljs-keyword">byte</span>[] buf = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[<span class="hljs-number">1024</span>];
                    <span class="hljs-keyword">final</span> StringBuilder sb = <span class="hljs-keyword">new</span> StringBuilder();
                    <span class="hljs-keyword">while</span> ((len = is.read(buf)) != -<span class="hljs-number">1</span>) {
                        sb.append(<span class="hljs-keyword">new</span> String(buf, <span class="hljs-number">0</span>, len));
                    }
                    is.close();<span class="hljs-comment">//关闭流</span>

                    <span class="hljs-comment">//把获取的字符串数据显示在UI文本中，但是要在主线程中进行</span>
                    runOnUiThread(<span class="hljs-keyword">new</span> Runnable() {
                        <span class="hljs-annotation">@Override</span>
                        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span>() {
                            textView.setText(sb.toString());
                        }
                    });
                } <span class="hljs-keyword">catch</span> (Exception e) {
                    e.printStackTrace();
                }

            }
        }).start();

    }

    <span class="hljs-comment">//连接并处理网络文件，用自定义的布局显示出来</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">conn2</span>(View view) {
        <span class="hljs-comment">//get请求使用？来拼接参数，多个参数使用&amp;符号</span>
        <span class="hljs-comment">//判断是显示图片还是显示文本信息</span>
        <span class="hljs-keyword">boolean</span> isImage = checkBox.isChecked();

        <span class="hljs-comment">//确定URL的链接地址</span>
        <span class="hljs-comment">// 这里的showapi_appid和showapi_sign都要自己上网注册使用自己的账号的应用信息。</span>
        String baseURL = <span class="hljs-string">""</span>;
        <span class="hljs-keyword">if</span> (isImage) {
            baseURL = <span class="hljs-string">"http://route.showapi.com/341-2?showapi_appid=27155&amp;showapi_sign=5bd3b5774c2346068463b526171ba86e&amp;page="</span>;
        } <span class="hljs-keyword">else</span> {
            baseURL = <span class="hljs-string">"http://route.showapi.com/341-1?showapi_appid=27155&amp;showapi_sign=5bd3b5774c2346068463b526171ba86e&amp;page="</span>;
        }
        <span class="hljs-keyword">int</span> pageNum = <span class="hljs-number">1</span>;<span class="hljs-comment">//定义more的页码数</span>
        String pageString = editText.getText().toString(); <span class="hljs-comment">//获取用户输入页数</span>
        <span class="hljs-keyword">try</span> {
            pageNum = Integer.parseInt(TextUtils.isEmpty(pageString) ? <span class="hljs-string">"1"</span> : pageString);
            <span class="hljs-keyword">if</span> (pageNum &lt;= <span class="hljs-number">1</span>) {
                pageNum = <span class="hljs-number">1</span>;
            }
        } <span class="hljs-keyword">catch</span> (Exception e) {
            Toast.makeText(<span class="hljs-keyword">this</span>, <span class="hljs-string">"你输入的页码数有误！"</span>, Toast.LENGTH_SHORT).show();
        }
        baseURL += pageNum;
        <span class="hljs-comment">//使用异步任务来加载数据,在异步任务里面，任务完成后做页面跳转</span>
        MyAsyncTask task = <span class="hljs-keyword">new</span> MyAsyncTask(MainActivity.<span class="hljs-keyword">this</span>);
        task.execute(baseURL);
    }


}</code></pre> 
<h4 id="8设计另一个显示笑话的显示类">8.设计另一个显示笑话的显示类</h4> 
<pre class="prettyprint"><code class=" hljs java"><span class="hljs-keyword">package</span> com.lwz.conn;

<span class="hljs-keyword">import</span> android.app.Activity;
<span class="hljs-keyword">import</span> android.os.Bundle;
<span class="hljs-keyword">import</span> android.view.View;
<span class="hljs-keyword">import</span> android.view.ViewGroup;
<span class="hljs-keyword">import</span> android.widget.BaseAdapter;
<span class="hljs-keyword">import</span> android.widget.ImageView;
<span class="hljs-keyword">import</span> android.widget.ListView;
<span class="hljs-keyword">import</span> android.widget.TextView;

<span class="hljs-keyword">import</span> com.lwz.conn.utils.ImagsUtils;

<span class="hljs-javadoc">/**
 * 显示网络的文字或图片的页面
 */</span>

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ShowActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Activity</span> {<!-- --></span>

    JokeBean jokeBean;<span class="hljs-comment">//定义一个JokeBean对象</span>
    ListView listView;<span class="hljs-comment">//定义一个ListView显示页面数据</span>

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onCreate</span>(Bundle savedInstanceState) {
        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState);
        listView = <span class="hljs-keyword">new</span> ListView(<span class="hljs-keyword">this</span>);
        setContentView(listView);
        <span class="hljs-comment">//获取传递过来的数据</span>
        jokeBean = (JokeBean) getIntent().getSerializableExtra(<span class="hljs-string">"jokeBean"</span>);
        <span class="hljs-comment">//使用java代码创建一个ListView</span>
        listView.setAdapter(adapter);

    }

    BaseAdapter adapter = <span class="hljs-keyword">new</span> BaseAdapter() {
        <span class="hljs-annotation">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getCount</span>() {
            <span class="hljs-keyword">return</span> jokeBean.showapi_res_body.contentlist.size();
        }

        <span class="hljs-annotation">@Override</span>
        <span class="hljs-keyword">public</span> Object <span class="hljs-title">getItem</span>(<span class="hljs-keyword">int</span> position) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
        }

        <span class="hljs-annotation">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">long</span> <span class="hljs-title">getItemId</span>(<span class="hljs-keyword">int</span> position) {
            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
        }

        <span class="hljs-annotation">@Override</span>
        <span class="hljs-keyword">public</span> View <span class="hljs-title">getView</span>(<span class="hljs-keyword">int</span> position, View convertView, ViewGroup parent) {
            ViewHolder holder;
            <span class="hljs-keyword">if</span> (convertView == <span class="hljs-keyword">null</span>) {
                convertView = View.inflate(getBaseContext(), R.layout.activity_joke, <span class="hljs-keyword">null</span>);
                holder = <span class="hljs-keyword">new</span> ViewHolder(convertView);
                convertView.setTag(holder);
            } <span class="hljs-keyword">else</span>
                holder = (ViewHolder) convertView.getTag();
            JokeBean.Body.Content content = jokeBean.showapi_res_body.contentlist.get(position);
            <span class="hljs-keyword">if</span> (content.type == <span class="hljs-number">1</span>) {
                holder.tv_content.setVisibility(View.VISIBLE);
                holder.iv_content.setVisibility(View.GONE);
                holder.tv_content.setText(content.text);
            } <span class="hljs-keyword">else</span> {
                holder.iv_content.setVisibility(View.VISIBLE);
                holder.tv_content.setVisibility(View.GONE);
                ImagsUtils.bindView(content.img, holder.iv_content);
            }
            holder.tv_title.setText(content.title);
            holder.tv_time.setText(content.ct);
            <span class="hljs-keyword">return</span> convertView;
        }

        class ViewHolder {

            TextView tv_title, tv_content, tv_time;
            ImageView iv_content;

            <span class="hljs-keyword">public</span> <span class="hljs-title">ViewHolder</span>(View convertView) {
                tv_title = (TextView) convertView.findViewById(R.id.joke_tv_title);
                tv_content = (TextView) convertView.findViewById(R.id.joke_tv_content);
                tv_time = (TextView) convertView.findViewById(R.id.joke_tv_time);
                iv_content = (ImageView) convertView.findViewById(R.id.joke_iv_content);
            }


        }
    };

}</code></pre> 
<p>       设计完上面的代码后，还记得要添加上网的个人权限，才能去请求网络。运行程序。</p> 
<p>       这里程序设计过程可能会遇到许多的问题，但是只要你细心，一步一步的去排查，看看问题出在哪里，这里涉及到很多字符串的变量，如果写错了经常会有的。比如出现了问题，首先要查看是否收到了json数据，在查看每一层接收到的json对象是否都有值。。。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f3c0f508324863553994a54514ddf331/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">[软工]概要设计说明书(GB8567-88)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/eb5318ba411192723dc893aeeb4fbedb/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Android 使用Face&#43;&#43;进行人脸识别</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>