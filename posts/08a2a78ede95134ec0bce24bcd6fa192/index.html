<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>消息队列ActiveMQ-（入门篇简单易懂） - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="消息队列ActiveMQ-（入门篇简单易懂）" />
<meta property="og:description" content="最近遇到一个问题：
我们如何同步solr的索引库，那这牵连到服务与服务之间的调用。
方案一：添加商品的业务逻辑中，添加一个同步索引库的业务逻辑。
缺点：业务逻辑耦合度高，业务拆分不明确
方案二：业务逻辑在taotao-search中实现，调用服务在taotao-manager实现。业务逻辑分开。
缺点：服务之间的耦合度变高。服务的启动有先后顺序。
方案三：使用消息队列。MQ是一个消息中间件。
ActiveMQ MQ是一个消息中间件，ActiveMQ、RabbitMQ、kafka
1.1. 什么是ActiveMQ ActiveMQ 是Apache出品，最流行的，能力强劲的开源消息总线。ActiveMQ 是一个完全支持JMS1.1和J2EE 1.4规范的 JMS Provider实现,尽管JMS规范出台已经是很久的事情了,但是JMS在当今的J2EE应用中间仍然扮演着特殊的地位。
主要特点：
1. 多种语言和协议编写客户端。语言: Java, C, C&#43;&#43;, C#, Ruby, Perl, Python, PHP。应用协议: OpenWire,Stomp REST,WS Notification,XMPP,AMQP
2. 完全支持JMS1.1和J2EE 1.4规范 (持久化,XA消息,事务)
3. 对Spring的支持,ActiveMQ可以很容易内嵌到使用Spring的系统里面去,而且也支持Spring2.0的特性
4. 通过了常见J2EE服务器(如 Geronimo,JBoss 4, GlassFish,WebLogic)的测试,其中通过JCA 1.5 resource adaptors的配置,可以让ActiveMQ可以自动的部署到任何兼容J2EE 1.4 商业服务器上
5. 支持多种传送协议:in-VM,TCP,SSL,NIO,UDP,JGroups,JXTA
6. 支持通过JDBC和journal提供高速的消息持久化
7. 从设计上保证了高性能的集群,客户端-服务器,点对点
8. 支持Ajax
9. 支持与Axis的整合
10. 可以很容易得调用内嵌JMS provider,进行测试
1.2. ActiveMQ的消息形式 对于消息的传递有两种类型：
一种是点对点的，即一个生产者和一个消费者一一对应；(queue)
另一种是发布/订阅模式，即一个生产者产生消息并进行发送后，可以由多个消费者进行接收。(topic)
JMS定义了五种不同的消息正文格式，以及调用的消息类型，允许你发送并接收以一些不同形式的数据，提供现有消息格式的一些级别的兼容性。
· StreamMessage -- Java原始值的数据流" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/08a2a78ede95134ec0bce24bcd6fa192/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-04-16T11:27:18+08:00" />
<meta property="article:modified_time" content="2018-04-16T11:27:18+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">消息队列ActiveMQ-（入门篇简单易懂）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><strong>最近遇到一个问题：</strong></p> 
<p>我们如何同步solr的索引库，那这牵连到服务与服务之间的调用。</p> 
<p></p> 
<p><span style="font-family:'宋体';"><strong>方案一：</strong></span><span style="font-family:'宋体';">添加商品的业务逻辑中，添加一个同步索引库的业务逻辑。</span></p> 
<p><span style="font-size:12px;">缺点：业务逻辑耦合度高，业务拆分不明确</span></p> 
<p><span style="font-family:'宋体';"><strong>方案二</strong>：业务逻辑在</span>taotao-search<span style="font-family:'宋体';">中实现，调用服务在</span><span style="font-family:'Times New Roman';">taotao-manager</span><span style="font-family:'宋体';">实现。业务逻辑分开。</span></p> 
<p><span style="font-size:12px;">缺点：服务之间的耦合度变高。服务的启动有先后顺序。</span></p> 
<p><span style="font-family:'宋体';"><span style="font-size:14px;"><strong>方案三</strong></span>：使用消息队列。</span>MQ<span style="font-family:'宋体';">是一个消息中间件。</span></p> 
<p><span style="font-family:'宋体';"><img src="https://images2.imgbox.com/4a/14/EzoDn1r4_o.png" alt=""><br></span></p> 
<p><span style="font-family:'宋体';"></span></p> 
<h2><strong><span style="font-family:'宋体';font-size:22pt;">ActiveMQ</span><span style="font-family:'宋体';font-size:22pt;"></span></strong></h2> 
<p><strong></strong></p> 
<strong></strong> 
<p>MQ<span style="font-family:'宋体';">是一个消息中间件，</span><span style="font-family:'Times New Roman';">ActiveMQ</span><span style="font-family:'宋体';">、</span><span style="font-family:'Times New Roman';">RabbitMQ</span><span style="font-family:'宋体';">、</span><span style="font-family:'Times New Roman';">kafka</span></p> 
<h3>1.1. <span style="font-family:'宋体';">什么是</span>ActiveMQ</h3> 
<p>ActiveMQ <span style="font-family:'宋体';">是</span><span style="font-family:'Times New Roman';">Apache</span><span style="font-family:'宋体';">出品，最流行的，能力强劲的开源消息总线。</span><span style="font-family:'Times New Roman';">ActiveMQ </span><span style="font-family:'宋体';">是一个完全支持</span><span style="font-family:'Times New Roman';">JMS1.1</span><span style="font-family:'宋体';">和</span><span style="font-family:'Times New Roman';">J2EE 1.4</span><span style="font-family:'宋体';">规范的 </span><span style="font-family:'Times New Roman';">JMS Provider</span><span style="font-family:'宋体';">实现</span><span style="font-family:'Times New Roman';">,</span><span style="font-family:'宋体';">尽管</span><span style="font-family:'Times New Roman';">JMS</span><span style="font-family:'宋体';">规范出台已经是很久的事情了</span><span style="font-family:'Times New Roman';">,</span><span style="font-family:'宋体';">但是</span><span style="font-family:'Times New Roman';">JMS</span><span style="font-family:'宋体';">在当今的</span><span style="font-family:'Times New Roman';">J2EE</span><span style="font-family:'宋体';">应用中间仍然扮演着特殊的地位。</span></p> 
<p>主要特点：</p> 
<p>1. <span style="font-family:'宋体';">多种语言和协议编写客户端。语言</span><span style="font-family:'Times New Roman';">: Java, C, C++, C#, Ruby, Perl, Python, PHP</span><span style="font-family:'宋体';">。应用协议</span><span style="font-family:'Times New Roman';">: OpenWire,Stomp REST,WS Notification,XMPP,AMQP</span></p> 
<p>2. <span style="font-family:'宋体';">完全支持</span><span style="font-family:'Times New Roman';">JMS1.1</span><span style="font-family:'宋体';">和</span><span style="font-family:'Times New Roman';">J2EE 1.4</span><span style="font-family:'宋体';">规范 </span><span style="font-family:'Times New Roman';">(</span><span style="font-family:'宋体';">持久化</span><span style="font-family:'Times New Roman';">,XA</span><span style="font-family:'宋体';">消息</span><span style="font-family:'Times New Roman';">,</span><span style="font-family:'宋体';">事务</span><span style="font-family:'Times New Roman';">)</span></p> 
<p>3. <span style="font-family:'宋体';">对</span><span style="font-family:'Times New Roman';">Spring</span><span style="font-family:'宋体';">的支持</span><span style="font-family:'Times New Roman';">,ActiveMQ</span><span style="font-family:'宋体';">可以很容易内嵌到使用</span><span style="font-family:'Times New Roman';">Spring</span><span style="font-family:'宋体';">的系统里面去</span><span style="font-family:'Times New Roman';">,</span><span style="font-family:'宋体';">而且也支持</span><span style="font-family:'Times New Roman';">Spring2.0</span><span style="font-family:'宋体';">的特性</span></p> 
<p>4. <span style="font-family:'宋体';">通过了常见</span><span style="font-family:'Times New Roman';">J2EE</span><span style="font-family:'宋体';">服务器</span><span style="font-family:'Times New Roman';">(</span><span style="font-family:'宋体';">如 </span><span style="font-family:'Times New Roman';">Geronimo,JBoss 4, GlassFish,WebLogic)</span><span style="font-family:'宋体';">的测试</span><span style="font-family:'Times New Roman';">,</span><span style="font-family:'宋体';">其中通过</span><span style="font-family:'Times New Roman';">JCA 1.5 resource adaptors</span><span style="font-family:'宋体';">的配置</span><span style="font-family:'Times New Roman';">,</span><span style="font-family:'宋体';">可以让</span><span style="font-family:'Times New Roman';">ActiveMQ</span><span style="font-family:'宋体';">可以自动的部署到任何兼容</span><span style="font-family:'Times New Roman';">J2EE 1.4 </span><span style="font-family:'宋体';">商业服务器上</span></p> 
<p>5. <span style="font-family:'宋体';">支持多种传送协议</span><span style="font-family:'Times New Roman';">:in-VM,TCP,SSL,NIO,UDP,JGroups,JXTA</span></p> 
<p>6. <span style="font-family:'宋体';">支持通过</span><span style="font-family:'Times New Roman';">JDBC</span><span style="font-family:'宋体';">和</span><span style="font-family:'Times New Roman';">journal</span><span style="font-family:'宋体';">提供高速的消息持久化</span></p> 
<p>7. <span style="font-family:'宋体';">从设计上保证了高性能的集群</span><span style="font-family:'Times New Roman';">,</span><span style="font-family:'宋体';">客户端</span><span style="font-family:'Times New Roman';">-</span><span style="font-family:'宋体';">服务器</span><span style="font-family:'Times New Roman';">,</span><span style="font-family:'宋体';">点对点</span></p> 
<p>8. <span style="font-family:'宋体';">支持</span><span style="font-family:'Times New Roman';">Ajax</span></p> 
<p>9. <span style="font-family:'宋体';">支持与</span><span style="font-family:'Times New Roman';">Axis</span><span style="font-family:'宋体';">的整合</span></p> 
<p>10. <span style="font-family:'宋体';">可以很容易得调用内嵌</span><span style="font-family:'Times New Roman';">JMS provider,</span><span style="font-family:'宋体';">进行测试</span></p> 
<p><span style="font-family:'宋体';"></span></p> 
<h3>1.2. ActiveMQ<span style="font-family:'宋体';">的消息形式</span></h3> 
<p>对于消息的传递有两种类型：</p> 
<p><strong><span style="color:rgb(0,0,255);">一种是点对点的</span></strong>，即一个生产者和一个消费者一一对应；<strong>(queue)</strong></p> 
<p><strong><span style="color:rgb(0,0,255);"><span style="font-family:'宋体';">另一种是发布</span>/<span style="font-family:'宋体';">订阅模式</span></span></strong>，即一个生产者产生消息并进行发送后，可以由多个消费者进行接收。<strong>(topic)</strong></p> 
<p>JMS<span style="font-family:'宋体';">定义了五种不同的消息正文格式，以及调用的消息类型，允许你发送并接收以一些不同形式的数据，提供现有消息格式的一些级别的兼容性。</span></p> 
<p>· <span style="font-family:'Times New Roman';">StreamMessage -- Java</span><span style="font-family:'宋体';">原始值的数据流</span></p> 
<p>· <span style="font-family:'Times New Roman';">MapMessage--</span><span style="font-family:'宋体';">一套名称</span><span style="font-family:'Times New Roman';">-</span><span style="font-family:'宋体';">值对</span></p> 
<p>· <span style="font-family:'Times New Roman';">TextMessage--</span><span style="font-family:'宋体';">一个字符串对象</span></p> 
<p>· <span style="font-family:'Times New Roman';">ObjectMessage--</span><span style="font-family:'宋体';">一个序列化的 </span><span style="font-family:'Times New Roman';">Java</span><span style="font-family:'宋体';">对象</span></p> 
<p>· <span style="font-family:'Times New Roman';">BytesMessage--</span><span style="font-family:'宋体';">一个字节的数据流</span></p> 
<p><span style="font-family:'宋体';"></span></p> 
<h2><strong><span style="font-family:'宋体';font-size:22pt;"><br></span></strong></h2> 
<h2><strong><span style="font-family:'宋体';font-size:22pt;">ActiveMQ<span style="font-family:'宋体';">的安装</span></span><span style="font-family:Calibri;font-size:22pt;"></span></strong></h2> 
<p><strong></strong></p> 
<strong></strong> 
<div> 
 <span style="font-family:'宋体';font-size:22pt;"><span style="font-family:'宋体';"></span></span> 
 <p style="font-weight:bold;"><span style="font-family:'宋体';">进入</span>http://activemq.apache.org/<span style="font-family:'宋体';">下载</span><span style="font-family:'Times New Roman';">ActiveMQ</span></p> 
 <h3 style="font-weight:bold;">1.1. 安装环境：</h3> 
 <p style="font-weight:bold;">1、<span style="font-family:'宋体';">需要</span>jdk</p> 
 <p style="font-weight:bold;">2、<span style="font-family:'宋体';">安装</span>Linux<span style="font-family:'宋体';">系统。生产环境都是</span><span style="font-family:'Times New Roman';">Linux</span><span style="font-family:'宋体';">系统。</span></p> 
 <h3 style="font-weight:bold;">1.2. 安装步骤</h3> 
 <p><span style="font-family:'宋体';">第一步：</span> <span style="font-family:'宋体';">把</span>ActiveMQ <span style="font-family:'宋体';">的压缩包上传到</span><span style="font-family:'Times New Roman';">Linux</span><span style="font-family:'宋体';">系统。</span></p> 
 <p>第二步：解压缩。</p> 
 <p>第三步：启动。</p> 
 <p><span style="font-family:'宋体';">使用</span>bin<span style="font-family:'宋体';">目录下的</span><span style="font-family:'Times New Roman';">activemq</span><span style="font-family:'宋体';">命令启动：</span>[root@localhost bin]# ./activemq start</p> 
 <p>关闭：[root@localhost bin]# ./activemq stop</p> 
 <p>查看状态：[root@localhost bin]# ./activemq status</p> 
 <p><strong>web页面查看进入管理后台</strong>：<strong>8161端口</strong></p> 
 <p><span style="font-family:'宋体';">用户名：</span>admin 密码：admin</p> 
</div> 
<p><span style="font-family:'宋体';"></span></p> 
<div> 
 <span style="font-family:'宋体';font-size:22pt;"><span style="font-family:'宋体';"></span></span> 
 <p><strong><img src="https://images2.imgbox.com/45/72/r1IXNvua_o.png" alt=""><br></strong></p> 
 <p><strong><br></strong></p> 
 <p><strong></strong></p> 
 <h2><strong><span style="font-family:'宋体';font-size:22pt;">ActiveMQ<span style="font-family:'宋体';">的使用方法</span></span><span style="font-family:'宋体';font-size:22pt;"></span></strong></h2> 
 <p><strong></strong></p> 
 <strong></strong> 
 <div> 
  <strong><span style="font-family:'宋体';font-size:22pt;"><span style="font-family:'宋体';"><img src="https://images2.imgbox.com/f4/81/OBS18Qod_o.png" alt=""><br></span></span></strong> 
 </div> 
 <div> 
  <span style="font-weight:bold;"><span style="font-family:'宋体';font-size:22pt;"><span style="font-family:'宋体';"></span></span></span> 
  <h3>1.1. Queue</h3> 
  <h4>1.1.1. Producer</h4> 
  <p>生产者：生产消息，发送端。</p> 
  <p><span style="font-family:'宋体';">把</span>jar<span style="font-family:'宋体';">包添加到工程中。使用</span><span style="font-family:'Times New Roman';">5.11.2</span><span style="font-family:'宋体';">版本的</span><span style="font-family:'Times New Roman';">jar</span><span style="font-family:'宋体';">包。</span></p> 
 </div> 
 <pre><code class="language-html"> &lt;!-- activemq --&gt;
 &lt;dependency&gt;
	&lt;groupId&gt;org.apache.activemq&lt;/groupId&gt;
	&lt;artifactId&gt;activemq-all&lt;/artifactId&gt;
	&lt;version&gt;5.11.2&lt;/version&gt;
&lt;/dependency&gt;</code></pre> 
 <p><span style="font-family:'宋体';">第一步：创建</span>ConnectionFactory<span style="font-family:'宋体';">对象，需要指定服务端</span><span style="font-family:'Times New Roman';">ip</span><span style="font-family:'宋体';">及端口号。</span></p> 
 <p><span style="font-family:'宋体';">第二步：使用</span>ConnectionFactory<span style="font-family:'宋体';">对象创建一个</span><span style="font-family:'Times New Roman';">Connection</span><span style="font-family:'宋体';">对象。</span></p> 
 <p><span style="font-family:'宋体';">第三步：开启连接，调用</span>Connection<span style="font-family:'宋体';">对象的</span><span style="font-family:'Times New Roman';">start</span><span style="font-family:'宋体';">方法。</span></p> 
 <p><span style="font-family:'宋体';">第四步：使用</span>Connection<span style="font-family:'宋体';">对象创建一个</span><span style="font-family:'Times New Roman';">Session</span><span style="font-family:'宋体';">对象。</span></p> 
 <p><span style="font-family:'宋体';">第五步：使用</span>Session<span style="font-family:'宋体';">对象创建一个</span><span style="font-family:'Times New Roman';">Destination</span><span style="font-family:'宋体';">对象（</span><span style="font-family:'Times New Roman';">topic</span><span style="font-family:'宋体';">、</span><span style="font-family:'Times New Roman';">queue</span><span style="font-family:'宋体';">），此处创建一个</span><span style="font-family:'Times New Roman';">Queue</span><span style="font-family:'宋体';">对象。</span></p> 
 <p><span style="font-family:'宋体';">第六步：使用</span>Session<span style="font-family:'宋体';">对象创建一个</span><span style="font-family:'Times New Roman';">Producer</span><span style="font-family:'宋体';">对象。</span></p> 
 <p><span style="font-family:'宋体';">第七步：创建一个</span>Message<span style="font-family:'宋体';">对象，创建一个</span><span style="font-family:'Times New Roman';">TextMessage</span><span style="font-family:'宋体';">对象。</span></p> 
 <p><span style="font-family:'宋体';">第八步：使用</span>Producer<span style="font-family:'宋体';">对象发送消息。</span></p> 
 <p>第九步：关闭资源。</p> 
</div> 
<pre><code class="language-java">public void testQueueProducer() throws Exception {
		//1、创建一个连接工厂对象，需要指定服务的ip及端口。
		ConnectionFactory connectionFactory = new ActiveMQConnectionFactory("tcp://192.168.25.161:61616");
		//2、使用工厂对象创建一个Connection对象。
		Connection connection = connectionFactory.createConnection();
		//3、开启连接，调用Connection对象的start方法。
		connection.start();
		//4、创建一个Session对象。
		//第一个参数：是否开启事务。如果true开启事务，第二个参数无意义。一般不开启事务false。
		//第二个参数：应答模式。自动应答或者手动应答。一般自动应答。
		Session session = connection.createSession(false, Session.AUTO_ACKNOWLEDGE);
		//5、使用Session对象创建一个Destination对象。两种形式queue、topic，现在应该使用queue
		Queue queue = session.createQueue("test-queue");
		//6、使用Session对象创建一个Producer对象。
		MessageProducer producer = session.createProducer(queue);
		//7、创建一个Message对象，可以使用TextMessage。
		/*TextMessage textMessage = new ActiveMQTextMessage();
		textMessage.setText("hello Activemq");*/
		TextMessage textMessage = session.createTextMessage("hello activemq");
		//8、发送消息
		producer.send(textMessage);
		//9、关闭资源
		producer.close();
		session.close();
		connection.close();
	}</code></pre> 
<p><span style="font-family:'宋体';">运行，然后打开web管理界面：</span></p> 
<p><span style="font-family:'宋体';"><img src="https://images2.imgbox.com/c4/ff/FxhHEn4C_o.png" alt=""><br></span></p> 
<p><span style="font-family:'宋体';"></span></p> 
<h4>1.1.2.Consumer</h4> 
<p>消费者：接收消息。</p> 
<p><span style="font-family:'宋体';">第一步：创建一个</span>ConnectionFactory<span style="font-family:'宋体';">对象。</span></p> 
<p><span style="font-family:'宋体';">第二步：从</span>ConnectionFactory<span style="font-family:'宋体';">对象中获得一个</span><span style="font-family:'Times New Roman';">Connection</span><span style="font-family:'宋体';">对象。</span></p> 
<p><span style="font-family:'宋体';">第三步：开启连接。调用</span>Connection<span style="font-family:'宋体';">对象的</span><span style="font-family:'Times New Roman';">start</span><span style="font-family:'宋体';">方法。</span></p> 
<p><span style="font-family:'宋体';">第四步：使用</span>Connection<span style="font-family:'宋体';">对象创建一个</span><span style="font-family:'Times New Roman';">Session</span><span style="font-family:'宋体';">对象。</span></p> 
<p><span style="font-family:'宋体';">第五步：使用</span>Session<span style="font-family:'宋体';">对象创建一个</span><span style="font-family:'Times New Roman';">Destination</span><span style="font-family:'宋体';">对象。和发送端保持一致</span><span style="font-family:'Times New Roman';">queue</span><span style="font-family:'宋体';">，并且队列的名称一致。</span></p> 
<p><span style="font-family:'宋体';">第六步：使用</span>Session<span style="font-family:'宋体';">对象创建一个</span><span style="font-family:'Times New Roman';">Consumer</span><span style="font-family:'宋体';">对象。</span></p> 
<p>第七步：接收消息。</p> 
<p>第八步：打印消息。</p> 
<p>第九步：关闭资源</p> 
<pre><code class="language-java">public void testQueueConsumer() throws Exception {
		//创建一个ConnectionFactory对象连接MQ服务器
		ConnectionFactory connectionFactory = new ActiveMQConnectionFactory("tcp://192.168.25.161:61616");
		//创建一个连接对象
		Connection connection = connectionFactory.createConnection();
		//开启连接
		connection.start();
		//使用Connection对象创建一个Session对象
		Session session = connection.createSession(false, Session.AUTO_ACKNOWLEDGE);
		//创建一个Destination对象。queue对象
		Queue queue = session.createQueue("test-queue");
		//使用Session对象创建一个消费者对象。
		MessageConsumer consumer = session.createConsumer(queue);
		//接收消息
		consumer.setMessageListener(new MessageListener() {
			
			@Override
			public void onMessage(Message message) {
				//打印结果
				TextMessage textMessage = (TextMessage) message;
				String text;
				try {
					text = textMessage.getText();
					System.out.println(text);
				} catch (JMSException e) {
					e.printStackTrace();
				}
				
			}
		});
		//等待接收消息
		System.in.read();
		//关闭资源
		consumer.close();
		session.close();
		connection.close();
	}</code></pre> 
<br> 
<p><span style="font-family:'宋体';"><img src="https://images2.imgbox.com/52/4f/bbDhSH0D_o.png" alt=""></span></p> 
<p><span style="font-family:'宋体';"><br></span></p> 
<p><span style="font-family:'宋体';"></span></p> 
<h3>1.1. Topic</h3> 
<h4>1.1.1. Producer</h4> 
<p>使用步骤：</p> 
<p><span style="font-family:'宋体';">第一步：创建</span>ConnectionFactory<span style="font-family:'宋体';">对象，需要指定服务端</span><span style="font-family:'Times New Roman';">ip</span><span style="font-family:'宋体';">及端口号。</span></p> 
<p><span style="font-family:'宋体';">第二步：使用</span>ConnectionFactory<span style="font-family:'宋体';">对象创建一个</span><span style="font-family:'Times New Roman';">Connection</span><span style="font-family:'宋体';">对象。</span></p> 
<p><span style="font-family:'宋体';">第三步：开启连接，调用</span>Connection<span style="font-family:'宋体';">对象的</span><span style="font-family:'Times New Roman';">start</span><span style="font-family:'宋体';">方法。</span></p> 
<p><span style="font-family:'宋体';">第四步：使用</span>Connection<span style="font-family:'宋体';">对象创建一个</span><span style="font-family:'Times New Roman';">Session</span><span style="font-family:'宋体';">对象。</span></p> 
<p><span style="font-family:'宋体';">第五步：使用</span>Session<span style="font-family:'宋体';">对象创建一个</span><span style="font-family:'Times New Roman';">Destination</span><span style="font-family:'宋体';">对象（</span><span style="font-family:'Times New Roman';">topic</span><span style="font-family:'宋体';">、</span><span style="font-family:'Times New Roman';">queue</span><span style="font-family:'宋体';">），此处创建一个</span><span style="font-family:'Times New Roman';">Topic</span><span style="font-family:'宋体';">对象。</span></p> 
<p><span style="font-family:'宋体';">第六步：使用</span>Session<span style="font-family:'宋体';">对象创建一个</span><span style="font-family:'Times New Roman';">Producer</span><span style="font-family:'宋体';">对象。</span></p> 
<p><span style="font-family:'宋体';">第七步：创建一个</span>Message<span style="font-family:'宋体';">对象，创建一个</span><span style="font-family:'Times New Roman';">TextMessage</span><span style="font-family:'宋体';">对象。</span></p> 
<p><span style="font-family:'宋体';">第八步：使用</span>Producer<span style="font-family:'宋体';">对象发送消息。</span></p> 
<p>第九步：关闭资源。</p> 
<br> 
<pre><code class="language-java">@Test
	public void testTopicProducer() throws Exception {
		//1、创建一个连接工厂对象，需要指定服务的ip及端口。
		ConnectionFactory connectionFactory = new ActiveMQConnectionFactory("tcp://192.168.25.161:61616");
		//2、使用工厂对象创建一个Connection对象。
		Connection connection = connectionFactory.createConnection();
		//3、开启连接，调用Connection对象的start方法。
		connection.start();
		//4、创建一个Session对象。
		//第一个参数：是否开启事务。如果true开启事务，第二个参数无意义。一般不开启事务false。
		//第二个参数：应答模式。自动应答或者手动应答。一般自动应答。
		Session session = connection.createSession(false, Session.AUTO_ACKNOWLEDGE);
		//5、使用Session对象创建一个Destination对象。两种形式queue、topic，现在应该使用topic
		Topic topic = session.createTopic("test-topic");
		//6、使用Session对象创建一个Producer对象。
		MessageProducer producer = session.createProducer(topic);
		//7、创建一个Message对象，可以使用TextMessage。
		/*TextMessage textMessage = new ActiveMQTextMessage();
		textMessage.setText("hello Activemq");*/
		TextMessage textMessage = session.createTextMessage("topic message");
		//8、发送消息
		producer.send(textMessage);
		//9、关闭资源
		producer.close();
		session.close();
		connection.close();
	}</code></pre> 
<h4>1.1.1. Consumer</h4> 
<p>消费者：接收消息。</p> 
<p><span style="font-family:'宋体';">第一步：创建一个</span>ConnectionFactory<span style="font-family:'宋体';">对象。</span></p> 
<p><span style="font-family:'宋体';">第二步：从</span>ConnectionFactory<span style="font-family:'宋体';">对象中获得一个</span><span style="font-family:'Times New Roman';">Connection</span><span style="font-family:'宋体';">对象。</span></p> 
<p><span style="font-family:'宋体';">第三步：开启连接。调用</span>Connection<span style="font-family:'宋体';">对象的</span><span style="font-family:'Times New Roman';">start</span><span style="font-family:'宋体';">方法。</span></p> 
<p><span style="font-family:'宋体';">第四步：使用</span>Connection<span style="font-family:'宋体';">对象创建一个</span><span style="font-family:'Times New Roman';">Session</span><span style="font-family:'宋体';">对象。</span></p> 
<p><span style="font-family:'宋体';">第五步：使用</span>Session<span style="font-family:'宋体';">对象创建一个</span><span style="font-family:'Times New Roman';">Destination</span><span style="font-family:'宋体';">对象。和发送端保持一致</span><span style="font-family:'Times New Roman';">topic</span><span style="font-family:'宋体';">，并且话题的名称一致。</span></p> 
<p><span style="font-family:'宋体';">第六步：使用</span>Session<span style="font-family:'宋体';">对象创建一个</span><span style="font-family:'Times New Roman';">Consumer</span><span style="font-family:'宋体';">对象。</span></p> 
<p>第七步：接收消息。</p> 
<p>第八步：打印消息。</p> 
<p>第九步：关闭资源</p> 
<pre><code class="language-java">	@Test
	public void testTopicConsumer() throws Exception {
		//创建一个ConnectionFactory对象连接MQ服务器
		ConnectionFactory connectionFactory = new ActiveMQConnectionFactory("tcp://192.168.25.161:61616");
		//创建一个连接对象
		Connection connection = connectionFactory.createConnection();
		//开启连接
		connection.start();
		//使用Connection对象创建一个Session对象
		Session session = connection.createSession(false, Session.AUTO_ACKNOWLEDGE);
		//创建一个Destination对象。topic对象
		Topic topic = session.createTopic("test-topic");
		//使用Session对象创建一个消费者对象。
		MessageConsumer consumer = session.createConsumer(topic);
		//接收消息
		consumer.setMessageListener(new MessageListener() {
			
			@Override
			public void onMessage(Message message) {
				//打印结果
				TextMessage textMessage = (TextMessage) message;
				String text;
				try {
					text = textMessage.getText();
					System.out.println(text);
				} catch (JMSException e) {
					e.printStackTrace();
				}
				
			}
		});
		System.out.println("topic消费者3启动。。。。");
		//等待接收消息
		System.in.read();
		//关闭资源
		consumer.close();
		session.close();
		connection.close();
	}</code></pre> 
<p><img src="https://images2.imgbox.com/b7/36/sLJLg6N5_o.png" alt=""><br></p> 
<p>恭喜你有了解了一门技术。。。。</p> 
<span style="font-family:'宋体';"><br></span> 
<br>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/86a77a39cce15fa83c3d44df9b28df48/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">VC6.0与OpenCV1.0 的安装和配置，及相关可能出现的错误与解决方案</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ac494924c207e1f4a244b8f207da9060/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">浅谈Kotlin语法篇之扩展函数(五)</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>