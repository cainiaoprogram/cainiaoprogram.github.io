<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>某网课m3u8视频流hls.js算法逆向 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="某网课m3u8视频流hls.js算法逆向" />
<meta property="og:description" content="前言 需要了解m3u8基础知识，可在下方链接阅读笔者之前的文章。
https://www.52pojie.cn/thread-1686788-1-1.html
初步分析 目标站点：aHR0cHM6Ly93d3cuOTJneXcuY29tL3Nob3J0VmlkZW8vYWxidW0vMjA1P3ZpZGVvSWQ9NDY4NQ==
打开浏览器，按下F12开发者工具，然后粘贴链接进入页面。
在上方点击 Network 菜单栏（在这里可以监视浏览器与服务器之间的网络请求和响应。你可以查看请求的详细信息、响应的状态码和内容，并分析网络性能。）
接下来就是分析 m3u8和key 的链接
观察m3u8，发现是标准格式，并没有经过加密处理
接着观察key，发现是16字节
可事实真的如此吗？打开 M3U8批量下载器 试试。
M3U8批量下载器 V1.4.8 0508【5月8日更新】
https://www.52pojie.cn/thread-1631141-1-1.html
粘贴m3u8链接，点击【添加】按钮
再点击【全部开始】按钮
提示
文件解码失败，请检查key是否正确 此时有2种可能，我们依次分析
第1种可能：key链接，存在次数限制，在浏览器打开了首次，然后第2次访问，不给数据或者是假数据（key）
在连续多次请求，与浏览器首次响应，对比发现是一致的字节，那么就不是这个原因。
第2种可能：key密钥的响应值被加密了，市面上别的平台通常是返回32位或者更长的字节。
此时就得js逆向了，分析 hls.js 文件，这里面有做特殊处理，播放前会解密出正确的密钥。
找到 001.ts，菜单栏点击 Initiator ，这是 js函数调用堆栈，然后进去下断点，动态调试分析。
这个过程比较繁琐，需要了解 Hls.js 的加载过程。
当然我是这么分析出的，教大家一招简单的技巧。
我们换一种思路，通过关键词来定位
aes-128 decryptdata.key buffer 观察到这行有点可疑，可能是个解密函数，又将key和iv传递进去。
let _ = C.softwareDecrypt(n, R.key.buffer, R.iv.buffer); 点击行号，到这里下断，然后F5重新加载网页。
观察发现，n是ts的文件数据，R里面有我们想要的key和iv数据。
key [101, 77, 103, 113, 121, 121, 112, 108, 55, 84, 71, 79, 55, 99, 65, 98] iv [55, 108, 98, 109, 52, 103, 113, 57, 106, 114, 108, 66, 50, 86, 67, 49] 主要是key，在python中转成hex十六进制，看看。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/ab238b6eb3c63751fdb32df17d99b777/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-02T19:40:02+08:00" />
<meta property="article:modified_time" content="2023-11-02T19:40:02+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">某网课m3u8视频流hls.js算法逆向</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="_0"></a>前言</h3> 
<p>需要了解m3u8基础知识，可在下方链接阅读笔者之前的文章。<br> <a href="https://www.52pojie.cn/thread-1686788-1-1.html" rel="nofollow">https://www.52pojie.cn/thread-1686788-1-1.html</a></p> 
<h3><a id="_5"></a>初步分析</h3> 
<p>目标站点：aHR0cHM6Ly93d3cuOTJneXcuY29tL3Nob3J0VmlkZW8vYWxidW0vMjA1P3ZpZGVvSWQ9NDY4NQ==</p> 
<p>打开浏览器，按下F12开发者工具，然后粘贴链接进入页面。</p> 
<p>在上方点击 Network 菜单栏（在这里可以监视浏览器与服务器之间的网络请求和响应。你可以查看请求的详细信息、响应的状态码和内容，并分析网络性能。）</p> 
<p><img src="https://images2.imgbox.com/1c/f8/PDzTZgm4_o.png" alt="在这里插入图片描述"><br> 接下来就是分析 m3u8和key 的链接<br> <img src="https://images2.imgbox.com/4b/4f/mmlM1DTf_o.png" alt="在这里插入图片描述"><br> 观察m3u8，发现是标准格式，并没有经过加密处理<br> 接着观察key，发现是16字节<br> <img src="https://images2.imgbox.com/be/e3/f0uwDCmW_o.png" alt="在这里插入图片描述"><br> 可事实真的如此吗？打开 M3U8批量下载器 试试。</p> 
<p>M3U8批量下载器 V1.4.8 0508【5月8日更新】<br> <a href="https://www.52pojie.cn/thread-1631141-1-1.html" rel="nofollow">https://www.52pojie.cn/thread-1631141-1-1.html</a></p> 
<p><img src="https://images2.imgbox.com/11/86/msqKChFG_o.png" alt="在这里插入图片描述"><br> 粘贴m3u8链接，点击【添加】按钮<br> <img src="https://images2.imgbox.com/c2/32/XWytXOCx_o.png" alt="在这里插入图片描述"><br> 再点击【全部开始】按钮<br> <img src="https://images2.imgbox.com/6e/7c/Lp6hYwEd_o.png" alt="在这里插入图片描述"><br> 提示</p> 
<pre><code>文件解码失败，请检查key是否正确
</code></pre> 
<p>此时有2种可能，我们依次分析</p> 
<p>第1种可能：key链接，存在次数限制，在浏览器打开了首次，然后第2次访问，不给数据或者是假数据（key）</p> 
<p><img src="https://images2.imgbox.com/d4/55/snSVk4ts_o.png" alt="在这里插入图片描述"></p> 
<p>在连续多次请求，与浏览器首次响应，对比发现是一致的字节，那么就不是这个原因。</p> 
<p>第2种可能：key密钥的响应值被加密了，市面上别的平台通常是返回32位或者更长的字节。</p> 
<p>此时就得js逆向了，分析 hls.js 文件，这里面有做特殊处理，播放前会解密出正确的密钥。</p> 
<p><img src="https://images2.imgbox.com/e6/db/gKKfghzo_o.png" alt="在这里插入图片描述"><br> 找到 001.ts，菜单栏点击 Initiator ，这是 js函数调用堆栈，然后进去下断点，动态调试分析。</p> 
<p>这个过程比较繁琐，需要了解 Hls.js 的加载过程。</p> 
<p><img src="https://images2.imgbox.com/30/eb/82L6V7sr_o.png" alt="在这里插入图片描述"></p> 
<p>当然我是这么分析出的，教大家一招简单的技巧。</p> 
<p>我们换一种思路，通过关键词来定位</p> 
<pre><code>aes-128
decryptdata.key
buffer
</code></pre> 
<p><img src="https://images2.imgbox.com/e7/69/PJKWk3bu_o.png" alt="在这里插入图片描述"><br> 观察到这行有点可疑，可能是个解密函数，又将key和iv传递进去。</p> 
<pre><code class="prism language-javascript"><span class="token keyword">let</span> _ <span class="token operator">=</span> <span class="token constant">C</span><span class="token punctuation">.</span><span class="token function">softwareDecrypt</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> <span class="token constant">R</span><span class="token punctuation">.</span>key<span class="token punctuation">.</span>buffer<span class="token punctuation">,</span> <span class="token constant">R</span><span class="token punctuation">.</span>iv<span class="token punctuation">.</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>点击行号，到这里下断，然后F5重新加载网页。</p> 
<p>观察发现，n是ts的文件数据，R里面有我们想要的key和iv数据。</p> 
<pre><code class="prism language-javascript">key
<span class="token punctuation">[</span><span class="token number">101</span><span class="token punctuation">,</span> <span class="token number">77</span><span class="token punctuation">,</span> <span class="token number">103</span><span class="token punctuation">,</span> <span class="token number">113</span><span class="token punctuation">,</span> <span class="token number">121</span><span class="token punctuation">,</span> <span class="token number">121</span><span class="token punctuation">,</span> <span class="token number">112</span><span class="token punctuation">,</span> <span class="token number">108</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">,</span> <span class="token number">84</span><span class="token punctuation">,</span> <span class="token number">71</span><span class="token punctuation">,</span> <span class="token number">79</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">,</span> <span class="token number">65</span><span class="token punctuation">,</span> <span class="token number">98</span><span class="token punctuation">]</span>

iv
<span class="token punctuation">[</span><span class="token number">55</span><span class="token punctuation">,</span> <span class="token number">108</span><span class="token punctuation">,</span> <span class="token number">98</span><span class="token punctuation">,</span> <span class="token number">109</span><span class="token punctuation">,</span> <span class="token number">52</span><span class="token punctuation">,</span> <span class="token number">103</span><span class="token punctuation">,</span> <span class="token number">113</span><span class="token punctuation">,</span> <span class="token number">57</span><span class="token punctuation">,</span> <span class="token number">106</span><span class="token punctuation">,</span> <span class="token number">114</span><span class="token punctuation">,</span> <span class="token number">108</span><span class="token punctuation">,</span> <span class="token number">66</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">86</span><span class="token punctuation">,</span> <span class="token number">67</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">]</span>
</code></pre> 
<p>主要是key，在python中转成hex十六进制，看看。</p> 
<p><img src="https://images2.imgbox.com/4d/64/EUFesEbm_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-python">
b <span class="token operator">=</span> <span class="token builtin">bytearray</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">101</span><span class="token punctuation">,</span> <span class="token number">77</span><span class="token punctuation">,</span> <span class="token number">103</span><span class="token punctuation">,</span> <span class="token number">113</span><span class="token punctuation">,</span> <span class="token number">121</span><span class="token punctuation">,</span> <span class="token number">121</span><span class="token punctuation">,</span> <span class="token number">112</span><span class="token punctuation">,</span> <span class="token number">108</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">,</span> <span class="token number">84</span><span class="token punctuation">,</span> <span class="token number">71</span><span class="token punctuation">,</span> <span class="token number">79</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">,</span> <span class="token number">65</span><span class="token punctuation">,</span> <span class="token number">98</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
hex_str <span class="token operator">=</span> b<span class="token punctuation">.</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>hex_str<span class="token punctuation">)</span>
<span class="token comment"># 654d67717979706c3754474f37634162</span>

</code></pre> 
<p>然后打开 m3u8下载器，自定义key下载，试试</p> 
<p><img src="https://images2.imgbox.com/67/54/sWCwuGwb_o.png" alt="在这里插入图片描述"><br> 神奇的一幕发生了，居然下载成功了</p> 
<p><img src="https://images2.imgbox.com/d3/fc/AhhVzPPx_o.png" alt="在这里插入图片描述"></p> 
<pre><code>那么真实的key就是
[101, 77, 103, 113, 121, 121, 112, 108, 55, 84, 71, 79, 55, 99, 65, 98]

但.key文件，返回的却是
[128, 245, 244, 139, 212, 166, 215, 255, 208, 226, 106, 4, 240, 217, 14, 134]
</code></pre> 
<p>我们需要得知是如何互转的，这个过程就是js逆向，继续回到浏览器。</p> 
<p><img src="https://images2.imgbox.com/33/a8/rhOeAKL2_o.png" alt="在这里插入图片描述"><br> 在右侧 调用堆栈(Call Stack)，需要逐个分析出key是在哪里赋值的。</p> 
<p>观察到 play-utils-508447cf.js 的 onSuccess 关键词附近，貌似在请求并取回响应，到这里下断看看。</p> 
<p><img src="https://images2.imgbox.com/dd/86/UHWaqT4U_o.png" alt="在这里插入图片描述"><br> 然后刷新网页</p> 
<pre><code class="prism language-javascript"><span class="token keyword">const</span> pt <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ut</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> mt <span class="token operator">=</span> <span class="token function">lt</span><span class="token punctuation">(</span><span class="token string">"nt:main/lib/js/ntPlayer"</span><span class="token punctuation">)</span>
  <span class="token punctuation">,</span> z <span class="token operator">=</span> <span class="token keyword">class</span> <span class="token class-name">extends</span> nt<span class="token punctuation">.</span>DefaultConfig<span class="token punctuation">.</span>loader <span class="token punctuation">{<!-- --></span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">d</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">"_superLoad"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_superLoad <span class="token operator">=</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">load</span><span class="token punctuation">(</span><span class="token parameter">e<span class="token punctuation">,</span> i<span class="token punctuation">,</span> a</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>keyInfo<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">const</span> p <span class="token operator">=</span> a<span class="token punctuation">.</span>onSuccess<span class="token punctuation">;</span>
            a<span class="token punctuation">.</span><span class="token function-variable function">onSuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter"><span class="token constant">E</span><span class="token punctuation">,</span> g<span class="token punctuation">,</span> c<span class="token punctuation">,</span> v</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">const</span> y <span class="token operator">=</span> <span class="token constant">E</span><span class="token punctuation">.</span>data
                  <span class="token punctuation">,</span> $ <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataView</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>z<span class="token punctuation">.</span>_revise<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">const</span> b <span class="token operator">=</span> z<span class="token punctuation">.</span>_revise<span class="token punctuation">;</span>
                    $<span class="token punctuation">.</span><span class="token function">setInt32</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> $<span class="token punctuation">.</span><span class="token function">getInt32</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">^</span> b<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    $<span class="token punctuation">.</span><span class="token function">setInt32</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> $<span class="token punctuation">.</span><span class="token function">getInt32</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">^</span> b<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    $<span class="token punctuation">.</span><span class="token function">setInt32</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> $<span class="token punctuation">.</span><span class="token function">getInt32</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">^</span> b<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    $<span class="token punctuation">.</span><span class="token function">setInt32</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> $<span class="token punctuation">.</span><span class="token function">getInt32</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span> <span class="token operator">^</span> b<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token constant">E</span><span class="token punctuation">.</span>data <span class="token operator">=</span> $<span class="token punctuation">.</span>buffer
                <span class="token punctuation">}</span>
                <span class="token function">p</span><span class="token punctuation">(</span><span class="token constant">E</span><span class="token punctuation">,</span> g<span class="token punctuation">,</span> c<span class="token punctuation">,</span> v<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_superLoad</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> i<span class="token punctuation">,</span> a<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">static</span> <span class="token function">setRevise</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        z<span class="token punctuation">.</span>_revise <span class="token operator">=</span> e
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/8c/ab/CupaTzlY_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-javascript">z<span class="token punctuation">.</span>_revise
<span class="token punctuation">[</span><span class="token number">3854078970</span><span class="token punctuation">,</span> <span class="token number">2917115795</span><span class="token punctuation">,</span> <span class="token number">3887476043</span><span class="token punctuation">,</span> <span class="token number">3350876132</span><span class="token punctuation">]</span>
</code></pre> 
<p>发现该变量，在下面有用到，于是全局搜索，共4处引用，挨个下断，再次刷新网页<br> <img src="https://images2.imgbox.com/88/cf/YuKoybL8_o.png" alt="在这里插入图片描述"><br> 发现这里的入参是这些值，那么从堆栈里往上跟，就能找出来了。</p> 
<p><img src="https://images2.imgbox.com/2b/6c/SuolW92N_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-javascript">        <span class="token keyword">const</span> t <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">".player[nt-main-skey]"</span><span class="token punctuation">)</span>
          <span class="token punctuation">,</span> e <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">"#app-key"</span><span class="token punctuation">)</span>
          <span class="token punctuation">,</span> i <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">".end-tips"</span><span class="token punctuation">)</span>
          <span class="token punctuation">,</span> a <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">"[nt-buy-vip]"</span><span class="token punctuation">)</span>
          <span class="token punctuation">,</span> l <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">"nt-video-id"</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">"0"</span><span class="token punctuation">)</span>
          <span class="token punctuation">,</span> p <span class="token operator">=</span> t<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">"nt-main-poster"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>existSrt <span class="token operator">=</span> t<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">"nt-srt"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"1"</span><span class="token punctuation">,</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>skey <span class="token operator">=</span> t<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">"nt-main-skey"</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">""</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> <span class="token constant">E</span> <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">[</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>e<span class="token punctuation">.</span>dataset<span class="token punctuation">.</span>keys<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">]</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t<span class="token punctuation">.</span><span class="token function">removeAttribute</span><span class="token punctuation">(</span><span class="token string">"nt-main-poster"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        t<span class="token punctuation">.</span><span class="token function">removeAttribute</span><span class="token punctuation">(</span><span class="token string">"nt-main-skey"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        t<span class="token punctuation">.</span><span class="token function">removeAttribute</span><span class="token punctuation">(</span><span class="token string">"nt-srt"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        e<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>playLog <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Et</span><span class="token punctuation">,</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>pageState <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span>st<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">"{}"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">tt</span><span class="token punctuation">(</span><span class="token string">"pageState: %o"</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pageState<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>player <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">_t</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span><span class="token punctuation">{<!-- --></span>
            <span class="token literal-property property">poster</span><span class="token operator">:</span> p <span class="token operator">||</span> <span class="token string">""</span><span class="token punctuation">,</span>
            <span class="token literal-property property">logo</span><span class="token operator">:</span> ct<span class="token punctuation">,</span>
            <span class="token literal-property property">logoWidth</span><span class="token operator">:</span> <span class="token number">120</span><span class="token punctuation">,</span>
            <span class="token literal-property property">autoplay</span><span class="token operator">:</span> <span class="token operator">!</span><span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token literal-property property">muted</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pageState<span class="token punctuation">.</span>muted <span class="token operator">||</span> <span class="token operator">!</span><span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token literal-property property">volume</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pageState<span class="token punctuation">.</span>volume <span class="token operator">||</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token literal-property property">playbackRate</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pageState<span class="token punctuation">.</span>playbackRate <span class="token operator">||</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token literal-property property">enablePlaybackRate</span><span class="token operator">:</span> <span class="token operator">!</span><span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token literal-property property">enableCue</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>existSrt<span class="token punctuation">,</span>
            <span class="token literal-property property">revise</span><span class="token operator">:</span> <span class="token constant">E</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/06/0d/qCd9YcfZ_o.png" alt="在这里插入图片描述"><br> 于是找到了关键位置</p> 
<pre><code class="prism language-javascript">e <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">"#app-key"</span><span class="token punctuation">)</span>
<span class="token operator">...</span>
<span class="token keyword">const</span> <span class="token constant">E</span> <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">[</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>e<span class="token punctuation">.</span>dataset<span class="token punctuation">.</span>keys<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">]</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">...</span>
</code></pre> 
<p>querySelector() 方法返回文档中匹配指定 CSS 选择器的一个元素。</p> 
<p>于是到 HTML 里搜索 app-key 看看</p> 
<p><img src="https://images2.imgbox.com/32/57/cMrTVi93_o.png" alt="在这里插入图片描述"><br> 果然找到了</p> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>app-key<span class="token punctuation">"</span></span> <span class="token attr-name">data-keys</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>3854078970,2917115795,3887476043,3350876132<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>接着在Nodejs补环境，完成脱机调用，也就是还原解密过程。</p> 
<h3><a id="_Nodejs_217"></a>纯算法 Nodejs</h3> 
<p><img src="https://images2.imgbox.com/6c/32/gKJt3zdR_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-javascript">
<span class="token keyword">var</span> z <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">'_revise'</span> <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">3854078970</span><span class="token punctuation">,</span> <span class="token number">2917115795</span><span class="token punctuation">,</span> <span class="token number">3887476043</span><span class="token punctuation">,</span> <span class="token number">3350876132</span><span class="token punctuation">]</span> <span class="token comment">// app-key 的值</span>
<span class="token punctuation">}</span>
<span class="token comment">// console.log(z)</span>

<span class="token keyword">var</span> key <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">245</span><span class="token punctuation">,</span> <span class="token number">244</span><span class="token punctuation">,</span> <span class="token number">139</span><span class="token punctuation">,</span> <span class="token number">212</span><span class="token punctuation">,</span> <span class="token number">166</span><span class="token punctuation">,</span> <span class="token number">215</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">208</span><span class="token punctuation">,</span> <span class="token number">226</span><span class="token punctuation">,</span> <span class="token number">106</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">240</span><span class="token punctuation">,</span> <span class="token number">217</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">134</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 网页 .key文件返回的加密值</span>

<span class="token keyword">let</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayBuffer</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> view <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataView</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> data<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  view<span class="token punctuation">.</span><span class="token function">setUint8</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> <span class="token constant">T</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataView</span><span class="token punctuation">(</span>view<span class="token punctuation">.</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>z<span class="token punctuation">.</span>_revise<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">const</span> <span class="token constant">L</span> <span class="token operator">=</span> z<span class="token punctuation">.</span>_revise<span class="token punctuation">;</span>
    <span class="token constant">T</span><span class="token punctuation">.</span><span class="token function">setInt32</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token constant">T</span><span class="token punctuation">.</span><span class="token function">getInt32</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token constant">L</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token constant">T</span><span class="token punctuation">.</span><span class="token function">setInt32</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token constant">T</span><span class="token punctuation">.</span><span class="token function">getInt32</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token constant">L</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token constant">T</span><span class="token punctuation">.</span><span class="token function">setInt32</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token constant">T</span><span class="token punctuation">.</span><span class="token function">getInt32</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token constant">L</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token constant">T</span><span class="token punctuation">.</span><span class="token function">setInt32</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token constant">T</span><span class="token punctuation">.</span><span class="token function">getInt32</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token constant">L</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ok <span class="token operator">=</span> <span class="token constant">T</span><span class="token punctuation">.</span>buffer

    dec_16 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span>ok<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">""</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>dec_16<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 101,77,103,113,121,121,112,108,55,84,71,79,55,99,65,98</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>封装成解密函数</p> 
<pre><code class="prism language-javascript"><span class="token keyword">function</span> <span class="token function">decrypt</span><span class="token punctuation">(</span><span class="token parameter">app_key<span class="token punctuation">,</span> en_key</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">var</span> z <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string-property property">'_revise'</span><span class="token operator">:</span> app_key
    <span class="token punctuation">}</span>

    <span class="token keyword">let</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayBuffer</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span>en_key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> view <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataView</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> data<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        view<span class="token punctuation">.</span><span class="token function">setUint8</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">var</span> <span class="token constant">T</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataView</span><span class="token punctuation">(</span>view<span class="token punctuation">.</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>z<span class="token punctuation">.</span>_revise<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">const</span> <span class="token constant">L</span> <span class="token operator">=</span> z<span class="token punctuation">.</span>_revise<span class="token punctuation">;</span>
        <span class="token constant">T</span><span class="token punctuation">.</span><span class="token function">setInt32</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token constant">T</span><span class="token punctuation">.</span><span class="token function">getInt32</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token constant">L</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token constant">T</span><span class="token punctuation">.</span><span class="token function">setInt32</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token constant">T</span><span class="token punctuation">.</span><span class="token function">getInt32</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token constant">L</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token constant">T</span><span class="token punctuation">.</span><span class="token function">setInt32</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token constant">T</span><span class="token punctuation">.</span><span class="token function">getInt32</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token constant">L</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token constant">T</span><span class="token punctuation">.</span><span class="token function">setInt32</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token constant">T</span><span class="token punctuation">.</span><span class="token function">getInt32</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token constant">L</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ok <span class="token operator">=</span> <span class="token constant">T</span><span class="token punctuation">.</span>buffer<span class="token punctuation">;</span>

        dec_16 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span>ok<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> dec_16
<span class="token punctuation">}</span>

<span class="token keyword">var</span> app_key <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">3854078970</span><span class="token punctuation">,</span> <span class="token number">2917115795</span><span class="token punctuation">,</span> <span class="token number">3887476043</span><span class="token punctuation">,</span> <span class="token number">3350876132</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> en_key <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">245</span><span class="token punctuation">,</span> <span class="token number">244</span><span class="token punctuation">,</span> <span class="token number">139</span><span class="token punctuation">,</span> <span class="token number">212</span><span class="token punctuation">,</span> <span class="token number">166</span><span class="token punctuation">,</span> <span class="token number">215</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">208</span><span class="token punctuation">,</span> <span class="token number">226</span><span class="token punctuation">,</span> <span class="token number">106</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">240</span><span class="token punctuation">,</span> <span class="token number">217</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">134</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> ok <span class="token operator">=</span> <span class="token function">decrypt</span><span class="token punctuation">(</span>app_key<span class="token punctuation">,</span> en_key<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ok<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ok <span class="token operator">+</span> <span class="token string">""</span> <span class="token operator">==</span> <span class="token punctuation">[</span><span class="token number">101</span><span class="token punctuation">,</span> <span class="token number">77</span><span class="token punctuation">,</span> <span class="token number">103</span><span class="token punctuation">,</span> <span class="token number">113</span><span class="token punctuation">,</span> <span class="token number">121</span><span class="token punctuation">,</span> <span class="token number">121</span><span class="token punctuation">,</span> <span class="token number">112</span><span class="token punctuation">,</span> <span class="token number">108</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">,</span> <span class="token number">84</span><span class="token punctuation">,</span> <span class="token number">71</span><span class="token punctuation">,</span> <span class="token number">79</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">,</span> <span class="token number">65</span><span class="token punctuation">,</span> <span class="token number">98</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> 
<h3><a id="BlobArrayBuffer_290"></a>Blob和ArrayBuffer是什么鬼？</h3> 
<ol><li> <p>最早是数据库直接用Blob来存储二进制数据对象，这样就不用关注存储数据的格式了。在web领域，Blob对象表示一个只读原始数据的类文件对象，虽然是二进制原始数据但是类似文件的对象，因此可以像操作文件对象一样操作Blob对象。</p> </li><li> <p>ArrayBuffer对象用来表示通用的、固定长度的原始二进制数据缓冲区。我们可以通过new ArrayBuffer(length)来获得一片连续的内存空间，它不能直接读写，但可根据需要将其传递到TypedArray视图或 DataView 对象来解释原始缓冲区。实际上视图只是给你提供了一个某种类型的读写接口，让你可以操作ArrayBuffer里的数据。TypedArray需指定一个数组类型来保证数组成员都是同一个数据类型，而DataView数组成员可以是不同的数据类型。</p> </li></ol> 
<p>TypedArray视图的类型数组对象有以下几个:</p> 
<blockquote> 
 <p>Int8Array：8位有符号整数，长度1个字节。<br> Uint8Array：8位无符号整数，长度1个字节。<br> Uint8ClampedArray：8位无符号整数，长度1个字节，溢出处理不同。<br> Int16Array：16位有符号整数，长度2个字节。<br> Uint16Array：16位无符号整数，长度2个字节。<br> Int32Array：32位有符号整数，长度4个字节。<br> Uint32Array：32位无符号整数，长度4个字节。<br> Float32Array：32位浮点数，长度4个字节。<br> Float64Array：64位浮点数，长度8个字节。</p> 
</blockquote> 
<blockquote> 
 <p>Int8Array：1 个字节的有符号整数类型，范围在 -128 ~ 127 之间；<br> Uint8Array：1 个字节的无符号整数类型，范围在 0 ~ 255 之间；<br> Uint16Array：2 个字节的无符号整数类型，范围在 0 ~ 65535 之间；<br> Int16Array：2 个字节的有符号整数类型，范围在 -32768 ~ 32767 之间；<br> Uint32Array：4 个字节的无符号整数类型，范围在 0 ~ 4294967295 之间；<br> Float32Array：4 个字节的单精度浮点数类型；<br> Float64Array：8 个字节的双精度浮点数类型。</p> 
</blockquote> 
<p>DIV标签的 app-key 值</p> 
<pre><code>Uint32Array
[3854078970, 2917115795, 3887476043, 3350876132]

Uint8Array
[229, 184, 147, 250, 173, 223, 167, 147, 231, 182, 45, 75, 199, 186, 79, 228]
</code></pre> 
<p>加密key文件返回的是</p> 
<pre><code>Uint8Array
[128, 245, 244, 139, 212, 166, 215, 255, 208, 226, 106, 4, 240, 217, 14, 134]

hex
80f5f48bd4a6d7ffd0e26a04f0d90e86
</code></pre> 
<p>真实key</p> 
<pre><code>Uint8Array
[101, 77, 103, 113, 121, 121, 112, 108, 55, 84, 71, 79, 55, 99, 65, 98]

十六进制（hex）
654d67717979706c3754474f37634162

字符串
eMgqyypl7TGO7cAb
</code></pre> 
<h3><a id="Uint32Array___Uint8Array_351"></a>Uint32Array 转换 Uint8Array</h3> 
<pre><code class="prism language-javascript">
<span class="token keyword">let</span> uint32Arr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1902595429</span><span class="token punctuation">,</span> <span class="token number">1819310457</span><span class="token punctuation">,</span> <span class="token number">1330074679</span><span class="token punctuation">,</span> <span class="token number">1648452407</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  
<span class="token comment">// 创建新的Uint8Array，长度为Uint32Array的4倍  </span>
<span class="token keyword">let</span> uint8Arr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span>uint32Arr<span class="token punctuation">.</span>length <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  
<span class="token comment">// 遍历Uint32Array并转换每个元素为4个字节序列  </span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> uint32Arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
  <span class="token keyword">let</span> value <span class="token operator">=</span> uint32Arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>  
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
    <span class="token comment">// 将32位值右移8位（除以256），然后取低8位作为8位无符号整数  </span>
    uint8Arr<span class="token punctuation">[</span>i <span class="token operator">*</span> <span class="token number">4</span> <span class="token operator">+</span> j<span class="token punctuation">]</span> <span class="token operator">=</span> value <span class="token operator">&gt;&gt;</span> <span class="token number">8</span> <span class="token operator">*</span> j <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">;</span>  
  <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>  
  
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>uint8Arr<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出转换后的Uint8Array</span>
<span class="token comment">// [101, 77, 103, 113, 121, 121, 112, 108, 55, 84, 71, 79, 55, 99, 65, 98]</span>

</code></pre> 
<h3><a id="_Python_372"></a>纯算法 Python</h3> 
<pre><code class="prism language-python">
<span class="token keyword">def</span> <span class="token function">int_to_bytes</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 使用 '&gt;I' 表示大端序（Most Significant Byte First）的无符号整数格式</span>
    <span class="token keyword">return</span> n<span class="token punctuation">.</span>to_bytes<span class="token punctuation">(</span><span class="token punctuation">(</span>n<span class="token punctuation">.</span>bit_length<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">7</span><span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">'big'</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">decrypt</span><span class="token punctuation">(</span>app_key<span class="token punctuation">,</span>en_key<span class="token punctuation">)</span><span class="token punctuation">:</span>
    int_list <span class="token operator">=</span> app_key
    byte_list <span class="token operator">=</span> <span class="token punctuation">[</span>int_to_bytes<span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> int_list<span class="token punctuation">]</span>
    app_key <span class="token operator">=</span> <span class="token string">b''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>byte_list<span class="token punctuation">)</span>
    <span class="token comment"># app_key = bytes([229, 184, 147, 250, 173, 223, 167, 147, 231, 182, 45, 75, 199, 186, 79, 228])</span>
    <span class="token comment"># print(list(app_key))</span>

    <span class="token comment"># 对每个字节进行异或操作</span>
    app_key_xor <span class="token operator">=</span> <span class="token builtin">bytes</span><span class="token punctuation">(</span><span class="token punctuation">[</span>app_key<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">^</span> en_key<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>app_key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> app_key_xor


app_key <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">3854078970</span><span class="token punctuation">,</span> <span class="token number">2917115795</span><span class="token punctuation">,</span> <span class="token number">3887476043</span><span class="token punctuation">,</span> <span class="token number">3350876132</span><span class="token punctuation">]</span>
en_key <span class="token operator">=</span> <span class="token builtin">bytes</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">245</span><span class="token punctuation">,</span> <span class="token number">244</span><span class="token punctuation">,</span> <span class="token number">139</span><span class="token punctuation">,</span> <span class="token number">212</span><span class="token punctuation">,</span> <span class="token number">166</span><span class="token punctuation">,</span> <span class="token number">215</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">208</span><span class="token punctuation">,</span> <span class="token number">226</span><span class="token punctuation">,</span> <span class="token number">106</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">240</span><span class="token punctuation">,</span> <span class="token number">217</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">134</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

ok <span class="token operator">=</span> decrypt<span class="token punctuation">(</span>app_key<span class="token punctuation">,</span>en_key<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>ok<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span>ok<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>ok<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">'eMgqyypl7TGO7cAb'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>ok<span class="token punctuation">.</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">'654d67717979706c3754474f37634162'</span><span class="token punctuation">)</span>

</code></pre> 
<p><img src="https://images2.imgbox.com/fd/e1/VG8HUMVj_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/dd921bf4dc2554f245679d9772401f19/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">掌握layui.xmSelect：打造高效、美观的下拉选择框</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/374a695436d14a3c39687801363532f1/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">ffmpeg的基本功能介绍</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>