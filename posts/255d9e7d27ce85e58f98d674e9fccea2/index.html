<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【Amis Low Code 结合FastAPI进行前端框架开发】 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【Amis Low Code 结合FastAPI进行前端框架开发】" />
<meta property="og:description" content="官方文档
封装思想 直接复制官网json数据即可开发每个json中的接口由fastapi 转发（透传）使其开发模式与前端思维一致 基础组件 from amis import Page, Service, App from pydantic import BaseModel, Field from fastapi import FastAPI, Request, Response, APIRouter from starlette.responses import HTMLResponse class JsonRegister(BaseModel): page_json_url: str = &#34;/demo.json&#34; def __init__(self, **kwargs): super(JsonRegister, self).__init__(**kwargs) def register(self, router: APIRouter): router.add_api_route(self.page_json_url, endpoint=self.json) def json(self) -&gt; {}: &#34;&#34;&#34;amis json格式数据&#34;&#34;&#34; return {} class HtmlRegister(BaseModel): page_url = &#34;/&#34; def __init__(self, **kwargs): super(HtmlRegister, self).__init__(**kwargs) def register(self, router: APIRouter): router.add_api_route(self.page_url, endpoint=self.html) def html(self): &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/255d9e7d27ce85e58f98d674e9fccea2/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-09T19:58:07+08:00" />
<meta property="article:modified_time" content="2023-12-09T19:58:07+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【Amis Low Code 结合FastAPI进行前端框架开发】</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><a href="https://aisuda.bce.baidu.com/amis/zh-CN/docs/index" rel="nofollow">官方文档</a></p> 
<h2><a id="_2"></a>封装思想</h2> 
<ul><li>直接复制官网<code>json</code>数据即可开发</li><li>每个<code>json</code>中的接口由<code>fastapi</code> 转发（透传）使其开发模式与前端思维一致</li></ul> 
<h2><a id="_6"></a>基础组件</h2> 
<pre><code class="prism language-python"><span class="token keyword">from</span> amis <span class="token keyword">import</span> Page<span class="token punctuation">,</span> Service<span class="token punctuation">,</span> App
<span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel<span class="token punctuation">,</span> Field
<span class="token keyword">from</span> fastapi <span class="token keyword">import</span> FastAPI<span class="token punctuation">,</span> Request<span class="token punctuation">,</span> Response<span class="token punctuation">,</span> APIRouter
<span class="token keyword">from</span> starlette<span class="token punctuation">.</span>responses <span class="token keyword">import</span> HTMLResponse


<span class="token keyword">class</span> <span class="token class-name">JsonRegister</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
    page_json_url<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> <span class="token string">"/demo.json"</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>JsonRegister<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">register</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> router<span class="token punctuation">:</span> APIRouter<span class="token punctuation">)</span><span class="token punctuation">:</span>
        router<span class="token punctuation">.</span>add_api_route<span class="token punctuation">(</span>self<span class="token punctuation">.</span>page_json_url<span class="token punctuation">,</span> endpoint<span class="token operator">=</span>self<span class="token punctuation">.</span>json<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">json</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""amis json格式数据"""</span>
        <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>


<span class="token keyword">class</span> <span class="token class-name">HtmlRegister</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
    page_url <span class="token operator">=</span> <span class="token string">"/"</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>HtmlRegister<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">register</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> router<span class="token punctuation">:</span> APIRouter<span class="token punctuation">)</span><span class="token punctuation">:</span>
        router<span class="token punctuation">.</span>add_api_route<span class="token punctuation">(</span>self<span class="token punctuation">.</span>page_url<span class="token punctuation">,</span> endpoint<span class="token operator">=</span>self<span class="token punctuation">.</span>html<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">html</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""渲染html页面"""</span>
        <span class="token keyword">return</span> HTMLResponse<span class="token punctuation">(</span>content<span class="token operator">=</span>Page<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">TableRegister</span><span class="token punctuation">(</span>JsonRegister<span class="token punctuation">)</span><span class="token punctuation">:</span>
    base_url <span class="token operator">=</span> <span class="token string">"/crud/"</span>
    primary_key <span class="token operator">=</span> <span class="token string">"id"</span>
    page_json_url <span class="token operator">=</span> <span class="token string">"/curd/model.json"</span>

    primary_key_url <span class="token operator">=</span> <span class="token string">""</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>TableRegister<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">register</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> router<span class="token punctuation">:</span> APIRouter<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>TableRegister<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>register<span class="token punctuation">(</span>router<span class="token operator">=</span>router<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>primary_key_url <span class="token operator">=</span> self<span class="token punctuation">.</span>base_url <span class="token operator">+</span> <span class="token string">"{"</span> <span class="token operator">+</span> self<span class="token punctuation">.</span>primary_key <span class="token operator">+</span> <span class="token string">"}"</span>
        router<span class="token punctuation">.</span>add_api_route<span class="token punctuation">(</span>self<span class="token punctuation">.</span>primary_key_url<span class="token punctuation">,</span> endpoint<span class="token operator">=</span>self<span class="token punctuation">.</span>get_item<span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"GET"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        router<span class="token punctuation">.</span>add_api_route<span class="token punctuation">(</span>self<span class="token punctuation">.</span>primary_key_url<span class="token punctuation">,</span> endpoint<span class="token operator">=</span>self<span class="token punctuation">.</span>delete_item<span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"DELETE"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        router<span class="token punctuation">.</span>add_api_route<span class="token punctuation">(</span>self<span class="token punctuation">.</span>primary_key_url<span class="token punctuation">,</span> endpoint<span class="token operator">=</span>self<span class="token punctuation">.</span>put_item<span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"PUT"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        router<span class="token punctuation">.</span>add_api_route<span class="token punctuation">(</span>self<span class="token punctuation">.</span>primary_key_url<span class="token punctuation">,</span> endpoint<span class="token operator">=</span>self<span class="token punctuation">.</span>options_item<span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"OPTIONS"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        router<span class="token punctuation">.</span>add_api_route<span class="token punctuation">(</span>self<span class="token punctuation">.</span>base_url<span class="token punctuation">,</span> endpoint<span class="token operator">=</span>self<span class="token punctuation">.</span>get_items<span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"GET"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        router<span class="token punctuation">.</span>add_api_route<span class="token punctuation">(</span>self<span class="token punctuation">.</span>base_url<span class="token punctuation">,</span> endpoint<span class="token operator">=</span>self<span class="token punctuation">.</span>post_item<span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"POST"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">get_item</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">:</span> Request<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

    <span class="token keyword">def</span> <span class="token function">delete_item</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">:</span> Request<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

    <span class="token keyword">def</span> <span class="token function">put_item</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">:</span> Request<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

    <span class="token keyword">def</span> <span class="token function">options_item</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">:</span> Request<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

    <span class="token keyword">def</span> <span class="token function">get_items</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">:</span> Request<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">post_item</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">:</span> Request<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
</code></pre> 
<ul><li>上诉组件中定义</li><li>json格式注册器</li><li>html页面注册器</li><li>表格增删改查注册器</li></ul> 
<h2><a id="_85"></a>常见业务功能组件封装</h2> 
<pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">RouterJson</span><span class="token punctuation">(</span>JsonRegister<span class="token punctuation">)</span><span class="token punctuation">:</span>
    page_json_url <span class="token operator">=</span> <span class="token string">"/router.json"</span>
    children_pages <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token string">"label"</span><span class="token punctuation">:</span> <span class="token string">"父页面"</span><span class="token punctuation">,</span>
            <span class="token string">"url"</span><span class="token punctuation">:</span> <span class="token string">"/parent"</span><span class="token punctuation">,</span>
            <span class="token string">"redirect"</span><span class="token punctuation">:</span> <span class="token string">"/parent/pageA"</span><span class="token punctuation">,</span>
            <span class="token string">"children"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token string">"label"</span><span class="token punctuation">:</span> <span class="token string">"子页面"</span><span class="token punctuation">,</span>
                    <span class="token string">"url"</span><span class="token punctuation">:</span> <span class="token string">"pageA"</span><span class="token punctuation">,</span>
                    <span class="token string">"schemaApi"</span><span class="token punctuation">:</span> <span class="token string">"get:/pages/crud-list.json"</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token string">"label"</span><span class="token punctuation">:</span> <span class="token string">"子页面"</span><span class="token punctuation">,</span>
                    <span class="token string">"url"</span><span class="token punctuation">:</span> <span class="token string">"pageB"</span><span class="token punctuation">,</span>
                    <span class="token string">"schemaApi"</span><span class="token punctuation">:</span> <span class="token string">"get:/pages/crud-list.json"</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">json</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"status"</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token string">"msg"</span><span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
            <span class="token string">"data"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string">"pages"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token string">"children"</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>children_pages
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>


<span class="token keyword">class</span> <span class="token class-name">AppAdminHtml</span><span class="token punctuation">(</span>HtmlRegister<span class="token punctuation">)</span><span class="token punctuation">:</span>
    web_url<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> <span class="token string">"/"</span>
    <span class="token triple-quoted-string string">"""获取静态页面地址"""</span>
    app_brandName <span class="token operator">=</span> <span class="token string">"测试Demo"</span>
    router_json<span class="token punctuation">:</span> RouterJson <span class="token operator">=</span> RouterJson<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">html</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        app_ <span class="token operator">=</span> App<span class="token punctuation">(</span><span class="token punctuation">)</span>
        app_<span class="token punctuation">.</span>brandName <span class="token operator">=</span> <span class="token string">"测试Demo"</span>
        app_<span class="token punctuation">.</span>api <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"get:</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>self<span class="token punctuation">.</span>router_json<span class="token punctuation">.</span>page_json_url<span class="token punctuation">}</span></span><span class="token string">"</span></span>
        <span class="token keyword">return</span> HTMLResponse<span class="token punctuation">(</span>app_<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">ModelAdminJson</span><span class="token punctuation">(</span>TableRegister<span class="token punctuation">)</span><span class="token punctuation">:</span>
    base_url <span class="token operator">=</span> <span class="token string">"/crud/"</span>
    primary_key <span class="token operator">=</span> <span class="token string">"id"</span>
    page_json_url <span class="token operator">=</span> <span class="token string">"/curd/model.json"</span>

    <span class="token keyword">def</span> <span class="token function">get_item</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">:</span> Request<span class="token punctuation">)</span><span class="token punctuation">:</span>
        id_ <span class="token operator">=</span> request<span class="token punctuation">.</span>get<span class="token punctuation">(</span>self<span class="token punctuation">.</span>primary_key<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span><span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"mock data"</span><span class="token punctuation">,</span> <span class="token string">"id"</span><span class="token punctuation">:</span> id_<span class="token punctuation">}</span>

    <span class="token keyword">def</span> <span class="token function">delete_item</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">:</span> Request<span class="token punctuation">)</span><span class="token punctuation">:</span>
        id_ <span class="token operator">=</span> request<span class="token punctuation">.</span>get<span class="token punctuation">(</span>self<span class="token punctuation">.</span>primary_key<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span><span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"mock data"</span><span class="token punctuation">,</span> <span class="token string">"id"</span><span class="token punctuation">:</span> id_<span class="token punctuation">}</span>

    <span class="token keyword">def</span> <span class="token function">put_item</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">:</span> Request<span class="token punctuation">)</span><span class="token punctuation">:</span>
        id_ <span class="token operator">=</span> request<span class="token punctuation">.</span>get<span class="token punctuation">(</span>self<span class="token punctuation">.</span>primary_key<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span><span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"mock data"</span><span class="token punctuation">,</span> <span class="token string">"id"</span><span class="token punctuation">:</span> id_<span class="token punctuation">}</span>

    <span class="token keyword">def</span> <span class="token function">options_item</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">:</span> Request<span class="token punctuation">)</span><span class="token punctuation">:</span>
        id_ <span class="token operator">=</span> request<span class="token punctuation">.</span>get<span class="token punctuation">(</span>self<span class="token punctuation">.</span>primary_key<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span><span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"mock data"</span><span class="token punctuation">,</span> <span class="token string">"id"</span><span class="token punctuation">:</span> id_<span class="token punctuation">}</span>

    <span class="token keyword">def</span> <span class="token function">get_items</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">:</span> Request<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"mock data </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>id_<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">,</span> <span class="token string">"id"</span><span class="token punctuation">:</span> id_<span class="token punctuation">}</span> <span class="token keyword">for</span> id_ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">post_item</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">:</span> Request<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span><span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"mock data"</span><span class="token punctuation">,</span> <span class="token string">"id"</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">}</span>


<span class="token keyword">class</span> <span class="token class-name">LoginJson</span><span class="token punctuation">(</span>JsonRegister<span class="token punctuation">)</span><span class="token punctuation">:</span>
    page_json_url<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> <span class="token string">"/login.json"</span>
    <span class="token triple-quoted-string string">"""获取json配置接口地址"""</span>
    title<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> <span class="token string">""</span>
    <span class="token triple-quoted-string string">"""标题"""</span>
    success_redirect_url <span class="token operator">=</span> <span class="token string">"/"</span>
    <span class="token triple-quoted-string string">"""成功登陆后的重定向地址"""</span>
    login_params <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"url"</span><span class="token punctuation">:</span> <span class="token string">"${serverUrl}/login/"</span><span class="token punctuation">,</span>
        <span class="token string">"method"</span><span class="token punctuation">:</span> <span class="token string">"post"</span><span class="token punctuation">,</span>
        <span class="token string">"dataType"</span><span class="token punctuation">:</span> <span class="token string">"form-data"</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">def</span> <span class="token function">register</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> router<span class="token punctuation">:</span> APIRouter<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>LoginJson<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>register<span class="token punctuation">(</span>router<span class="token operator">=</span>router<span class="token punctuation">)</span>
        router<span class="token punctuation">.</span>add_api_route<span class="token punctuation">(</span><span class="token string">"/login/"</span><span class="token punctuation">,</span> endpoint<span class="token operator">=</span>self<span class="token punctuation">.</span>post_item<span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"POST"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">post_item</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">:</span> Request<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span><span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"mock data"</span><span class="token punctuation">,</span> <span class="token string">"id"</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">}</span>

    <span class="token keyword">def</span> <span class="token function">json</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> Page<span class="token punctuation">(</span><span class="token operator">**</span><span class="token punctuation">{<!-- --></span>
            <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"page"</span><span class="token punctuation">,</span>
            <span class="token string">"title"</span><span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
            <span class="token string">"style"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string">"backgroundImage"</span><span class="token punctuation">:</span> <span class="token string">"linear-gradient(180deg, #86a4e9, transparent)"</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token string">"cssVars"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string">"--Form-input-onFocused-borderColor"</span><span class="token punctuation">:</span> <span class="token string">"#e8e9eb"</span><span class="token punctuation">,</span>
                <span class="token string">"--Form-input-onHover-borderColor"</span><span class="token punctuation">:</span> <span class="token string">"#e8e9eb"</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token string">"body"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"grid-2d"</span><span class="token punctuation">,</span>
                <span class="token string">"cols"</span><span class="token punctuation">:</span> <span class="token number">12</span><span class="token punctuation">,</span>
                <span class="token string">"grids"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
                    <span class="token punctuation">{<!-- --></span>
                        <span class="token string">"x"</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
                        <span class="token string">"y"</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
                        <span class="token string">"h"</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
                        <span class="token string">"w"</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
                        <span class="token string">"width"</span><span class="token punctuation">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
                        <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"form"</span><span class="token punctuation">,</span>
                        <span class="token string">"mode"</span><span class="token punctuation">:</span> <span class="token string">"horizontal"</span><span class="token punctuation">,</span>
                        <span class="token string">"title"</span><span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
                        <span class="token string">"api"</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>login_params<span class="token punctuation">,</span>
                        <span class="token string">"panelClassName"</span><span class="token punctuation">:</span> <span class="token string">"p-r p-l p-b-md"</span><span class="token punctuation">,</span>
                        <span class="token string">"redirect"</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>success_redirect_url<span class="token punctuation">,</span>
                        <span class="token string">"body"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
                            <span class="token punctuation">{<!-- --></span>
                                <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"tpl"</span><span class="token punctuation">,</span>
                                <span class="token string">"tpl"</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"&lt;div style='text-align: center; font-weight: bold;'&gt;&lt;p&gt;</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>self<span class="token punctuation">.</span>title<span class="token punctuation">}</span></span><span class="token string">&lt;/p&gt;&lt;/div&gt;"</span></span>
                            <span class="token punctuation">}</span><span class="token punctuation">,</span>
                            <span class="token punctuation">{<!-- --></span>
                                <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"input-text"</span><span class="token punctuation">,</span>
                                <span class="token string">"label"</span><span class="token punctuation">:</span> <span class="token boolean">False</span><span class="token punctuation">,</span>
                                <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"userName"</span><span class="token punctuation">,</span>
                                <span class="token string">"size"</span><span class="token punctuation">:</span> <span class="token string">"full"</span><span class="token punctuation">,</span>
                                <span class="token string">"placeholder"</span><span class="token punctuation">:</span> <span class="token string">"登陆名"</span><span class="token punctuation">,</span>
                                <span class="token string">"addOn"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
                                    <span class="token string">"label"</span><span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
                                    <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span>
                                    <span class="token string">"position"</span><span class="token punctuation">:</span> <span class="token string">"left"</span><span class="token punctuation">,</span>
                                    <span class="token string">"icon"</span><span class="token punctuation">:</span> <span class="token string">"fa fa-user"</span>
                                <span class="token punctuation">}</span>
                            <span class="token punctuation">}</span><span class="token punctuation">,</span>
                            <span class="token punctuation">{<!-- --></span>
                                <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"input-password"</span><span class="token punctuation">,</span>
                                <span class="token string">"label"</span><span class="token punctuation">:</span> <span class="token boolean">False</span><span class="token punctuation">,</span>
                                <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"password"</span><span class="token punctuation">,</span>
                                <span class="token string">"size"</span><span class="token punctuation">:</span> <span class="token string">"full"</span><span class="token punctuation">,</span>
                                <span class="token string">"placeholder"</span><span class="token punctuation">:</span> <span class="token string">"密码"</span><span class="token punctuation">,</span>
                                <span class="token string">"addOn"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
                                    <span class="token string">"label"</span><span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
                                    <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span>
                                    <span class="token string">"position"</span><span class="token punctuation">:</span> <span class="token string">"left"</span><span class="token punctuation">,</span>
                                    <span class="token string">"icon"</span><span class="token punctuation">:</span> <span class="token string">"fa fa-lock"</span>
                                <span class="token punctuation">}</span>
                            <span class="token punctuation">}</span><span class="token punctuation">,</span>
                            <span class="token punctuation">{<!-- --></span>
                                <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"checkbox"</span><span class="token punctuation">,</span>
                                <span class="token string">"label"</span><span class="token punctuation">:</span> <span class="token boolean">False</span><span class="token punctuation">,</span>
                                <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"record"</span><span class="token punctuation">,</span>
                                <span class="token string">"option"</span><span class="token punctuation">:</span> <span class="token string">"记住密码"</span>
                            <span class="token punctuation">}</span><span class="token punctuation">,</span>
                            <span class="token punctuation">{<!-- --></span>
                                <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"control"</span><span class="token punctuation">,</span>
                                <span class="token string">"label"</span><span class="token punctuation">:</span> <span class="token boolean">False</span><span class="token punctuation">,</span>
                                <span class="token string">"body"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
                                    <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"button"</span><span class="token punctuation">,</span>
                                    <span class="token string">"level"</span><span class="token punctuation">:</span> <span class="token string">"primary"</span><span class="token punctuation">,</span>
                                    <span class="token string">"actionType"</span><span class="token punctuation">:</span> <span class="token string">"submit"</span><span class="token punctuation">,</span>
                                    <span class="token string">"block"</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span>
                                    <span class="token string">"label"</span><span class="token punctuation">:</span> <span class="token string">"登陆"</span><span class="token punctuation">,</span>
                                    <span class="token string">"size"</span><span class="token punctuation">:</span> <span class="token string">"lg"</span>
                                <span class="token punctuation">}</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">]</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to_dict<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">LoginHtml</span><span class="token punctuation">(</span>HtmlRegister<span class="token punctuation">)</span><span class="token punctuation">:</span>
    page_url<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> <span class="token string">"/login"</span>
    <span class="token triple-quoted-string string">"""获取静态页面地址"""</span>
    login_json<span class="token punctuation">:</span> LoginJson <span class="token operator">=</span> LoginJson<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">html</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> HTMLResponse<span class="token punctuation">(</span>Page<span class="token punctuation">(</span>body<span class="token operator">=</span>Service<span class="token punctuation">(</span>schemaApi<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f"get:</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>self<span class="token punctuation">.</span>login_json<span class="token punctuation">.</span>page_json_url<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<h2><a id="_273"></a>启动运行</h2> 
<pre><code class="prism language-python"><span class="token keyword">import</span> json
<span class="token keyword">import</span> re

<span class="token keyword">from</span> fastapi <span class="token keyword">import</span> FastAPI<span class="token punctuation">,</span> Request<span class="token punctuation">,</span> APIRouter
<span class="token keyword">from</span> default_template <span class="token keyword">import</span> <span class="token operator">*</span>

app <span class="token operator">=</span> FastAPI<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">main_router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    router <span class="token operator">=</span> APIRouter<span class="token punctuation">(</span><span class="token punctuation">)</span>

    login_json <span class="token operator">=</span> LoginJson<span class="token punctuation">(</span><span class="token punctuation">)</span>
    login_json<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">"欢迎登录"</span>
    login_json<span class="token punctuation">.</span>success_redirect_url <span class="token operator">=</span> <span class="token string">"/#/home"</span>
    login_json<span class="token punctuation">.</span>register<span class="token punctuation">(</span>router<span class="token operator">=</span>router<span class="token punctuation">)</span>
    <span class="token triple-quoted-string string">"""登录json"""</span>
    router_json <span class="token operator">=</span> RouterJson<span class="token punctuation">(</span><span class="token punctuation">)</span>
    router_json<span class="token punctuation">.</span>children_pages <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token string">"label"</span><span class="token punctuation">:</span> <span class="token string">"首页"</span><span class="token punctuation">,</span>
            <span class="token string">"url"</span><span class="token punctuation">:</span> <span class="token string">"/home"</span><span class="token punctuation">,</span>
            <span class="token string">"schema"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"markdown"</span><span class="token punctuation">,</span>
                <span class="token string">"value"</span><span class="token punctuation">:</span> <span class="token string">"# title\n markdown **text**"</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token string">"label"</span><span class="token punctuation">:</span> <span class="token string">"测试页面"</span><span class="token punctuation">,</span>
            <span class="token string">"url"</span><span class="token punctuation">:</span> <span class="token string">"/parent"</span><span class="token punctuation">,</span>
            <span class="token string">"redirect"</span><span class="token punctuation">:</span> <span class="token string">"/parent/pageA"</span><span class="token punctuation">,</span>
            <span class="token string">"children"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token string">"label"</span><span class="token punctuation">:</span> <span class="token string">"测试页面1"</span><span class="token punctuation">,</span>
                    <span class="token string">"url"</span><span class="token punctuation">:</span> <span class="token string">"pageA"</span><span class="token punctuation">,</span>
                    <span class="token string">"schemaApi"</span><span class="token punctuation">:</span> <span class="token string">"get:/pages/crud-list.json"</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token string">"label"</span><span class="token punctuation">:</span> <span class="token string">"测试页面2"</span><span class="token punctuation">,</span>
                    <span class="token string">"url"</span><span class="token punctuation">:</span> <span class="token string">"pageB"</span><span class="token punctuation">,</span>
                    <span class="token string">"schemaApi"</span><span class="token punctuation">:</span> <span class="token string">"get:/pages/crud-list.json"</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
    router_json<span class="token punctuation">.</span>register<span class="token punctuation">(</span>router<span class="token operator">=</span>router<span class="token punctuation">)</span>
    <span class="token triple-quoted-string string">"""路由json"""</span>

    login_html <span class="token operator">=</span> LoginHtml<span class="token punctuation">(</span><span class="token punctuation">)</span>
    login_html<span class="token punctuation">.</span>login_json <span class="token operator">=</span> login_json
    login_html<span class="token punctuation">.</span>register<span class="token punctuation">(</span>router<span class="token operator">=</span>router<span class="token punctuation">)</span>
    <span class="token triple-quoted-string string">"""登录页面"""</span>
    app_admin_html <span class="token operator">=</span> AppAdminHtml<span class="token punctuation">(</span><span class="token punctuation">)</span>
    app_admin_html<span class="token punctuation">.</span>app_brandName <span class="token operator">=</span> <span class="token string">"测试应用"</span>
    app_admin_html<span class="token punctuation">.</span>router_json <span class="token operator">=</span> router_json
    app_admin_html<span class="token punctuation">.</span>register<span class="token punctuation">(</span>router<span class="token operator">=</span>router<span class="token punctuation">)</span>
    <span class="token triple-quoted-string string">"""后台页面"""</span>
    <span class="token keyword">return</span> router


app<span class="token punctuation">.</span>include_router<span class="token punctuation">(</span>main_router<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    <span class="token keyword">import</span> uvicorn

    uvicorn<span class="token punctuation">.</span>run<span class="token punctuation">(</span>app<span class="token punctuation">,</span> host<span class="token operator">=</span><span class="token string">"0.0.0.0"</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">9000</span><span class="token punctuation">)</span>

</code></pre> 
<ul><li>可以知道当下页面中有登录界面，后台页面</li><li>业务中的所有json 页面接口都可以先行注册，再注册静态页面</li></ul> 
<p><img src="https://images2.imgbox.com/e4/7e/LTIhbJk9_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/e8/1b/fV881Lkj_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a3e9cbc4de94b7dd7e43661d461aae2f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">如何自动筛选高质量的指令微调数据喂给大模型？</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/fa8383ddbab3f1a6203d14ed11727637/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">TCP拥塞控制</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>