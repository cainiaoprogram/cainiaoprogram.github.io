<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>使用iServer JAVA API访问iServer空间分析服务进行叠加分析示例 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="使用iServer JAVA API访问iServer空间分析服务进行叠加分析示例" />
<meta property="og:description" content="作者：MR
之前一篇博客（SuperMap iServer JAVA API介绍）介绍了SuperMap iServer Java API（以下简称Java API）用处、用法，本篇介绍JAVA API访问iServer空间分析服务进行叠加分析的具体应用，并提供工程源码下载。作为示例，这里使用eclipse创建一个控制台应用。
###一、创建JAVA工程&amp;主类
创建一个Java工程，工程下新建lib文件夹，复制%iServerROOT%\WEB-INF\lib\iserver-all-8.1.1-14511.jar到lib文件夹里，并将lib文件夹下的iserver-all-8.1.1-14511.jar右键添加到Build Path里。
本文新建一个包，命名spatialAnalystSample，其下创建一个类，命名SpatialAnalystSample，添加main方法。工程结构如图（JDK1.8）：
###二、获取空间服务提供者
本文访问的空间分析服务REST资源根目录如下：
http://support.supermap.com.cn:8090/iserver/services/spatialanalyst-changchun/restjsr 创建/释放RestSpatialAnalystProvider方法如下：
/** * @param RootURL * 空间分许服务REST资源根目录 * @return RestSpatialAnalystProvider */ private static RestSpatialAnalystProvider getAnalystProvider( String rootURL ) { // 服务提供者设置 RestSpatialAnalystProviderSetting setting = new RestSpatialAnalystProviderSetting( ); setting.restServiceRootURL = rootURL; // 创建服务提供者 return new RestSpatialAnalystProvider( setting ); } /** * @param provider * 待释放资源的服务提供者对象 */ private static void dispose( RestSpatialAnalystProvider provider ) { if ( provider !" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/cb4e62e7357070b7ede8d976b52b385d/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2017-05-05T08:25:51+08:00" />
<meta property="article:modified_time" content="2017-05-05T08:25:51+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">使用iServer JAVA API访问iServer空间分析服务进行叠加分析示例</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <blockquote> 
 <p>作者：MR</p> 
</blockquote> 
<p>    之前一篇博客（<a href="http://blog.csdn.net/supermapsupport/article/details/70171593">SuperMap iServer JAVA API介绍</a>）介绍了SuperMap iServer Java API（以下简称Java API）用处、用法，本篇介绍JAVA API访问iServer空间分析服务进行叠加分析的具体应用，并提供工程源码下载。作为示例，这里使用eclipse创建一个控制台应用。</p> 
<p>###一、创建JAVA工程&amp;主类</p> 
<p>    创建一个Java工程，工程下新建<strong>lib</strong>文件夹，复制<code>%iServerROOT%\WEB-INF\lib\iserver-all-8.1.1-14511.jar</code>到lib文件夹里，并将lib文件夹下的<strong>iserver-all-8.1.1-14511.jar</strong>右键添加到<strong>Build Path</strong>里。<br>     本文新建一个包，命名<code>spatialAnalystSample</code>，其下创建一个类，命名<code>SpatialAnalystSample</code>，添加<code>main</code>方法。工程结构如图（JDK1.8）：</p> 
<p><img src="https://images2.imgbox.com/b2/06/skP7LHaN_o.png" alt="工程"></p> 
<p>###二、获取空间服务提供者</p> 
<p>    本文访问的空间分析服务REST资源根目录如下：</p> 
<pre><code class="prism language-URL">http://support.supermap.com.cn:8090/iserver/services/spatialanalyst-changchun/restjsr
</code></pre> 
<p>    创建/释放<code>RestSpatialAnalystProvider</code>方法如下：</p> 
<pre><code class="prism language-JAVA">	/**
	 * @param RootURL
	 *            空间分许服务REST资源根目录
	 * @return RestSpatialAnalystProvider
	 */
	private static RestSpatialAnalystProvider getAnalystProvider( String rootURL )
	{
		// 服务提供者设置
		RestSpatialAnalystProviderSetting setting = new RestSpatialAnalystProviderSetting( );
		setting.restServiceRootURL = rootURL;
		// 创建服务提供者
		return new RestSpatialAnalystProvider( setting );
	}

	/**
	 * @param provider
	 *            待释放资源的服务提供者对象
	 */
	private static void dispose( RestSpatialAnalystProvider provider )
	{
		if ( provider != null )
		{
			provider.clearCache( );
			provider.dispose( );
		}
	}
</code></pre> 
<p>     <code>RestSpatialAnalystProvider</code>类参考最新在线地址<a href="http://support.supermap.com.cn:8090/iserver/help/html/mergedProjects/iServerJavadoc/com/supermap/services/providers/RestSpatialAnalystProvider.html" rel="nofollow">如下</a>（建议使用<a href="http://support.supermap.com.cn/product/iServer.aspx" rel="nofollow">CHM格式</a>）：</p> 
<pre><code class="prism language-URL">http://support.supermap.com.cn:8090/iserver/help/html/mergedProjects/iServerJavadoc/com/supermap/services/providers/RestSpatialAnalystProvider.html
</code></pre> 
<p>###三、业务逻辑实现</p> 
<p>    接下来就可以使用服务提供者对象提供的方法实现各种业务逻辑了，本文实现对两个数据集里满足指定条件的要素<strong>求交集</strong>。<code>main</code>方法如下：</p> 
<pre><code class="prism language-JAVA">	private static final String SPASURL = "http://support.supermap.com.cn:8090/iserver/services/spatialanalyst-changchun/restjsr";

	/**
	 * @param args
	 */
	public static void main( String[ ] args )
	{
		long start = System.currentTimeMillis( );
		RestSpatialAnalystProvider spatialProvider = getAnalystProvider( SPASURL );
		// 设置分析的结果
		DataReturnOption option = new DataReturnOption( );
		option.dataReturnMode = DataReturnMode.DATASET_AND_RECORDSET;// 设置数据返回模式：l另存数据集和返回记录集对象
		option.dataset = "analystTemp"; // 结果保存到的数据集名称
		option.deleteExistResultDataset = true;// 如果analystTemp与已有的数据集重名，删除已有的数据集
		option.expectCount = 0; // 返回所有记录

		DatasetOverlayResultSetting setting = new DatasetOverlayResultSetting( ); // 数据集叠加分析结果设置类
		setting.dataReturnOption = option;
		// 指定返回结果的保留字段
		setting.sourceDatasetFields = new String[ ] { "name", "x", "y" };
		setting.operateDatasetFields = new String[ ] { "ClassID" };

		// 查询条件
		QueryParameter sourceQueryParameter = new QueryParameter( );// 数据集的查询参数
		sourceQueryParameter.name = "Park"; // 指定要查询的数据集
		sourceQueryParameter.attributeFilter = "SmID&gt;0"; // 指定数据集的查询条件

		QueryParameter operateQueryParameter = new QueryParameter( );// 数据集的查询参数
		operateQueryParameter.name = "Frame_R";// 指定要叠加的数据集
		operateQueryParameter.attributeFilter = "SmID&gt;0"; // 指定数据集的查询条件

		// 获取和处理结果
		// 数据集空间分析结果类 取得2数据集相交的结果
		DatasetSpatialAnalystResult intersectResult = spatialProvider.intersect( "Park@Changchun", sourceQueryParameter,
				"Frame_R@Changchun", operateQueryParameter, setting );// 获取叠加分析结果
		if ( intersectResult.succeed )
		{
			System.out.println( "叠加分析成功，返回结果数为：" + intersectResult.recordset.features.length );

			System.out.println( "返回的结果数据集字段如下：" );
			for ( String field : intersectResult.recordset.fields )
			{
				System.out.println( field );
			}
		} else
		{
			System.out.println( "叠加分析失败！" );
		}

		System.out.println( "done,cost:" + ( System.currentTimeMillis( ) - start ) );
		dispose( spatialProvider );
	}
</code></pre> 
<p>    运行时会有报错<code>java.lang.NoClassdeFoundError</code>，这是因为我们虽然都只使用了<code>iserver-all-8.1.1-14511.jar</code>包里的方法，但是该包还会<strong>import</strong>别的包，所以编译没错，运行时就会报错了，目前暂无便捷的依赖管理工具去自动列出需要的依赖项，只能手动和根据报错添加依赖的包；反编译查看<code>import</code>也不是很好用，需要反编译你使用的类，找到它的依赖、依赖的依赖…，所以本文建议排除法，JAVA API所有的依赖都在<code>%iServerROOT%\WEB-INF\lib</code>目录下，把这些jar包<strong>都加到Build Path</strong>就行了，并且，已知<strong>本文使用的方法不涉及SuperMap iObjects Java</strong>，所以可以去掉<code>com.supermap</code>开头的(即Java组件的)的jar包，也不需要配置Java组件环境，剩下的jar先通过文件名排除一部分，然后一个一个去掉看运行结果来排除剩下的。</p> 
<p>###结果</p> 
<p><img src="https://images2.imgbox.com/ac/02/B9RKc9Ta_o.png" alt="结果1"></p> 
<p><img src="https://images2.imgbox.com/29/e2/Uz5RBKXG_o.png" alt="结果2"></p> 
<p><img src="https://images2.imgbox.com/a6/79/f9XaSfft_o.png" alt="结果3"></p> 
<p>###其他&amp;下载<br>     可以输出工程为jar，使用java命令运行（可以写成批处理脚本或shell脚本）即可，本文不再介绍。<br>     排除无用jar包后的工程如下，使用eclipse打开工程即可运行查看结果。</p> 
<blockquote> 
 <p><a href="http://download.csdn.net/detail/supermapsupport/9833942">使用iServer JAVA API访问iServer空间分析服务进行叠加分析示例工程</a><br> <a href="http://download.csdn.net/detail/supermapsupport/9833942">http://download.csdn.net/detail/supermapsupport/9833942</a></p> 
</blockquote>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f2f4e5847b02de4f12f1caf7d3f26d3d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">opencv 图像傅里叶变换</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/0d2b18485928e0391cc3ea89022ad137/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">python：使用scipy求解常微分方程</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>