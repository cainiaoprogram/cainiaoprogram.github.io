<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>DrGraph原理示教 - OpenCV 4 功能 - 直方图 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="DrGraph原理示教 - OpenCV 4 功能 - 直方图" />
<meta property="og:description" content="OpenCV直方图是一种可以对整幅图的灰度分布进行整体了解的图示。它是带有像素值（从0到255，不总是）的图在X轴上，在y轴上的图像对应的像素个数。通过观察图像的直方图，我们可以直观的了解图像的对比度、亮度、亮度分布等。
在直方图中，横坐标表示图像中各个像素点的灰度级，纵坐标表示具有该灰度级的像素个数。直方图的左边部分显示了图像中较暗像素的数量，右边区域显示了更明亮的像素。
直方图是非常常用的图像处理方法，有时在很多图像预处理中能起到特别好的效果。
一维直方图 OpenCV中，直方图是调用calxHist函数，该函数的参数比较多，不太好理解
The function cv::calcHist calculates the histogram of one or more arrays. The elements of a tuple used to increment a histogram bin are taken from the corresponding input arrays at the same location. The sample below shows how to compute a 2D Hue-Saturation histogram for a color image. : @include snippets/imgproc_calcHist.cpp @param images Source arrays. They all should have the same depth, CV_8U, CV_16U or CV_32F , and the same size." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/0cdf5a3abb379a53376223425c449d1d/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-06T20:45:10+08:00" />
<meta property="article:modified_time" content="2024-01-06T20:45:10+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">DrGraph原理示教 - OpenCV 4 功能 - 直方图</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>OpenCV直方图是一种可以对整幅图的灰度分布进行整体了解的图示。它是带有像素值（从0到255，不总是）的图在X轴上，在y轴上的图像对应的像素个数。通过观察图像的直方图，我们可以直观的了解图像的对比度、亮度、亮度分布等。<br> 在直方图中，横坐标表示图像中各个像素点的灰度级，纵坐标表示具有该灰度级的像素个数。直方图的左边部分显示了图像中较暗像素的数量，右边区域显示了更明亮的像素。<br> 直方图是非常常用的图像处理方法，有时在很多图像预处理中能起到特别好的效果。</p> 
<h3><a id="_3"></a>一维直方图</h3> 
<p>OpenCV中，直方图是调用calxHist函数，该函数的参数比较多，不太好理解</p> 
<pre><code class="prism language-cpp">The function cv<span class="token double-colon punctuation">::</span>calcHist calculates the histogram of one <span class="token operator">or</span> more arrays<span class="token punctuation">.</span> The elements of a tuple used
to increment a histogram bin are taken from the corresponding input arrays at the same location<span class="token punctuation">.</span> The
sample below shows how to compute a <span class="token number">2</span>D Hue<span class="token operator">-</span>Saturation histogram <span class="token keyword">for</span> a color image<span class="token punctuation">.</span> <span class="token operator">:</span>
@include snippets<span class="token operator">/</span>imgproc_calcHist<span class="token punctuation">.</span>cpp

@param images Source arrays<span class="token punctuation">.</span> They all should have the same depth<span class="token punctuation">,</span> CV_8U<span class="token punctuation">,</span> CV_16U <span class="token operator">or</span> CV_32F <span class="token punctuation">,</span> <span class="token operator">and</span> the same
size<span class="token punctuation">.</span> Each of them can have an arbitrary number of channels<span class="token punctuation">.</span>
@param nimages Number of source images<span class="token punctuation">.</span>
@param channels List of the dims channels used to compute the histogram<span class="token punctuation">.</span> The first array channels
are numerated from <span class="token number">0</span> to images<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">channels</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">,</span> the second array channels are counted from
images<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">channels</span><span class="token punctuation">(</span><span class="token punctuation">)</span> to images<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">channels</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> images<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">channels</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">and</span> so on<span class="token punctuation">.</span>
@param mask Optional mask<span class="token punctuation">.</span> If the matrix is <span class="token operator">not</span> empty<span class="token punctuation">,</span> it must be an <span class="token number">8</span><span class="token operator">-</span>bit array of the same size
as images<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token punctuation">.</span> The non<span class="token operator">-</span>zero mask elements mark the array elements counted in the histogram<span class="token punctuation">.</span>
@param hist Output histogram<span class="token punctuation">,</span> which is a dense <span class="token operator">or</span> sparse dims <span class="token operator">-</span>dimensional array<span class="token punctuation">.</span>
@param dims Histogram dimensionality that must be positive <span class="token operator">and</span> <span class="token operator">not</span> greater than <span class="token function">CV_MAX_DIMS</span>
<span class="token punctuation">(</span>equal to <span class="token number">32</span> in the current OpenCV version<span class="token punctuation">)</span><span class="token punctuation">.</span>
@param histSize Array of histogram sizes in each dimension<span class="token punctuation">.</span>
@param ranges Array of the dims arrays of the histogram bin boundaries in each dimension<span class="token punctuation">.</span> When the
histogram is <span class="token function">uniform</span> <span class="token punctuation">(</span> uniform <span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span> then <span class="token keyword">for</span> each dimension i it is enough to specify the <span class="token function">lower</span>
<span class="token punctuation">(</span>inclusive<span class="token punctuation">)</span> boundary \f$L_0\f$ of the <span class="token number">0</span><span class="token operator">-</span>th histogram bin <span class="token operator">and</span> the <span class="token function">upper</span> <span class="token punctuation">(</span>exclusive<span class="token punctuation">)</span> boundary
\f$U_<span class="token punctuation">{<!-- --></span>\texttt<span class="token punctuation">{<!-- --></span>histSize<span class="token punctuation">}</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span>\f$ <span class="token keyword">for</span> the last histogram bin histSize<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">.</span> That is<span class="token punctuation">,</span> in <span class="token keyword">case</span> of a
uniform histogram each of ranges<span class="token punctuation">[</span>i<span class="token punctuation">]</span> is an array of <span class="token number">2</span> elements<span class="token punctuation">.</span> When the histogram is <span class="token operator">not</span> <span class="token function">uniform</span> <span class="token punctuation">(</span>
uniform<span class="token operator">=</span><span class="token boolean">false</span> <span class="token punctuation">)</span><span class="token punctuation">,</span> then each of ranges<span class="token punctuation">[</span>i<span class="token punctuation">]</span> contains histSize<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">+</span><span class="token number">1</span> elements<span class="token operator">:</span>
\f$L_0<span class="token punctuation">,</span> U_0<span class="token operator">=</span>L_1<span class="token punctuation">,</span> U_1<span class="token operator">=</span>L_2<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> U_<span class="token punctuation">{<!-- --></span>\texttt<span class="token punctuation">{<!-- --></span>histSize<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">}</span><span class="token operator">=</span>L_<span class="token punctuation">{<!-- --></span>\texttt<span class="token punctuation">{<!-- --></span>histSize<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> U_<span class="token punctuation">{<!-- --></span>\texttt<span class="token punctuation">{<!-- --></span>histSize<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span>\f$
<span class="token punctuation">.</span> The array elements<span class="token punctuation">,</span> that are <span class="token operator">not</span> between \f$L_0\f$ <span class="token operator">and</span> \f$U_<span class="token punctuation">{<!-- --></span>\texttt<span class="token punctuation">{<!-- --></span>histSize<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span>\f$ <span class="token punctuation">,</span> are <span class="token operator">not</span>
counted in the histogram<span class="token punctuation">.</span>
@param uniform Flag indicating whether the histogram is uniform <span class="token operator">or</span> <span class="token function">not</span> <span class="token punctuation">(</span>see above<span class="token punctuation">)</span><span class="token punctuation">.</span>
@param accumulate Accumulation flag<span class="token punctuation">.</span> If it is set<span class="token punctuation">,</span> the histogram is <span class="token operator">not</span> cleared in the beginning
when it is allocated<span class="token punctuation">.</span> This feature enables you to compute a single histogram from several sets of
arrays<span class="token punctuation">,</span> <span class="token operator">or</span> to update the histogram in time<span class="token punctuation">.</span>
<span class="token operator">*</span><span class="token operator">/</span>
CV_EXPORTS <span class="token keyword">void</span> <span class="token function">calcHist</span><span class="token punctuation">(</span> <span class="token keyword">const</span> Mat<span class="token operator">*</span> images<span class="token punctuation">,</span> <span class="token keyword">int</span> nimages<span class="token punctuation">,</span>
                          <span class="token keyword">const</span> <span class="token keyword">int</span><span class="token operator">*</span> channels<span class="token punctuation">,</span> InputArray mask<span class="token punctuation">,</span>
                          OutputArray hist<span class="token punctuation">,</span> <span class="token keyword">int</span> dims<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">int</span><span class="token operator">*</span> histSize<span class="token punctuation">,</span>
                          <span class="token keyword">const</span> <span class="token keyword">float</span><span class="token operator">*</span><span class="token operator">*</span> ranges<span class="token punctuation">,</span> <span class="token keyword">bool</span> uniform <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token keyword">bool</span> accumulate <span class="token operator">=</span> <span class="token boolean">false</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> 
<p>简单化理解，那就是hist参数之前的为输入参数，其余的为输出参数。<br> dims指定直方图的维数，可以先理解1维的。<br> 因为calcHist函数可以用于多维，所以它的参数也要支持多维。其实嘛，简单点多好，多用几个函数分别实现相应多维，用得多的一二维直方图就用得轻松了。<br> 正常使用，calcHist就针对一维处理。所以要用的时候，先需要将彩色图像灰度化，或者split取得各通首图像分别应用calcHist，然后相应算后再合并处理。如果只是想看直方图，那就直接画出来。</p> 
<pre><code class="prism language-cpp">
  		std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>Mat<span class="token operator">&gt;</span> mv<span class="token punctuation">;</span>
   		<span class="token function">split</span><span class="token punctuation">(</span>dstMat<span class="token punctuation">,</span> mv<span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token keyword">int</span> histSize<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> bins <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">float</span> rgb_ranges<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> <span class="token number">0</span><span class="token punctuation">,</span> r <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> <span class="token keyword">float</span> <span class="token operator">*</span> ranges<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> rgb_ranges <span class="token punctuation">}</span><span class="token punctuation">;</span>
        dstMat <span class="token operator">=</span> <span class="token class-name">CvHelper</span><span class="token double-colon punctuation">::</span><span class="token function">ToMat_BGR</span><span class="token punctuation">(</span>dstMat<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> channels<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
        Mat b_hist<span class="token punctuation">,</span> g_hist<span class="token punctuation">,</span> r_hist<span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>channelType <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span> channelType <span class="token operator">==</span> <span class="token number">3</span> <span class="token operator">||</span> channelType <span class="token operator">==</span> <span class="token number">4</span> <span class="token operator">||</span> channelType <span class="token operator">==</span> <span class="token number">6</span><span class="token punctuation">)</span>    <span class="token comment">// B</span>
            <span class="token function">calcHist</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> channels<span class="token punctuation">,</span> <span class="token function">Mat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> b_hist<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> histSize<span class="token punctuation">,</span> ranges<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>channelType <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">||</span> channelType <span class="token operator">==</span> <span class="token number">3</span> <span class="token operator">||</span> channelType <span class="token operator">==</span> <span class="token number">5</span> <span class="token operator">||</span> channelType <span class="token operator">==</span> <span class="token number">6</span><span class="token punctuation">)</span>    <span class="token comment">// G</span>
            <span class="token function">calcHist</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> channels<span class="token punctuation">,</span> <span class="token function">Mat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> g_hist<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> histSize<span class="token punctuation">,</span> ranges<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>channelType <span class="token operator">==</span> <span class="token number">2</span> <span class="token operator">||</span> channelType <span class="token operator">==</span> <span class="token number">4</span> <span class="token operator">||</span> channelType <span class="token operator">==</span> <span class="token number">5</span> <span class="token operator">||</span> channelType <span class="token operator">==</span> <span class="token number">6</span><span class="token punctuation">)</span>    <span class="token comment">// R</span>
            <span class="token function">calcHist</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> channels<span class="token punctuation">,</span> <span class="token function">Mat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> r_hist<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> histSize<span class="token punctuation">,</span> ranges<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">double</span> maxVal <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> hist_w <span class="token operator">=</span> <span class="token number">512</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> hist_h <span class="token operator">=</span> <span class="token number">400</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> bin_w <span class="token operator">=</span> <span class="token function">cvRound</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span>hist_w <span class="token operator">/</span> histSize<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Mat histImage <span class="token operator">=</span> <span class="token class-name">Mat</span><span class="token double-colon punctuation">::</span><span class="token function">zeros</span><span class="token punctuation">(</span>hist_h<span class="token punctuation">,</span> hist_w<span class="token punctuation">,</span> CV_8UC3<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">normalize</span><span class="token punctuation">(</span>b_hist<span class="token punctuation">,</span> b_hist<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> histImage<span class="token punctuation">.</span>rows<span class="token punctuation">,</span> NORM_MINMAX<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token function">Mat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">normalize</span><span class="token punctuation">(</span>g_hist<span class="token punctuation">,</span> g_hist<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> histImage<span class="token punctuation">.</span>rows<span class="token punctuation">,</span> NORM_MINMAX<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token function">Mat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">normalize</span><span class="token punctuation">(</span>r_hist<span class="token punctuation">,</span> r_hist<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> histImage<span class="token punctuation">.</span>rows<span class="token punctuation">,</span> NORM_MINMAX<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token function">Mat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> histSize<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>r_hist<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
                <span class="token function">line</span><span class="token punctuation">(</span>histImage<span class="token punctuation">,</span> <span class="token function">Point</span><span class="token punctuation">(</span>bin_w <span class="token operator">*</span> <span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> hist_h <span class="token operator">-</span> <span class="token function">cvRound</span><span class="token punctuation">(</span>r_hist<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">float</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                     <span class="token function">Point</span><span class="token punctuation">(</span>bin_w <span class="token operator">*</span> i<span class="token punctuation">,</span> hist_h <span class="token operator">-</span> <span class="token function">cvRound</span><span class="token punctuation">(</span>r_hist<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">float</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> LINE_AA<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>g_hist<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
                <span class="token function">line</span><span class="token punctuation">(</span>histImage<span class="token punctuation">,</span> <span class="token function">Point</span><span class="token punctuation">(</span>bin_w <span class="token operator">*</span> <span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> hist_h <span class="token operator">-</span> <span class="token function">cvRound</span><span class="token punctuation">(</span>g_hist<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">float</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                     <span class="token function">Point</span><span class="token punctuation">(</span>bin_w <span class="token operator">*</span> i<span class="token punctuation">,</span> hist_h <span class="token operator">-</span> <span class="token function">cvRound</span><span class="token punctuation">(</span>g_hist<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">float</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> LINE_AA<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>b_hist<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
                <span class="token function">line</span><span class="token punctuation">(</span>histImage<span class="token punctuation">,</span> <span class="token function">Point</span><span class="token punctuation">(</span>bin_w <span class="token operator">*</span> <span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> hist_h <span class="token operator">-</span> <span class="token function">cvRound</span><span class="token punctuation">(</span>b_hist<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">float</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                     <span class="token function">Point</span><span class="token punctuation">(</span>bin_w <span class="token operator">*</span> i<span class="token punctuation">,</span> hist_h <span class="token operator">-</span> <span class="token function">cvRound</span><span class="token punctuation">(</span>b_hist<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">float</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> LINE_AA<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        dstMat <span class="token operator">=</span> histImage<span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/af/65/t422g8Wr_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/1f/d3/JjbAa2yV_o.png" alt="在这里插入图片描述"><br> OpenCV 2中，实现calcHist的代码为</p> 
<pre><code class="prism language-cpp">	<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">calcHist</span><span class="token punctuation">(</span><span class="token keyword">const</span> Mat<span class="token operator">*</span> images<span class="token punctuation">,</span> <span class="token keyword">int</span> nimages<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">int</span><span class="token operator">*</span> channels<span class="token punctuation">,</span>
		<span class="token keyword">const</span> Mat<span class="token operator">&amp;</span> mask<span class="token punctuation">,</span> SparseMat<span class="token operator">&amp;</span> hist<span class="token punctuation">,</span> <span class="token keyword">int</span> dims<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">int</span><span class="token operator">*</span> histSize<span class="token punctuation">,</span>
		<span class="token keyword">const</span> <span class="token keyword">float</span><span class="token operator">*</span><span class="token operator">*</span> ranges<span class="token punctuation">,</span> <span class="token keyword">bool</span> uniform<span class="token punctuation">,</span> <span class="token keyword">bool</span> accumulate<span class="token punctuation">,</span> <span class="token keyword">bool</span> keepInt<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		size_t i<span class="token punctuation">,</span> N<span class="token punctuation">;</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>accumulate<span class="token punctuation">)</span>
			hist<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>dims<span class="token punctuation">,</span> histSize<span class="token punctuation">,</span> CV_32F<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
			SparseMatIterator it <span class="token operator">=</span> hist<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> N <span class="token operator">=</span> hist<span class="token punctuation">.</span><span class="token function">nzcount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> N<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">,</span> <span class="token operator">++</span>it<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				Cv32suf<span class="token operator">*</span> val <span class="token operator">=</span> <span class="token punctuation">(</span>Cv32suf<span class="token operator">*</span><span class="token punctuation">)</span>it<span class="token punctuation">.</span>ptr<span class="token punctuation">;</span>
				val<span class="token operator">-&gt;</span>i <span class="token operator">=</span> <span class="token function">cvRound</span><span class="token punctuation">(</span>val<span class="token operator">-&gt;</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>

		vector<span class="token operator">&lt;</span>uchar<span class="token operator">*</span><span class="token operator">&gt;</span>ptrs<span class="token punctuation">;</span>
		vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span>deltas<span class="token punctuation">;</span>
		vector<span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">&gt;</span>uniranges<span class="token punctuation">;</span>
		Size imsize<span class="token punctuation">;</span>

		<span class="token function">CV_Assert</span><span class="token punctuation">(</span><span class="token operator">!</span>mask<span class="token punctuation">.</span>data <span class="token operator">||</span> mask<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> CV_8UC1<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">histPrepareImages</span><span class="token punctuation">(</span>images<span class="token punctuation">,</span> nimages<span class="token punctuation">,</span> channels<span class="token punctuation">,</span> mask<span class="token punctuation">,</span> dims<span class="token punctuation">,</span> hist<span class="token punctuation">.</span>hdr<span class="token operator">-&gt;</span>size<span class="token punctuation">,</span>
			ranges<span class="token punctuation">,</span> uniform<span class="token punctuation">,</span> ptrs<span class="token punctuation">,</span> deltas<span class="token punctuation">,</span> imsize<span class="token punctuation">,</span> uniranges<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">const</span> <span class="token keyword">double</span><span class="token operator">*</span> _uniranges <span class="token operator">=</span> uniform <span class="token operator">?</span> <span class="token operator">&amp;</span>uniranges<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>

		<span class="token keyword">int</span> depth <span class="token operator">=</span> images<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">depth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>depth <span class="token operator">==</span> CV_8U<span class="token punctuation">)</span>
			<span class="token function">calcSparseHist_8u</span><span class="token punctuation">(</span>ptrs<span class="token punctuation">,</span> deltas<span class="token punctuation">,</span> imsize<span class="token punctuation">,</span> hist<span class="token punctuation">,</span> dims<span class="token punctuation">,</span> ranges<span class="token punctuation">,</span>
			_uniranges<span class="token punctuation">,</span> uniform<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>depth <span class="token operator">==</span> CV_16U<span class="token punctuation">)</span>
			<span class="token generic-function"><span class="token function">calcSparseHist_</span><span class="token generic class-name"><span class="token operator">&lt;</span>ushort<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>ptrs<span class="token punctuation">,</span> deltas<span class="token punctuation">,</span> imsize<span class="token punctuation">,</span> hist<span class="token punctuation">,</span> dims<span class="token punctuation">,</span> ranges<span class="token punctuation">,</span>
			_uniranges<span class="token punctuation">,</span> uniform<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>depth <span class="token operator">==</span> CV_32F<span class="token punctuation">)</span>
			<span class="token generic-function"><span class="token function">calcSparseHist_</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">float</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>ptrs<span class="token punctuation">,</span> deltas<span class="token punctuation">,</span> imsize<span class="token punctuation">,</span> hist<span class="token punctuation">,</span> dims<span class="token punctuation">,</span> ranges<span class="token punctuation">,</span>
			_uniranges<span class="token punctuation">,</span> uniform<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">else</span>
			<span class="token function">CV_Error</span><span class="token punctuation">(</span>CV_StsUnsupportedFormat<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>keepInt<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			SparseMatIterator it <span class="token operator">=</span> hist<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> N <span class="token operator">=</span> hist<span class="token punctuation">.</span><span class="token function">nzcount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> N<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">,</span> <span class="token operator">++</span>it<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				Cv32suf<span class="token operator">*</span> val <span class="token operator">=</span> <span class="token punctuation">(</span>Cv32suf<span class="token operator">*</span><span class="token punctuation">)</span>it<span class="token punctuation">.</span>ptr<span class="token punctuation">;</span>
				val<span class="token operator">-&gt;</span>f <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>val<span class="token operator">-&gt;</span>i<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token keyword">void</span> cv<span class="token double-colon punctuation">::</span><span class="token function">calcHist</span><span class="token punctuation">(</span><span class="token keyword">const</span> Mat<span class="token operator">*</span> images<span class="token punctuation">,</span> <span class="token keyword">int</span> nimages<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">int</span><span class="token operator">*</span> channels<span class="token punctuation">,</span>
	InputArray _mask<span class="token punctuation">,</span> SparseMat<span class="token operator">&amp;</span> hist<span class="token punctuation">,</span> <span class="token keyword">int</span> dims<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">int</span><span class="token operator">*</span> histSize<span class="token punctuation">,</span>
	<span class="token keyword">const</span> <span class="token keyword">float</span><span class="token operator">*</span><span class="token operator">*</span> ranges<span class="token punctuation">,</span> <span class="token keyword">bool</span> uniform<span class="token punctuation">,</span> <span class="token keyword">bool</span> accumulate<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	Mat mask <span class="token operator">=</span> _mask<span class="token punctuation">.</span><span class="token function">getMat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">calcHist</span><span class="token punctuation">(</span>images<span class="token punctuation">,</span> nimages<span class="token punctuation">,</span> channels<span class="token punctuation">,</span> mask<span class="token punctuation">,</span> hist<span class="token punctuation">,</span> dims<span class="token punctuation">,</span> histSize<span class="token punctuation">,</span> ranges<span class="token punctuation">,</span>
		uniform<span class="token punctuation">,</span> accumulate<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> cv<span class="token double-colon punctuation">::</span><span class="token function">calcHist</span><span class="token punctuation">(</span>InputArrayOfArrays images<span class="token punctuation">,</span> <span class="token keyword">const</span> vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span><span class="token operator">&amp;</span> channels<span class="token punctuation">,</span>
	InputArray mask<span class="token punctuation">,</span> OutputArray hist<span class="token punctuation">,</span> <span class="token keyword">const</span> vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span><span class="token operator">&amp;</span> histSize<span class="token punctuation">,</span>
	<span class="token keyword">const</span> vector<span class="token operator">&lt;</span><span class="token keyword">float</span><span class="token operator">&gt;</span><span class="token operator">&amp;</span> ranges<span class="token punctuation">,</span> <span class="token keyword">bool</span> accumulate<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">int</span> i<span class="token punctuation">,</span> dims <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>histSize<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> rsz <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>ranges<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> csz <span class="token operator">=</span>
		<span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>channels<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> nimages <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>images<span class="token punctuation">.</span><span class="token function">total</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">CV_Assert</span><span class="token punctuation">(</span>nimages <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> dims <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">CV_Assert</span><span class="token punctuation">(</span>rsz <span class="token operator">==</span> dims<span class="token operator">*</span><span class="token number">2</span> <span class="token operator">||</span> <span class="token punctuation">(</span>rsz <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> images<span class="token punctuation">.</span><span class="token function">depth</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">==</span> CV_8U<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">CV_Assert</span><span class="token punctuation">(</span>csz <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span> csz <span class="token operator">==</span> dims<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">float</span><span class="token operator">*</span> _ranges<span class="token punctuation">[</span>CV_MAX_DIM<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>rsz <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> rsz <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
			_ranges<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>ranges<span class="token punctuation">[</span>i <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	AutoBuffer<span class="token operator">&lt;</span>Mat<span class="token operator">&gt;</span><span class="token function">buf</span><span class="token punctuation">(</span>nimages<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> nimages<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
		buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> images<span class="token punctuation">.</span><span class="token function">getMat</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">calcHist</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>buf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> nimages<span class="token punctuation">,</span> csz <span class="token operator">?</span> <span class="token operator">&amp;</span>channels<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> mask<span class="token punctuation">,</span> hist<span class="token punctuation">,</span> dims<span class="token punctuation">,</span>
		<span class="token operator">&amp;</span>histSize<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> rsz <span class="token operator">?</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">float</span><span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">)</span>_ranges <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> accumulate<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>看似有点麻烦，其实一点也没必要去理解这个代码，知道其作用就OK</p> 
<h3><a id="_173"></a>直方图均衡化</h3> 
<p>直方图均衡化，调用equalizeHist即可。同样也是针对单通道进行处理</p> 
<pre><code class="prism language-cpp">  		std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>Mat<span class="token operator">&gt;</span> mv<span class="token punctuation">;</span>
   		<span class="token function">split</span><span class="token punctuation">(</span>dstMat<span class="token punctuation">,</span> mv<span class="token punctuation">)</span><span class="token punctuation">;</span>  
   		Mat b_hist<span class="token punctuation">,</span> g_hist<span class="token punctuation">,</span> r_hist<span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>channelType <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span> channelType <span class="token operator">==</span> <span class="token number">3</span> <span class="token operator">||</span> channelType <span class="token operator">==</span> <span class="token number">4</span> <span class="token operator">||</span> channelType <span class="token operator">==</span> <span class="token number">6</span><span class="token punctuation">)</span>    <span class="token comment">// B</span>
            <span class="token function">equalizeHist</span><span class="token punctuation">(</span>mv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> mv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>channelType <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">||</span> channelType <span class="token operator">==</span> <span class="token number">3</span> <span class="token operator">||</span> channelType <span class="token operator">==</span> <span class="token number">5</span> <span class="token operator">||</span> channelType <span class="token operator">==</span> <span class="token number">6</span><span class="token punctuation">)</span>    <span class="token comment">// G</span>
            <span class="token function">equalizeHist</span><span class="token punctuation">(</span>mv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> mv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>channelType <span class="token operator">==</span> <span class="token number">2</span> <span class="token operator">||</span> channelType <span class="token operator">==</span> <span class="token number">4</span> <span class="token operator">||</span> channelType <span class="token operator">==</span> <span class="token number">5</span> <span class="token operator">||</span> channelType <span class="token operator">==</span> <span class="token number">6</span><span class="token punctuation">)</span>    <span class="token comment">// R</span>
            <span class="token function">equalizeHist</span><span class="token punctuation">(</span>mv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> mv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">merge</span><span class="token punctuation">(</span>mv<span class="token punctuation">,</span> dstMat<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/4d/81/ajOUDiMT_o.png" alt="在这里插入图片描述"></p> 
<p>直方图均衡化（Histogram Equalization）是一种图像增强技术，其目的是通过对图像的直方图进行调整，使得图像的灰度分布更加均匀，从而提高图像的对比度和整体质量。<br> 在直方图均衡化过程中，首先计算图像的直方图，即统计图像中每个灰度级出现的次数或频率。然后，根据直方图的分布情况，对灰度级进行重新映射，使得每个灰度级在整个灰度范围内具有相同的出现概率或频率。<br> 具体实现时，可以通过计算累积直方图来确定灰度级的映射关系。累积直方图表示了灰度级小于等于某个值的像素数量占总像素数量的比例。根据累积直方图，可以将原始的灰度级映射到新的灰度级，使得每个灰度级在新的灰度范围内具有相同的出现概率。<br> 直方图均衡化的效果是使图像的灰度分布更加均匀，从而增强图像的对比度和细节。它可以用于改善图像的视觉效果，特别是在低对比度或亮度不均匀的情况下。<br> 需要注意的是，直方图均衡化可能会导致图像的局部信息丢失，因为它是对整个图像进行全局的灰度调整。在实际应用中，需要根据具体情况选择是否使用直方图均衡化以及如何调整参数以获得最佳效果。</p> 
<h3><a id="_196"></a>自适应直方图均衡化</h3> 
<p>自适应直方图均衡化（Adaptive Histogram Equalization，AHE）是一种改进的直方图均衡化技术，它在保留图像细节和对比度的同时，对局部区域进行自适应的灰度调整。<br> 传统的直方图均衡化是对整个图像进行全局的灰度变换，可能会导致图像的局部信息丢失。而自适应直方图均衡化则考虑了图像的局部上下文信息，根据每个像素周围的像素分布来调整其灰度级。<br> 自适应直方图均衡化的基本思路如下：<br> 将图像划分为多个子区域（通常是矩形或方形）。<br> 对每个子区域计算其直方图，并进行均衡化操作。<br> 使用均衡化后的子区域直方图对该区域内的像素进行灰度级调整。<br> 通过将图像划分为较小的子区域，可以更好地适应图像中不同区域的灰度分布特征。每个子区域的直方图均衡化操作是独立进行的，从而能够保留图像的局部细节和对比度。<br> 自适应直方图均衡化通常可以提高图像的对比度和细节，尤其在具有亮度不均匀或局部对比度低的情况下效果更为明显。它在图像增强、图像处理和计算机视觉等领域有广泛的应用。<br> 自适应直方图均衡化（Adaptive Histogram Equalization，AHE）和直方图均衡化（Histogram Equalization，HE）都是图像增强技术，用于改善图像的对比度和视觉效果。它们的主要区别在于处理图像的方式。<br> 直方图均衡化是一种全局的方法，它对整幅图像进行均衡化处理。通过计算图像的直方图，然后对灰度级进行重新映射，使得图像的灰度分布更加均匀。这样可以增强图像的对比度，但可能会导致图像的局部细节丢失。<br> 自适应直方图均衡化是对直方图均衡化的改进，它考虑了图像的局部上下文信息。AHE 将图像划分为多个子区域，并对每个子区域进行独立的均衡化处理。这样可以更好地保留图像的局部细节和对比度。<br> 通过将图像划分为较小的子区域，可以更好地适应图像中不同区域的灰度分布特征。每个子区域的直方图均衡化操作是独立进行的，从而能够保留图像的局部细节和对比度。<br> 自适应直方图均衡化在保留图像细节和对比度方面通常比全局的直方图均衡化更有效。它在图像增强、图像处理和计算机视觉等领域有广泛的应用。<br> 其实，说得太多，不知道咋用或用的效果，也是意义不大，至少理解不深，代码倒是很简单</p> 
<pre><code class="prism language-cpp">        <span class="token keyword">double</span> clipLimit <span class="token operator">=</span> <span class="token function">GetParamValue_Double</span><span class="token punctuation">(</span>paramIndex<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> sizeX <span class="token operator">=</span> <span class="token function">GetParamValue_Int</span><span class="token punctuation">(</span>paramIndex<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> sizeY <span class="token operator">=</span> <span class="token function">GetParamValue_Int</span><span class="token punctuation">(</span>paramIndex<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">auto</span> clahe <span class="token operator">=</span> <span class="token function">createCLAHE</span><span class="token punctuation">(</span>clipLimit<span class="token punctuation">,</span> <span class="token function">Size</span><span class="token punctuation">(</span>sizeX<span class="token punctuation">,</span> sizeY<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Mat b_hist<span class="token punctuation">,</span> g_hist<span class="token punctuation">,</span> r_hist<span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>channelType <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span> channelType <span class="token operator">==</span> <span class="token number">3</span> <span class="token operator">||</span> channelType <span class="token operator">==</span> <span class="token number">4</span> <span class="token operator">||</span> channelType <span class="token operator">==</span> <span class="token number">6</span><span class="token punctuation">)</span>    <span class="token comment">// B</span>
            clahe<span class="token operator">-&gt;</span><span class="token function">apply</span><span class="token punctuation">(</span>mv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> mv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>channelType <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">||</span> channelType <span class="token operator">==</span> <span class="token number">3</span> <span class="token operator">||</span> channelType <span class="token operator">==</span> <span class="token number">5</span> <span class="token operator">||</span> channelType <span class="token operator">==</span> <span class="token number">6</span><span class="token punctuation">)</span>    <span class="token comment">// G</span>
            clahe<span class="token operator">-&gt;</span><span class="token function">apply</span><span class="token punctuation">(</span>mv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> mv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>channelType <span class="token operator">==</span> <span class="token number">2</span> <span class="token operator">||</span> channelType <span class="token operator">==</span> <span class="token number">4</span> <span class="token operator">||</span> channelType <span class="token operator">==</span> <span class="token number">5</span> <span class="token operator">||</span> channelType <span class="token operator">==</span> <span class="token number">6</span><span class="token punctuation">)</span>    <span class="token comment">// R</span>
            clahe<span class="token operator">-&gt;</span><span class="token function">apply</span><span class="token punctuation">(</span>mv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> mv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">merge</span><span class="token punctuation">(</span>mv<span class="token punctuation">,</span> dstMat<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/d0/6a/NEAnxN98_o.png" alt="在这里插入图片描述"><br> 反正我是没太理解该咋用，只是用了有图像有变化，这些参数的调整，以后再慢慢理解。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5f7816c9de2a0f18f06cb424191f3255/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">网络安全（黑客）——自学2024</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4f4deecc5af7a8c243b1fc2c8df6728e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">SpringCloud系列篇：核心组件之注册中心组件</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>