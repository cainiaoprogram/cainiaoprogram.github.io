<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Nmap扫描原理（上） - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Nmap扫描原理（上）" />
<meta property="og:description" content="Nmap是一款开源免费的网络发现（Network Discovery）和安全审计（Security Auditing）工具。软件名字Nmap是Network Mapper的简称。Nmap最初是由Fyodor在1997年开始创建的。随后在开源社区众多的志愿者参与下，该工具逐渐成为最为流行安全必备工具之一。最新版的Nmap6.0在2012年5月21日发布，详情请参见：www.nmap.org。
一般情况下，Nmap用于列举网络主机清单、管理服务升级调度、监控主机或服务运行状况。Nmap可以检测目标机是否在线、端口开放情况、侦测运行的服务类型及版本信息、侦测操作系统与设备类型等信息。
Nmap的优点：
1. 灵活。支持数十种不同的扫描方式，支持多种目标对象的扫描。
2. 强大。Nmap可以用于扫描互联网上大规模的计算机。
3. 可移植。支持主流操作系统：Windows/Linux/Unix/MacOS等等；源码开放，方便移植。
4. 简单。提供默认的操作能覆盖大部分功能，基本端口扫描nmap targetip，全面的扫描nmap –A targetip。
5. 自由。Nmap作为开源软件，在GPL License的范围内可以自由的使用。
6. 文档丰富。Nmap官网提供了详细的文档描述。Nmap作者及其他安全专家编写了多部Nmap参考书籍。
7. 社区支持。Nmap背后有强大的社区团队支持。
8. 赞誉有加。获得很多的奖励，并在很多影视作品中出现（如黑客帝国2、Die Hard4等）。
9. 流行。目前Nmap已经被成千上万的安全专家列为必备的工具之一。
1.1 Zenmap Zenmap是Nmap官方提供的图形界面，通常随Nmap的安装包发布。Zenmap是用Python语言编写而成的开源免费的图形界面，能够运行在不同操作系统平台上（Windows/Linux/Unix/Mac OS等）。Zenmap旨在为nmap提供更加简单的操作方式。简单常用的操作命令可以保存成为profile，用户扫描时选择profile即可；可以方便地比较不同的扫描结果；提供网络拓扑结构(NetworkTopology)的图形显示功能。
其中Profile栏位，用于选择“Zenmap默认提供的Profile”或“用户创建的Profile”；Command栏位，用于显示选择Profile对应的命令或者用户自行指定的命令；Topology选项卡，用于显示扫描到的目标机与本机之间的拓扑结构。
1.2 功能架构图 Nmap包含四项基本功能：
主机发现（Host Discovery）
端口扫描（Port Scanning）
版本侦测（Version Detection）
操作系统侦测（Operating System Detection）
而这四项功能之间，又存在大致的依赖关系（通常情况下的顺序关系，但特殊应用另外考虑），首先需要进行主机发现，随后确定端口状况，然后确定端口上运行具体应用程序与版本信息，然后可以进行操作系统的侦测。而在四项基本功能的基础上，Nmap提供防火墙与IDS（IntrusionDetection System,入侵检测系统）的规避技巧，可以综合应用到四个基本功能的各个阶段；另外Nmap提供强大的NSE（Nmap Scripting Language）脚本引擎功能，脚本可以对基本功能进行补充和扩展。
2 Nmap基本扫描方法 Nmap主要包括四个方面的扫描功能，主机发现、端口扫描、应用与版本侦测、操作系统侦测。在详细讲解每个具体功能之前，首先可以看看Nmap的典型用法。
2.1 用法引入 2.1.1 确定端口状况 如果直接针对某台计算的IP地址或域名进行扫描，那么Nmap对该主机进行主机发现过程和端口扫描。该方式执行迅速，可以用于确定端口的开放状况。
命令形式:
nmap targethost
可以确定目标主机在线情况及端口基本状况。
2.1.2 完整全面的扫描 如果希望对某台主机进行完整全面的扫描，那么可以使用nmap内置的-A选项。使用了改选项，nmap对目标主机进行主机发现、端口扫描、应用程序与版本侦测、操作系统侦测及调用默认NSE脚本扫描。
命令形式：
nmap –T4 –A –v targethost" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/c40220d2484a852f85f450a14bc4633e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-04-06T15:05:39+08:00" />
<meta property="article:modified_time" content="2019-04-06T15:05:39+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Nmap扫描原理（上）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>Nmap是一款开源免费的网络发现（Network Discovery）和安全审计（Security Auditing）工具。软件名字Nmap是Network Mapper的简称。Nmap最初是由Fyodor在1997年开始创建的。随后在开源社区众多的志愿者参与下，该工具逐渐成为最为流行安全必备工具之一。最新版的Nmap6.0在2012年5月21日发布，详情请参见：<a href="http://www.nmap.org/" rel="nofollow">www.nmap.org</a>。</p> 
<p>一般情况下，Nmap用于列举网络主机清单、管理服务升级调度、监控主机或服务运行状况。Nmap可以检测目标机是否在线、端口开放情况、侦测运行的服务类型及版本信息、侦测操作系统与设备类型等信息。</p> 
<p>Nmap的优点：</p> 
<p>1.      灵活。支持数十种不同的扫描方式，支持多种目标对象的扫描。</p> 
<p>2.      强大。Nmap可以用于扫描互联网上大规模的计算机。</p> 
<p>3.      可移植。支持主流操作系统：Windows/Linux/Unix/MacOS等等；源码开放，方便移植。</p> 
<p>4.      简单。提供默认的操作能覆盖大部分功能，基本端口扫描nmap targetip，全面的扫描nmap –A targetip。</p> 
<p>5.      自由。Nmap作为开源软件，在GPL License的范围内可以自由的使用。</p> 
<p>6.      文档丰富。Nmap官网提供了详细的文档描述。Nmap作者及其他安全专家编写了多部Nmap参考书籍。</p> 
<p>7.      社区支持。Nmap背后有强大的社区团队支持。</p> 
<p>8.      赞誉有加。获得很多的奖励，并在很多影视作品中出现（如黑客帝国2、Die Hard4等）。</p> 
<p>9.      流行。目前Nmap已经被成千上万的安全专家列为必备的工具之一。</p> 
<p> </p> 
<h3>1.1    Zenmap</h3> 
<p>Zenmap是Nmap官方提供的图形界面，通常随Nmap的安装包发布。Zenmap是用Python语言编写而成的开源免费的图形界面，能够运行在不同操作系统平台上（Windows/Linux/Unix/Mac OS等）。Zenmap旨在为nmap提供更加简单的操作方式。简单常用的操作命令可以保存成为profile，用户扫描时选择profile即可；可以方便地比较不同的扫描结果；提供网络拓扑结构(NetworkTopology)的图形显示功能。</p> 
<p><img alt="" class="has" src="https://images2.imgbox.com/ee/80/irIE4m1J_o.jpg" width="557"></p> 
<p> </p> 
<p>其中Profile栏位，用于选择“Zenmap默认提供的Profile”或“用户创建的Profile”；Command栏位，用于显示选择Profile对应的命令或者用户自行指定的命令；Topology选项卡，用于显示扫描到的目标机与本机之间的拓扑结构。</p> 
<h3>1.2    功能架构图</h3> 
<p><img alt="" class="has" src="https://images2.imgbox.com/60/4e/RdHxBOXM_o.jpg"></p> 
<p>Nmap包含四项基本功能：</p> 
<ol><li> <p>主机发现（Host Discovery）</p> </li><li> <p>端口扫描（Port Scanning）</p> </li><li> <p>版本侦测（Version Detection）</p> </li><li> <p>操作系统侦测（Operating System Detection）</p> </li></ol> 
<p>而这四项功能之间，又存在大致的依赖关系（通常情况下的顺序关系，但特殊应用另外考虑），首先需要进行主机发现，随后确定端口状况，然后确定端口上运行具体应用程序与版本信息，然后可以进行操作系统的侦测。而在四项基本功能的基础上，Nmap提供防火墙与IDS（IntrusionDetection System,入侵检测系统）的规避技巧，可以综合应用到四个基本功能的各个阶段；另外Nmap提供强大的NSE（Nmap Scripting Language）脚本引擎功能，脚本可以对基本功能进行补充和扩展。</p> 
<p> </p> 
<p> </p> 
<h2>2     Nmap基本扫描方法</h2> 
<p>Nmap主要包括四个方面的扫描功能，主机发现、端口扫描、应用与版本侦测、操作系统侦测。在详细讲解每个具体功能之前，首先可以看看Nmap的典型用法。</p> 
<h3>2.1    用法引入</h3> 
<h4>2.1.1    确定端口状况</h4> 
<p>如果直接针对某台计算的IP地址或域名进行扫描，那么Nmap对该主机进行主机发现过程和端口扫描。该方式执行迅速，可以用于确定端口的开放状况。</p> 
<p>命令形式:</p> 
<p>nmap targethost</p> 
<p>可以确定目标主机在线情况及端口基本状况。</p> 
<p><img alt="" class="has" src="https://images2.imgbox.com/9b/ed/yOTS09pa_o.jpg"></p> 
<h4>2.1.2    完整全面的扫描</h4> 
<p>如果希望对某台主机进行完整全面的扫描，那么可以使用nmap内置的-A选项。使用了改选项，nmap对目标主机进行主机发现、端口扫描、应用程序与版本侦测、操作系统侦测及调用默认NSE脚本扫描。</p> 
<p>命令形式：</p> 
<p>nmap –T4 –A –v targethost</p> 
<p>其中-A选项用于使用进攻性（Aggressive）方式扫描；-T4指定扫描过程使用的时序（Timing），总有6个级别（0-5），级别越高，扫描速度越快，但也容易被防火墙或IDS检测并屏蔽掉，在网络通讯状况良好的情况推荐使用T4；-v表示显示冗余（verbosity）信息，在扫描过程中显示扫描的细节，从而让用户了解当前的扫描状态。</p> 
<p><img alt="" class="has" src="https://images2.imgbox.com/c6/50/PGi9AW55_o.jpg"></p> 
<p>例如，扫描局域网内地址为192.168.1.100的电脑。显而易见，扫描出的信息非常丰富，在对192.168.1.100的扫描报告部分中（以红框圈出），可以看到主机发现的结果“Host is up”；端口扫描出的结果，有996个关闭端口，4个开放端口（在未指定扫描端口时，Nmap默认扫描1000个最有可能开放的端口）；而版本侦测针对扫描到的开放状况进一步探测端口上运行的具体的应用程序和版本信息；OS侦测对该目标主机的设备类型与操作系统进行探测；而绿色框图是nmap调用NSE脚本进行进一步的信息挖掘的显示结果。</p> 
<p> </p> 
<h3>2.2    主机发现</h3> 
<p>主机发现（Host Discovery），即用于发现目标主机是否在线（Alive，处于开启状态）。</p> 
<h4>2.2.1    主机发现原理</h4> 
<p>主机发现发现的原理与Ping命令类似，发送探测包到目标主机，如果收到回复，那么说明目标主机是开启的。Nmap支持十多种不同的主机探测方式，比如发送ICMP ECHO/TIMESTAMP/NETMASK报文、发送TCPSYN/ACK包、发送SCTP INIT/COOKIE-ECHO包，用户可以在不同的条件下灵活选用不同的方式来探测目标机。</p> 
<p>主机发现基本原理：（以ICMP echo方式为例）</p> 
<p><img alt="" class="has" src="https://images2.imgbox.com/62/67/GumxEsSO_o.jpg"></p> 
<p>Nmap的用户位于源端，IP地址192.168.0.5，向目标主机192.168.0.3发送ICMP Echo Request。如果该请求报文没有被防火墙拦截掉，那么目标机会回复ICMP Echo Reply包回来。以此来确定目标主机是否在线。</p> 
<p>默认情况下，Nmap会发送四种不同类型的数据包来探测目标主机是否在线。</p> 
<p>1.      ICMP echo request</p> 
<p>2.      a TCP SYN packet to port 443</p> 
<p>3.      a TCP ACK packet to port 80</p> 
<p>4.      an ICMP timestamp request</p> 
<p>依次发送四个报文探测目标机是否开启。只要收到其中一个包的回复，那就证明目标机开启。使用四种不同类型的数据包可以避免因防火墙或丢包造成的判断错误。</p> 
<h4>2.2.2    主机发现的用法</h4> 
<p>通常主机发现并不单独使用，而只是作为端口扫描、版本侦测、OS侦测先行步骤。而在某些特殊应用（例如确定大型局域网内活动主机的数量），可能会单独专门适用主机发现功能来完成。</p> 
<p>不管是作为辅助用法还是专门用途，用户都可以使用Nmap提供的丰富的选项来定制主机发现的探测方式。</p> 
<p>[plain] <a href="http://blog.csdn.net/aspirationflow/article/details/7694274#">view plain</a><a href="http://blog.csdn.net/aspirationflow/article/details/7694274#">copy</a></p> 
<ol><li> <p>-sL: List Scan 列表扫描，仅将指定的目标的IP列举出来，不进行主机发现。</p> </li><li> <p>-sn: Ping Scan 只进行主机发现，不进行端口扫描。</p> </li><li> <p>-Pn: 将所有指定的主机视作开启的，跳过主机发现的过程。</p> </li><li> <p>-PS/PA/PU/PY[portlist]: 使用TCPSYN/ACK或SCTP INIT/ECHO方式进行发现。</p> </li><li> <p>-PE/PP/PM: 使用ICMP echo, timestamp, and netmask 请求包发现主机。-PO[protocollist]: 使用IP协议包探测对方主机是否开启。</p> </li><li> <p>-n/-R: -n表示不进行DNS解析；-R表示总是进行DNS解析。</p> </li><li> <p>–dns-servers &lt;serv1[,serv2],…&gt;: 指定DNS服务器。</p> </li><li> <p>–system-dns: 指定使用系统的DNS服务器</p> </li><li> <p>–traceroute: 追踪每个路由节点</p> </li></ol> 
<p>其中，比较常用的使用的是-sn，表示只单独进行主机发现过程；-Pn表示直接跳过主机发现而进行端口扫描等高级操作（如果已经确知目标主机已经开启，可用该选项）；-n，如果不想使用DNS或reverse DNS解析，那么可以使用该选项。</p> 
<h4>2.2.3    使用演示</h4> 
<p>探测<a href="http://scanme.nmap.org/" rel="nofollow">scanme.nmap.org</a></p> 
<p>下面以探测<a href="http://www.163.com/" rel="nofollow">scanme.nmap.org</a> 的主机为例，简单演示主机发现的用法。</p> 
<p>命令如下：</p> 
<p>nmap –sn –PE –PS80,135 –PU53 <a href="http://scanme.nmap.org/" rel="nofollow">scanme.nmap.org</a></p> 
<p><img alt="" class="has" src="https://images2.imgbox.com/74/0f/833QG4N7_o.jpg"></p> 
<p> </p> 
<p>使用Wireshark抓包，我们看到，<a href="http://scanme.nmap.org/" rel="nofollow">scanme.nmap.org</a> 的IP地址74.207.244.221发送了四个探测包：ICMPEcho，80和135端口的TCP SYN包，53端口的UDP包（DNS domain）。而收到ICMP Echo的回复与80端口的回复。从而确定了<a href="http://scanme.nmap.org/" rel="nofollow">scanme.nmap.org</a>主机正常在线。</p> 
<p><img alt="" class="has" src="https://images2.imgbox.com/28/fb/6WP8F74F_o.jpg"></p> 
<p>探测局域网内活动主机</p> 
<p>扫描局域网192.168.1.100-192.168.1.120范围内哪些IP的主机是活动的。</p> 
<p>命令如下：</p> 
<p>nmap –sn 192.168.1.100-120</p> 
<p><img alt="" class="has" src="https://images2.imgbox.com/76/b0/QznyKtvY_o.jpg"></p> 
<p>从结果中，可以看到这个IP范围内有三台主机处于活动状态。</p> 
<p>从Wireshark抓取的包中，可以看到发送的探测包的情况：</p> 
<p><img alt="" class="has" src="https://images2.imgbox.com/83/ea/JeZNdWd8_o.jpg"></p> 
<p>在局域网内，Nmap是通过ARP包来询问IP地址上的主机是否活动的，如果收到ARP回复包，那么说明主机在线。</p> 
<p>例如，某条ARP回复的报文详细信息如下：</p> 
<p> </p> 
<p><img alt="" class="has" src="https://images2.imgbox.com/04/9f/fO99yDuC_o.jpg"></p> 
<h3>2.3    端口扫描</h3> 
<p>端口扫描是Nmap最基本最核心的功能，用于确定目标主机的TCP/UDP端口的开放情况。</p> 
<p>默认情况下，Nmap会扫描1000个最有可能开放的TCP端口。</p> 
<p>Nmap通过探测将端口划分为6个状态：</p> 
<ol><li> <p>open：端口是开放的。</p> </li><li> <p>closed：端口是关闭的。</p> </li><li> <p>filtered：端口被防火墙IDS/IPS屏蔽，无法确定其状态。</p> </li><li> <p>unfiltered：端口没有被屏蔽，但是否开放需要进一步确定。</p> </li><li> <p>open|filtered：端口是开放的或被屏蔽。</p> </li><li> <p>closed|filtered ：端口是关闭的或被屏蔽。</p> </li></ol> 
<h4>2.3.1    端口扫描原理</h4> 
<p>Nmap在端口扫描方面非常强大，提供了十多种探测方式。</p> 
<p>2.3.1.1    TCP SYN scanning</p> 
<p>这是Nmap默认的扫描方式，通常被称作半开放扫描（Half-open scanning）。该方式发送SYN到目标端口，如果收到SYN/ACK回复，那么判断端口是开放的；如果收到RST包，说明该端口是关闭的。如果没有收到回复，那么判断该端口被屏蔽（Filtered）。因为该方式仅发送SYN包对目标主机的特定端口，但不建立的完整的TCP连接，所以相对比较隐蔽，而且效率比较高，适用范围广。</p> 
<p>TCP SYN探测到端口关闭：</p> 
<p><img alt="" class="has" src="https://images2.imgbox.com/02/8d/wBDFMtld_o.jpg"></p> 
<p>TCP SYN探测到端口开放：</p> 
<p><img alt="" class="has" src="https://images2.imgbox.com/b6/57/qodbl7AS_o.jpg"></p> 
<p>2.3.1.2    TCP connect scanning</p> 
<p>TCP connect方式使用系统网络API connect向目标主机的端口发起连接，如果无法连接，说明该端口关闭。该方式扫描速度比较慢，而且由于建立完整的TCP连接会在目标机上留下记录信息，不够隐蔽。所以，TCP connect是TCP SYN无法使用才考虑选择的方式。</p> 
<p>TCP connect探测到端口关闭：</p> 
<p><img alt="" class="has" src="https://images2.imgbox.com/ab/31/CKDYJE3Q_o.jpg"></p> 
<p>TCP connect探测到端口开放：</p> 
<p><img alt="" class="has" src="https://images2.imgbox.com/35/b5/KWmf4Wq8_o.jpg"></p> 
<p>2.3.1.3    TCP ACK scanning</p> 
<p>向目标主机的端口发送ACK包，如果收到RST包，说明该端口没有被防火墙屏蔽；没有收到RST包，说明被屏蔽。该方式只能用于确定防火墙是否屏蔽某个端口，可以辅助TCP SYN的方式来判断目标主机防火墙的状况。</p> 
<p>TCP ACK探测到端口被屏蔽：</p> 
<p><img alt="" class="has" src="https://images2.imgbox.com/a2/5a/mNnraFpw_o.jpg"></p> 
<p>TCP ACK探测到端口未被屏蔽：</p> 
<p><img alt="" class="has" src="https://images2.imgbox.com/3c/cc/GFWm0plm_o.jpg"></p> 
<p>2.3.1.4    TCP FIN/Xmas/NULL scanning</p> 
<p>这三种扫描方式被称为秘密扫描（Stealthy Scan），因为相对比较隐蔽。FIN扫描向目标主机的端口发送的TCP FIN包或Xmas tree包/Null包，如果收到对方RST回复包，那么说明该端口是关闭的；没有收到RST包说明端口可能是开放的或被屏蔽的（open|filtered）。</p> 
<p>其中Xmas tree包是指flags中FIN URG PUSH被置为1的TCP包；NULL包是指所有flags都为0的TCP包。</p> 
<p>TCP FIN探测到主机端口是关闭的：</p> 
<p><img alt="" class="has" src="https://images2.imgbox.com/0e/6e/F9KhVaFG_o.jpg"></p> 
<p>TCP FIN探测到主机端口是开放或屏蔽的：</p> 
<p><img alt="" class="has" src="https://images2.imgbox.com/7d/19/cEYYW9Zk_o.jpg"></p> 
<p>2.3.1.5    UDP scanning</p> 
<p>UDP扫描方式用于判断UDP端口的情况。向目标主机的UDP端口发送探测包，如果收到回复“ICMP port unreachable”就说明该端口是关闭的；如果没有收到回复，那说明UDP端口可能是开放的或屏蔽的。因此，通过反向排除法的方式来断定哪些UDP端口是可能出于开放状态。</p> 
<p>UDP端口关闭：</p> 
<p><img alt="" class="has" src="https://images2.imgbox.com/9b/9b/fHmlJkJ6_o.jpg"></p> 
<p>UDP端口开放或被屏蔽：</p> 
<p><img alt="" class="has" src="https://images2.imgbox.com/ee/c7/kJplxHm8_o.jpg"></p> 
<p>2.3.1.6    其他方式</p> 
<p>除上述几种常用的方式之外，Nmap还支持多种其他探测方式。例如使用SCTP INIT/COOKIE-ECHO方式来探测SCTP的端口开放情况；使用IP protocol方式来探测目标主机支持的协议类型（TCP/UDP/ICMP/SCTP等等）；使用idle scan方式借助僵尸主机（zombie host，也被称为idle host，该主机处于空闲状态并且它的IPID方式为递增。详细实现原理参见：<a href="http://nmap.org/book/idlescan.html" rel="nofollow">http://nmap.org/book/idlescan.html</a>）来扫描目标在主机，达到隐蔽自己的目的；或者使用FTP bounce scan，借助FTP允许的代理服务扫描其他的主机，同样达到隐藏自己的身份的目的。</p> 
<p> </p> 
<h4>2.3.2    端口扫描用法</h4> 
<p>端口扫描用法比较简单，Nmap提供丰富的命令行参数来指定扫描方式和扫描端口。</p> 
<p> </p> 
<p>具体可以参见如下描述。</p> 
<p>2.3.2.1    扫描方式选项</p> 
<p>[plain] <a href="http://blog.csdn.net/aspirationflow/article/details/7694274#">view plain</a><a href="http://blog.csdn.net/aspirationflow/article/details/7694274#">copy</a></p> 
<ol><li> <p>-sS/sT/sA/sW/sM:指定使用 TCP SYN/Connect()/ACK/Window/Maimon scans的方式来对目标主机进行扫描。</p> </li><li> <p>  -sU: 指定使用UDP扫描方式确定目标主机的UDP端口状况。</p> </li><li> <p>  -sN/sF/sX: 指定使用TCP Null, FIN, and Xmas scans秘密扫描方式来协助探测对方的TCP端口状态。</p> </li><li> <p>  –scanflags &lt;flags&gt;: 定制TCP包的flags。</p> </li><li> <p>  -sI &lt;zombiehost[:probeport]&gt;: 指定使用idle scan方式来扫描目标主机（前提需要找到合适的zombie host）</p> </li><li> <p>  -sY/sZ: 使用SCTP INIT/COOKIE-ECHO来扫描SCTP协议端口的开放的情况。</p> </li><li> <p>  -sO: 使用IP protocol 扫描确定目标机支持的协议类型。</p> </li><li> <p>  -b &lt;FTP relay host&gt;: 使用FTP bounce scan扫描方式</p> </li></ol> 
<p> </p> 
<p>2.3.2.2    端口参数与扫描顺序</p> 
<p>[plain] <a href="http://blog.csdn.net/aspirationflow/article/details/7694274#">view plain</a><a href="http://blog.csdn.net/aspirationflow/article/details/7694274#">copy</a></p> 
<ol><li> <p>-p &lt;port ranges&gt;: 扫描指定的端口</p> </li><li> <p>实例: -p22; -p1-65535; -p U:53,111,137,T:21-25,80,139,8080,S:9（其中T代表TCP协议、U代表UDP协议、S代表SCTP协议）</p> </li><li> <p>-F: Fast mode – 快速模式，仅扫描TOP 100的端口</p> </li><li> <p>-r: 不进行端口随机打乱的操作（如无该参数，nmap会将要扫描的端口以随机顺序方式扫描，以让nmap的扫描不易被对方防火墙检测到）。</p> </li><li> <p>–top-ports &lt;number&gt;:扫描开放概率最高的number个端口（nmap的作者曾经做过大规模地互联网扫描，以此统计出网络上各种端口可能开放的概率。以此排列出最有可能开放端口的列表，具体可以参见文件：nmap-services。默认情况下，nmap会扫描最有可能的1000个TCP端口）</p> </li><li> <p>–port-ratio &lt;ratio&gt;: 扫描指定频率以上的端口。与上述–top-ports类似，这里以概率作为参数，让概率大于–port-ratio的端口才被扫描。显然参数必须在在0到1之间，具体范围概率情况可以查看nmap-services文件。</p> </li></ol> 
<p> </p> 
<h4>2.3.3    端口扫描演示</h4> 
<p>这里，我们以扫描局域网内192.168.1.100主机为例。</p> 
<p>命令如下：</p> 
<p>nmap –sS –sU –T4 –top-ports 300 192.168.1.100</p> 
<p>参数-sS表示使用TCP SYN方式扫描TCP端口；-sU表示扫描UDP端口；-T4表示时间级别配置4级；–top-ports 300表示扫描最有可能开放的300个端口（TCP和UDP分别有300个端口）。</p> 
<p><img alt="" class="has" src="https://images2.imgbox.com/29/90/4hI2a6ik_o.jpg"></p> 
<p>从上图中，我们看到扫描结果，横线处写明有共有589端口是关闭的；红色框图中列举出开放的端口和可能是开放的端口。</p> 
<h3>2.4    版本侦测</h3> 
<p>版本侦测，用于确定目标主机开放端口上运行的具体的应用程序及版本信息。</p> 
<p>Nmap提供的版本侦测具有如下的优点：</p> 
<ul><li> <p>高速。并行地进行套接字操作，实现一组高效的探测匹配定义语法。</p> </li><li> <p>尽可能地确定应用名字与版本名字。</p> </li><li> <p>支持TCP/UDP协议，支持文本格式与二进制格式。</p> </li><li> <p>支持多种平台服务的侦测，包括Linux/Windows/Mac OS/FreeBSD等系统。</p> </li><li> <p>如果检测到SSL，会调用openSSL继续侦测运行在SSL上的具体协议（如HTTPS/POP3S/IMAPS）。</p> </li><li> <p>如果检测到SunRPC服务，那么会调用brute-force RPC grinder进一步确定RPC程序编号、名字、版本号。</p> </li><li> <p>支持完整的IPv6功能，包括TCP/UDP，基于TCP的SSL。</p> </li><li> <p>通用平台枚举功能（CPE）</p> </li><li> <p>广泛的应用程序数据库（nmap-services-probes）。目前Nmap可以识别几千种服务的签名，包含了180多种不同的协议。</p> </li></ul> 
<h4>2.4.1    版本侦测原理</h4> 
<p>简要的介绍版本的侦测原理。</p> 
<p>版本侦测主要分为以下几个步骤：</p> 
<ol><li> <p>首先检查open与open|filtered状态的端口是否在排除端口列表内。如果在排除列表，将该端口剔除。</p> </li><li> <p>如果是TCP端口，尝试建立TCP连接。尝试等待片刻（通常6秒或更多，具体时间可以查询文件nmap-services-probes中Probe TCP NULL q||对应的totalwaitms）。通常在等待时间内，会接收到目标机发送的“WelcomeBanner”信息。nmap将接收到的Banner与nmap-services-probes中NULL probe中的签名进行对比。查找对应应用程序的名字与版本信息。</p> </li><li> <p>如果通过“Welcome Banner”无法确定应用程序版本，那么nmap再尝试发送其他的探测包（即从nmap-services-probes中挑选合适的probe），将probe得到回复包与数据库中的签名进行对比。如果反复探测都无法得出具体应用，那么打印出应用返回报文，让用户自行进一步判定。</p> </li><li> <p>如果是UDP端口，那么直接使用nmap-services-probes中探测包进行探测匹配。根据结果对比分析出UDP应用服务类型。</p> </li><li> <p>如果探测到应用程序是SSL，那么调用openSSL进一步的侦查运行在SSL之上的具体的应用类型。</p> </li><li> <p>如果探测到应用程序是SunRPC，那么调用brute-force RPC grinder进一步探测具体服务。</p> </li></ol> 
<h4>2.4.2    版本侦测的用法</h4> 
<p>版本侦测方面的命令行选项比较简单。</p> 
<p>[plain] <a href="http://blog.csdn.net/aspirationflow/article/details/7694274#">view plain</a><a href="http://blog.csdn.net/aspirationflow/article/details/7694274#">copy</a></p> 
<ol><li> <p>-sV: 指定让Nmap进行版本侦测</p> </li><li> <p>–version-intensity &lt;level&gt;: 指定版本侦测强度（0-9），默认为7。数值越高，探测出的服务越准确，但是运行时间会比较长。</p> </li><li> <p>–version-light: 指定使用轻量侦测方式 (intensity 2)</p> </li><li> <p>–version-all: 尝试使用所有的probes进行侦测 (intensity 9)</p> </li><li> <p>–version-trace: 显示出详细的版本侦测过程信息。</p> </li></ol> 
<p> </p> 
<h4>2.4.3    版本侦测演示</h4> 
<p>命令：</p> 
<p>nmap –sV 192.168.1.100</p> 
<p>对主机192.168.1.100进行版本侦测。</p> 
<p><img alt="" class="has" src="https://images2.imgbox.com/7d/a2/4oiJsJ6B_o.jpg"></p> 
<p>从结果中，我们可以看到996个端口是关闭状态，对于4个open的端口进行版本侦测。图中红色为版本信息。红色线条划出部分是版本侦测得到的附加信息，因为从应用中检测到微软特定的应用服务，所以推断出对方运行的Windows的操作系统。</p> 
<h3>2.5    OS侦测</h3> 
<p>操作系统侦测用于检测目标主机运行的操作系统类型及设备类型等信息。</p> 
<p>Nmap拥有丰富的系统数据库nmap-os-db，目前可以识别2600多种操作系统与设备类型。</p> 
<h4>2.5.1    OS侦测原理</h4> 
<p>Nmap使用TCP/IP协议栈指纹来识别不同的操作系统和设备。在RFC规范中，有些地方对TCP/IP的实现并没有强制规定，由此不同的TCP/IP方案中可能都有自己的特定方式。Nmap主要是根据这些细节上的差异来判断操作系统的类型的。</p> 
<p>具体实现方式如下：</p> 
<p> </p> 
<ol><li> <p>Nmap内部包含了2600多已知系统的指纹特征（在文件nmap-os-db文件中）。将此指纹数据库作为进行指纹对比的样本库。</p> </li><li> <p>分别挑选一个open和closed的端口，向其发送经过精心设计的TCP/UDP/ICMP数据包，根据返回的数据包生成一份系统指纹。</p> </li><li> <p>将探测生成的指纹与nmap-os-db中指纹进行对比，查找匹配的系统。如果无法匹配，以概率形式列举出可能的系统。</p> </li></ol> 
<p> </p> 
<h4>2.5.2    OS侦测用法</h4> 
<p>OS侦测的用法简单，Nmap提供的命令比较少。</p> 
<p>[plain] <a href="http://blog.csdn.net/aspirationflow/article/details/7694274#">view plain</a><a href="http://blog.csdn.net/aspirationflow/article/details/7694274#">copy</a></p> 
<ol><li> <p>-O: 指定Nmap进行OS侦测。</p> </li><li> <p>–osscan-limit: 限制Nmap只对确定的主机的进行OS探测（至少需确知该主机分别有一个open和closed的端口）。</p> </li><li> <p>–osscan-guess: 大胆猜测对方的主机的系统类型。由此准确性会下降不少，但会尽可能多为用户提供潜在的操作系统。</p> </li></ol> 
<h4>2.5.3    OS侦测演示</h4> 
<p>命令：</p> 
<p>nmap –O 192.168.1.100</p> 
<p><img alt="" class="has" src="https://images2.imgbox.com/15/f8/o9kxa7Rq_o.jpg"></p> 
<p>从上图中可看到，指定-O选项后先进行主机发现与端口扫描，根据扫描到端口来进行进一步的OS侦测。获取的结果信息有设备类型，操作系统类型，操作系统的CPE描述，操作系统细节，网络距离等。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/fd0acaa3ff33c6c87419c33750576f5a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">MyEclipse10.7能否使用jdk1.8？</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/dbda1bac05626a51c05cc7cd29af0924/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">摄像头移植简述(sprd)</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>