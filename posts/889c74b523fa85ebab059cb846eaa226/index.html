<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>mediastreamer2 android,一起启动Linphone MediaStreamer2音频和视频流 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="mediastreamer2 android,一起启动Linphone MediaStreamer2音频和视频流" />
<meta property="og:description" content="仅使用mediastreamer2库我可以使用远程ip和端口开始音频调用，并调用audiostream.c各自的方法 .
然后我也需要开始视频通话 . 所以初始化videostream.c并使用其各自的方法并为其提供表面以呈现远程和本地相机馈送 . 我能够通过远程端口和ip成功启动视频流 .
但问题是我一起开始两个流 . 声音停止和视频流也停止 . 只有本地相机输入工作 .
所以我有一个神奇的方法，为我做这一切 . 如果我评论它的视频部分 . 音频通话工作正常，如果评论音频部分，视频通话工作正常 . 但是当我开始时 . 没有声音没有流媒体 . 但是我们成功启动了AudioStream并且VideoStream成功启动了日志 .
拥有linphone经验的人可以帮助确定正确的方法顺序吗？或者我们做错了什么这是我们的方法 .
JNIEXPORT jint JNICALL Java_com_myapp_services_LinPhoneMSEngine_LinPhoneMSVE_1AudioStreamStartFull
(JNIEnv *env, jclass self, jstring remote_ip, jint remote_port, jint localport, jint payloadindex, jboolean isLowEnd)
{
int bRetVal = 0;
MSVideoSize size = {320, 240};
char rtcp_tool[128]={0};
int ret;
//jboolean copy;
char cname[128]={0};
const char *cremote_ip;
ortp_warning(&#34;Audio Stream Start Full&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/889c74b523fa85ebab059cb846eaa226/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-05-28T11:51:55+08:00" />
<meta property="article:modified_time" content="2021-05-28T11:51:55+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">mediastreamer2 android,一起启动Linphone MediaStreamer2音频和视频流</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div style="font-size:16px;"> 
 <p>仅使用mediastreamer2库我可以使用远程ip和端口开始音频调用，并调用audiostream.c各自的方法 .</p> 
 <p>然后我也需要开始视频通话 . 所以初始化videostream.c并使用其各自的方法并为其提供表面以呈现远程和本地相机馈送 . 我能够通过远程端口和ip成功启动视频流 .</p> 
 <p>但问题是我一起开始两个流 . 声音停止和视频流也停止 . 只有本地相机输入工作 .</p> 
 <p>所以我有一个神奇的方法，为我做这一切 . 如果我评论它的视频部分 . 音频通话工作正常，如果评论音频部分，视频通话工作正常 . 但是当我开始时 . 没有声音没有流媒体 . 但是我们成功启动了AudioStream并且VideoStream成功启动了日志 .</p> 
 <p>拥有linphone经验的人可以帮助确定正确的方法顺序吗？或者我们做错了什么这是我们的方法 .</p> 
 <p>JNIEXPORT jint JNICALL Java_com_myapp_services_LinPhoneMSEngine_LinPhoneMSVE_1AudioStreamStartFull</p> 
 <p>(JNIEnv *env, jclass self, jstring remote_ip, jint remote_port, jint localport, jint payloadindex, jboolean isLowEnd)</p> 
 <p>{<!-- --></p> 
 <p>int bRetVal = 0;</p> 
 <p>MSVideoSize size = {320, 240};</p> 
 <p>char rtcp_tool[128]={0};</p> 
 <p>int ret;</p> 
 <p>//jboolean copy;</p> 
 <p>char cname[128]={0};</p> 
 <p>const char *cremote_ip;</p> 
 <p>ortp_warning("Audio Stream Start Full");</p> 
 <p>LOGD("Audio Stream Start Full");</p> 
 <p>cremote_ip = (*env)-&gt;GetStringUTFChars(env, remote_ip, NULL);</p> 
 <p>ortp_warning("Cremote_ip= %s", cremote_ip);</p> 
 <p>LOGD("Cremote_ip= %s", cremote_ip);</p> 
 <p>// ms_filter_enable_statistics(TRUE);</p> 
 <p>veData-&gt;queue = ortp_ev_queue_new();</p> 
 <p>veData-&gt;soundCard = NULL;</p> 
 <p>set_playback_device();</p> 
 <p>ortp_warning("sound: playback_dev_id: %s", ms_snd_card_get_string_id(veData-&gt;soundCard));</p> 
 <p>LOGD("sound: playback_dev_id: %s", ms_snd_card_get_string_id(veData-&gt;soundCard));</p> 
 <p>veData-&gt;CaptureCard = NULL;</p> 
 <p>set_capture_device();</p> 
 <p>ortp_warning("sound: capture_dev_id: %s", ms_snd_card_get_string_id(veData-&gt;CaptureCard));</p> 
 <p>LOGD("sound: capture_dev_id: %s", ms_snd_card_get_string_id(veData-&gt;CaptureCard));</p> 
 <p>veData-&gt;audioStream = audio_stream_new(msFactory ,localport, localport + 1, false);</p> 
 <p>audio_stream_enable_adaptive_bitrate_control(veData-&gt;audioStream, true);</p> 
 <p>audio_stream_enable_adaptive_jittcomp(veData-&gt;audioStream, true);</p> 
 <p>rtp_session_set_jitter_compensation(veData-&gt;audioStream-&gt;ms.sessions.rtp_session, 50);</p> 
 <p>rtp_session_enable_rtcp_mux(veData-&gt;audioStream-&gt;ms.sessions.rtp_session, true);</p> 
 <p>ret=AUDIO_STREAM_FEATURE_VOL_SND | \</p> 
 <p>AUDIO_STREAM_FEATURE_VOL_RCV;</p> 
 <p>if (!isLowEnd)</p> 
 <p>{<!-- --></p> 
 <p>ret = ret | AUDIO_STREAM_FEATURE_EC | AUDIO_STREAM_FEATURE_EQUALIZER | AUDIO_STREAM_FEATURE_DTMF | AUDIO_STREAM_FEATURE_DTMF_ECHO;</p> 
 <p>audio_stream_set_features(veData-&gt;audioStream, ret);</p> 
 <p>ortp_warning("Setting Echo Canceller params");</p> 
 <p>LOGD("Setting Echo Canceller params");</p> 
 <p>rtp_session_enable_jitter_buffer(veData-&gt;audioStream-&gt;ms.sessions.rtp_session, TRUE);</p> 
 <p>audio_stream_set_echo_canceller_params(veData-&gt;audioStream, 60, 0, 128);</p> 
 <p>audio_stream_enable_gain_control(veData-&gt;audioStream, true);</p> 
 <p>audio_stream_enable_automatic_gain_control(veData-&gt;audioStream, true);</p> 
 <p>}</p> 
 <p>else</p> 
 <p>{<!-- --></p> 
 <p>audio_stream_set_features(veData-&gt;audioStream, ret);</p> 
 <p>ortp_warning("No Echo Canceller params!!");</p> 
 <p>LOGD("No Echo Canceller params!!");</p> 
 <p>rtp_session_enable_jitter_buffer(veData-&gt;audioStream-&gt;ms.sessions.rtp_session, FALSE);</p> 
 <p>}</p> 
 <p>if( veData-&gt;audioStream == NULL){<!-- --></p> 
 <p>ortp_warning("AudioStream is Null");</p> 
 <p>LOGD("AudioStream is Null");</p> 
 <p>bRetVal = -1;</p> 
 <p>return -1;</p> 
 <p>}</p> 
 <p>audio_stream_play_received_dtmfs(veData-&gt;audioStream, true);</p> 
 <p>snprintf(rtcp_tool,sizeof(rtcp_tool)-1,"%s-%s","Android","2.8.0");</p> 
 <p>snprintf(cname,sizeof(cname)-1,"%s-%d", cremote_ip, remote_port);</p> 
 <p>ortp_warning("cname value: %s",cname);</p> 
 <p>LOGD("cname value: %s",cname);</p> 
 <p>audio_stream_prepare_sound(veData-&gt;audioStream, veData-&gt;soundCard, veData-&gt;CaptureCard);</p> 
 <p>if(0== audio_stream_start_full(veData-&gt;audioStream,veData-&gt;prof, cremote_ip, remote_port, cremote_ip, remote_port + 1, 114, 50,NULL,NULL,veData-&gt;soundCard,veData-&gt;CaptureCard, !isLowEnd))</p> 
 <p>{<!-- --></p> 
 <p>veData-&gt;rtpSession = veData-&gt;audioStream-&gt;ms.sessions.rtp_session;</p> 
 <p>ortp_warning("AudioStreamStartFull Success");</p> 
 <p>post_audio_config(veData-&gt;audioStream);</p> 
 <p>audio_stream_set_rtcp_information(veData-&gt;audioStream, cname, rtcp_tool);</p> 
 <p>}</p> 
 <p>else</p> 
 <p>{<!-- --></p> 
 <p>ortp_warning("AudioStream start failed");</p> 
 <p>bRetVal = -1;</p> 
 <p>}</p> 
 <p>// init video stream</p> 
 <p>veData-&gt;videoStream = video_stream_new(msFactory, localport,localport+1,false);</p> 
 <p>video_stream_enable_adaptive_bitrate_control(veData-&gt;videoStream, true);</p> 
 <p>video_stream_enable_adaptive_jittcomp(veData-&gt;videoStream, true);</p> 
 <p>rtp_session_enable_rtcp_mux(veData-&gt;videoStream-&gt;ms.sessions.rtp_session, true);</p> 
 <p>video_stream_use_video_preset(veData-&gt;videoStream, "custom");</p> 
 <p>video_stream_set_sent_video_size(veData-&gt;videoStream, size);</p> 
 <p>video_stream_set_preview_size(veData-&gt;videoStream, size);</p> 
 <p>video_stream_enable_self_view(veData-&gt;videoStream, TRUE);</p> 
 <p>ortp_message("Video Stream : [%p] &amp; native window id : [%p]",veData-&gt;videoStream, veData-&gt;native_window_id);</p> 
 <p>video_stream_set_native_window_id(veData-&gt;videoStream, veData-&gt;native_window_id);</p> 
 <p>ortp_message("Video Stream : [%p] &amp; preview window id : [%p]",veData-&gt;videoStream, veData-&gt;native_preview_window_id);</p> 
 <p>video_stream_set_native_preview_window_id(veData-&gt;videoStream, veData-&gt;native_preview_window_id);</p> 
 <p>video_stream_use_preview_video_window(veData-&gt;videoStream, TRUE);</p> 
 <p>video_stream_set_device_rotation(veData-&gt;videoStream, 0);</p> 
 <p>video_stream_set_fps(veData-&gt;videoStream, 10.0);</p> 
 <p>// link audio with video</p> 
 <p>audio_stream_link_video(veData-&gt;audioStream, veData-&gt;videoStream);</p> 
 <p>ms_message("Setting webcam as %p", veData-&gt;msWebCam);</p> 
 <p>if(bRetVal != -1 &amp;&amp; video_stream_start(veData-&gt;videoStream, veData-&gt;prof,</p> 
 <p>cremote_ip,</p> 
 <p>remote_port,</p> 
 <p>cremote_ip,</p> 
 <p>remote_port + 1,</p> 
 <p>101,</p> 
 <p>60,</p> 
 <p>veData-&gt;msWebCam) &gt;=0 ) {<!-- --></p> 
 <p>ortp_warning("VideoStream started successfully");</p> 
 <p>veData-&gt;rtpSession = veData-&gt;videoStream-&gt;ms.sessions.rtp_session;</p> 
 <p>video_stream_set_rtcp_information(veData-&gt;videoStream, cname,rtcp_tool);</p> 
 <p>}</p> 
 <p>else</p> 
 <p>{<!-- --></p> 
 <p>ortp_warning("VideoStream start failed");</p> 
 <p>bRetVal = -1;</p> 
 <p>}</p> 
 <p>(*env)-&gt;ReleaseStringUTFChars(env, remote_ip, cremote_ip);</p> 
 <p>return bRetVal;</p> 
 <p>}</p> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/559f8a2fcf8f72e31a09fc7ba8ac8c25/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">npm install的几种方式区别</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/426c8fc6636021f153b9102d987963c9/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【python】去除图片高光</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>