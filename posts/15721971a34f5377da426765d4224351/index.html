<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>动态库加载失败：error while loading shared libraries: xxx.so: cannot open shared object file: No such file o - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="动态库加载失败：error while loading shared libraries: xxx.so: cannot open shared object file: No such file o" />
<meta property="og:description" content="已解决：动态库加载失败：error while loading shared libraries: xxx.so: cannot open shared object file: No such file or directory 使用动态库编译链接main.c后，得到名为main的可执行程序。但是在运行main可执行程序时，程序报错：
./main: error while loading shared libraries: libcalc.so: cannot open shared object file: No such file or directory
如下图所示：
2. 问题出现的原因 首先利用ldd命令查看一下main的动态库依赖关系。
ldd main 1 结果如下图所示，可以看到，动态库libcalc.so没有被找到。
至于找不到的情况分为两种:
系统里根本不存在libcalc.so库；libcalc.so库在系统中存在，但是ld-linux.so找不到，即libxxx.so库的位置没有告知ld-linux.so。 由于动态库libcalc.so是自己刚刚创建好的，因此属于第二种情况。
由0.1 动态库的工作原理可知，只要把动态库libcalc.so的绝对路径添加到动态载入器ld-linux.so的搜索路径中，那么动态载入器就可以获取到动态库libcalc.so的绝对路径，接着就可以找到动态库文件libcalc.so，将动态库文件载入内存，然后就可以使用动态库里面的代码，最终可执行程序main就可以成功运行，不会报错。
还是由0.1 动态库的工作原理可知，动态载入器搜索动态库绝对路径的搜索顺序为：DT_RPATH段→环境变量LD_LIBRARY_PATH→/etc/ld.so.cache文件列表→/lib/或/usr/lib目录
因此，添加动态库绝对路径的方法也有很多种
接下来，我们就按照上述分析进行操作。
3. 解决问题 3.1 将动态库绝对路径添加至环境变量LD_LIBRARY_PATH 3.1.1 临时环境变量 首先进入存放动态库的文件夹内，然后输入如下命令，获取动态库libcalc.so的绝对路径，然后复制此绝对路径。
pwd的全称为Print Working Directory，即显示工作目录的路径。 pwd 1 输出如下：
然后输入如下命令，将动态库绝对路径添加至环境变量LD_LIBRARY_PATH中。其中：
export的意思是设置一个环境变量。$LD_LIBRARY_PATH的意思是，获取环境变量LD_LIBRARY_PATH当前的值。:/home/veroll/Linux/lesson1.6/library/lib的意思是，在冒号后写上要新加入环境变量的值，即动态库的绝对路径/home/veroll/Linux/lesson1.6/library/lib。 export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/home/veroll/Linux/lesson1.6/library/lib 1 输入完上述命令后，输入如下命令检查一下环境变量LD_LIBRARY_PATH的值。其中：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/15721971a34f5377da426765d4224351/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-11-16T16:50:07+08:00" />
<meta property="article:modified_time" content="2022-11-16T16:50:07+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">动态库加载失败：error while loading shared libraries: xxx.so: cannot open shared object file: No such file o</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-github-gist">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="error_while_loading_shared_libraries_xxxso_cannot_open_shared_object_file_No_such_file_or_directory_0"></a>已解决：动态库加载失败：error while loading shared libraries: xxx.so: cannot open shared object file: No such file or directory</h2> 
<p>使用动态库编译链接main.c后，得到名为main的可执行程序。但是在运行main可执行程序时，程序报错：<br> <code>./main: error while loading shared libraries: libcalc.so: cannot open shared object file: No such file or directory</code><br> 如下图所示：<br> <img src="https://images2.imgbox.com/bb/bd/TtY2zcDg_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="2__6"></a>2. 问题出现的原因</h2> 
<p>首先利用ldd命令查看一下main的动态库依赖关系。</p> 
<pre class="prettyprint"><code class="prism language-bash has-numbering">ldd main
</code>
 
 <div class="hljs-button {2}"></div>
 
 </pre><ul class="pre-numbering"><li>1</li></ul> 
<p>结果如下图所示，可以看到，动态库libcalc.so没有被找到。<br> <img src="https://images2.imgbox.com/55/f1/4BsrKxPk_o.png" alt="在这里插入图片描述"></p> 
<p>至于找不到的情况分为两种:</p> 
<ul><li>系统里根本不存在libcalc.so库；</li><li>libcalc.so库在系统中存在，但是ld-linux.so找不到，即libxxx.so库的位置没有告知ld-linux.so。</li></ul> 
<p>由于动态库libcalc.so是自己刚刚创建好的，因此属于第二种情况。</p> 
<p>由<a href="https://blog.csdn.net/mahoon411/article/details/113565482">0.1 动态库的工作原理</a>可知，只要把动态库libcalc.so的绝对路径添加到动态载入器ld-linux.so的搜索路径中，那么动态载入器就可以获取到动态库libcalc.so的绝对路径，接着就可以找到动态库文件libcalc.so，将动态库文件载入内存，然后就可以使用动态库里面的代码，最终可执行程序main就可以成功运行，不会报错。</p> 
<p>还是由<a href="https://blog.csdn.net/mahoon411/article/details/113565482">0.1 动态库的工作原理</a>可知，动态载入器搜索动态库绝对路径的搜索顺序为：DT_RPATH段→环境变量LD_LIBRARY_PATH→/etc/ld.so.cache文件列表→/lib/或/usr/lib目录</p> 
<p>因此，添加动态库绝对路径的方法也有很多种</p> 
<p>接下来，我们就按照上述分析进行操作。</p> 
<h2><a id="3__28"></a>3. 解决问题</h2> 
<h3><a id="31_LD_LIBRARY_PATH_29"></a>3.1 将动态库绝对路径添加至环境变量LD_LIBRARY_PATH</h3> 
<h4><a id="311__30"></a>3.1.1 临时环境变量</h4> 
<p>首先进入存放动态库的文件夹内，然后输入如下命令，获取动态库libcalc.so的绝对路径，然后复制此绝对路径。</p> 
<ul><li><code>pwd</code>的全称为Print Working Directory，即显示工作目录的路径。</li></ul> 
<pre class="prettyprint"><code class="prism language-bash has-numbering"><span class="token builtin class-name">pwd</span>
</code>
 
 <div class="hljs-button {2}"></div>
 
 </pre><ul class="pre-numbering"><li>1</li></ul> 
<p>输出如下：<br> <img src="https://images2.imgbox.com/66/66/F90nzYO2_o.png" alt="在这里插入图片描述"><br> 然后输入如下命令，将动态库绝对路径添加至环境变量LD_LIBRARY_PATH中。其中：</p> 
<ul><li><code>export</code>的意思是设置一个环境变量。</li><li><code>$LD_LIBRARY_PATH</code>的意思是，获取环境变量LD_LIBRARY_PATH当前的值。</li><li><code>:/home/veroll/Linux/lesson1.6/library/lib</code>的意思是，在冒号后写上要新加入环境变量的值，即动态库的绝对路径<code>/home/veroll/Linux/lesson1.6/library/lib</code>。</li></ul> 
<pre class="prettyprint"><code class="prism language-bash has-numbering"><span class="token builtin class-name">export</span> <span class="token assign-left variable">LD_LIBRARY_PATH</span><span class="token operator">=</span><span class="token variable">$LD_LIBRARY_PATH</span>:/home/veroll/Linux/lesson1.6/library/lib
</code>
 
 <div class="hljs-button {2}"></div>
 
 </pre><ul class="pre-numbering"><li>1</li></ul> 
<p><img src="https://images2.imgbox.com/b2/a9/Ighx9zZH_o.png" alt="在这里插入图片描述"></p> 
<p>输入完上述命令后，输入如下命令检查一下环境变量LD_LIBRARY_PATH的值。其中：</p> 
<ul><li><code>echo</code>的意思是，输出echo后的内容。有两种用法：1. 直接跟着string，则在界面上打印出string。2. $sth，$表示后面接的是变量，会在界面上显示出sth变量的值。</li></ul> 
<pre class="prettyprint"><code class="prism language-bash has-numbering"><span class="token builtin class-name">echo</span> <span class="token variable">$LD_LIBRARY_PATH</span>
</code>
 
 <div class="hljs-button {2}"></div>
 
 </pre><ul class="pre-numbering"><li>1</li></ul> 
<p>输出结果如下图，可见动态库的绝对路径已经成功添加至环境变量LD_LIBRARY_PATH中了。<br> <img src="https://images2.imgbox.com/46/fe/K3VgyWE7_o.png" alt="在这里插入图片描述"><br> 最后再使用ldd命令查看一下main的动态库依赖关系，如下图所示，此时动态载入器就可以获取到动态库libcalc.so的绝对路径了。接下来就可以找到动态库文件libcalc.so，然后将动态库文件载入内存，接着就可以使用动态库里面的代码，最终可执行程序main就可以成功运行了。<br> <img src="https://images2.imgbox.com/20/28/jMphD7GV_o.png" alt="在这里插入图片描述"><br> 我们来试着运行一下main。<br> <img src="https://images2.imgbox.com/f7/67/rJIY2lua_o.png" alt="在这里插入图片描述"><br> 此时main就可以成功运行了。</p> 
<p>但是这个方法有一个缺点，就是：刚才配置环境变量时，本质上是在刚才使用的终端中配置的环境变量(临时的环境变量)，一旦关闭刚才的终端，再新启动一个终端，再次运行main时，就又会报错。<br> <img src="https://images2.imgbox.com/b8/fa/KwBdmQ07_o.png" alt="在这里插入图片描述"></p> 
<p>因此最好配置一个永久的环境变量。配置永久的环境变量又有两种方法，一种是用户级别，另一种是系统级别。</p> 
<h4><a id="312__68"></a>3.1.2 用户级别：配置永久环境变量</h4> 
<p>输入命令<code>cd</code>或者命令<code>cd /home/veroll/</code>，进入用户目录(veroll)下。<br> <img src="https://images2.imgbox.com/4e/05/HlXQUXm5_o.png" alt="在这里插入图片描述"><br> 输入命令<code>vim ./.bashrc</code>，编辑<code>.bashrc</code>文件。其中：</p> 
<ul><li><code>./</code>的意思是当前目录下。<br> <img src="https://images2.imgbox.com/88/26/mbHHmSUO_o.png" alt="在这里插入图片描述"></li></ul> 
<p><img src="https://images2.imgbox.com/c8/23/Wc28S3pL_o.png" alt="在这里插入图片描述"><br> 然后在当前模式(命令模式)下输入shift+g(也就是G)移动到这个文件的最后一行，然后输入o(小写的o)，即在目前光标所在的下一行处输入新的一行，进入输入模式。<br> (更多vim指令请见博客：<a href="https://blog.csdn.net/mahoon411/article/details/113246926">Linux vi/vim命令大全</a>)<br> <img src="https://images2.imgbox.com/ce/17/PTAm87c0_o.png" alt="在这里插入图片描述"><br> 在这里输入配置环境变量的命令<code>export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/home/veroll/Linux/lesson1.6/library/lib</code>。<br> <img src="https://images2.imgbox.com/4a/83/VKCuplkl_o.png" alt="在这里插入图片描述"><br> 然后按一下esc见进入命令模式，输入命令<code>:wq</code>，按回车，保存并退出。<br> <img src="https://images2.imgbox.com/6b/be/drpznWLJ_o.png" alt="在这里插入图片描述"><br> 接着输入如下命令，使修改生效。其中：</p> 
<ul><li><code>source</code>的用法语句为<code>source filename</code>，意思是通知当前shell读入路径为filename的文件并依次执行文件中的所有语句。该命令通常用<code>.</code>替代，如：<code>source ./.bashrc</code>与<code>. ./.bashrc</code>是等价的。详细用法见博客：<a href="https://blog.csdn.net/mahoon411/article/details/113620848">Linux中的source命令(.命令)的用法</a></li></ul> 
<pre class="prettyprint"><code class="prism language-bash has-numbering"><span class="token builtin class-name">source</span> ./.bashrc
</code>
 
 <div class="hljs-button {2}"></div>
 
 </pre><ul class="pre-numbering"><li>1</li></ul> 
<p>如下图所示运行完此命令后，<code>.bashrc</code>文件的修改就生效了，也就是说环境变量添加成功了。<br> <img src="https://images2.imgbox.com/94/dd/6oL7T5iF_o.png" alt="在这里插入图片描述"><br> 然后进入main的目录中，使用ldd命令查看一下main的动态库依赖关系。<br> <img src="https://images2.imgbox.com/3f/58/rjqsQhh2_o.png" alt="在这里插入图片描述"><br> 如上图所示，此时动态载入器就可以获取到动态库libcalc.so的绝对路径了。</p> 
<p>运行一下main。<br> <img src="https://images2.imgbox.com/85/3b/TmewdO2j_o.png" alt="在这里插入图片描述"><br> 运行成功。</p> 
<h4><a id="313__100"></a>3.1.3 系统级别：配置永久环境变量</h4> 
<p>在系统级别下配置永久环境变量时，需要获取权限。</p> 
<p>在任意目录下，输入如下命令，然后输入用户密码。</p> 
<pre class="prettyprint"><code class="prism language-bash has-numbering"><span class="token function">sudo</span> <span class="token function">vim</span> /etc/profile
</code>
 
 <div class="hljs-button {2}"></div>
 
 </pre><ul class="pre-numbering"><li>1</li></ul> 
<p><img src="https://images2.imgbox.com/3b/dd/C3GlNiD3_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/29/77/omMsmHgK_o.png" alt="在这里插入图片描述"><br> 然后在当前模式(命令模式)下输入shift+g(也就是G)移动到这个文件的最后一行，然后输入o(小写的o)，即在目前光标所在的下一行处输入新的一行，进入输入模式。<br> (更多vim指令请见博客：<a href="https://blog.csdn.net/mahoon411/article/details/113246926">Linux vi/vim命令大全</a>)<br> <img src="https://images2.imgbox.com/cf/79/vehYzuCz_o.png" alt="在这里插入图片描述"></p> 
<p>在这里输入配置环境变量的命令<code>export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/home/veroll/Linux/lesson1.6/library/lib</code>。</p> 
<p><img src="https://images2.imgbox.com/16/eb/h7Bi3Ybg_o.png" alt="在这里插入图片描述"></p> 
<p>然后按一下esc见进入命令模式，输入命令<code>:wq</code>，按回车，保存并退出。<br> <img src="https://images2.imgbox.com/07/f6/TD55i1BL_o.png" alt="在这里插入图片描述"></p> 
<p>接着输入如下命令，使修改生效。</p> 
<pre class="prettyprint"><code class="prism language-bash has-numbering"><span class="token builtin class-name">source</span> /etc/profile
</code>
 
 <div class="hljs-button {2}"></div>
 
 </pre><ul class="pre-numbering"><li>1</li></ul> 
<p><img src="https://images2.imgbox.com/e8/dd/JgAVjCkV_o.png" alt="在这里插入图片描述"><br> 使用ldd命令查看一下main的动态库依赖关系。<br> <img src="https://images2.imgbox.com/88/40/6s7LO6ag_o.png" alt="在这里插入图片描述"><br> 如上图所示，此时动态载入器就可以获取到动态库libcalc.so的绝对路径了。</p> 
<p>运行一下main。<br> <img src="https://images2.imgbox.com/51/39/NzlLN3jx_o.png" alt="在这里插入图片描述"><br> 运行成功。</p> 
<h3><a id="32_etcldsocache_137"></a>3.2 将动态库绝对路径添加至/etc/ld.so.cache文件列表中</h3> 
<p>首先输入如下命令查看一下<code>ld.so.cache</code>文件，并尝试对其进行修改</p> 
<pre class="prettyprint"><code class="prism language-bash has-numbering"><span class="token function">vim</span> /etc/ld.so.cache
</code>
 
 <div class="hljs-button {2}"></div>
 
 </pre><ul class="pre-numbering"><li>1</li></ul> 
<p><img src="https://images2.imgbox.com/c6/d3/BuebiUcD_o.png" alt="在这里插入图片描述"></p> 
<p>发现是二进制文件，无法直接对其进行修改，因此需要间接修改文件内容。输入<code>:q!</code>，不保存直接退出。</p> 
<p>接着，输入如下命令，对<code>ld.so.conf</code>文件进行编辑，间接修改<code>ld.so.cache</code>文件内容。</p> 
<pre class="prettyprint"><code class="prism language-bash has-numbering"><span class="token function">sudo</span> <span class="token function">vim</span> /etc/ld.so.conf
</code>
 
 <div class="hljs-button {2}"></div>
 
 </pre><ul class="pre-numbering"><li>1</li></ul> 
<p><img src="https://images2.imgbox.com/5f/5d/AqunBLmB_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/09/9b/pCb9uS6R_o.png" alt="在这里插入图片描述"><br> 输入<code>o</code>(小写的o)进入输入模式，输入动态库的绝对路径<code>/home/veroll/Linux/lesson1.6/library/lib</code>。输入完成后，按下esc键，然后输入<code>:wq</code>，保存并退出。<br> <img src="https://images2.imgbox.com/f4/93/mv3bV4Ic_o.png" alt="在这里插入图片描述"><br> 然后输入如下命令，进行更新</p> 
<pre class="prettyprint"><code class="prism language-bash has-numbering"><span class="token function">sudo</span> ldconfig
</code>
 
 <div class="hljs-button {2}"></div>
 
 </pre><ul class="pre-numbering"><li>1</li></ul> 
<p><img src="https://images2.imgbox.com/ff/02/tuf2y7jd_o.png" alt="在这里插入图片描述"><br> 进入main所在目录后，使用ldd命令查看一下main的动态库依赖关系。<br> <img src="https://images2.imgbox.com/f2/a9/YdrWUp6T_o.png" alt="在这里插入图片描述"></p> 
<p>如上图所示，此时动态载入器就可以获取到动态库libcalc.so的绝对路径了。</p> 
<p>运行一下main。<br> <img src="https://images2.imgbox.com/8f/3f/I2chwsPK_o.png" alt="在这里插入图片描述"><br> 运行成功。</p> 
<h3><a id="33_libusrlib_171"></a>3.3 将动态库添加至/lib/或/usr/lib目录</h3> 
<p>如本节标题所示，直接将需要用到的动态库添加至<code>/lib/</code>或<code>/usr/lib</code>目录中，即可使用动态库。</p> 
<p>查看一下<code>/lib/</code>和<code>/usr/lib</code>目录中的内容，发现里面存放有系统的动态库文件。<br> <img src="https://images2.imgbox.com/34/a2/lc7DVdhB_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/56/b2/PNV5mziF_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/30/cb/nkXJXBB1_o.png" alt="在这里插入图片描述"></p> 
<p>若用户自己制作的动态库文件名与系统的动态库文件名重名的话，当把用户自己制作的动态库文件移动至上述两个文件夹内，会将系统的动态库文件覆盖掉，造成损失。因此不推荐使用此方法。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/12c539713b9fe491ab13e627fced5cdc/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">索引【MySQL】</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/91fe22eaba5798bb907a334986cc5299/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">尚硅谷智慧校园 —— 2、登录功能实现</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>