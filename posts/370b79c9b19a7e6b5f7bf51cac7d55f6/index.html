<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Python爬虫：网易云音乐评论爬取 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Python爬虫：网易云音乐评论爬取" />
<meta property="og:description" content="目录 0x00 写在前面0x01 iframe处理0x02 获取歌单0x03 获取歌曲0x04 获取评论0x05 完整代码0x06 总结 0x00 写在前面 这次的网易云音乐评论爬取跟ctfhub登录&#43;签到一样，算是一次实战吧，也算是把这几天学习到的给真正拿来运用了，在这期间呢也确实又学到了新的知识，也对之前学的selenium的知识做了巩固。
0x01 iframe处理 先来看网页源码
这里采用了iframe来构造页面，当我们单纯显示网站源码时，iframe里的东西我们时看不到的，所以我这里采用了selenium的switch_to.frame来切换到iframe页面进行元素的定位和信息的填写
url = &#34;https://music.163.com/#/search/m/&#34; driver.get(url) driver.switch_to.frame(&#39;g_iframe&#39;)#切换到iframe部分 sleep(1) driver.find_element_by_id(&#39;m-search-input&#39;).send_keys(user)#找到输入框并输入信息 driver.find_element_by_id(&#39;m-search-input&#39;).send_keys(Keys.ENTER) 回到网站，我是想搜索用户并访问其主页，再获取用户自己创建的歌单列表和歌单网址的列表，所以我们先去获得用户主页的网址，还是先去看看网页
显然我们可以通过id搜索来确定输入框，接着我偷了个懒没有管搜索的按钮，而是直接在输入框输入enter来达到目的。最后，我们还要点击用户按钮来使得我们的搜索显示的是用户以及用户主页，最后获得table元素即可
从而，getUser函数完整代码如下：
def getUser(user, driver):#user是要搜索的用户名，driver是我们的浏览器驱动 url = &#34;https://music.163.com/#/search/m/&#34; driver.get(url) driver.switch_to.frame(&#39;g_iframe&#39;)#根据iframe的id切换到iframe部分 sleep(1) driver.find_element_by_id(&#39;m-search-input&#39;).send_keys(user)#向搜索框中输入用户名 driver.find_element_by_id(&#39;m-search-input&#39;).send_keys(Keys.ENTER)#输入enter，代表开始搜索 driver.find_element_by_xpath(&#39;//*[@class=&#34;m-tabs m-tabs-srch f-cb ztag&#34;]/li[8]&#39;).click()#点击网页中的用户按钮，改变table的值 sleep(1) tab = driver.find_element_by_xpath(&#39;/html/body/div[3]/div/div[2]/div[2]/div/table/tbody&#39;)#获得table内的元素 users = tab.find_elements_by_tag_name(&#39;a&#39;)#从table中分离出包含有用数据的所有标签 list = [] for i, n in enumerate(users): if (i - 1) % 3 == 0: tu = (n.get_attribute(&#39;title&#39;), n.get_attribute(&#39;href&#39;)) list." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/370b79c9b19a7e6b5f7bf51cac7d55f6/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-08-30T12:28:51+08:00" />
<meta property="article:modified_time" content="2020-08-30T12:28:51+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Python爬虫：网易云音乐评论爬取</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><a href="#0x00__1" rel="nofollow">0x00 写在前面</a></li><li><a href="#0x01_iframe_3" rel="nofollow">0x01 iframe处理</a></li><li><a href="#0x02__45" rel="nofollow">0x02 获取歌单</a></li><li><a href="#0x03__69" rel="nofollow">0x03 获取歌曲</a></li><li><a href="#0x04__120" rel="nofollow">0x04 获取评论</a></li><li><a href="#0x05__231" rel="nofollow">0x05 完整代码</a></li><li><a href="#0x06__403" rel="nofollow">0x06 总结</a></li></ul> 
</div> 
<p></p> 
<h2><a id="0x00__1"></a>0x00 写在前面</h2> 
<p>这次的网易云音乐评论爬取跟ctfhub登录+签到一样，算是一次实战吧，也算是把这几天学习到的给真正拿来运用了，在这期间呢也确实又学到了新的知识，也对之前学的selenium的知识做了巩固。</p> 
<h2><a id="0x01_iframe_3"></a>0x01 iframe处理</h2> 
<p>先来看网页源码<br> <img src="https://images2.imgbox.com/0e/43/FXoRXoMf_o.png" alt="在这里插入图片描述"><br> 这里采用了iframe来构造页面，当我们单纯显示网站源码时，iframe里的东西我们时看不到的，所以我这里采用了selenium的switch_to.frame来切换到iframe页面进行元素的定位和信息的填写</p> 
<pre><code class="prism language-python">	url <span class="token operator">=</span> <span class="token string">"https://music.163.com/#/search/m/"</span>
    driver<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
    driver<span class="token punctuation">.</span>switch_to<span class="token punctuation">.</span>frame<span class="token punctuation">(</span><span class="token string">'g_iframe'</span><span class="token punctuation">)</span><span class="token comment">#切换到iframe部分</span>
    sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    driver<span class="token punctuation">.</span>find_element_by_id<span class="token punctuation">(</span><span class="token string">'m-search-input'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>send_keys<span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token comment">#找到输入框并输入信息</span>
    driver<span class="token punctuation">.</span>find_element_by_id<span class="token punctuation">(</span><span class="token string">'m-search-input'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>send_keys<span class="token punctuation">(</span>Keys<span class="token punctuation">.</span>ENTER<span class="token punctuation">)</span>
</code></pre> 
<p>回到网站，我是想搜索用户并访问其主页，再获取用户自己创建的歌单列表和歌单网址的列表，所以我们先去获得用户主页的网址，还是先去看看网页<br> <img src="https://images2.imgbox.com/fa/48/LKTEqeSO_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/7e/b1/Fay8REhn_o.png" alt="在这里插入图片描述"></p> 
<p>显然我们可以通过id搜索来确定输入框，接着我偷了个懒没有管搜索的按钮，而是直接在输入框输入enter来达到目的。最后，我们还要点击用户按钮来使得我们的搜索显示的是用户以及用户主页，最后获得table元素即可<br> 从而，getUser函数完整代码如下：</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">getUser</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> driver<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment">#user是要搜索的用户名，driver是我们的浏览器驱动</span>
    url <span class="token operator">=</span> <span class="token string">"https://music.163.com/#/search/m/"</span>
    driver<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
    driver<span class="token punctuation">.</span>switch_to<span class="token punctuation">.</span>frame<span class="token punctuation">(</span><span class="token string">'g_iframe'</span><span class="token punctuation">)</span><span class="token comment">#根据iframe的id切换到iframe部分</span>
    sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    driver<span class="token punctuation">.</span>find_element_by_id<span class="token punctuation">(</span><span class="token string">'m-search-input'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>send_keys<span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token comment">#向搜索框中输入用户名</span>
    driver<span class="token punctuation">.</span>find_element_by_id<span class="token punctuation">(</span><span class="token string">'m-search-input'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>send_keys<span class="token punctuation">(</span>Keys<span class="token punctuation">.</span>ENTER<span class="token punctuation">)</span><span class="token comment">#输入enter，代表开始搜索</span>
    driver<span class="token punctuation">.</span>find_element_by_xpath<span class="token punctuation">(</span><span class="token string">'//*[@class="m-tabs m-tabs-srch f-cb ztag"]/li[8]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#点击网页中的用户按钮，改变table的值</span>
    sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    tab <span class="token operator">=</span> driver<span class="token punctuation">.</span>find_element_by_xpath<span class="token punctuation">(</span><span class="token string">'/html/body/div[3]/div/div[2]/div[2]/div/table/tbody'</span><span class="token punctuation">)</span><span class="token comment">#获得table内的元素</span>
    users <span class="token operator">=</span> tab<span class="token punctuation">.</span>find_elements_by_tag_name<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token comment">#从table中分离出包含有用数据的所有标签</span>
    <span class="token builtin">list</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> i<span class="token punctuation">,</span> n <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>users<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">3</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            tu <span class="token operator">=</span> <span class="token punctuation">(</span>n<span class="token punctuation">.</span>get_attribute<span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> n<span class="token punctuation">.</span>get_attribute<span class="token punctuation">(</span><span class="token string">'href'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token builtin">list</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>tu<span class="token punctuation">)</span><span class="token comment">#通过循环把所有的用户id和对应主页url成对放在列表list里</span>
    <span class="token keyword">for</span> i<span class="token punctuation">,</span> n <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'['</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">']\t'</span> <span class="token operator">+</span> n<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">'\t'</span> <span class="token operator">+</span> n<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment">#打印list</span>
    num <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'请输入用户对应序号：'</span><span class="token punctuation">)</span><span class="token comment">#输入对应想要查看的用户</span>
    <span class="token keyword">return</span> <span class="token builtin">list</span><span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token comment">#返回该用户的url以及用户id，即(id,url)元组</span>
</code></pre> 
<h2><a id="0x02__45"></a>0x02 获取歌单</h2> 
<p>获取到了用户的url，接下来我们就要获取对应用户的歌单列表，这里我偷了个懒，只获得用户自己创建的歌单，先来看看网页</p> 
<p><img src="https://images2.imgbox.com/43/ac/j8PiR5lM_o.png" alt="在这里插入图片描述"><br> 又是一个iframe，其中，用户自己创建的歌单在id为cbox的ul里，这里就跟搜索用户一样，直接上代码</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">getSongs</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> driver<span class="token punctuation">)</span><span class="token punctuation">:</span>
    driver<span class="token punctuation">.</span>get<span class="token punctuation">(</span>user<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment">#打开对应网页</span>
    sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    driver<span class="token punctuation">.</span>switch_to<span class="token punctuation">.</span>frame<span class="token punctuation">(</span><span class="token string">'g_iframe'</span><span class="token punctuation">)</span><span class="token comment">#移动到iframe里</span>
    box <span class="token operator">=</span> driver<span class="token punctuation">.</span>find_element_by_xpath<span class="token punctuation">(</span><span class="token string">'//*[@id="cBox"]'</span><span class="token punctuation">)</span><span class="token comment">#找到歌单所在位置</span>
    li <span class="token operator">=</span> box<span class="token punctuation">.</span>find_elements_by_tag_name<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token comment">#找到里面包含歌单名和url的标签</span>
    <span class="token builtin">list</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> i<span class="token punctuation">,</span> n <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>li<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> i <span class="token operator">%</span> <span class="token number">3</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            tu <span class="token operator">=</span> <span class="token punctuation">(</span>n<span class="token punctuation">.</span>get_attribute<span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> n<span class="token punctuation">.</span>get_attribute<span class="token punctuation">(</span><span class="token string">'href'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token builtin">list</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>tu<span class="token punctuation">)</span><span class="token comment">#循环写把歌单和url成对写入列表里</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>user<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">'创建的歌单如下：'</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i<span class="token punctuation">,</span> n <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'['</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">']\t'</span> <span class="token operator">+</span> n<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">'\t'</span> <span class="token operator">+</span> n<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment">#打印列表</span>
    num <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'请选择对应歌单:'</span><span class="token punctuation">)</span><span class="token comment">#输入序号选择</span>
    <span class="token keyword">return</span> <span class="token builtin">list</span><span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">]</span>

</code></pre> 
<h2><a id="0x03__69"></a>0x03 获取歌曲</h2> 
<p>打开了歌单网页，接下来就是获取歌曲名和对应url了，代码写到这里的时候我才发现网页上只能显示前20首歌，自己登陆了看自己的歌单能看前1000首…所以我在这里又多写了一个登陆的代码块</p> 
<p>登陆按钮位置：<br> <img src="https://images2.imgbox.com/65/db/ofiZPMIj_o.png" alt="在这里插入图片描述"><br> 对登录弹框的处理(这里我选的是手机登录)：<br> <img src="https://images2.imgbox.com/ee/2f/U9TLldnH_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/b0/99/adHHhJa6_o.png" alt="在这里插入图片描述"><br> 别忘了要先勾选同意条款：<br> <img src="https://images2.imgbox.com/5e/9b/VyOF8Ysp_o.png" alt="在这里插入图片描述"><br> 接着输入账号密码：<br> <img src="https://images2.imgbox.com/5a/b3/Sc36B9Gj_o.png" alt="在这里插入图片描述"><br> 就能登录成功了，其实这一步可以省略，因为这步只是让我们爬取自己的歌单的时候可以爬到更多的信息…</p> 
<p>接下来是歌曲的获取部分，位置如图（这里图方便我就只获得了歌曲名，没有去多获取歌手名，其实影响不大）:</p> 
<p><img src="https://images2.imgbox.com/d7/4c/8lYvfrIR_o.png" alt="在这里插入图片描述"></p> 
<p>ok，位置都找到了，接下来就是写代码了</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">getSong</span><span class="token punctuation">(</span>driver<span class="token punctuation">,</span> songsname<span class="token punctuation">)</span><span class="token punctuation">:</span>
    sleep<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token comment">#sleep都是为了等待网页加载...</span>
    driver<span class="token punctuation">.</span>find_element_by_xpath<span class="token punctuation">(</span><span class="token string">'/html/body/div[1]/div[1]/div/div[1]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#点击登录按钮</span>
    sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    driver<span class="token punctuation">.</span>find_element_by_xpath<span class="token punctuation">(</span><span class="token string">'/html/body/div[3]/div[2]/div/div[2]/div/div[3]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#点击[其他登录方式]</span>
    sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    driver<span class="token punctuation">.</span>find_element_by_xpath<span class="token punctuation">(</span><span class="token string">'/html/body/div[3]/div[2]/div/div[1]/div[1]/div[3]/input'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#勾选[同意条款]</span>
    sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    driver<span class="token punctuation">.</span>find_element_by_xpath<span class="token punctuation">(</span><span class="token string">'/html/body/div[3]/div[2]/div/div[1]/div[1]/div[1]/div[2]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#点击[手机号登录]</span>
    sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    driver<span class="token punctuation">.</span>find_element_by_xpath<span class="token punctuation">(</span><span class="token string">'/html/body/div[3]/div[2]/div/div[1]/div[1]/div/div/input'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>send_keys<span class="token punctuation">(</span><span class="token string">'手机号码'</span><span class="token punctuation">)</span>
    sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    driver<span class="token punctuation">.</span>find_element_by_xpath<span class="token punctuation">(</span><span class="token string">'/html/body/div[3]/div[2]/div/div[1]/div[2]/input'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>send_keys<span class="token punctuation">(</span>
        <span class="token string">'密码'</span> <span class="token operator">+</span> Keys<span class="token punctuation">.</span>ENTER<span class="token punctuation">)</span><span class="token comment">#输入手机号跟密码并用enter表示登录</span>
    sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    driver<span class="token punctuation">.</span>switch_to<span class="token punctuation">.</span>frame<span class="token punctuation">(</span><span class="token string">'contentFrame'</span><span class="token punctuation">)</span><span class="token comment">#登录成功后歌单能够加载完全，进入iframe准备抓取信息</span>
    sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    a <span class="token operator">=</span> driver<span class="token punctuation">.</span>find_elements_by_xpath<span class="token punctuation">(</span>
        <span class="token string">'/html/body/div[3]/div[1]/div/div/div[2]/div[2]/div/div[1]/table/tbody/tr/td[2]/div/div/div/span/a'</span><span class="token punctuation">)</span><span class="token comment">#该a标签下包含了歌曲的url</span>
    b <span class="token operator">=</span> driver<span class="token punctuation">.</span>find_elements_by_xpath<span class="token punctuation">(</span>
        <span class="token string">'/html/body/div[3]/div[1]/div/div/div[2]/div[2]/div/div[1]/table/tbody/tr/td[2]/div/div/div/span/a/b'</span><span class="token punctuation">)</span><span class="token comment">#该b标签下包含了歌曲名，注意这里的ab都是find_elements，返回的是包含所有符合xpath的所有标签的列表</span>
    dic <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        title <span class="token operator">=</span> b<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>get_attribute<span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">)</span>
        dic<span class="token punctuation">[</span>title<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>get_attribute<span class="token punctuation">(</span><span class="token string">'href'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token comment">#循环把信息写入字典</span>
    <span class="token comment">#这里后续还会有一部分函数</span>
	<span class="token keyword">for</span> i <span class="token keyword">in</span> dic<span class="token punctuation">:</span>
        <span class="token comment"># print(i,dic[i][0])</span>
        comment <span class="token operator">=</span> getComment<span class="token punctuation">(</span>driver<span class="token punctuation">,</span> dic<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token comment">#把歌曲的名称和url传给下一个函数，并通过循环得到每个歌曲的评论</span>
</code></pre> 
<h2><a id="0x04__120"></a>0x04 获取评论</h2> 
<p>走到了最后一步了，这里我当时花费了很长时间，一开始还是按部就班的先切换到iframe内，然后再找到评论的位置，如图<br> <img src="https://images2.imgbox.com/32/9d/45YIiHuq_o.png" alt="在这里插入图片描述"><br> 这两个div分别带有评论内容，时间和点赞数，当然，如果是回复其它评论，会多出一个div来装其它的评论<br> <img src="https://images2.imgbox.com/e5/5b/8GjYKxS9_o.png" alt="在这里插入图片描述"><br> 比如看这个评论<br> <img src="https://images2.imgbox.com/72/30/ISl1tNow_o.png" alt="在这里插入图片描述"><br> 用户，评论内容，回复的评论，发布时间，点赞数都能找到，然后我最初的想法是得到大的div标签下所有的text再用纯正则匹配分割所有的内容，在之前的实践中text()仅能够得到当前标签的文本，下级标签的文本是不会被读取的，但是，我们可以使用</p> 
<pre><code class="prism language-python">get_attribute<span class="token punctuation">(</span><span class="token string">'textContent'</span><span class="token punctuation">)</span>
</code></pre> 
<p>来得到该标签下的所有文本，所以我最初的想法是。。。</p> 
<pre><code class="prism language-python">	driver<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
    sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    driver<span class="token punctuation">.</span>switch_to<span class="token punctuation">.</span>frame<span class="token punctuation">(</span><span class="token string">'g_iframe'</span><span class="token punctuation">)</span><span class="token comment">#切换至iframe</span>
    comment<span class="token operator">=</span>driver<span class="token punctuation">.</span>find_elements_by_xpath<span class="token punctuation">(</span><span class="token string">'/html/body/div[3]/div[1]/div/div/div[2]/div/div[2]/div[2]/div/div[2]'</span><span class="token punctuation">)</span><span class="token comment">#找到评论的最高级div标签</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>song<span class="token punctuation">)</span><span class="token comment">#打印当前准备爬取的歌曲名</span>
    <span class="token keyword">for</span> n<span class="token punctuation">,</span> i <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>comment<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> n <span class="token operator">&gt;=</span> <span class="token number">15</span><span class="token punctuation">:</span><span class="token comment">#当前评论超过15个就break;因为精彩评论最多就15条，我也没有让他切换至下一页爬取最新评论，但是这也导致了精彩评论不足15条的时候会去爬取最新评论</span>
            <span class="token keyword">break</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">.</span>get_attribute<span class="token punctuation">(</span><span class="token string">'textContent'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        text <span class="token operator">=</span> i<span class="token punctuation">.</span>get_attribute<span class="token punctuation">(</span><span class="token string">'textContent'</span><span class="token punctuation">)</span><span class="token comment">#获取所有文本并打印</span>
        li <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>r<span class="token string">'(.*?)：(.*)20(.*?)日 [(](.*?)[)][|]回复'</span><span class="token punctuation">,</span> text<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token comment">#通过正则分割用户名，评论，时间，点赞数</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>li<span class="token punctuation">)</span>
        content <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">'用户'</span><span class="token punctuation">:</span> li<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string">'内容'</span><span class="token punctuation">:</span> li<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string">'时间'</span><span class="token punctuation">:</span> <span class="token string">'20'</span> <span class="token operator">+</span> li<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">'日'</span><span class="token punctuation">,</span>
            <span class="token string">'点赞数'</span><span class="token punctuation">:</span> li<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token comment">#将得到的数据放入字典</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span>
</code></pre> 
<p>可以看到，我的正则很有问题…首先，时间不一定都是年开头，还可能是月或者几点开头，其次，可能没有点赞数据，所以这样是不能够找到正确的数据的，所以我就又写了一个版本</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">getComment</span><span class="token punctuation">(</span>driver<span class="token punctuation">,</span> url<span class="token punctuation">,</span> song<span class="token punctuation">)</span><span class="token punctuation">:</span>
    driver<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
    sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    driver<span class="token punctuation">.</span>switch_to<span class="token punctuation">.</span>frame<span class="token punctuation">(</span><span class="token string">'g_iframe'</span><span class="token punctuation">)</span>
    client <span class="token operator">=</span> driver<span class="token punctuation">.</span>find_elements_by_xpath<span class="token punctuation">(</span>
        <span class="token string">'/html/body/div[3]/div[1]/div/div/div[2]/div/div[2]/div[2]/div/div[2]/div[1]/div/a'</span><span class="token punctuation">)</span><span class="token comment">#定位用户名</span>
    <span class="token comment"># content=driver.find_elements_by_xpath('/html/body/div[3]/div[1]/div/div/div[2]/div/div[2]/div[2]/div/div[2]/div[1]/div')</span>
    time <span class="token operator">=</span> driver<span class="token punctuation">.</span>find_elements_by_xpath<span class="token punctuation">(</span>
        <span class="token string">'/html/body/div[3]/div[1]/div/div/div[2]/div/div[2]/div[2]/div/div[2]/div[@class="rp"]/div'</span><span class="token punctuation">)</span><span class="token comment">#定位时间</span>
    thumbs <span class="token operator">=</span> driver<span class="token punctuation">.</span>find_elements_by_xpath<span class="token punctuation">(</span>
        <span class="token string">'/html/body/div[3]/div[1]/div/div/div[2]/div/div[2]/div[2]/div/div[2]/div[@class="rp"]/a[1]'</span><span class="token punctuation">)</span><span class="token comment">#定位点赞数</span>
    text <span class="token operator">=</span> driver<span class="token punctuation">.</span>find_elements_by_xpath<span class="token punctuation">(</span><span class="token string">'/html/body/div[3]/div[1]/div/div/div[2]/div/div[2]/div[2]/div/div[2]'</span><span class="token punctuation">)</span>获得评论最高级div下的所有文本，因为正则仅用来分割评论内容和回复的评论还是容易做到的
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'正在爬取:'</span> <span class="token operator">+</span> song<span class="token punctuation">)</span>
    li <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> n<span class="token punctuation">,</span> i <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>time<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> n <span class="token operator">&gt;=</span> <span class="token number">15</span><span class="token punctuation">:</span><span class="token comment">#只爬取前15条</span>
            <span class="token keyword">break</span>
        <span class="token keyword">if</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span>r<span class="token string">'[(](.*)[)]'</span><span class="token punctuation">,</span> thumbs<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">.</span>text<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            thumb <span class="token operator">=</span> <span class="token string">'0'</span><span class="token comment">#如果点赞数为None，就把点赞数变成0，这里是str而不是int是为了防止后续的re报错</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            thumb <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>r<span class="token string">'[(](.*)[)]'</span><span class="token punctuation">,</span> thumbs<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token comment">#否则就获取点赞数</span>
        <span class="token keyword">if</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span>r<span class="token string">'万'</span><span class="token punctuation">,</span> thumb<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            thumb <span class="token operator">=</span> thumb<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'万'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            thumb <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">float</span><span class="token punctuation">(</span>thumb<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">10000</span><span class="token punctuation">)</span><span class="token comment">#如果带汉字万，就换成数字*10000，便于后续的排序</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            thumb <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>thumb<span class="token punctuation">)</span><span class="token comment">#都变成int类型</span>
        comment <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">'歌曲'</span><span class="token punctuation">:</span> song<span class="token punctuation">,</span>
            <span class="token string">'用户'</span><span class="token punctuation">:</span> client<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">.</span>text<span class="token punctuation">,</span>
            <span class="token string">'内容'</span><span class="token punctuation">:</span> ILLEGAL_CHARACTERS_RE<span class="token punctuation">.</span>sub<span class="token punctuation">(</span>r<span class="token string">''</span><span class="token punctuation">,</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>r<span class="token string">'：(.*)'</span> <span class="token operator">+</span> i<span class="token punctuation">.</span>text<span class="token punctuation">,</span> text<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">.</span>get_attribute<span class="token punctuation">(</span><span class="token string">'textContent'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">#正则匹配评论正文，这里的ILLEGAL_CHARACTERS_RE.sub后续再做解释</span>
            <span class="token string">'时间'</span><span class="token punctuation">:</span> i<span class="token punctuation">.</span>text<span class="token punctuation">,</span>
            <span class="token string">'点赞数'</span><span class="token punctuation">:</span> thumb<span class="token punctuation">,</span>
            <span class="token string">'类型'</span><span class="token punctuation">:</span> <span class="token string">'评论'</span><span class="token punctuation">,</span>
            <span class="token string">'关联评论'</span><span class="token punctuation">:</span> <span class="token string">'无'</span><span class="token comment">#写入字典</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span>r<span class="token string">'◆◆'</span><span class="token punctuation">,</span> comment<span class="token punctuation">[</span><span class="token string">'内容'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token boolean">None</span><span class="token punctuation">:</span><span class="token comment">#根据◆◆来判断是否是回复</span>
            tu <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>r<span class="token string">'(.*)◆◆(.*)'</span><span class="token punctuation">,</span> comment<span class="token punctuation">[</span><span class="token string">'内容'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            <span class="token comment"># print(tu[0]+'回复了评论：'+tu[1])</span>
            comment<span class="token punctuation">[</span><span class="token string">'内容'</span><span class="token punctuation">]</span> <span class="token operator">=</span> tu<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            comment<span class="token punctuation">[</span><span class="token string">'类型'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'回复'</span>
            comment<span class="token punctuation">[</span><span class="token string">'关联评论'</span><span class="token punctuation">]</span> <span class="token operator">=</span> tu<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token comment">#是回复的话就改变字典里对应的值</span>
        li<span class="token punctuation">.</span>append<span class="token punctuation">(</span>comment<span class="token punctuation">)</span>把这个字典加入列表
    <span class="token comment"># print(li)</span>
    <span class="token keyword">return</span> li<span class="token comment">#返回列表</span>
</code></pre> 
<p>至此我们已经获得了所有的数据并且都存在了列表里，后续我又有了个想法，就是把数据写入excel，这里用到了 openpyxl 库，有大佬已经详细的写了关于这个库的使用，我这里就不赘述了，直接上代码</p> 
<pre><code class="prism language-python"><span class="token comment">#这部分代码是在getSong函数里的</span>
    wb <span class="token operator">=</span> openpyxl<span class="token punctuation">.</span>Workbook<span class="token punctuation">(</span><span class="token punctuation">)</span>
    sheet <span class="token operator">=</span> wb<span class="token punctuation">.</span>active
    sheet<span class="token punctuation">.</span>merge_cells<span class="token punctuation">(</span>start_row<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> start_column<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> end_row<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> end_column<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token comment">#这里是合并几个单元格</span>
    sheet<span class="token punctuation">[</span><span class="token string">'A1'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value <span class="token operator">=</span> songsname
    sheet<span class="token punctuation">[</span><span class="token string">'A2'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">'歌曲名'</span>
    sheet<span class="token punctuation">[</span><span class="token string">'B2'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">'用户'</span>
    sheet<span class="token punctuation">[</span><span class="token string">'C2'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">'内容'</span>
    sheet<span class="token punctuation">[</span><span class="token string">'D2'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">'时间'</span>
    sheet<span class="token punctuation">[</span><span class="token string">'E2'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">'点赞数'</span>
    sheet<span class="token punctuation">[</span><span class="token string">'F2'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">'类型'</span>
    sheet<span class="token punctuation">[</span><span class="token string">'G2'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">'关联评论'</span><span class="token comment">#给第二行的单元格写入数据</span>
    I <span class="token operator">=</span> <span class="token number">3</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> dic<span class="token punctuation">:</span>
        <span class="token comment"># print(i,dic[i][0])</span>
        comment <span class="token operator">=</span> getComment<span class="token punctuation">(</span>driver<span class="token punctuation">,</span> dic<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span>
        <span class="token keyword">for</span> n <span class="token keyword">in</span> comment<span class="token punctuation">:</span>
            sheet<span class="token punctuation">[</span><span class="token string">'A'</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>I<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value <span class="token operator">=</span> n<span class="token punctuation">[</span><span class="token string">'歌曲'</span><span class="token punctuation">]</span>
            sheet<span class="token punctuation">[</span><span class="token string">'B'</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>I<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value <span class="token operator">=</span> n<span class="token punctuation">[</span><span class="token string">'用户'</span><span class="token punctuation">]</span>
            sheet<span class="token punctuation">[</span><span class="token string">'C'</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>I<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value <span class="token operator">=</span> n<span class="token punctuation">[</span><span class="token string">'内容'</span><span class="token punctuation">]</span>
            sheet<span class="token punctuation">[</span><span class="token string">'D'</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>I<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value <span class="token operator">=</span> n<span class="token punctuation">[</span><span class="token string">'时间'</span><span class="token punctuation">]</span>
            sheet<span class="token punctuation">[</span><span class="token string">'E'</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>I<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value <span class="token operator">=</span> n<span class="token punctuation">[</span><span class="token string">'点赞数'</span><span class="token punctuation">]</span>
            sheet<span class="token punctuation">[</span><span class="token string">'F'</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>I<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value <span class="token operator">=</span> n<span class="token punctuation">[</span><span class="token string">'类型'</span><span class="token punctuation">]</span>
            sheet<span class="token punctuation">[</span><span class="token string">'G'</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>I<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value <span class="token operator">=</span> n<span class="token punctuation">[</span><span class="token string">'关联评论'</span><span class="token punctuation">]</span>
            I <span class="token operator">+=</span> <span class="token number">1</span>
    wb<span class="token punctuation">.</span>save<span class="token punctuation">(</span>filename<span class="token operator">=</span>songsname <span class="token operator">+</span> <span class="token string">'歌单爬取.xlsx'</span><span class="token punctuation">)</span><span class="token comment">#循环写入数据后并保存为文件</span>
</code></pre> 
<p>结果如图：<br> <img src="https://images2.imgbox.com/76/bf/FlL5BOpI_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="0x05__231"></a>0x05 完整代码</h2> 
<pre><code class="prism language-python"><span class="token keyword">from</span> openpyxl<span class="token punctuation">.</span>cell<span class="token punctuation">.</span>cell <span class="token keyword">import</span> ILLEGAL_CHARACTERS_RE
<span class="token keyword">from</span> selenium<span class="token punctuation">.</span>webdriver<span class="token punctuation">.</span>common<span class="token punctuation">.</span>keys <span class="token keyword">import</span> Keys
<span class="token keyword">import</span> re
<span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver
<span class="token keyword">from</span> time <span class="token keyword">import</span> sleep
<span class="token keyword">import</span> openpyxl


<span class="token keyword">def</span> <span class="token function">getUser</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> driver<span class="token punctuation">)</span><span class="token punctuation">:</span>
    url <span class="token operator">=</span> <span class="token string">"https://music.163.com/#/search/m/"</span>
    driver<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
    driver<span class="token punctuation">.</span>switch_to<span class="token punctuation">.</span>frame<span class="token punctuation">(</span><span class="token string">'g_iframe'</span><span class="token punctuation">)</span>
    sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    driver<span class="token punctuation">.</span>find_element_by_id<span class="token punctuation">(</span><span class="token string">'m-search-input'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>send_keys<span class="token punctuation">(</span>user<span class="token punctuation">)</span>
    driver<span class="token punctuation">.</span>find_element_by_id<span class="token punctuation">(</span><span class="token string">'m-search-input'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>send_keys<span class="token punctuation">(</span>Keys<span class="token punctuation">.</span>ENTER<span class="token punctuation">)</span>
    driver<span class="token punctuation">.</span>find_element_by_xpath<span class="token punctuation">(</span><span class="token string">'//*[@class="m-tabs m-tabs-srch f-cb ztag"]/li[8]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>
    sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    tab <span class="token operator">=</span> driver<span class="token punctuation">.</span>find_element_by_xpath<span class="token punctuation">(</span><span class="token string">'/html/body/div[3]/div/div[2]/div[2]/div/table/tbody'</span><span class="token punctuation">)</span>
    users <span class="token operator">=</span> tab<span class="token punctuation">.</span>find_elements_by_tag_name<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span>
    <span class="token builtin">list</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> i<span class="token punctuation">,</span> n <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>users<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">3</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            tu <span class="token operator">=</span> <span class="token punctuation">(</span>n<span class="token punctuation">.</span>get_attribute<span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> n<span class="token punctuation">.</span>get_attribute<span class="token punctuation">(</span><span class="token string">'href'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token builtin">list</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>tu<span class="token punctuation">)</span>
    <span class="token keyword">for</span> i<span class="token punctuation">,</span> n <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'['</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">']\t'</span> <span class="token operator">+</span> n<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">'\t'</span> <span class="token operator">+</span> n<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    num <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'请输入用户对应序号：'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token builtin">list</span><span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">]</span>


<span class="token keyword">def</span> <span class="token function">getSongs</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> driver<span class="token punctuation">)</span><span class="token punctuation">:</span>
    driver<span class="token punctuation">.</span>get<span class="token punctuation">(</span>user<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    driver<span class="token punctuation">.</span>switch_to<span class="token punctuation">.</span>frame<span class="token punctuation">(</span><span class="token string">'g_iframe'</span><span class="token punctuation">)</span>
    box <span class="token operator">=</span> driver<span class="token punctuation">.</span>find_element_by_xpath<span class="token punctuation">(</span><span class="token string">'//*[@id="cBox"]'</span><span class="token punctuation">)</span>
    li <span class="token operator">=</span> box<span class="token punctuation">.</span>find_elements_by_tag_name<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span>
    <span class="token builtin">list</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> i<span class="token punctuation">,</span> n <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>li<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> i <span class="token operator">%</span> <span class="token number">3</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            tu <span class="token operator">=</span> <span class="token punctuation">(</span>n<span class="token punctuation">.</span>get_attribute<span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> n<span class="token punctuation">.</span>get_attribute<span class="token punctuation">(</span><span class="token string">'href'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token builtin">list</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>tu<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>user<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">'创建的歌单如下：'</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i<span class="token punctuation">,</span> n <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'['</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">']\t'</span> <span class="token operator">+</span> n<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">'\t'</span> <span class="token operator">+</span> n<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    num <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'请选择对应歌单:'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token builtin">list</span><span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">]</span>


<span class="token keyword">def</span> <span class="token function">getSong</span><span class="token punctuation">(</span>driver<span class="token punctuation">,</span> songsname<span class="token punctuation">)</span><span class="token punctuation">:</span>
    sleep<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
    driver<span class="token punctuation">.</span>find_element_by_xpath<span class="token punctuation">(</span><span class="token string">'/html/body/div[1]/div[1]/div/div[1]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>
    sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    driver<span class="token punctuation">.</span>find_element_by_xpath<span class="token punctuation">(</span><span class="token string">'/html/body/div[3]/div[2]/div/div[2]/div/div[3]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>
    sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    driver<span class="token punctuation">.</span>find_element_by_xpath<span class="token punctuation">(</span><span class="token string">'/html/body/div[3]/div[2]/div/div[1]/div[1]/div[3]/input'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>
    sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    driver<span class="token punctuation">.</span>find_element_by_xpath<span class="token punctuation">(</span><span class="token string">'/html/body/div[3]/div[2]/div/div[1]/div[1]/div[1]/div[2]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>
    sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    driver<span class="token punctuation">.</span>find_element_by_xpath<span class="token punctuation">(</span><span class="token string">'/html/body/div[3]/div[2]/div/div[1]/div[1]/div/div/input'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>send_keys<span class="token punctuation">(</span><span class="token string">'手机号'</span><span class="token punctuation">)</span>
    sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    driver<span class="token punctuation">.</span>find_element_by_xpath<span class="token punctuation">(</span><span class="token string">'/html/body/div[3]/div[2]/div/div[1]/div[2]/input'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>send_keys<span class="token punctuation">(</span>
        <span class="token string">'密码'</span> <span class="token operator">+</span> Keys<span class="token punctuation">.</span>ENTER<span class="token punctuation">)</span>
    sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    driver<span class="token punctuation">.</span>switch_to<span class="token punctuation">.</span>frame<span class="token punctuation">(</span><span class="token string">'contentFrame'</span><span class="token punctuation">)</span>
    sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    a <span class="token operator">=</span> driver<span class="token punctuation">.</span>find_elements_by_xpath<span class="token punctuation">(</span>
        <span class="token string">'/html/body/div[3]/div[1]/div/div/div[2]/div[2]/div/div[1]/table/tbody/tr/td[2]/div/div/div/span/a'</span><span class="token punctuation">)</span>
    b <span class="token operator">=</span> driver<span class="token punctuation">.</span>find_elements_by_xpath<span class="token punctuation">(</span>
        <span class="token string">'/html/body/div[3]/div[1]/div/div/div[2]/div[2]/div/div[1]/table/tbody/tr/td[2]/div/div/div/span/a/b'</span><span class="token punctuation">)</span>
    dic <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        title <span class="token operator">=</span> b<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>get_attribute<span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">)</span>
        dic<span class="token punctuation">[</span>title<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>get_attribute<span class="token punctuation">(</span><span class="token string">'href'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    wb <span class="token operator">=</span> openpyxl<span class="token punctuation">.</span>Workbook<span class="token punctuation">(</span><span class="token punctuation">)</span>
    sheet <span class="token operator">=</span> wb<span class="token punctuation">.</span>active
    sheet<span class="token punctuation">.</span>merge_cells<span class="token punctuation">(</span>start_row<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> start_column<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> end_row<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> end_column<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">)</span>
    sheet<span class="token punctuation">[</span><span class="token string">'A1'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value <span class="token operator">=</span> songsname
    sheet<span class="token punctuation">[</span><span class="token string">'A2'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">'歌曲名'</span>
    sheet<span class="token punctuation">[</span><span class="token string">'B2'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">'用户'</span>
    sheet<span class="token punctuation">[</span><span class="token string">'C2'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">'内容'</span>
    sheet<span class="token punctuation">[</span><span class="token string">'D2'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">'时间'</span>
    sheet<span class="token punctuation">[</span><span class="token string">'E2'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">'点赞数'</span>
    sheet<span class="token punctuation">[</span><span class="token string">'F2'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">'类型'</span>
    sheet<span class="token punctuation">[</span><span class="token string">'G2'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">'关联评论'</span>
    I <span class="token operator">=</span> <span class="token number">3</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> dic<span class="token punctuation">:</span>
        <span class="token comment"># print(i,dic[i][0])</span>
        comment <span class="token operator">=</span> getComment<span class="token punctuation">(</span>driver<span class="token punctuation">,</span> dic<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span>
        <span class="token keyword">for</span> n <span class="token keyword">in</span> comment<span class="token punctuation">:</span>
            sheet<span class="token punctuation">[</span><span class="token string">'A'</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>I<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value <span class="token operator">=</span> n<span class="token punctuation">[</span><span class="token string">'歌曲'</span><span class="token punctuation">]</span>
            sheet<span class="token punctuation">[</span><span class="token string">'B'</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>I<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value <span class="token operator">=</span> n<span class="token punctuation">[</span><span class="token string">'用户'</span><span class="token punctuation">]</span>
            sheet<span class="token punctuation">[</span><span class="token string">'C'</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>I<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value <span class="token operator">=</span> n<span class="token punctuation">[</span><span class="token string">'内容'</span><span class="token punctuation">]</span>
            sheet<span class="token punctuation">[</span><span class="token string">'D'</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>I<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value <span class="token operator">=</span> n<span class="token punctuation">[</span><span class="token string">'时间'</span><span class="token punctuation">]</span>
            sheet<span class="token punctuation">[</span><span class="token string">'E'</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>I<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value <span class="token operator">=</span> n<span class="token punctuation">[</span><span class="token string">'点赞数'</span><span class="token punctuation">]</span>
            sheet<span class="token punctuation">[</span><span class="token string">'F'</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>I<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value <span class="token operator">=</span> n<span class="token punctuation">[</span><span class="token string">'类型'</span><span class="token punctuation">]</span>
            sheet<span class="token punctuation">[</span><span class="token string">'G'</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>I<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value <span class="token operator">=</span> n<span class="token punctuation">[</span><span class="token string">'关联评论'</span><span class="token punctuation">]</span>
            I <span class="token operator">+=</span> <span class="token number">1</span>
    wb<span class="token punctuation">.</span>save<span class="token punctuation">(</span>filename<span class="token operator">=</span>songsname <span class="token operator">+</span> <span class="token string">'歌单爬取.xlsx'</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">getComment</span><span class="token punctuation">(</span>driver<span class="token punctuation">,</span> url<span class="token punctuation">,</span> song<span class="token punctuation">)</span><span class="token punctuation">:</span>
    driver<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
    sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    driver<span class="token punctuation">.</span>switch_to<span class="token punctuation">.</span>frame<span class="token punctuation">(</span><span class="token string">'g_iframe'</span><span class="token punctuation">)</span>
    <span class="token comment"># comment=driver.find_elements_by_xpath('/html/body/div[3]/div[1]/div/div/div[2]/div/div[2]/div[2]/div/div[2]')</span>
    <span class="token comment"># print(song)</span>
    <span class="token comment"># for n, i in enumerate(comment):</span>
    <span class="token comment">#     if n &gt;= 15:</span>
    <span class="token comment">#         break</span>
    <span class="token comment">#     print(i.get_attribute('textContent'))</span>
    <span class="token comment">#     text = i.get_attribute('textContent')</span>
    <span class="token comment">#     li = re.findall(r'(.*?)：(.*)20(.*?)日 [(](.*?)[)][|]回复', text)[0]</span>
    <span class="token comment">#     print(li)</span>
    <span class="token comment">#     content = {<!-- --></span>
    <span class="token comment">#         '用户': li[0],</span>
    <span class="token comment">#         '内容': li[1],</span>
    <span class="token comment">#         '时间': '20' + li[2] + '日',</span>
    <span class="token comment">#         '点赞数': li[3]</span>
    <span class="token comment">#     }</span>
    <span class="token comment">#     print(content)</span>
    client <span class="token operator">=</span> driver<span class="token punctuation">.</span>find_elements_by_xpath<span class="token punctuation">(</span>
        <span class="token string">'/html/body/div[3]/div[1]/div/div/div[2]/div/div[2]/div[2]/div/div[2]/div[1]/div/a'</span><span class="token punctuation">)</span>
    <span class="token comment"># content=driver.find_elements_by_xpath('/html/body/div[3]/div[1]/div/div/div[2]/div/div[2]/div[2]/div/div[2]/div[1]/div')</span>
    time <span class="token operator">=</span> driver<span class="token punctuation">.</span>find_elements_by_xpath<span class="token punctuation">(</span>
        <span class="token string">'/html/body/div[3]/div[1]/div/div/div[2]/div/div[2]/div[2]/div/div[2]/div[@class="rp"]/div'</span><span class="token punctuation">)</span>
    thumbs <span class="token operator">=</span> driver<span class="token punctuation">.</span>find_elements_by_xpath<span class="token punctuation">(</span>
        <span class="token string">'/html/body/div[3]/div[1]/div/div/div[2]/div/div[2]/div[2]/div/div[2]/div[@class="rp"]/a[1]'</span><span class="token punctuation">)</span>
    text <span class="token operator">=</span> driver<span class="token punctuation">.</span>find_elements_by_xpath<span class="token punctuation">(</span><span class="token string">'/html/body/div[3]/div[1]/div/div/div[2]/div/div[2]/div[2]/div/div[2]'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'正在爬取:'</span> <span class="token operator">+</span> song<span class="token punctuation">)</span>
    li <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> n<span class="token punctuation">,</span> i <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>time<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> n <span class="token operator">&gt;=</span> <span class="token number">15</span><span class="token punctuation">:</span>
            <span class="token keyword">break</span>
        <span class="token keyword">if</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span>r<span class="token string">'[(](.*)[)]'</span><span class="token punctuation">,</span> thumbs<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">.</span>text<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            thumb <span class="token operator">=</span> <span class="token string">'0'</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            thumb <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>r<span class="token string">'[(](.*)[)]'</span><span class="token punctuation">,</span> thumbs<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        <span class="token keyword">if</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span>r<span class="token string">'万'</span><span class="token punctuation">,</span> thumb<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            thumb <span class="token operator">=</span> thumb<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'万'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            thumb <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">float</span><span class="token punctuation">(</span>thumb<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">10000</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            thumb <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>thumb<span class="token punctuation">)</span>
        comment <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">'歌曲'</span><span class="token punctuation">:</span> song<span class="token punctuation">,</span>
            <span class="token string">'用户'</span><span class="token punctuation">:</span> client<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">.</span>text<span class="token punctuation">,</span>
            <span class="token string">'内容'</span><span class="token punctuation">:</span> ILLEGAL_CHARACTERS_RE<span class="token punctuation">.</span>sub<span class="token punctuation">(</span>r<span class="token string">''</span><span class="token punctuation">,</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>r<span class="token string">'：(.*)'</span> <span class="token operator">+</span> i<span class="token punctuation">.</span>text<span class="token punctuation">,</span> text<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">.</span>get_attribute<span class="token punctuation">(</span><span class="token string">'textContent'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">#这里的ILLEGAL_CHARACTERS_RE就是为了过滤excel的非法字符，防止程序报错</span>
            <span class="token string">'时间'</span><span class="token punctuation">:</span> i<span class="token punctuation">.</span>text<span class="token punctuation">,</span>
            <span class="token string">'点赞数'</span><span class="token punctuation">:</span> thumb<span class="token punctuation">,</span>
            <span class="token string">'类型'</span><span class="token punctuation">:</span> <span class="token string">'评论'</span><span class="token punctuation">,</span>
            <span class="token string">'关联评论'</span><span class="token punctuation">:</span> <span class="token string">'无'</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span>r<span class="token string">'◆◆'</span><span class="token punctuation">,</span> comment<span class="token punctuation">[</span><span class="token string">'内容'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            tu <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>r<span class="token string">'(.*)◆◆(.*)'</span><span class="token punctuation">,</span> comment<span class="token punctuation">[</span><span class="token string">'内容'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            <span class="token comment"># print(tu[0]+'回复了评论：'+tu[1])</span>
            comment<span class="token punctuation">[</span><span class="token string">'内容'</span><span class="token punctuation">]</span> <span class="token operator">=</span> tu<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            comment<span class="token punctuation">[</span><span class="token string">'类型'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'回复'</span>
            comment<span class="token punctuation">[</span><span class="token string">'关联评论'</span><span class="token punctuation">]</span> <span class="token operator">=</span> tu<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
        li<span class="token punctuation">.</span>append<span class="token punctuation">(</span>comment<span class="token punctuation">)</span>
    <span class="token comment"># print(li)</span>
    <span class="token keyword">return</span> li


driver <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span><span class="token punctuation">)</span>
user <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'请输入你要查找的用户：'</span><span class="token punctuation">)</span>
li <span class="token operator">=</span> getUser<span class="token punctuation">(</span>user<span class="token punctuation">,</span> driver<span class="token punctuation">)</span>
songs <span class="token operator">=</span> getSongs<span class="token punctuation">(</span>li<span class="token punctuation">,</span> driver<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'准备开始爬取歌单: '</span> <span class="token operator">+</span> songs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">' 中的内容'</span><span class="token punctuation">)</span>
driver<span class="token punctuation">.</span>get<span class="token punctuation">(</span>songs<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
getSong<span class="token punctuation">(</span>driver<span class="token punctuation">,</span> songs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

</code></pre> 
<h2><a id="0x06__403"></a>0x06 总结</h2> 
<p>这次爬取走了很多弯路，这也说明我学的还不是很到位…最后也是终于成功了，也算是对前面的一次复习吧，当然，也学到了很多新知识，接下来要继续努力呀</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a2aa0492dbff1c5e9163723547f672a6/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Android 开发实践（二）弄懂项目结构</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/3ce76430db229c0b652b15a8afa8bb0d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">CTFHub学习笔记(2) - 技能树 - 信息泄露[只做了部分，待更新]</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>