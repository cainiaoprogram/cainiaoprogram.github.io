<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>宝塔部署「免费WAF」长亭雷池防护个人网站 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="宝塔部署「免费WAF」长亭雷池防护个人网站" />
<meta property="og:description" content="原文地址： 宝塔部署长亭waf防护自己的网站
雷池是长亭科技耗时近 10 年倾情打造的 WAF，核心检测能力由智能语义分析算法驱动。
Slogan: 不让黑客越雷池半步。这里是官方地址：长亭雷池 WAF 社区版 (chaitin.cn)。
部署资源 系统版本：Ubuntu Server 20.04 LTS 64bit
规格：CPU - 2核 内存 - 2GB 系统盘 - SSD云硬盘 40GB
部署方式 单机下部署：宝塔负责运维管理网站、长亭WAF负责防护外来攻击
部署开始 安装宝塔 自行部署
安装网站建设必要软件 我这里是静态站所以只需要安装nginx，docker是后边waf安装需要动用到的所以也是必须安装。根据自己的网站环境需要安装即可。
修改默认端口 这里需要修改 nginx 默认监听端口 80（http）443（https）
找到/www/server/panel/vhost/nginx/0.default.conf文件修改如下：
server { listen 81; server_name _; index index.html; root /www/server/nginx/html; } 找到/www/server/panel/vhost/nginx/phpfpm_status.conf文件修改如下：
server { listen 81; server_name 127.0.0.1; allow 127.0.0.1; location /nginx_status { stub_status on; access_log off; } location /phpfpm_52_status { fastcgi_pass unix:/tmp/php-cgi-52." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/ecc985769e1956aafd7266fd86117db0/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-08-17T11:21:34+08:00" />
<meta property="article:modified_time" content="2023-08-17T11:21:34+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">宝塔部署「免费WAF」长亭雷池防护个人网站</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>原文地址： <a href="https://blog.qjqq.cn/posts/972c.html" rel="nofollow">宝塔部署长亭waf防护自己的网站</a></p> 
<p>雷池是长亭科技耗时近 10 年倾情打造的 WAF，核心检测能力由智能语义分析算法驱动。</p> 
<p>Slogan: 不让黑客越雷池半步。这里是官方地址：<a href="https://waf-ce.chaitin.cn/" rel="nofollow">长亭雷池 WAF 社区版 (chaitin.cn)</a>。</p> 
<h2><a id="_6"></a>部署资源</h2> 
<p>系统版本：Ubuntu Server 20.04 LTS 64bit</p> 
<p>规格：CPU - 2核 内存 - 2GB 系统盘 - SSD云硬盘 40GB</p> 
<h2><a id="_11"></a>部署方式</h2> 
<p>单机下部署：宝塔负责运维管理网站、长亭WAF负责防护外来攻击</p> 
<h2><a id="_14"></a>部署开始</h2> 
<h3><a id="_15"></a>安装宝塔</h3> 
<p>自行部署</p> 
<h3><a id="_18"></a>安装网站建设必要软件</h3> 
<p>我这里是静态站所以只需要安装<code>nginx</code>，<code>docker</code>是后边waf安装需要动用到的所以也是必须安装。根据自己的网站环境需要安装即可。<br> <img src="https://images2.imgbox.com/92/99/Uarg7O2O_o.png" alt="1.png"></p> 
<h3><a id="_22"></a>修改默认端口</h3> 
<p>这里需要修改 nginx 默认监听端口 80（http）443（https）</p> 
<p>找到<code>/www/server/panel/vhost/nginx/0.default.conf</code>文件修改如下：</p> 
<pre><code>server
{
    listen 81;
    server_name _;
    index index.html;
    root /www/server/nginx/html;
}
</code></pre> 
<p>找到<code>/www/server/panel/vhost/nginx/phpfpm_status.conf</code>文件修改如下：</p> 
<pre><code>server {
    listen 81;
    server_name 127.0.0.1;
    allow 127.0.0.1;
    location /nginx_status {
        stub_status on;
        access_log off;
    }
    location /phpfpm_52_status {
        fastcgi_pass unix:/tmp/php-cgi-52.sock;
        include fastcgi_params;
        fastcgi_param SCRIPT_FILENAME $fastcgi_script_name;
    }
    location /phpfpm_53_status {
        fastcgi_pass unix:/tmp/php-cgi-53.sock;
        include fastcgi_params;
        fastcgi_param SCRIPT_FILENAME $fastcgi_script_name;
    }
    location /phpfpm_54_status {
        fastcgi_pass unix:/tmp/php-cgi-54.sock;
        include fastcgi_params;
        fastcgi_param SCRIPT_FILENAME $fastcgi_script_name;
    }
    location /phpfpm_55_status {
        fastcgi_pass unix:/tmp/php-cgi-55.sock;
        include fastcgi_params;
        fastcgi_param SCRIPT_FILENAME $fastcgi_script_name;
    }
    location /phpfpm_56_status {
        fastcgi_pass unix:/tmp/php-cgi-56.sock;
        include fastcgi_params;
        fastcgi_param SCRIPT_FILENAME $fastcgi_script_name;
    }
    location /phpfpm_70_status {
        fastcgi_pass unix:/tmp/php-cgi-70.sock;
        include fastcgi_params;
        fastcgi_param SCRIPT_FILENAME $fastcgi_script_name;
    }
    location /phpfpm_71_status {
        fastcgi_pass unix:/tmp/php-cgi-71.sock;
        include fastcgi_params;
        fastcgi_param SCRIPT_FILENAME $fastcgi_script_name;
    }
    location /phpfpm_72_status {
        fastcgi_pass unix:/tmp/php-cgi-72.sock;
        include fastcgi_params;
        fastcgi_param SCRIPT_FILENAME $fastcgi_script_name;
    }
    location /phpfpm_73_status {
        fastcgi_pass unix:/tmp/php-cgi-73.sock;
        include fastcgi_params;
        fastcgi_param SCRIPT_FILENAME $fastcgi_script_name;
    }
    location /phpfpm_74_status {
        fastcgi_pass unix:/tmp/php-cgi-74.sock;
        include fastcgi_params;
        fastcgi_param SCRIPT_FILENAME $fastcgi_script_name;
    }
    location /phpfpm_75_status {
        fastcgi_pass unix:/tmp/php-cgi-75.sock;
        include fastcgi_params;
        fastcgi_param SCRIPT_FILENAME $fastcgi_script_name;
    }
    location /phpfpm_80_status {
        fastcgi_pass unix:/tmp/php-cgi-80.sock;
        include fastcgi_params;
        fastcgi_param SCRIPT_FILENAME $fastcgi_script_name;
    }
    location /phpfpm_81_status {
        fastcgi_pass unix:/tmp/php-cgi-81.sock;
        include fastcgi_params;
        fastcgi_param SCRIPT_FILENAME $fastcgi_script_name;
    }
    location /phpfpm_82_status {
        fastcgi_pass unix:/tmp/php-cgi-82.sock;
        include fastcgi_params;
        fastcgi_param SCRIPT_FILENAME $fastcgi_script_name;
    }
}
</code></pre> 
<p>更改完成后需要到nginx面板去重载配置以及重启操作！以防万一这两项操作必须都进行！</p> 
<h3><a id="_123"></a>新建网站</h3> 
<p>新建网站时，域名后边加除80的其他端口。这里我修改成81<br> <img src="https://images2.imgbox.com/8c/dd/1rrFfMsk_o.png" alt="2.png"></p> 
<p>网站开启ssl后需要修改端口除443的其他端口。这里我修改成8443<br> <img src="https://images2.imgbox.com/a7/ed/Kz9OAoNI_o.png" alt="3.png"></p> 
<h3><a id="waf_130"></a>安装长亭waf</h3> 
<p><a href="https://waf-ce.chaitin.cn/" rel="nofollow">官网</a>提供了三种安装方式，这里我选择在线安装，使用命令：</p> 
<pre><code>bash -c "$(curl -fsSLk https://waf-ce.chaitin.cn/release/latest/setup.sh)"
</code></pre> 
<p>根据脚本提示安装，完成后是这样的<br> <img src="https://images2.imgbox.com/43/72/PPtq6g11_o.png" alt="4.png"></p> 
<p>浏览器打开后台管理页面 <code>https://&lt;waf-ip&gt;:9443</code>。根据界面提示，使用 <strong>支持 TOTP 的认证软件或者小程序</strong> 扫描二维码，然后输入动态口令登录：</p> 
<p><img src="https://images2.imgbox.com/46/d6/EH82IXSd_o.png" alt="image.png"></p> 
<p>看到这个页面说明 长亭waf 安装成功啦。<br> <img src="https://images2.imgbox.com/33/d1/YvEu8PCu_o.png" alt="6.png"></p> 
<h3><a id="_145"></a>配置防护网站</h3> 
<p><img src="https://images2.imgbox.com/e9/53/9woqPajn_o.png" alt="7.png"><br> <img src="https://images2.imgbox.com/d1/70/SRxLpNpN_o.png" alt="8.png"></p> 
<h4><a id="https_148"></a>配置https</h4> 
<p><img src="https://images2.imgbox.com/c5/7b/05ZzzfNM_o.png" alt="9.png"></p> 
<h4><a id="_150"></a>测试防护效果</h4> 
<ul><li>确认网站可以正常访问</li><li>尝试手动模拟攻击</li><li>模拟 SQL 注入，请访问 <code>http://&lt;IP或域名&gt;:&lt;端口&gt;/?id=1%20AND%201=1</code></li><li>模拟 XSS，请访问 <code>http://&lt;IP或域名&gt;:&lt;端口&gt;/?html=&lt;script&gt;alert(1)&lt;/script&gt;</code></li><li>通过浏览器，你将会看到雷池已经发现并阻断了攻击请求。</li></ul> 
<p><img src="https://images2.imgbox.com/17/95/ArZjjeEi_o.png" alt="10.png"></p> 
<p><img src="https://images2.imgbox.com/fe/0a/JkA9p1aN_o.png" alt="11.png"></p> 
<h3><a id="cdn_161"></a>配置cdn</h3> 
<p>我们还可以添加cdn来加速自己的网站来达到隐藏源站的需求，加速的域名是防护网站的域名，回源端口默认的就好，<code>这里提醒一下：建议回源协议ssl 懂的都懂。</code></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/465d5ea95a35fc898330b2ca6f3ca15f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">最新SSD固态硬盘颗粒QLC、SLC、MLC、TLC详解</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9d131768dafd39cd0243cc510b5b08dc/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">OpenAI全球招外包大军，手把手训练ChatGPT取代码农 ； 码农：我自己「杀」自己</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>