<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>shell sshpass 主机交互 在另外一台主机上执行某个命令 批量管理主机 以及一些案例 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="shell sshpass 主机交互 在另外一台主机上执行某个命令 批量管理主机 以及一些案例" />
<meta property="og:description" content="目录 作用安装 sshpasssshpass 用法在远程主机执行某个命令 案例批量传输密匙批量拷贝文件批量修改密码 作用 就是用一台主机 控制另外一台主机免交互任务管理工具方便批量管理主机使用方法就是在ssh 前边加一个 sshpass 安装 sshpass # 安装 sshpass yum -y install sshpass # 卸载 yum -y reomve sshpass sshpass 用法 #第一次登录时候需要输入yes 执行之后会登录到目标主机 sshpass -p{密码} ssh -p {端口} -o StrictHostKeyChecking=no root@{ip} sshpass -proot ssh -p 22 -o StrictHostKeyChecking=no root@192.168.1.102 在远程主机执行某个命令 #使用sshpass获取ip地址 sshpass -p{密码} shh -p {端口} root@{ip} &#34;{命令}&#34; sshpass -proot ssh root@192.168.1.102 -p 22 &#34;ip a&#34; # 指定文件 echo &#34;passwd&#34; &gt; passwd sshpass -f -p@Baipiao123 ssh root@{123." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/7c86ab3e94daab6079736ada4a257255/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-04T23:18:26+08:00" />
<meta property="article:modified_time" content="2024-01-04T23:18:26+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">shell sshpass 主机交互 在另外一台主机上执行某个命令 批量管理主机 以及一些案例</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><a href="#_1" rel="nofollow">作用</a></li><li><ul><li><a href="#_sshpass_8" rel="nofollow">安装 sshpass</a></li><li><a href="#sshpass__17" rel="nofollow">sshpass 用法</a></li><li><a href="#_26" rel="nofollow">在远程主机执行某个命令</a></li></ul> 
  </li><li><a href="#_52" rel="nofollow">案例</a></li><li><ul><li><a href="#_53" rel="nofollow">批量传输密匙</a></li><li><a href="#_76" rel="nofollow">批量拷贝文件</a></li><li><a href="#_98" rel="nofollow">批量修改密码</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="_1"></a>作用</h2> 
<ul><li>就是用一台主机 控制另外一台主机</li><li>免交互任务管理工具</li><li>方便批量管理主机</li><li>使用方法就是在ssh 前边加一个 sshpass</li></ul> 
<h3><a id="_sshpass_8"></a>安装 sshpass</h3> 
<pre><code class="prism language-shell"><span class="token comment"># 安装 sshpass</span>
yum <span class="token parameter variable">-y</span> <span class="token function">install</span> sshpass

<span class="token comment"># 卸载</span>
yum <span class="token parameter variable">-y</span> reomve sshpass
</code></pre> 
<h3><a id="sshpass__17"></a>sshpass 用法</h3> 
<pre><code class="prism language-sh"><span class="token comment">#第一次登录时候需要输入yes   执行之后会登录到目标主机</span>
sshpass -p<span class="token punctuation">{<!-- --></span>密码<span class="token punctuation">}</span> <span class="token function">ssh</span>  <span class="token parameter variable">-p</span> <span class="token punctuation">{<!-- --></span>端口<span class="token punctuation">}</span> <span class="token parameter variable">-o</span> <span class="token assign-left variable">StrictHostKeyChecking</span><span class="token operator">=</span>no root@<span class="token punctuation">{<!-- --></span>ip<span class="token punctuation">}</span> 
sshpass <span class="token parameter variable">-proot</span> <span class="token function">ssh</span> <span class="token parameter variable">-p</span> <span class="token number">22</span> <span class="token parameter variable">-o</span> <span class="token assign-left variable">StrictHostKeyChecking</span><span class="token operator">=</span>no root@192.168.1.102 
</code></pre> 
<p><img src="https://images2.imgbox.com/7b/a0/QF0a17Fj_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_26"></a>在远程主机执行某个命令</h3> 
<pre><code class="prism language-sh"><span class="token comment">#使用sshpass获取ip地址</span>
sshpass -p<span class="token punctuation">{<!-- --></span>密码<span class="token punctuation">}</span> shh <span class="token parameter variable">-p</span> <span class="token punctuation">{<!-- --></span>端口<span class="token punctuation">}</span>  root@<span class="token punctuation">{<!-- --></span>ip<span class="token punctuation">}</span> <span class="token string">"{命令}"</span>
sshpass <span class="token parameter variable">-proot</span> <span class="token function">ssh</span> root@192.168.1.102  <span class="token parameter variable">-p</span> <span class="token number">22</span> <span class="token string">"ip a"</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/04/6b/wPD1tL8J_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/d9/60/GTk9FSJ4_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-sh"><span class="token comment"># 指定文件</span>
<span class="token builtin class-name">echo</span> <span class="token string">"passwd"</span> <span class="token operator">&gt;</span> <span class="token function">passwd</span>
sshpass <span class="token parameter variable">-f</span> -p@Baipiao123 <span class="token function">ssh</span> root@<span class="token punctuation">{<!-- --></span><span class="token number">123.123</span>.123.123<span class="token punctuation">}</span> <span class="token string">"ip a"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"password"</span> <span class="token operator">&gt;</span> password
sshpass <span class="token parameter variable">-f</span> password <span class="token function">ssh</span> root@10.36.182.100 <span class="token string">"ip a"</span>

<span class="token comment"># 结合scp一起使用</span>
sshpass <span class="token parameter variable">-p</span> 密码 <span class="token function">scp</span> <span class="token function">file</span> root@ip:/路径
<span class="token comment">## 示例：把本地文件/etc/hosts传入远程机器10.36.182.100</span>
sshpass <span class="token parameter variable">-p</span> <span class="token number">1</span> <span class="token function">scp</span> /etc/hosts root@10.36.182.100:/etc


<span class="token comment"># 远程解压</span>
sshpass <span class="token parameter variable">-p</span> 密码 <span class="token function">ssh</span> root@ip <span class="token parameter variable">-tt</span> <span class="token function">tar</span> <span class="token parameter variable">-xzf</span> 远程文件.tar包 <span class="token parameter variable">-C</span> 解压路径
</code></pre> 
<h2><a id="_52"></a>案例</h2> 
<h3><a id="_53"></a>批量传输密匙</h3> 
<pre><code class="prism language-sh"><span class="token shebang important">#!/bin/bash</span>
<span class="token operator">&lt;&lt;</span><span class="token string">bak
pass.txt 文件示例
192.168.1.2 root password 22
192.168.1.3 root password 22
bak</span>
<span class="token punctuation">[</span> <span class="token operator">!</span> <span class="token parameter variable">-f</span> <span class="token environment constant">$HOME</span>/.ssh/id_rsa <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> ssh-keygen <span class="token parameter variable">-t</span> rsa <span class="token parameter variable">-b</span> <span class="token number">2048</span> <span class="token parameter variable">-N</span> <span class="token string">""</span> <span class="token parameter variable">-f</span> <span class="token environment constant">$HOME</span>/.ssh/id_rsa
<span class="token punctuation">[</span> <span class="token parameter variable">-f</span> /etc/init.d/functions <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">.</span> /etc/init.d/functions
<span class="token assign-left variable">INFO</span><span class="token operator">=</span>pass.txt
<span class="token comment"># yum install -y sshpass</span>
<span class="token keyword">for</span> <span class="token for-or-select variable">IP</span> <span class="token keyword">in</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">awk</span> <span class="token string">'/^[^#]/{print $1}'</span> $INFO<span class="token variable">)</span></span><span class="token punctuation">;</span> <span class="token keyword">do</span>
    <span class="token assign-left variable"><span class="token environment constant">USER</span></span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">awk</span> <span class="token parameter variable">-v</span> <span class="token assign-left variable">I</span><span class="token operator">=</span>$IP <span class="token string">'I==$1{print $2}'</span> $INFO<span class="token variable">)</span></span>
    <span class="token assign-left variable">PASS</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">awk</span> <span class="token parameter variable">-v</span> <span class="token assign-left variable">I</span><span class="token operator">=</span>$IP <span class="token string">'I==$1{print $3}'</span> $INFO<span class="token variable">)</span></span>
    <span class="token assign-left variable">PORT</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">awk</span> <span class="token parameter variable">-v</span> <span class="token assign-left variable">I</span><span class="token operator">=</span>$IP <span class="token string">'I==$1{print $4}'</span> $INFO<span class="token variable">)</span></span>
    sshpass <span class="token parameter variable">-p</span> <span class="token variable">$PASS</span> ssh-copy-id <span class="token parameter variable">-o</span> <span class="token assign-left variable">StrictHostKeyChecking</span><span class="token operator">=</span>no <span class="token variable">${<!-- --><span class="token environment constant">USER</span>}</span>@<span class="token variable">${IP}</span>  <span class="token operator">&amp;&amp;</span> <span class="token punctuation">\</span>
    action <span class="token string">"秘钥传输成功 <span class="token variable">$IP</span>"</span> /bin/true <span class="token operator">||</span> <span class="token punctuation">\</span>
    action <span class="token string">"秘钥传输失败 <span class="token variable">$IP</span>"</span> /bin/false
<span class="token keyword">done</span>

</code></pre> 
<h3><a id="_76"></a>批量拷贝文件</h3> 
<pre><code class="prism language-sh"><span class="token shebang important">#!/bin/bash</span>
<span class="token operator">&lt;&lt;</span><span class="token string">bak
pass.txt 文件示例
192.168.1.2 root password 22
192.168.1.3 root password 22
bak</span>
<span class="token punctuation">[</span> <span class="token parameter variable">-f</span> /etc/init.d/functions <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">.</span> /etc/init.d/functions
<span class="token assign-left variable">INFO</span><span class="token operator">=</span>pass.txt
<span class="token comment"># yum install -y sshpass</span>
<span class="token keyword">for</span> <span class="token for-or-select variable">IP</span> <span class="token keyword">in</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">awk</span> <span class="token string">'/^[^#]/{print $1}'</span> $INFO<span class="token variable">)</span></span><span class="token punctuation">;</span> <span class="token keyword">do</span>
    <span class="token assign-left variable"><span class="token environment constant">USER</span></span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">awk</span> <span class="token parameter variable">-v</span> <span class="token assign-left variable">I</span><span class="token operator">=</span>$IP <span class="token string">'I==$1{print $2}'</span> $INFO<span class="token variable">)</span></span>
    <span class="token assign-left variable">PASS</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">awk</span> <span class="token parameter variable">-v</span> <span class="token assign-left variable">I</span><span class="token operator">=</span>$IP <span class="token string">'I==$1{print $3}'</span> $INFO<span class="token variable">)</span></span>
    <span class="token assign-left variable">PORT</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">awk</span> <span class="token parameter variable">-v</span> <span class="token assign-left variable">I</span><span class="token operator">=</span>$IP <span class="token string">'I==$1{print $4}'</span> $INFO<span class="token variable">)</span></span>
    sshpass <span class="token parameter variable">-p</span> <span class="token variable">$PASS</span> <span class="token function">scp</span> <span class="token parameter variable">-o</span> <span class="token assign-left variable">StrictHostKeyChecking</span><span class="token operator">=</span>no <span class="token variable">$1</span> <span class="token variable">${<!-- --><span class="token environment constant">USER</span>}</span>@<span class="token variable">${IP}</span><span class="token builtin class-name">:</span><span class="token variable">$2</span>  <span class="token operator">&amp;&amp;</span> <span class="token punctuation">\</span>
    action <span class="token string">"拷贝成功 <span class="token variable">$IP</span>"</span> /bin/true <span class="token operator">||</span> <span class="token punctuation">\</span>
    action <span class="token string">"拷贝失败 <span class="token variable">$IP</span>"</span> /bin/false
<span class="token keyword">done</span>

</code></pre> 
<h3><a id="_98"></a>批量修改密码</h3> 
<pre><code class="prism language-sh"><span class="token shebang important">#!/bin/bash</span>
<span class="token operator">&lt;&lt;</span><span class="token string">bak
old_pass.txt 文件示例
192.168.1.2 root password 22
192.168.1.3 root password 22
bak</span>

<span class="token punctuation">[</span> <span class="token parameter variable">-f</span> /etc/init.d/functions <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">.</span> /etc/init.d/functions
<span class="token assign-left variable">OLD_INFO</span><span class="token operator">=</span>old_pass.txt
<span class="token assign-left variable">NEW_INFO</span><span class="token operator">=</span>new_pass.txt
<span class="token comment"># yum install -y sshpass</span>
<span class="token keyword">for</span> <span class="token for-or-select variable">IP</span> <span class="token keyword">in</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">awk</span> <span class="token string">'/^[^#]/{print $1}'</span> $OLD_INFO<span class="token variable">)</span></span><span class="token punctuation">;</span> <span class="token keyword">do</span>
    <span class="token assign-left variable"><span class="token environment constant">USER</span></span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">awk</span> <span class="token parameter variable">-v</span> <span class="token assign-left variable">I</span><span class="token operator">=</span>$IP <span class="token string">'I==$1{print $2}'</span> $OLD_INFO<span class="token variable">)</span></span>
    <span class="token assign-left variable">PASS</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">awk</span> <span class="token parameter variable">-v</span> <span class="token assign-left variable">I</span><span class="token operator">=</span>$IP <span class="token string">'I==$1{print $3}'</span> $OLD_INFO<span class="token variable">)</span></span>
    <span class="token assign-left variable">PORT</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">awk</span> <span class="token parameter variable">-v</span> <span class="token assign-left variable">I</span><span class="token operator">=</span>$IP <span class="token string">'I==$1{print $4}'</span> $OLD_INFO<span class="token variable">)</span></span>
    <span class="token assign-left variable">NEW_PASS</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>openssl rand <span class="token parameter variable">-base64</span> <span class="token number">8</span><span class="token variable">)</span></span>
    <span class="token comment">#NEW_PASS=1</span>
    sshpass <span class="token parameter variable">-p</span> <span class="token string">"<span class="token variable">$PASS</span>"</span> <span class="token function">ssh</span> <span class="token parameter variable">-p</span> <span class="token variable">$PORT</span> <span class="token environment constant">$USER</span>@<span class="token variable">$IP</span> <span class="token parameter variable">-o</span> <span class="token assign-left variable">StrictHostKeyChecking</span><span class="token operator">=</span>no <span class="token string">"echo <span class="token variable">$NEW_PASS</span> |passwd --stdin <span class="token environment constant">$USER</span>"</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">\</span>
    <span class="token punctuation">(</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$IP</span> <span class="token environment constant">$USER</span> <span class="token variable">$NEW_PASS</span> <span class="token variable">$PORT</span> [<span class="token variable"><span class="token variable">`</span><span class="token function">date</span> <span class="token string">'+%F %T'</span><span class="token variable">`</span></span>]"</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">$NEW_INFO</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">\</span>
    action <span class="token string">"配置成功 <span class="token environment constant">$USER</span> <span class="token variable">$IP</span> <span class="token variable">$NEW_PASS</span>"</span> /bin/true
    <span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">\</span>
    action <span class="token string">"配置失败 <span class="token environment constant">$USER</span> <span class="token variable">$IP</span> <span class="token variable">$PASS</span>"</span> /bin/false
<span class="token keyword">done</span>

</code></pre> 
<hr> 
<p>本章完结<br> 爱情不是牢笼 而应该吧最好的展现给对方 让对方觉得被爱 和 尊重</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/085b6ba19788c38a7246058a21945f18/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">类和对象及其关系</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/0e7c0878b601c9b6d0e1890fe9c7e866/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">自动驾驶预测-决策-规划-控制学习（1）：自动驾驶框架、硬件、软件概述</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>