<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>大创项目推荐 深度学习人脸表情识别算法 - opencv python 机器视觉 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="大创项目推荐 深度学习人脸表情识别算法 - opencv python 机器视觉" />
<meta property="og:description" content="文章目录 0 前言1 技术介绍1.1 技术概括1.2 目前表情识别实现技术 2 实现效果3 深度学习表情识别实现过程3.1 网络架构3.2 数据3.3 实现流程3.4 部分实现代码 4 最后 0 前言 🔥 优质竞赛项目系列，今天要分享的是
🚩 深度学习人脸表情识别系统
该项目较为新颖，适合作为竞赛课题方向，学长非常推荐！
🥇学长这里给一个题目综合评分(每项满分5分)
难度系数：3分工作量：3分创新点：4分 🧿 更多资料, 项目分享：
https://gitee.com/dancheng-senior/postgraduate
1 技术介绍 1.1 技术概括 面部表情识别技术源于1971年心理学家Ekman和Friesen的一项研究，他们提出人类主要有六种基本情感，每种情感以唯一的表情来反映当时的心理活动，这六种情感分别是愤怒（anger）、高兴(happiness)、悲伤
(sadness)、惊讶(surprise)、厌恶(disgust)和恐惧(fear)。
尽管人类的情感维度和表情复杂度远不是数字6可以量化的，但总体而言，这6种也差不多够描述了。
1.2 目前表情识别实现技术 2 实现效果 废话不多说，先上实现效果
3 深度学习表情识别实现过程 3.1 网络架构 面部表情识别CNN架构（改编自 埃因霍芬理工大学PARsE结构图）
其中，通过卷积操作来创建特征映射，将卷积核挨个与图像进行卷积，从而创建一组要素图，并在其后通过池化（pooling）操作来降维。
3.2 数据 主要来源于kaggle比赛，下载地址。
有七种表情类别： (0=Angry, 1=Disgust, 2=Fear, 3=Happy, 4=Sad, 5=Surprise, 6=Neutral).
数据是48x48 灰度图，格式比较奇葩。
第一列是情绪分类，第二列是图像的numpy，第三列是train or test。
3.3 实现流程 3.4 部分实现代码 ​
import cv2 import sys import json import numpy as np from keras." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/7ecb761c599052e9675597138ff2d253/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-03T17:37:12+08:00" />
<meta property="article:modified_time" content="2024-01-03T17:37:12+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">大创项目推荐 深度学习人脸表情识别算法 - opencv python 机器视觉</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#0__3" rel="nofollow">0 前言</a></li><li><a href="#1__21" rel="nofollow">1 技术介绍</a></li><li><ul><li><a href="#11__23" rel="nofollow">1.1 技术概括</a></li><li><a href="#12__32" rel="nofollow">1.2 目前表情识别实现技术</a></li></ul> 
  </li><li><a href="#2__37" rel="nofollow">2 实现效果</a></li><li><a href="#3__46" rel="nofollow">3 深度学习表情识别实现过程</a></li><li><ul><li><a href="#31__48" rel="nofollow">3.1 网络架构</a></li><li><a href="#32__57" rel="nofollow">3.2 数据</a></li><li><a href="#33__66" rel="nofollow">3.3 实现流程</a></li><li><a href="#34__70" rel="nofollow">3.4 部分实现代码</a></li></ul> 
  </li><li><a href="#4__235" rel="nofollow">4 最后</a></li></ul> 
</div> 
<p></p> 
<h2><a id="0__3"></a>0 前言</h2> 
<p>🔥 优质竞赛项目系列，今天要分享的是</p> 
<p>🚩 <strong>深度学习人脸表情识别系统</strong></p> 
<p>该项目较为新颖，适合作为竞赛课题方向，学长非常推荐！</p> 
<p>🥇学长这里给一个题目综合评分(每项满分5分)</p> 
<ul><li>难度系数：3分</li><li>工作量：3分</li><li>创新点：4分</li></ul> 
<p>🧿 <strong>更多资料, 项目分享：</strong></p> 
<p><a href="https://gitee.com/dancheng-senior/postgraduate" rel="nofollow">https://gitee.com/dancheng-senior/postgraduate</a></p> 
<h2><a id="1__21"></a>1 技术介绍</h2> 
<h3><a id="11__23"></a>1.1 技术概括</h3> 
<p>面部表情识别技术源于1971年心理学家Ekman和Friesen的一项研究，他们提出人类主要有六种基本情感，每种情感以唯一的表情来反映当时的心理活动，这六种情感分别是愤怒（anger）、高兴(happiness)、悲伤<br> (sadness)、惊讶(surprise)、厌恶(disgust)和恐惧(fear)。</p> 
<p>尽管人类的情感维度和表情复杂度远不是数字6可以量化的，但总体而言，这6种也差不多够描述了。</p> 
<p><img src="https://images2.imgbox.com/0d/0d/pe40oBm5_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="12__32"></a>1.2 目前表情识别实现技术</h3> 
<p><img src="https://images2.imgbox.com/e9/5f/mBQMFBXF_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/fa/fa/ioz1SKqW_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="2__37"></a>2 实现效果</h2> 
<p>废话不多说，先上实现效果</p> 
<p><img src="https://images2.imgbox.com/76/89/Tpm6tfbj_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/c7/a8/ntmecgT1_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/44/d3/1cQ7aYyZ_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="3__46"></a>3 深度学习表情识别实现过程</h2> 
<h3><a id="31__48"></a>3.1 网络架构</h3> 
<p><img src="https://images2.imgbox.com/d2/9a/3XjZN3J5_o.png" alt="在这里插入图片描述"><br> 面部表情识别CNN架构（改编自 埃因霍芬理工大学PARsE结构图）</p> 
<p>其中，通过卷积操作来创建特征映射，将卷积核挨个与图像进行卷积，从而创建一组要素图，并在其后通过池化（pooling）操作来降维。</p> 
<p><img src="https://images2.imgbox.com/17/5c/js9ABV5r_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="32__57"></a>3.2 数据</h3> 
<p>主要来源于kaggle比赛，下载地址。<br> 有七种表情类别： (0=Angry, 1=Disgust, 2=Fear, 3=Happy, 4=Sad, 5=Surprise, 6=Neutral).<br> 数据是48x48 灰度图，格式比较奇葩。<br> 第一列是情绪分类，第二列是图像的numpy，第三列是train or test。</p> 
<p><img src="https://images2.imgbox.com/02/41/y3oNM3Zy_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="33__66"></a>3.3 实现流程</h3> 
<p><img src="https://images2.imgbox.com/af/73/B5n2RClA_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="34__70"></a>3.4 部分实现代码</h3> 
<p>​</p> 
<pre><code class="prism language-python">

    <span class="token keyword">import</span> cv2
    <span class="token keyword">import</span> sys
    <span class="token keyword">import</span> json
    <span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
    <span class="token keyword">from</span> keras<span class="token punctuation">.</span>models <span class="token keyword">import</span> model_from_json

    emotions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'angry'</span><span class="token punctuation">,</span> <span class="token string">'fear'</span><span class="token punctuation">,</span> <span class="token string">'happy'</span><span class="token punctuation">,</span> <span class="token string">'sad'</span><span class="token punctuation">,</span> <span class="token string">'surprise'</span><span class="token punctuation">,</span> <span class="token string">'neutral'</span><span class="token punctuation">]</span>
    cascPath <span class="token operator">=</span> sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    
    faceCascade <span class="token operator">=</span> cv2<span class="token punctuation">.</span>CascadeClassifier<span class="token punctuation">(</span>cascPath<span class="token punctuation">)</span>
    noseCascade <span class="token operator">=</span> cv2<span class="token punctuation">.</span>CascadeClassifier<span class="token punctuation">(</span>cascPath<span class="token punctuation">)</span>

    <span class="token comment"># load json and create model arch</span>
    json_file <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'model.json'</span><span class="token punctuation">,</span><span class="token string">'r'</span><span class="token punctuation">)</span>
    loaded_model_json <span class="token operator">=</span> json_file<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
    json_file<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
    model <span class="token operator">=</span> model_from_json<span class="token punctuation">(</span>loaded_model_json<span class="token punctuation">)</span>
    
    <span class="token comment"># load weights into new model</span>
    model<span class="token punctuation">.</span>load_weights<span class="token punctuation">(</span><span class="token string">'model.h5'</span><span class="token punctuation">)</span>
    
    <span class="token comment"># overlay meme face</span>
    <span class="token keyword">def</span> <span class="token function">overlay_memeface</span><span class="token punctuation">(</span>probs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token builtin">max</span><span class="token punctuation">(</span>probs<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0.8</span><span class="token punctuation">:</span>
            emotion <span class="token operator">=</span> emotions<span class="token punctuation">[</span>np<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span>probs<span class="token punctuation">)</span><span class="token punctuation">]</span>
            <span class="token keyword">return</span> <span class="token string">'meme_faces/{}-{}.png'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>emotion<span class="token punctuation">,</span> emotion<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            index1<span class="token punctuation">,</span> index2 <span class="token operator">=</span> np<span class="token punctuation">.</span>argsort<span class="token punctuation">(</span>probs<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span>
            emotion1 <span class="token operator">=</span> emotions<span class="token punctuation">[</span>index1<span class="token punctuation">]</span>
            emotion2 <span class="token operator">=</span> emotions<span class="token punctuation">[</span>index2<span class="token punctuation">]</span>
            <span class="token keyword">return</span> <span class="token string">'meme_faces/{}-{}.png'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>emotion1<span class="token punctuation">,</span> emotion2<span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">predict_emotion</span><span class="token punctuation">(</span>face_image_gray<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># a single cropped face</span>
        resized_img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>resize<span class="token punctuation">(</span>face_image_gray<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">48</span><span class="token punctuation">,</span><span class="token number">48</span><span class="token punctuation">)</span><span class="token punctuation">,</span> interpolation <span class="token operator">=</span> cv2<span class="token punctuation">.</span>INTER_AREA<span class="token punctuation">)</span>
        <span class="token comment"># cv2.imwrite(str(index)+'.png', resized_img)</span>
        image <span class="token operator">=</span> resized_img<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">)</span>
        list_of_list <span class="token operator">=</span> model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>image<span class="token punctuation">,</span> batch_size<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> verbose<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
        angry<span class="token punctuation">,</span> fear<span class="token punctuation">,</span> happy<span class="token punctuation">,</span> sad<span class="token punctuation">,</span> surprise<span class="token punctuation">,</span> neutral <span class="token operator">=</span> <span class="token punctuation">[</span>prob <span class="token keyword">for</span> lst <span class="token keyword">in</span> list_of_list <span class="token keyword">for</span> prob <span class="token keyword">in</span> lst<span class="token punctuation">]</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span>angry<span class="token punctuation">,</span> fear<span class="token punctuation">,</span> happy<span class="token punctuation">,</span> sad<span class="token punctuation">,</span> surprise<span class="token punctuation">,</span> neutral<span class="token punctuation">]</span>
    
    video_capture <span class="token operator">=</span> cv2<span class="token punctuation">.</span>VideoCapture<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        <span class="token comment"># Capture frame-by-frame</span>
        ret<span class="token punctuation">,</span> frame <span class="token operator">=</span> video_capture<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
        img_gray <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>frame<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2GRAY<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>

        faces <span class="token operator">=</span> faceCascade<span class="token punctuation">.</span>detectMultiScale<span class="token punctuation">(</span>
            img_gray<span class="token punctuation">,</span>
            scaleFactor<span class="token operator">=</span><span class="token number">1.1</span><span class="token punctuation">,</span>
            minNeighbors<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>
            minSize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            flags<span class="token operator">=</span>cv2<span class="token punctuation">.</span>cv<span class="token punctuation">.</span>CV_HAAR_SCALE_IMAGE
        <span class="token punctuation">)</span>
    
        <span class="token comment"># Draw a rectangle around the faces</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> w<span class="token punctuation">,</span> h<span class="token punctuation">)</span> <span class="token keyword">in</span> faces<span class="token punctuation">:</span>
    
            face_image_gray <span class="token operator">=</span> img_gray<span class="token punctuation">[</span>y<span class="token punctuation">:</span>y<span class="token operator">+</span>h<span class="token punctuation">,</span> x<span class="token punctuation">:</span>x<span class="token operator">+</span>w<span class="token punctuation">]</span>
            filename <span class="token operator">=</span> overlay_memeface<span class="token punctuation">(</span>predict_emotion<span class="token punctuation">(</span>face_image_gray<span class="token punctuation">)</span><span class="token punctuation">)</span>
    
            <span class="token keyword">print</span> filename
            meme <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span>filename<span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token comment"># meme = (meme/256).astype('uint8')</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                meme<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
            <span class="token keyword">except</span><span class="token punctuation">:</span>
                meme <span class="token operator">=</span> meme<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>meme<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> meme<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token comment"># print meme.dtype</span>
            <span class="token comment"># print meme.shape</span>
            orig_mask <span class="token operator">=</span> meme<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span>
            <span class="token comment"># print orig_mask.shape</span>
            <span class="token comment"># memegray = cv2.cvtColor(orig_mask, cv2.COLOR_BGR2GRAY)</span>
            ret1<span class="token punctuation">,</span> orig_mask <span class="token operator">=</span> cv2<span class="token punctuation">.</span>threshold<span class="token punctuation">(</span>orig_mask<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>THRESH_BINARY<span class="token punctuation">)</span>
            orig_mask_inv <span class="token operator">=</span> cv2<span class="token punctuation">.</span>bitwise_not<span class="token punctuation">(</span>orig_mask<span class="token punctuation">)</span>
            meme <span class="token operator">=</span> meme<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span>
            origMustacheHeight<span class="token punctuation">,</span> origMustacheWidth <span class="token operator">=</span> meme<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span>
    
            roi_gray <span class="token operator">=</span> img_gray<span class="token punctuation">[</span>y<span class="token punctuation">:</span>y<span class="token operator">+</span>h<span class="token punctuation">,</span> x<span class="token punctuation">:</span>x<span class="token operator">+</span>w<span class="token punctuation">]</span>
            roi_color <span class="token operator">=</span> frame<span class="token punctuation">[</span>y<span class="token punctuation">:</span>y<span class="token operator">+</span>h<span class="token punctuation">,</span> x<span class="token punctuation">:</span>x<span class="token operator">+</span>w<span class="token punctuation">]</span>
    
            <span class="token comment"># Detect a nose within the region bounded by each face (the ROI)</span>
            nose <span class="token operator">=</span> noseCascade<span class="token punctuation">.</span>detectMultiScale<span class="token punctuation">(</span>roi_gray<span class="token punctuation">)</span>
    
            <span class="token keyword">for</span> <span class="token punctuation">(</span>nx<span class="token punctuation">,</span>ny<span class="token punctuation">,</span>nw<span class="token punctuation">,</span>nh<span class="token punctuation">)</span> <span class="token keyword">in</span> nose<span class="token punctuation">:</span>
                <span class="token comment"># Un-comment the next line for debug (draw box around the nose)</span>
                <span class="token comment">#cv2.rectangle(roi_color,(nx,ny),(nx+nw,ny+nh),(255,0,0),2)</span>
    
                <span class="token comment"># The mustache should be three times the width of the nose</span>
                mustacheWidth <span class="token operator">=</span>  <span class="token number">20</span> <span class="token operator">*</span> nw
                mustacheHeight <span class="token operator">=</span> mustacheWidth <span class="token operator">*</span> origMustacheHeight <span class="token operator">/</span> origMustacheWidth
    
                <span class="token comment"># Center the mustache on the bottom of the nose</span>
                x1 <span class="token operator">=</span> nx <span class="token operator">-</span> <span class="token punctuation">(</span>mustacheWidth<span class="token operator">/</span><span class="token number">4</span><span class="token punctuation">)</span>
                x2 <span class="token operator">=</span> nx <span class="token operator">+</span> nw <span class="token operator">+</span> <span class="token punctuation">(</span>mustacheWidth<span class="token operator">/</span><span class="token number">4</span><span class="token punctuation">)</span>
                y1 <span class="token operator">=</span> ny <span class="token operator">+</span> nh <span class="token operator">-</span> <span class="token punctuation">(</span>mustacheHeight<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span>
                y2 <span class="token operator">=</span> ny <span class="token operator">+</span> nh <span class="token operator">+</span> <span class="token punctuation">(</span>mustacheHeight<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span>
    
                <span class="token comment"># Check for clipping</span>
                <span class="token keyword">if</span> x1 <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
                    x1 <span class="token operator">=</span> <span class="token number">0</span>
                <span class="token keyword">if</span> y1 <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
                    y1 <span class="token operator">=</span> <span class="token number">0</span>
                <span class="token keyword">if</span> x2 <span class="token operator">&gt;</span> w<span class="token punctuation">:</span>
                    x2 <span class="token operator">=</span> w
                <span class="token keyword">if</span> y2 <span class="token operator">&gt;</span> h<span class="token punctuation">:</span>
                    y2 <span class="token operator">=</span> h

                <span class="token comment"># Re-calculate the width and height of the mustache image</span>
                mustacheWidth <span class="token operator">=</span> <span class="token punctuation">(</span>x2 <span class="token operator">-</span> x1<span class="token punctuation">)</span>
                mustacheHeight <span class="token operator">=</span> <span class="token punctuation">(</span>y2 <span class="token operator">-</span> y1<span class="token punctuation">)</span>
    
                <span class="token comment"># Re-size the original image and the masks to the mustache sizes</span>
                <span class="token comment"># calcualted above</span>
                mustache <span class="token operator">=</span> cv2<span class="token punctuation">.</span>resize<span class="token punctuation">(</span>meme<span class="token punctuation">,</span> <span class="token punctuation">(</span>mustacheWidth<span class="token punctuation">,</span>mustacheHeight<span class="token punctuation">)</span><span class="token punctuation">,</span> interpolation <span class="token operator">=</span> cv2<span class="token punctuation">.</span>INTER_AREA<span class="token punctuation">)</span>
                mask <span class="token operator">=</span> cv2<span class="token punctuation">.</span>resize<span class="token punctuation">(</span>orig_mask<span class="token punctuation">,</span> <span class="token punctuation">(</span>mustacheWidth<span class="token punctuation">,</span>mustacheHeight<span class="token punctuation">)</span><span class="token punctuation">,</span> interpolation <span class="token operator">=</span> cv2<span class="token punctuation">.</span>INTER_AREA<span class="token punctuation">)</span>
                mask_inv <span class="token operator">=</span> cv2<span class="token punctuation">.</span>resize<span class="token punctuation">(</span>orig_mask_inv<span class="token punctuation">,</span> <span class="token punctuation">(</span>mustacheWidth<span class="token punctuation">,</span>mustacheHeight<span class="token punctuation">)</span><span class="token punctuation">,</span> interpolation <span class="token operator">=</span> cv2<span class="token punctuation">.</span>INTER_AREA<span class="token punctuation">)</span>
    
                <span class="token comment"># take ROI for mustache from background equal to size of mustache image</span>
                roi <span class="token operator">=</span> roi_color<span class="token punctuation">[</span>y1<span class="token punctuation">:</span>y2<span class="token punctuation">,</span> x1<span class="token punctuation">:</span>x2<span class="token punctuation">]</span>
    
                <span class="token comment"># roi_bg contains the original image only where the mustache is not</span>
                <span class="token comment"># in the region that is the size of the mustache.</span>
                roi_bg <span class="token operator">=</span> cv2<span class="token punctuation">.</span>bitwise_and<span class="token punctuation">(</span>roi<span class="token punctuation">,</span>roi<span class="token punctuation">,</span>mask <span class="token operator">=</span> mask_inv<span class="token punctuation">)</span>
    
                <span class="token comment"># roi_fg contains the image of the mustache only where the mustache is</span>
                roi_fg <span class="token operator">=</span> cv2<span class="token punctuation">.</span>bitwise_and<span class="token punctuation">(</span>mustache<span class="token punctuation">,</span>mustache<span class="token punctuation">,</span>mask <span class="token operator">=</span> mask<span class="token punctuation">)</span>
    
                <span class="token comment"># join the roi_bg and roi_fg</span>
                dst <span class="token operator">=</span> cv2<span class="token punctuation">.</span>add<span class="token punctuation">(</span>roi_bg<span class="token punctuation">,</span>roi_fg<span class="token punctuation">)</span>
    
                <span class="token comment"># place the joined image, saved to dst back over the original image</span>
                roi_color<span class="token punctuation">[</span>y1<span class="token punctuation">:</span>y2<span class="token punctuation">,</span> x1<span class="token punctuation">:</span>x2<span class="token punctuation">]</span> <span class="token operator">=</span> dst
    
                <span class="token keyword">break</span>
    
        <span class="token comment">#     cv2.rectangle(frame, (x, y), (x+w, y+h), (0, 255, 0), 2)</span>
        <span class="token comment">#     angry, fear, happy, sad, surprise, neutral = predict_emotion(face_image_gray)</span>
        <span class="token comment">#     text1 = 'Angry: {}     Fear: {}   Happy: {}'.format(angry, fear, happy)</span>
        <span class="token comment">#     text2 = '  Sad: {} Surprise: {} Neutral: {}'.format(sad, surprise, neutral)</span>
        <span class="token comment">#</span>
        <span class="token comment"># cv2.putText(frame, text1, (50, 50), cv2.FONT_HERSHEY_SIMPLEX, 2, (255, 0, 0), 3)</span>
        <span class="token comment"># cv2.putText(frame, text2, (50, 150), cv2.FONT_HERSHEY_SIMPLEX, 2, (255, 0, 0), 3)</span>
    
        <span class="token comment"># Display the resulting frame</span>
        cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'Video'</span><span class="token punctuation">,</span> frame<span class="token punctuation">)</span>
    
        <span class="token keyword">if</span> cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span> <span class="token operator">==</span> <span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">'q'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">break</span>
    
    <span class="token comment"># When everything is done, release the capture</span>
    video_capture<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>
    cv2<span class="token punctuation">.</span>destroyAllWindows<span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre> 
<p><strong>需要完整代码以及学长训练好的模型，联系学长获取</strong></p> 
<h2><a id="4__235"></a>4 最后</h2> 
<p>🧿 <strong>更多资料, 项目分享：</strong></p> 
<p><a href="https://gitee.com/dancheng-senior/postgraduate" rel="nofollow">https://gitee.com/dancheng-senior/postgraduate</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/9534846b72d470b5ad2a8ceaf271ed03/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">vim常用操作</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/33dfca04934c8c969d73abca0abae2f4/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">大创项目推荐 深度学习动物识别 - 卷积神经网络 机器视觉 图像识别</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>