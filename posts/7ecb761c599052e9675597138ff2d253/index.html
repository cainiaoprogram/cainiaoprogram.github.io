<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>å¤§åˆ›é¡¹ç›®æ¨è æ·±åº¦å­¦ä¹ äººè„¸è¡¨æƒ…è¯†åˆ«ç®—æ³• - opencv python æœºå™¨è§†è§‰ - èœé¸Ÿç¨‹åºå‘˜åšå®¢</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="å¤§åˆ›é¡¹ç›®æ¨è æ·±åº¦å­¦ä¹ äººè„¸è¡¨æƒ…è¯†åˆ«ç®—æ³• - opencv python æœºå™¨è§†è§‰" />
<meta property="og:description" content="æ–‡ç« ç›®å½• 0 å‰è¨€1 æŠ€æœ¯ä»‹ç»1.1 æŠ€æœ¯æ¦‚æ‹¬1.2 ç›®å‰è¡¨æƒ…è¯†åˆ«å®ç°æŠ€æœ¯ 2 å®ç°æ•ˆæœ3 æ·±åº¦å­¦ä¹ è¡¨æƒ…è¯†åˆ«å®ç°è¿‡ç¨‹3.1 ç½‘ç»œæ¶æ„3.2 æ•°æ®3.3 å®ç°æµç¨‹3.4 éƒ¨åˆ†å®ç°ä»£ç  4 æœ€å 0 å‰è¨€ ğŸ”¥ ä¼˜è´¨ç«èµ›é¡¹ç›®ç³»åˆ—ï¼Œä»Šå¤©è¦åˆ†äº«çš„æ˜¯
ğŸš© æ·±åº¦å­¦ä¹ äººè„¸è¡¨æƒ…è¯†åˆ«ç³»ç»Ÿ
è¯¥é¡¹ç›®è¾ƒä¸ºæ–°é¢–ï¼Œé€‚åˆä½œä¸ºç«èµ›è¯¾é¢˜æ–¹å‘ï¼Œå­¦é•¿éå¸¸æ¨èï¼
ğŸ¥‡å­¦é•¿è¿™é‡Œç»™ä¸€ä¸ªé¢˜ç›®ç»¼åˆè¯„åˆ†(æ¯é¡¹æ»¡åˆ†5åˆ†)
éš¾åº¦ç³»æ•°ï¼š3åˆ†å·¥ä½œé‡ï¼š3åˆ†åˆ›æ–°ç‚¹ï¼š4åˆ† ğŸ§¿ æ›´å¤šèµ„æ–™, é¡¹ç›®åˆ†äº«ï¼š
https://gitee.com/dancheng-senior/postgraduate
1 æŠ€æœ¯ä»‹ç» 1.1 æŠ€æœ¯æ¦‚æ‹¬ é¢éƒ¨è¡¨æƒ…è¯†åˆ«æŠ€æœ¯æºäº1971å¹´å¿ƒç†å­¦å®¶Ekmanå’ŒFriesençš„ä¸€é¡¹ç ”ç©¶ï¼Œä»–ä»¬æå‡ºäººç±»ä¸»è¦æœ‰å…­ç§åŸºæœ¬æƒ…æ„Ÿï¼Œæ¯ç§æƒ…æ„Ÿä»¥å”¯ä¸€çš„è¡¨æƒ…æ¥åæ˜ å½“æ—¶çš„å¿ƒç†æ´»åŠ¨ï¼Œè¿™å…­ç§æƒ…æ„Ÿåˆ†åˆ«æ˜¯æ„¤æ€’ï¼ˆangerï¼‰ã€é«˜å…´(happiness)ã€æ‚²ä¼¤
(sadness)ã€æƒŠè®¶(surprise)ã€åŒæ¶(disgust)å’Œææƒ§(fear)ã€‚
å°½ç®¡äººç±»çš„æƒ…æ„Ÿç»´åº¦å’Œè¡¨æƒ…å¤æ‚åº¦è¿œä¸æ˜¯æ•°å­—6å¯ä»¥é‡åŒ–çš„ï¼Œä½†æ€»ä½“è€Œè¨€ï¼Œè¿™6ç§ä¹Ÿå·®ä¸å¤šå¤Ÿæè¿°äº†ã€‚
1.2 ç›®å‰è¡¨æƒ…è¯†åˆ«å®ç°æŠ€æœ¯ 2 å®ç°æ•ˆæœ åºŸè¯ä¸å¤šè¯´ï¼Œå…ˆä¸Šå®ç°æ•ˆæœ
3 æ·±åº¦å­¦ä¹ è¡¨æƒ…è¯†åˆ«å®ç°è¿‡ç¨‹ 3.1 ç½‘ç»œæ¶æ„ é¢éƒ¨è¡¨æƒ…è¯†åˆ«CNNæ¶æ„ï¼ˆæ”¹ç¼–è‡ª åŸƒå› éœèŠ¬ç†å·¥å¤§å­¦PARsEç»“æ„å›¾ï¼‰
å…¶ä¸­ï¼Œé€šè¿‡å·ç§¯æ“ä½œæ¥åˆ›å»ºç‰¹å¾æ˜ å°„ï¼Œå°†å·ç§¯æ ¸æŒ¨ä¸ªä¸å›¾åƒè¿›è¡Œå·ç§¯ï¼Œä»è€Œåˆ›å»ºä¸€ç»„è¦ç´ å›¾ï¼Œå¹¶åœ¨å…¶åé€šè¿‡æ± åŒ–ï¼ˆpoolingï¼‰æ“ä½œæ¥é™ç»´ã€‚
3.2 æ•°æ® ä¸»è¦æ¥æºäºkaggleæ¯”èµ›ï¼Œä¸‹è½½åœ°å€ã€‚
æœ‰ä¸ƒç§è¡¨æƒ…ç±»åˆ«ï¼š (0=Angry, 1=Disgust, 2=Fear, 3=Happy, 4=Sad, 5=Surprise, 6=Neutral).
æ•°æ®æ˜¯48x48 ç°åº¦å›¾ï¼Œæ ¼å¼æ¯”è¾ƒå¥‡è‘©ã€‚
ç¬¬ä¸€åˆ—æ˜¯æƒ…ç»ªåˆ†ç±»ï¼Œç¬¬äºŒåˆ—æ˜¯å›¾åƒçš„numpyï¼Œç¬¬ä¸‰åˆ—æ˜¯train or testã€‚
3.3 å®ç°æµç¨‹ 3.4 éƒ¨åˆ†å®ç°ä»£ç  â€‹
import cv2 import sys import json import numpy as np from keras." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/7ecb761c599052e9675597138ff2d253/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-03T17:37:12+08:00" />
<meta property="article:modified_time" content="2024-01-03T17:37:12+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="èœé¸Ÿç¨‹åºå‘˜åšå®¢" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">èœé¸Ÿç¨‹åºå‘˜åšå®¢</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">å¤§åˆ›é¡¹ç›®æ¨è æ·±åº¦å­¦ä¹ äººè„¸è¡¨æƒ…è¯†åˆ«ç®—æ³• - opencv python æœºå™¨è§†è§‰</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>æ–‡ç« ç›®å½•</h4> 
 <ul><li><a href="#0__3" rel="nofollow">0 å‰è¨€</a></li><li><a href="#1__21" rel="nofollow">1 æŠ€æœ¯ä»‹ç»</a></li><li><ul><li><a href="#11__23" rel="nofollow">1.1 æŠ€æœ¯æ¦‚æ‹¬</a></li><li><a href="#12__32" rel="nofollow">1.2 ç›®å‰è¡¨æƒ…è¯†åˆ«å®ç°æŠ€æœ¯</a></li></ul> 
  </li><li><a href="#2__37" rel="nofollow">2 å®ç°æ•ˆæœ</a></li><li><a href="#3__46" rel="nofollow">3 æ·±åº¦å­¦ä¹ è¡¨æƒ…è¯†åˆ«å®ç°è¿‡ç¨‹</a></li><li><ul><li><a href="#31__48" rel="nofollow">3.1 ç½‘ç»œæ¶æ„</a></li><li><a href="#32__57" rel="nofollow">3.2 æ•°æ®</a></li><li><a href="#33__66" rel="nofollow">3.3 å®ç°æµç¨‹</a></li><li><a href="#34__70" rel="nofollow">3.4 éƒ¨åˆ†å®ç°ä»£ç </a></li></ul> 
  </li><li><a href="#4__235" rel="nofollow">4 æœ€å</a></li></ul> 
</div> 
<p></p> 
<h2><a id="0__3"></a>0 å‰è¨€</h2> 
<p>ğŸ”¥ ä¼˜è´¨ç«èµ›é¡¹ç›®ç³»åˆ—ï¼Œä»Šå¤©è¦åˆ†äº«çš„æ˜¯</p> 
<p>ğŸš© <strong>æ·±åº¦å­¦ä¹ äººè„¸è¡¨æƒ…è¯†åˆ«ç³»ç»Ÿ</strong></p> 
<p>è¯¥é¡¹ç›®è¾ƒä¸ºæ–°é¢–ï¼Œé€‚åˆä½œä¸ºç«èµ›è¯¾é¢˜æ–¹å‘ï¼Œå­¦é•¿éå¸¸æ¨èï¼</p> 
<p>ğŸ¥‡å­¦é•¿è¿™é‡Œç»™ä¸€ä¸ªé¢˜ç›®ç»¼åˆè¯„åˆ†(æ¯é¡¹æ»¡åˆ†5åˆ†)</p> 
<ul><li>éš¾åº¦ç³»æ•°ï¼š3åˆ†</li><li>å·¥ä½œé‡ï¼š3åˆ†</li><li>åˆ›æ–°ç‚¹ï¼š4åˆ†</li></ul> 
<p>ğŸ§¿ <strong>æ›´å¤šèµ„æ–™, é¡¹ç›®åˆ†äº«ï¼š</strong></p> 
<p><a href="https://gitee.com/dancheng-senior/postgraduate" rel="nofollow">https://gitee.com/dancheng-senior/postgraduate</a></p> 
<h2><a id="1__21"></a>1 æŠ€æœ¯ä»‹ç»</h2> 
<h3><a id="11__23"></a>1.1 æŠ€æœ¯æ¦‚æ‹¬</h3> 
<p>é¢éƒ¨è¡¨æƒ…è¯†åˆ«æŠ€æœ¯æºäº1971å¹´å¿ƒç†å­¦å®¶Ekmanå’ŒFriesençš„ä¸€é¡¹ç ”ç©¶ï¼Œä»–ä»¬æå‡ºäººç±»ä¸»è¦æœ‰å…­ç§åŸºæœ¬æƒ…æ„Ÿï¼Œæ¯ç§æƒ…æ„Ÿä»¥å”¯ä¸€çš„è¡¨æƒ…æ¥åæ˜ å½“æ—¶çš„å¿ƒç†æ´»åŠ¨ï¼Œè¿™å…­ç§æƒ…æ„Ÿåˆ†åˆ«æ˜¯æ„¤æ€’ï¼ˆangerï¼‰ã€é«˜å…´(happiness)ã€æ‚²ä¼¤<br> (sadness)ã€æƒŠè®¶(surprise)ã€åŒæ¶(disgust)å’Œææƒ§(fear)ã€‚</p> 
<p>å°½ç®¡äººç±»çš„æƒ…æ„Ÿç»´åº¦å’Œè¡¨æƒ…å¤æ‚åº¦è¿œä¸æ˜¯æ•°å­—6å¯ä»¥é‡åŒ–çš„ï¼Œä½†æ€»ä½“è€Œè¨€ï¼Œè¿™6ç§ä¹Ÿå·®ä¸å¤šå¤Ÿæè¿°äº†ã€‚</p> 
<p><img src="https://images2.imgbox.com/0d/0d/pe40oBm5_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h3><a id="12__32"></a>1.2 ç›®å‰è¡¨æƒ…è¯†åˆ«å®ç°æŠ€æœ¯</h3> 
<p><img src="https://images2.imgbox.com/e9/5f/mBQMFBXF_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br> <img src="https://images2.imgbox.com/fa/fa/ioz1SKqW_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h2><a id="2__37"></a>2 å®ç°æ•ˆæœ</h2> 
<p>åºŸè¯ä¸å¤šè¯´ï¼Œå…ˆä¸Šå®ç°æ•ˆæœ</p> 
<p><img src="https://images2.imgbox.com/76/89/Tpm6tfbj_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br> <img src="https://images2.imgbox.com/c7/a8/ntmecgT1_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p><img src="https://images2.imgbox.com/44/d3/1cQ7aYyZ_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h2><a id="3__46"></a>3 æ·±åº¦å­¦ä¹ è¡¨æƒ…è¯†åˆ«å®ç°è¿‡ç¨‹</h2> 
<h3><a id="31__48"></a>3.1 ç½‘ç»œæ¶æ„</h3> 
<p><img src="https://images2.imgbox.com/d2/9a/3XjZN3J5_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br> é¢éƒ¨è¡¨æƒ…è¯†åˆ«CNNæ¶æ„ï¼ˆæ”¹ç¼–è‡ª åŸƒå› éœèŠ¬ç†å·¥å¤§å­¦PARsEç»“æ„å›¾ï¼‰</p> 
<p>å…¶ä¸­ï¼Œé€šè¿‡å·ç§¯æ“ä½œæ¥åˆ›å»ºç‰¹å¾æ˜ å°„ï¼Œå°†å·ç§¯æ ¸æŒ¨ä¸ªä¸å›¾åƒè¿›è¡Œå·ç§¯ï¼Œä»è€Œåˆ›å»ºä¸€ç»„è¦ç´ å›¾ï¼Œå¹¶åœ¨å…¶åé€šè¿‡æ± åŒ–ï¼ˆpoolingï¼‰æ“ä½œæ¥é™ç»´ã€‚</p> 
<p><img src="https://images2.imgbox.com/17/5c/js9ABV5r_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h3><a id="32__57"></a>3.2 æ•°æ®</h3> 
<p>ä¸»è¦æ¥æºäºkaggleæ¯”èµ›ï¼Œä¸‹è½½åœ°å€ã€‚<br> æœ‰ä¸ƒç§è¡¨æƒ…ç±»åˆ«ï¼š (0=Angry, 1=Disgust, 2=Fear, 3=Happy, 4=Sad, 5=Surprise, 6=Neutral).<br> æ•°æ®æ˜¯48x48 ç°åº¦å›¾ï¼Œæ ¼å¼æ¯”è¾ƒå¥‡è‘©ã€‚<br> ç¬¬ä¸€åˆ—æ˜¯æƒ…ç»ªåˆ†ç±»ï¼Œç¬¬äºŒåˆ—æ˜¯å›¾åƒçš„numpyï¼Œç¬¬ä¸‰åˆ—æ˜¯train or testã€‚</p> 
<p><img src="https://images2.imgbox.com/02/41/y3oNM3Zy_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h3><a id="33__66"></a>3.3 å®ç°æµç¨‹</h3> 
<p><img src="https://images2.imgbox.com/af/73/B5n2RClA_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h3><a id="34__70"></a>3.4 éƒ¨åˆ†å®ç°ä»£ç </h3> 
<p>â€‹</p> 
<pre><code class="prism language-python">

    <span class="token keyword">import</span> cv2
    <span class="token keyword">import</span> sys
    <span class="token keyword">import</span> json
    <span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
    <span class="token keyword">from</span> keras<span class="token punctuation">.</span>models <span class="token keyword">import</span> model_from_json

    emotions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'angry'</span><span class="token punctuation">,</span> <span class="token string">'fear'</span><span class="token punctuation">,</span> <span class="token string">'happy'</span><span class="token punctuation">,</span> <span class="token string">'sad'</span><span class="token punctuation">,</span> <span class="token string">'surprise'</span><span class="token punctuation">,</span> <span class="token string">'neutral'</span><span class="token punctuation">]</span>
    cascPath <span class="token operator">=</span> sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    
    faceCascade <span class="token operator">=</span> cv2<span class="token punctuation">.</span>CascadeClassifier<span class="token punctuation">(</span>cascPath<span class="token punctuation">)</span>
    noseCascade <span class="token operator">=</span> cv2<span class="token punctuation">.</span>CascadeClassifier<span class="token punctuation">(</span>cascPath<span class="token punctuation">)</span>

    <span class="token comment"># load json and create model arch</span>
    json_file <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'model.json'</span><span class="token punctuation">,</span><span class="token string">'r'</span><span class="token punctuation">)</span>
    loaded_model_json <span class="token operator">=</span> json_file<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
    json_file<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
    model <span class="token operator">=</span> model_from_json<span class="token punctuation">(</span>loaded_model_json<span class="token punctuation">)</span>
    
    <span class="token comment"># load weights into new model</span>
    model<span class="token punctuation">.</span>load_weights<span class="token punctuation">(</span><span class="token string">'model.h5'</span><span class="token punctuation">)</span>
    
    <span class="token comment"># overlay meme face</span>
    <span class="token keyword">def</span> <span class="token function">overlay_memeface</span><span class="token punctuation">(</span>probs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token builtin">max</span><span class="token punctuation">(</span>probs<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0.8</span><span class="token punctuation">:</span>
            emotion <span class="token operator">=</span> emotions<span class="token punctuation">[</span>np<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span>probs<span class="token punctuation">)</span><span class="token punctuation">]</span>
            <span class="token keyword">return</span> <span class="token string">'meme_faces/{}-{}.png'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>emotion<span class="token punctuation">,</span> emotion<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            index1<span class="token punctuation">,</span> index2 <span class="token operator">=</span> np<span class="token punctuation">.</span>argsort<span class="token punctuation">(</span>probs<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span>
            emotion1 <span class="token operator">=</span> emotions<span class="token punctuation">[</span>index1<span class="token punctuation">]</span>
            emotion2 <span class="token operator">=</span> emotions<span class="token punctuation">[</span>index2<span class="token punctuation">]</span>
            <span class="token keyword">return</span> <span class="token string">'meme_faces/{}-{}.png'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>emotion1<span class="token punctuation">,</span> emotion2<span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">predict_emotion</span><span class="token punctuation">(</span>face_image_gray<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># a single cropped face</span>
        resized_img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>resize<span class="token punctuation">(</span>face_image_gray<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">48</span><span class="token punctuation">,</span><span class="token number">48</span><span class="token punctuation">)</span><span class="token punctuation">,</span> interpolation <span class="token operator">=</span> cv2<span class="token punctuation">.</span>INTER_AREA<span class="token punctuation">)</span>
        <span class="token comment"># cv2.imwrite(str(index)+'.png', resized_img)</span>
        image <span class="token operator">=</span> resized_img<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">)</span>
        list_of_list <span class="token operator">=</span> model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>image<span class="token punctuation">,</span> batch_size<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> verbose<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
        angry<span class="token punctuation">,</span> fear<span class="token punctuation">,</span> happy<span class="token punctuation">,</span> sad<span class="token punctuation">,</span> surprise<span class="token punctuation">,</span> neutral <span class="token operator">=</span> <span class="token punctuation">[</span>prob <span class="token keyword">for</span> lst <span class="token keyword">in</span> list_of_list <span class="token keyword">for</span> prob <span class="token keyword">in</span> lst<span class="token punctuation">]</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span>angry<span class="token punctuation">,</span> fear<span class="token punctuation">,</span> happy<span class="token punctuation">,</span> sad<span class="token punctuation">,</span> surprise<span class="token punctuation">,</span> neutral<span class="token punctuation">]</span>
    
    video_capture <span class="token operator">=</span> cv2<span class="token punctuation">.</span>VideoCapture<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        <span class="token comment"># Capture frame-by-frame</span>
        ret<span class="token punctuation">,</span> frame <span class="token operator">=</span> video_capture<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
        img_gray <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>frame<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2GRAY<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>

        faces <span class="token operator">=</span> faceCascade<span class="token punctuation">.</span>detectMultiScale<span class="token punctuation">(</span>
            img_gray<span class="token punctuation">,</span>
            scaleFactor<span class="token operator">=</span><span class="token number">1.1</span><span class="token punctuation">,</span>
            minNeighbors<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>
            minSize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            flags<span class="token operator">=</span>cv2<span class="token punctuation">.</span>cv<span class="token punctuation">.</span>CV_HAAR_SCALE_IMAGE
        <span class="token punctuation">)</span>
    
        <span class="token comment"># Draw a rectangle around the faces</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> w<span class="token punctuation">,</span> h<span class="token punctuation">)</span> <span class="token keyword">in</span> faces<span class="token punctuation">:</span>
    
            face_image_gray <span class="token operator">=</span> img_gray<span class="token punctuation">[</span>y<span class="token punctuation">:</span>y<span class="token operator">+</span>h<span class="token punctuation">,</span> x<span class="token punctuation">:</span>x<span class="token operator">+</span>w<span class="token punctuation">]</span>
            filename <span class="token operator">=</span> overlay_memeface<span class="token punctuation">(</span>predict_emotion<span class="token punctuation">(</span>face_image_gray<span class="token punctuation">)</span><span class="token punctuation">)</span>
    
            <span class="token keyword">print</span> filename
            meme <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span>filename<span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token comment"># meme = (meme/256).astype('uint8')</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                meme<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
            <span class="token keyword">except</span><span class="token punctuation">:</span>
                meme <span class="token operator">=</span> meme<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>meme<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> meme<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token comment"># print meme.dtype</span>
            <span class="token comment"># print meme.shape</span>
            orig_mask <span class="token operator">=</span> meme<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span>
            <span class="token comment"># print orig_mask.shape</span>
            <span class="token comment"># memegray = cv2.cvtColor(orig_mask, cv2.COLOR_BGR2GRAY)</span>
            ret1<span class="token punctuation">,</span> orig_mask <span class="token operator">=</span> cv2<span class="token punctuation">.</span>threshold<span class="token punctuation">(</span>orig_mask<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>THRESH_BINARY<span class="token punctuation">)</span>
            orig_mask_inv <span class="token operator">=</span> cv2<span class="token punctuation">.</span>bitwise_not<span class="token punctuation">(</span>orig_mask<span class="token punctuation">)</span>
            meme <span class="token operator">=</span> meme<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span>
            origMustacheHeight<span class="token punctuation">,</span> origMustacheWidth <span class="token operator">=</span> meme<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span>
    
            roi_gray <span class="token operator">=</span> img_gray<span class="token punctuation">[</span>y<span class="token punctuation">:</span>y<span class="token operator">+</span>h<span class="token punctuation">,</span> x<span class="token punctuation">:</span>x<span class="token operator">+</span>w<span class="token punctuation">]</span>
            roi_color <span class="token operator">=</span> frame<span class="token punctuation">[</span>y<span class="token punctuation">:</span>y<span class="token operator">+</span>h<span class="token punctuation">,</span> x<span class="token punctuation">:</span>x<span class="token operator">+</span>w<span class="token punctuation">]</span>
    
            <span class="token comment"># Detect a nose within the region bounded by each face (the ROI)</span>
            nose <span class="token operator">=</span> noseCascade<span class="token punctuation">.</span>detectMultiScale<span class="token punctuation">(</span>roi_gray<span class="token punctuation">)</span>
    
            <span class="token keyword">for</span> <span class="token punctuation">(</span>nx<span class="token punctuation">,</span>ny<span class="token punctuation">,</span>nw<span class="token punctuation">,</span>nh<span class="token punctuation">)</span> <span class="token keyword">in</span> nose<span class="token punctuation">:</span>
                <span class="token comment"># Un-comment the next line for debug (draw box around the nose)</span>
                <span class="token comment">#cv2.rectangle(roi_color,(nx,ny),(nx+nw,ny+nh),(255,0,0),2)</span>
    
                <span class="token comment"># The mustache should be three times the width of the nose</span>
                mustacheWidth <span class="token operator">=</span>  <span class="token number">20</span> <span class="token operator">*</span> nw
                mustacheHeight <span class="token operator">=</span> mustacheWidth <span class="token operator">*</span> origMustacheHeight <span class="token operator">/</span> origMustacheWidth
    
                <span class="token comment"># Center the mustache on the bottom of the nose</span>
                x1 <span class="token operator">=</span> nx <span class="token operator">-</span> <span class="token punctuation">(</span>mustacheWidth<span class="token operator">/</span><span class="token number">4</span><span class="token punctuation">)</span>
                x2 <span class="token operator">=</span> nx <span class="token operator">+</span> nw <span class="token operator">+</span> <span class="token punctuation">(</span>mustacheWidth<span class="token operator">/</span><span class="token number">4</span><span class="token punctuation">)</span>
                y1 <span class="token operator">=</span> ny <span class="token operator">+</span> nh <span class="token operator">-</span> <span class="token punctuation">(</span>mustacheHeight<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span>
                y2 <span class="token operator">=</span> ny <span class="token operator">+</span> nh <span class="token operator">+</span> <span class="token punctuation">(</span>mustacheHeight<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span>
    
                <span class="token comment"># Check for clipping</span>
                <span class="token keyword">if</span> x1 <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
                    x1 <span class="token operator">=</span> <span class="token number">0</span>
                <span class="token keyword">if</span> y1 <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
                    y1 <span class="token operator">=</span> <span class="token number">0</span>
                <span class="token keyword">if</span> x2 <span class="token operator">&gt;</span> w<span class="token punctuation">:</span>
                    x2 <span class="token operator">=</span> w
                <span class="token keyword">if</span> y2 <span class="token operator">&gt;</span> h<span class="token punctuation">:</span>
                    y2 <span class="token operator">=</span> h

                <span class="token comment"># Re-calculate the width and height of the mustache image</span>
                mustacheWidth <span class="token operator">=</span> <span class="token punctuation">(</span>x2 <span class="token operator">-</span> x1<span class="token punctuation">)</span>
                mustacheHeight <span class="token operator">=</span> <span class="token punctuation">(</span>y2 <span class="token operator">-</span> y1<span class="token punctuation">)</span>
    
                <span class="token comment"># Re-size the original image and the masks to the mustache sizes</span>
                <span class="token comment"># calcualted above</span>
                mustache <span class="token operator">=</span> cv2<span class="token punctuation">.</span>resize<span class="token punctuation">(</span>meme<span class="token punctuation">,</span> <span class="token punctuation">(</span>mustacheWidth<span class="token punctuation">,</span>mustacheHeight<span class="token punctuation">)</span><span class="token punctuation">,</span> interpolation <span class="token operator">=</span> cv2<span class="token punctuation">.</span>INTER_AREA<span class="token punctuation">)</span>
                mask <span class="token operator">=</span> cv2<span class="token punctuation">.</span>resize<span class="token punctuation">(</span>orig_mask<span class="token punctuation">,</span> <span class="token punctuation">(</span>mustacheWidth<span class="token punctuation">,</span>mustacheHeight<span class="token punctuation">)</span><span class="token punctuation">,</span> interpolation <span class="token operator">=</span> cv2<span class="token punctuation">.</span>INTER_AREA<span class="token punctuation">)</span>
                mask_inv <span class="token operator">=</span> cv2<span class="token punctuation">.</span>resize<span class="token punctuation">(</span>orig_mask_inv<span class="token punctuation">,</span> <span class="token punctuation">(</span>mustacheWidth<span class="token punctuation">,</span>mustacheHeight<span class="token punctuation">)</span><span class="token punctuation">,</span> interpolation <span class="token operator">=</span> cv2<span class="token punctuation">.</span>INTER_AREA<span class="token punctuation">)</span>
    
                <span class="token comment"># take ROI for mustache from background equal to size of mustache image</span>
                roi <span class="token operator">=</span> roi_color<span class="token punctuation">[</span>y1<span class="token punctuation">:</span>y2<span class="token punctuation">,</span> x1<span class="token punctuation">:</span>x2<span class="token punctuation">]</span>
    
                <span class="token comment"># roi_bg contains the original image only where the mustache is not</span>
                <span class="token comment"># in the region that is the size of the mustache.</span>
                roi_bg <span class="token operator">=</span> cv2<span class="token punctuation">.</span>bitwise_and<span class="token punctuation">(</span>roi<span class="token punctuation">,</span>roi<span class="token punctuation">,</span>mask <span class="token operator">=</span> mask_inv<span class="token punctuation">)</span>
    
                <span class="token comment"># roi_fg contains the image of the mustache only where the mustache is</span>
                roi_fg <span class="token operator">=</span> cv2<span class="token punctuation">.</span>bitwise_and<span class="token punctuation">(</span>mustache<span class="token punctuation">,</span>mustache<span class="token punctuation">,</span>mask <span class="token operator">=</span> mask<span class="token punctuation">)</span>
    
                <span class="token comment"># join the roi_bg and roi_fg</span>
                dst <span class="token operator">=</span> cv2<span class="token punctuation">.</span>add<span class="token punctuation">(</span>roi_bg<span class="token punctuation">,</span>roi_fg<span class="token punctuation">)</span>
    
                <span class="token comment"># place the joined image, saved to dst back over the original image</span>
                roi_color<span class="token punctuation">[</span>y1<span class="token punctuation">:</span>y2<span class="token punctuation">,</span> x1<span class="token punctuation">:</span>x2<span class="token punctuation">]</span> <span class="token operator">=</span> dst
    
                <span class="token keyword">break</span>
    
        <span class="token comment">#     cv2.rectangle(frame, (x, y), (x+w, y+h), (0, 255, 0), 2)</span>
        <span class="token comment">#     angry, fear, happy, sad, surprise, neutral = predict_emotion(face_image_gray)</span>
        <span class="token comment">#     text1 = 'Angry: {}     Fear: {}   Happy: {}'.format(angry, fear, happy)</span>
        <span class="token comment">#     text2 = '  Sad: {} Surprise: {} Neutral: {}'.format(sad, surprise, neutral)</span>
        <span class="token comment">#</span>
        <span class="token comment"># cv2.putText(frame, text1, (50, 50), cv2.FONT_HERSHEY_SIMPLEX, 2, (255, 0, 0), 3)</span>
        <span class="token comment"># cv2.putText(frame, text2, (50, 150), cv2.FONT_HERSHEY_SIMPLEX, 2, (255, 0, 0), 3)</span>
    
        <span class="token comment"># Display the resulting frame</span>
        cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'Video'</span><span class="token punctuation">,</span> frame<span class="token punctuation">)</span>
    
        <span class="token keyword">if</span> cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span> <span class="token operator">==</span> <span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">'q'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">break</span>
    
    <span class="token comment"># When everything is done, release the capture</span>
    video_capture<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>
    cv2<span class="token punctuation">.</span>destroyAllWindows<span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre> 
<p><strong>éœ€è¦å®Œæ•´ä»£ç ä»¥åŠå­¦é•¿è®­ç»ƒå¥½çš„æ¨¡å‹ï¼Œè”ç³»å­¦é•¿è·å–</strong></p> 
<h2><a id="4__235"></a>4 æœ€å</h2> 
<p>ğŸ§¿ <strong>æ›´å¤šèµ„æ–™, é¡¹ç›®åˆ†äº«ï¼š</strong></p> 
<p><a href="https://gitee.com/dancheng-senior/postgraduate" rel="nofollow">https://gitee.com/dancheng-senior/postgraduate</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/9534846b72d470b5ad2a8ceaf271ed03/" rel="prev">
			<span class="pager__subtitle">Â«&thinsp;Previous</span>
			<p class="pager__title">vimå¸¸ç”¨æ“ä½œ</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/33dfca04934c8c969d73abca0abae2f4/" rel="next">
			<span class="pager__subtitle">Next&thinsp;Â»</span>
			<p class="pager__title">å¤§åˆ›é¡¹ç›®æ¨è æ·±åº¦å­¦ä¹ åŠ¨ç‰©è¯†åˆ« - å·ç§¯ç¥ç»ç½‘ç»œ æœºå™¨è§†è§‰ å›¾åƒè¯†åˆ«</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 èœé¸Ÿç¨‹åºå‘˜åšå®¢.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>